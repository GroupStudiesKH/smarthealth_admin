import{_ as V,r as d,i as E,p as T,u as B,j as g,o as n,c as o,b as t,k as y,e as w,g as L,v as D,F as v,f,y as M,a as Q,t as r,l as U,n as j}from"./index-9b074a86.js";import{F as z,N as O,_ as R,a as S}from"./sidebar-9d2c40e1.js";const I={components:{Footer:z,Navbar:O,Sidebar:R},setup(){const u=d([]),s=d(!0),C=d([]),a=async()=>{try{const l=await S.getTagsOption("category");C.value=l}catch(l){console.error("獲取分類失敗:",l)}};E(()=>{e(),a()});const x=async()=>{s.value=!0,await e(),s.value=!1},k=T();B();const m=d(""),b=d(""),h=d(""),p=d([{label:"已上架",value:"publish"},{label:"未上架",value:"draft"},{label:"審核中",value:"pending"}]),e=async()=>{try{const l={category_id:b.value,status:h.value,search:m.value,pageSize:99},_=await S.getCourses(l);u.value=_.courses.map(i=>{var F;return{id:i.id,title:i.title,tags:i.tags,category:i.categories[0]||"",instructor:i.instructors.join(","),status_raw:i.status,status:((F=p.value.find(N=>N.value===i.status))==null?void 0:F.label)||i.status,publishDate:new Date(i.created_at).toISOString().split("T")[0]}})}catch(l){console.error("获取课程失败:",l)}finally{s.value=!1}};return{courses:u,router:k,searchQuery:m,selectedCategory:b,selectedStatus:h,statuses:p,handleFilter:x,handleEdit:l=>{k.push(`/course/edit/${l}`)},handleDelete:async l=>{if(confirm("確定要刪除此課程嗎？")){s.value=!0;try{await S.delCourse(l),u.value=u.value.filter(_=>_.id!==l)}catch(_){alert(`刪除失敗: ${_.message}`)}finally{s.value=!1}}},loading:s,categories:C}}},q={class:"main-wrapper"},A={class:"page-wrapper"},G={class:"page-content"},H={class:"row mb-3"},J={class:"col-md-12"},K={class:"card"},P={class:"card-body"},W={class:"row align-items-center"},X={class:"col-md-3"},Y={class:"col-md-3"},Z=["value"],$={class:"col-md-2"},tt=["value"],et={class:"col-md-4"},st=["disabled"],at={class:"row"},lt={class:"col-md-12 grid-margin stretch-card"},nt={class:"card"},ot={class:"card-body"},it={class:"table-responsive"},rt={class:"table table-hover"},dt=["onClick"],ct=["onClick"],ut=["onClick"],_t={key:0,class:"loading-overlay"};function vt(u,s,C,a,x,k){const m=g("Sidebar"),b=g("Navbar"),h=g("router-link"),p=g("Footer");return n(),o(v,null,[t("div",q,[y(m),t("div",A,[y(b),t("div",G,[t("div",H,[t("div",J,[t("div",K,[t("div",P,[t("div",W,[t("div",X,[w(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=e=>a.searchQuery=e),placeholder:"搜尋課程名稱或講師"},null,512),[[L,a.searchQuery]])]),t("div",Y,[w(t("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=e=>a.selectedCategory=e)},[s[4]||(s[4]=t("option",{value:""},"所有分類",-1)),(n(!0),o(v,null,f(a.categories,e=>(n(),o("option",{key:e.id,value:e.id},r(e.name),9,Z))),128))],512),[[D,a.selectedCategory]])]),t("div",$,[w(t("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=e=>a.selectedStatus=e)},[s[5]||(s[5]=t("option",{value:""},"所有狀態",-1)),(n(!0),o(v,null,f(a.statuses,e=>(n(),o("option",{key:e.value,value:e.value},r(e.label),9,tt))),128))],512),[[D,a.selectedStatus]])]),t("div",et,[t("button",{class:"btn btn-primary mx-2",onClick:s[3]||(s[3]=(...e)=>a.handleFilter&&a.handleFilter(...e)),disabled:a.loading}," 篩選 ",8,st),y(h,{to:"/course/add",class:"btn btn-secondary"},{default:M(()=>s[6]||(s[6]=[U(" 新增課程 ")])),_:1})])])])])])]),t("div",at,[t("div",lt,[t("div",nt,[t("div",ot,[t("div",it,[t("table",rt,[s[7]||(s[7]=t("thead",null,[t("tr",null,[t("th",null,"課程名稱"),t("th",null,"上架時間"),t("th",null,"講師"),t("th",null,"分類"),t("th",null,"標籤"),t("th",null,"狀態"),t("th",null,"操作")])],-1)),t("tbody",null,[(n(!0),o(v,null,f(a.courses,e=>(n(),o("tr",{key:e.id},[t("td",null,r(e.title),1),t("td",null,r(e.publishDate),1),t("td",null,r(e.instructor),1),t("td",null,r(e.category),1),t("td",null,[(n(!0),o(v,null,f(e.tags,c=>(n(),o("span",{key:c,class:"badge bg-primary me-1"},r(c),1))),128))]),t("td",null,[t("span",{class:j(["badge",{"bg-success":e.status==="已上架","bg-warning":e.status==="審核中","bg-secondary":e.status==="未上架"}])},r(e.status),3)]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:c=>a.handleEdit(e.id)}," 編輯 ",8,dt),t("button",{class:"btn btn-sm btn-outline-info me-2",onClick:c=>a.router.push(`/course/${e.id}/chapters`)}," 章節管理 ",8,ct),t("button",{class:"btn btn-sm btn-outline-danger",onClick:c=>a.handleDelete(e.id)}," 刪除 ",8,ut)])]))),128))])])])])])])])]),y(p)])]),a.loading?(n(),o("div",_t,s[8]||(s[8]=[t("div",{class:"loading-spinner"},[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"載入中...")]),t("div",{class:"mt-2"},"載入中...")],-1)]))):Q("",!0)],64)}const pt=V(I,[["render",vt],["__scopeId","data-v-184430f4"]]);export{pt as default};
