import{_ as R,r as i,w as N,o as r,c,a as w,b as t,t as p,d as T,e as M,v as D,F as g,f as q,g as U,n as S,h as G,u as J,i as K,j as W,k as F,l as A,m as I,p as H}from"./index-fd32de25.js";import{F as X,N as Y,_ as Z}from"./sidebar-00f7f4b6.js";import{a as P}from"./api-service-a37f4a4e.js";import{L as $}from"./loading-40382ee7.js";const tt={name:"QuestionModal",props:{show:{type:Boolean,required:!0},questionID:{type:String,required:!0},chapterOptions:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!1}},emits:["update:show","save"],setup(b,{emit:o}){const l=i({id:"",chapter_id:"",question:"",type:"true_false",note:"",options:[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]}),e=i("true_false"),Q=i(b.chapterOptions),y=i(b.questionID);N(()=>b.questionID,a=>{y.value=a,a?s(a):l.value={id:"",chapter_id:"",question:"",type:"true_false",note:"",options:[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]}}),N(()=>b.show,a=>{a&&!b.isEdit&&(l.value={id:"",chapter_id:"",question:"",type:"true_false",note:"",options:[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]},e.value="true_false")});const n={true_false:"是非題",single_choice:"單選題",multiple_choice:"多選題"},u=i(!1),v=i(""),C=i({}),h=a=>{v.value=a,u.value=!0},s=async a=>{try{l.value={id:"",chapter_id:"",question:"",type:"true_false",note:"",options:[]};const m=await P.getQuestion(a);l.value=m,e.value=m.type}catch{h("獲取題目失敗")}};N(()=>e.value,a=>{a==="true_false"?l.value.options=[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]:a!==l.value.type&&(l.value.options=[]),l.value.type=a});const k=a=>{l.value.type==="true_false"||l.value.type==="single_choice"?l.value.options.forEach((m,f)=>{m.is_correct=f===a}):l.value.options[a].is_correct=!l.value.options[a].is_correct},x=()=>{l.value.options.push({option_text:"",option_index:l.value.options.length,is_correct:!1})},O=a=>{l.value.options.splice(a,1),l.value.options.forEach((m,f)=>{m.option_index=f})},j=(a,m)=>{l.value.options[a].option_text=m},L=()=>{o("update:show",!1)};return{questionForm:l,questionTypes:n,chapterOptions:Q,addOption:x,removeOption:O,updateOption:j,closeModal:L,saveQuestion:async()=>{var a,m;try{b.isEdit?await P.updateQuestion(y.value,l.value):await P.addQuestion(l.value),o("save",l.value),L()}catch(f){if(((m=(a=f.response)==null?void 0:a.data)==null?void 0:m.status)==="error")if(f.response.data.content){const V={};for(const[_,d]of Object.entries(f.response.data.content))V[_]=Array.isArray(d)?d[0].replace(/[\[\]"]/g,""):d;C.value=V;const B=Object.values(V).join("<br/>");h("更新失敗："+(B||"未知錯誤"))}else h("更新失敗："+(f.response.data.message||"儲存失敗"));else h("儲存失敗")}},questionType:e,setAnswer:k,showModal:u,modalMessage:v,showErrorModal:h}}},et={key:0,class:"modal-backdrop fade show"},ot={key:1,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-hidden":"true"},st={class:"modal-dialog modal-lg",role:"document"},nt={class:"modal-content"},lt={class:"modal-header"},at={class:"modal-title"},it={class:"modal-body"},rt={class:"mb-3"},dt=["value"],ct={class:"mb-3"},ut=["value"],mt={class:"mb-3"},_t={class:"mb-3"},pt={class:"options-container"},vt={class:"form-check flex-grow-1"},ft=["type","checked","onChange"],bt=["onUpdate:modelValue","placeholder","onInput"],ht=["onClick"],yt={class:"mb-3"},gt={class:"modal-footer"},kt={class:"modal-dialog"},xt={class:"modal-content"},wt={class:"modal-header"},Mt=["innerHTML"],Qt={class:"modal-footer"},Ct={key:2,class:"modal-backdrop fade show"};function qt(b,o,l,e,Q,y){return r(),c(g,null,[l.show?(r(),c("div",et)):w("",!0),l.show?(r(),c("div",ot,[t("div",st,[t("div",nt,[t("div",lt,[t("h5",at,p(l.isEdit?"編輯題目":"新增題目"),1),t("button",{type:"button",class:"btn-close",onClick:o[0]||(o[0]=(...n)=>e.closeModal&&e.closeModal(...n))})]),t("div",it,[t("form",{onSubmit:o[7]||(o[7]=T((...n)=>e.saveQuestion&&e.saveQuestion(...n),["prevent"]))},[t("div",rt,[o[10]||(o[10]=t("label",{class:"form-label"},"題型",-1)),M(t("select",{class:"form-select","onUpdate:modelValue":o[1]||(o[1]=n=>e.questionType=n)},[(r(!0),c(g,null,q(e.questionTypes,(n,u)=>(r(),c("option",{key:u,value:u},p(n),9,dt))),128))],512),[[D,e.questionType]])]),t("div",ct,[o[12]||(o[12]=t("label",{class:"form-label"},"所屬範圍",-1)),M(t("select",{class:"form-select","onUpdate:modelValue":o[2]||(o[2]=n=>e.questionForm.chapter_id=n),required:""},[o[11]||(o[11]=t("option",{value:""},"請選擇章節/考試範圍",-1)),(r(!0),c(g,null,q(e.chapterOptions,n=>(r(),c("option",{key:n.id,value:n.id},p(n.title),9,ut))),128))],512),[[D,e.questionForm.chapter_id]])]),t("div",mt,[o[13]||(o[13]=t("label",{class:"form-label"},"題目內容",-1)),M(t("textarea",{class:"form-control","onUpdate:modelValue":o[3]||(o[3]=n=>e.questionForm.question=n),rows:"3",required:""},null,512),[[U,e.questionForm.question]])]),t("div",_t,[o[14]||(o[14]=t("label",{class:"form-label"},"選項與答案",-1)),t("div",pt,[(r(!0),c(g,null,q(e.questionForm.options,(n,u)=>(r(),c("div",{key:u,class:"option-item mb-2 d-flex align-items-center"},[t("div",vt,[t("input",{type:e.questionForm.type==="multiple_choice"?"checkbox":"radio",name:"answer",class:"form-check-input",checked:n.is_correct,onChange:v=>e.setAnswer(u)},null,40,ft),M(t("input",{type:"text",class:"form-control d-inline-block ms-2",style:{width:"calc(100% - 30px)"},"onUpdate:modelValue":v=>n.option_text=v,placeholder:"選項"+(u+1),onInput:v=>e.updateOption(u,v.target.value)},null,40,bt),[[U,n.option_text]])]),e.questionForm.type!=="true_false"&&e.questionForm.options.length>1?(r(),c("button",{key:0,type:"button",class:"btn btn-outline-danger btn-sm ms-2",onClick:v=>e.removeOption(u)}," 刪除 ",8,ht)):w("",!0)]))),128))]),e.questionForm.type!=="true_false"?(r(),c("button",{key:0,type:"button",class:"btn btn-outline-primary btn-sm mt-2",onClick:o[4]||(o[4]=(...n)=>e.addOption&&e.addOption(...n))}," 新增選項 ")):w("",!0)]),t("div",yt,[o[15]||(o[15]=t("label",{class:"form-label"},"備註",-1)),M(t("textarea",{class:"form-control","onUpdate:modelValue":o[5]||(o[5]=n=>e.questionForm.note=n),rows:"2"},null,512),[[U,e.questionForm.note]])]),t("div",gt,[t("button",{type:"button",class:"btn btn-secondary",onClick:o[6]||(o[6]=(...n)=>e.closeModal&&e.closeModal(...n))}," 取消 "),o[16]||(o[16]=t("button",{type:"submit",class:"btn btn-primary"},"保存",-1))])],32)])])])])):w("",!0),t("div",{class:S(["modal fade",{show:e.showModal}]),tabindex:"-1",style:G({display:e.showModal?"block":"none"})},[t("div",kt,[t("div",xt,[t("div",wt,[o[17]||(o[17]=t("h5",{class:"modal-title"},"錯誤提示",-1)),t("button",{type:"button",class:"btn-close",onClick:o[8]||(o[8]=n=>e.showModal=!1)})]),t("div",{class:"modal-body",innerHTML:e.modalMessage},null,8,Mt),t("div",Qt,[t("button",{type:"button",class:"btn btn-secondary",onClick:o[9]||(o[9]=n=>e.showModal=!1)}," 關閉 ")])])])],6),e.showModal?(r(),c("div",Ct)):w("",!0)],64)}const Ot=R(tt,[["render",qt],["__scopeId","data-v-fc0b6daf"]]);const Et={components:{Footer:X,Navbar:Y,Sidebar:Z,QuestionModal:Ot,Loading:$},setup(){const b=J(),o=K(),l=b.params.id,e=i(""),Q=i(""),y=i(1),n=i(10),u=i(0),v=i(10),C=i([]),h=i([]),s=i(!1),k=i({id:"",title:""}),x=i([]),O=async()=>{try{const _={course_id:l,chapter_id:Q.value,status:"",search:e.value,page:y.value,pageSize:n.value};s.value=!0;const d=await P.getQuestionLists(_);s.value=!1,C.value=[{id:"",title:"全部"},...d.chapterLists],h.value=d.chapterLists,x.value=d.questions,k.value=d.course,u.value=d.total,v.value=d.totalPages}catch(_){console.error("獲取題目列表失敗：",_)}},j=()=>{o.push("/exam/statistics")};N([y],()=>{O()}),W(()=>{O()});const L=_=>{var d;return _.type==="true_false"?(d=_.correctOptions[0])==null?void 0:d.option_text:_.correctOptions.map(E=>E.option_text).join(", ")},z=async _=>{try{if(confirm("確定要刪除此題目嗎？")){const d=x.value.findIndex(E=>E.id===_);d!==-1&&x.value.splice(d,1),s.value=!0,await P.delQuestion(_),s.value=!1}}catch(d){console.error("刪除題目失敗：",d)}},a=i(!1),m=i(null),f=i(!1);return{questions:x,searchQuery:e,selectedChapter:Q,currentPage:y,pageSize:n,total:u,totalPages:v,formatAnswer:L,deleteQuestion:z,editQuestion:async _=>{x.value.find(E=>E.id===_)&&(f.value=!0,a.value=!0,m.value=_)},addQuestion:()=>{f.value=!1,a.value=!0,m.value=null},showQuestionModal:a,questionID:m,isEditMode:f,chapterOptions:C,chapterModalOptions:h,fetchQuestions:O,loading:s,backToExamList:j,course:k}}},Ft={class:"main-wrapper"},St={class:"page-wrapper"},Pt={class:"page-content"},Lt={class:"row"},Vt={class:"col-md-12 grid-margin stretch-card"},It={class:"card"},Nt={class:"card-body"},Tt={class:"d-flex justify-content-between align-items-center mb-4"},Ut={class:"card-title mb-0"},jt={class:"d-flex gap-2"},At={class:"row mb-3"},Dt={class:"col-md-5"},zt={class:"col-md-5"},Bt=["value"],Ht={class:"col-md-2"},Rt={class:"table-responsive"},Gt={class:"table table-hover"},Jt=["onClick"],Kt=["onClick"],Wt={class:"d-flex justify-content-between align-items-center mt-4"},Xt={class:"text-muted"},Yt={class:"pagination mb-0"},Zt=["onClick"];function $t(b,o,l,e,Q,y){const n=F("Sidebar"),u=F("Navbar"),v=F("Footer"),C=F("QuestionModal"),h=F("Loading");return r(),c(g,null,[t("div",Ft,[A(n),t("div",St,[A(u),t("div",Pt,[t("div",Lt,[t("div",Vt,[t("div",It,[t("div",Nt,[t("div",Tt,[t("h6",Ut,p(e.course.title)+" 題目管理",1),t("div",jt,[t("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=(...s)=>e.addQuestion&&e.addQuestion(...s))},o[8]||(o[8]=[t("i",{class:"material-icons align-middle me-1"},"add",-1),I(" 新增題目 ")])),t("button",{type:"button",class:"btn btn-secondary",onClick:o[1]||(o[1]=(...s)=>e.backToExamList&&e.backToExamList(...s))},o[9]||(o[9]=[t("i",{class:"link-icon","data-feather":"plus"},null,-1),I(" 返回測驗課程列表 ")]))])]),t("div",At,[t("div",Dt,[M(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>e.searchQuery=s),placeholder:"搜尋題目內容或答案..."},null,512),[[U,e.searchQuery]])]),t("div",zt,[M(t("select",{class:"form-select","onUpdate:modelValue":o[3]||(o[3]=s=>e.selectedChapter=s)},[(r(!0),c(g,null,q(e.chapterOptions,s=>(r(),c("option",{key:s.id,value:s.id},p(s.title),9,Bt))),128))],512),[[D,e.selectedChapter]])]),t("div",Ht,[t("button",{class:"btn btn-primary",onClick:o[4]||(o[4]=(...s)=>e.fetchQuestions&&e.fetchQuestions(...s))}," 搜尋 ")])]),t("div",Rt,[t("table",Gt,[o[12]||(o[12]=t("thead",null,[t("tr",null,[t("th",null,"題型"),t("th",null,"題目內容"),t("th",null,"答案"),t("th",null,"註解"),t("th",null,"所屬章節/考試"),t("th",null,"操作")])],-1)),t("tbody",null,[(r(!0),c(g,null,q(e.questions,s=>(r(),c("tr",{key:s.id},[t("td",null,[t("span",{class:S(["badge",{"bg-primary":s.type==="single_choice","bg-success":s.type==="multiple_choice","bg-info":s.type==="true_false"}])},p(s.type==="true_false"?"是非題":s.type==="single_choice"?"單選題":s.type==="multiple_choice"?"多選題":s.type),3)]),t("td",null,p(s.question),1),t("td",null,p(e.formatAnswer(s)),1),t("td",null,p(s.note),1),t("td",null,p(s.chapterName),1),t("td",null,[t("button",{class:"btn btn-primary btn-sm me-2",onClick:k=>e.editQuestion(s.id)},o[10]||(o[10]=[t("i",{class:"material-icons align-middle"},"edit",-1),I(" 編輯 ")]),8,Jt),t("button",{class:"btn btn-danger btn-sm",onClick:k=>e.deleteQuestion(s.id)},o[11]||(o[11]=[t("i",{class:"material-icons align-middle"},"delete",-1),I(" 刪除 ")]),8,Kt)])]))),128))])])]),t("div",Wt,[t("div",Xt," 顯示 "+p((e.currentPage-1)*e.pageSize+1)+" 到 "+p(Math.min(e.currentPage*e.pageSize,e.total))+" 筆，共 "+p(e.total)+" 筆 ",1),t("nav",null,[t("ul",Yt,[t("li",{class:S(["page-item",{disabled:e.currentPage===1}])},[t("a",{class:"page-link",href:"#",onClick:o[5]||(o[5]=T(s=>e.currentPage--,["prevent"])),"aria-label":"Previous"},o[13]||(o[13]=[t("span",{"aria-hidden":"true"},"«",-1)]))],2),(r(!0),c(g,null,q(e.totalPages,s=>(r(),c("li",{key:s,class:S(["page-item",{active:s===e.currentPage}])},[t("a",{class:"page-link",href:"#",onClick:T(k=>e.currentPage=s,["prevent"])},p(s),9,Zt)],2))),128)),t("li",{class:S(["page-item",{disabled:e.currentPage===e.totalPages}])},[t("a",{class:"page-link",href:"#",onClick:o[6]||(o[6]=T(s=>e.currentPage++,["prevent"])),"aria-label":"Next"},o[14]||(o[14]=[t("span",{"aria-hidden":"true"},"»",-1)]))],2)])])])])])])])]),A(v),e.chapterModalOptions.length>0?(r(),H(C,{key:0,show:e.showQuestionModal,"onUpdate:show":o[7]||(o[7]=s=>e.showQuestionModal=s),questionID:e.questionID,chapterOptions:e.chapterModalOptions,isEdit:e.isEditMode,onSave:e.fetchQuestions},null,8,["show","questionID","chapterOptions","isEdit","onSave"])):w("",!0)])]),e.loading?(r(),H(h,{key:0})):w("",!0)],64)}const ne=R(Et,[["render",$t],["__scopeId","data-v-8c070d7e"]]);export{ne as default};
