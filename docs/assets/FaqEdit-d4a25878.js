import{_ as E,u as S,i as U,r as n,j as N,k as p,o as f,c as k,b as e,l as h,t as P,e as y,g as q,v as H,n as V,h as T,a as M,p as j,F as B}from"./index-c34474c4.js";import{F as Q,N as D,_ as R}from"./sidebar-01ba7568.js";import{a as F}from"./api-service-a37f4a4e.js";import{C as z,U as O}from"./UploadAdapter-52c461d9.js";import{L as G}from"./loading-5656bda6.js";const J={components:{Footer:Q,Navbar:D,Sidebar:R,Loading:G},setup(){const c=S(),o=U(),w=n([]),a=n(!1),l=n({id:null,title:"",content:"",sort:0,status:"active",type:"faq"}),_=n({}),i=n(!1),d=n(""),u=n(null),m=n(!1),t=async()=>{try{a.value=!0;const s=await F.getPost({id:c.params.id});l.value={...s},a.value=!1}catch(s){a.value=!1,console.error("Error fetching FAQ:",s),alert("獲取FAQ資料失敗，請稍後再試")}},L=async()=>{var s,v;try{if(a.value=!0,c.params.id){const r=await F.updatePost(l.value.id,l.value)}else{const r=await F.createPost(l.value)}a.value=!1,o.push({name:"faqList"})}catch(r){if(console.error("Failed to save member:",r),((v=(s=r.response)==null?void 0:s.data)==null?void 0:v.status)==="error")if(r.response.data.content){const b={};for(const[A,g]of Object.entries(r.response.data.content))b[A]=Array.isArray(g)?g[0].replace(/[\[\]"]/g,""):g;_.value=b;const C=Object.values(b).join("<br/>");d.value=C,i.value=!0}else d.value=r.response.data.message||"儲存失敗",i.value=!0;else d.value="儲存失敗",i.value=!0}};N(async()=>{c.params.id&&(await t(),m.value=!0),u.value=await z.create(document.querySelector("#editor"),{removePlugins:["Markdown"],extraPlugins:[x],toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","blockQuote","imageUpload"],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"}]}}).then(s=>(s.model.document.on("change:data",()=>{l.value.content=s.getData()}),s)).catch(s=>{console.error(s)})});function x(s){s.plugins.get("FileRepository").createUploadAdapter=v=>new O(v)}return{faqList:w,currentFaq:l,editor:u,editFaq:t,saveFaq:L,showModal:i,modalMessage:d,errors:_,isEdit:m,loading:a}}},K={class:"main-wrapper"},W={class:"page-wrapper"},X={class:"page-content"},Y={class:"row"},Z={class:"col-md-12 grid-margin stretch-card"},I={class:"card"},$={class:"card-body"},ee={class:"card-title"},oe={class:"row mb-4"},ae={class:"col-12"},se={class:"col-12 my-3"},te=["innerHTML"],ne={class:"col-6"},le={class:"col-6"},re={class:"col-12 d-flex align-items-end my-3"},ie={class:"modal-dialog"},de={class:"modal-content"},ce={class:"modal-header"},ue=["innerHTML"],me={class:"modal-footer"},ve={key:0,class:"modal-backdrop fade show"};function pe(c,o,w,a,l,_){const i=p("Navbar"),d=p("Sidebar"),u=p("Footer"),m=p("Loading");return f(),k(B,null,[e("div",K,[h(i),h(d),e("div",W,[e("div",X,[e("div",Y,[e("div",Z,[e("div",I,[e("div",$,[e("h6",ee,"FAQ "+P(a.isEdit?"管理":"新增"),1),e("div",oe,[e("div",ae,[o[6]||(o[6]=e("label",{class:"form-label"},"標題",-1)),y(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[0]||(o[0]=t=>a.currentFaq.title=t)},null,512),[[q,a.currentFaq.title]])]),e("div",se,[o[7]||(o[7]=e("label",{class:"form-label"},"內容編輯",-1)),e("div",{id:"editor",innerHTML:a.currentFaq.content},null,8,te)]),e("div",ne,[o[9]||(o[9]=e("label",{class:"form-label"},"狀態",-1)),y(e("select",{class:"form-select","onUpdate:modelValue":o[1]||(o[1]=t=>a.currentFaq.status=t)},o[8]||(o[8]=[e("option",{value:"active"},"啟用",-1),e("option",{value:"inactive"},"停用",-1)]),512),[[H,a.currentFaq.status]])]),e("div",le,[o[10]||(o[10]=e("label",{class:"form-label"},"排序",-1)),y(e("input",{type:"number",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=t=>a.currentFaq.sort=t)},null,512),[[q,a.currentFaq.sort,void 0,{number:!0}]])]),e("div",re,[e("button",{class:"btn btn-primary w-100",onClick:o[3]||(o[3]=(...t)=>a.saveFaq&&a.saveFaq(...t))}," 儲存變更 ")])])])])])]),h(u)])]),e("div",{class:V(["modal fade",{show:a.showModal}]),tabindex:"-1",style:T({display:a.showModal?"block":"none"})},[e("div",ie,[e("div",de,[e("div",ce,[o[11]||(o[11]=e("h5",{class:"modal-title"},"錯誤提示",-1)),e("button",{type:"button",class:"btn-close",onClick:o[4]||(o[4]=t=>a.showModal=!1)})]),e("div",{class:"modal-body",innerHTML:a.modalMessage},null,8,ue),e("div",me,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[5]||(o[5]=t=>a.showModal=!1)}," 關閉 ")])])])],6),a.showModal?(f(),k("div",ve)):M("",!0)]),a.loading?(f(),j(m,{key:0})):M("",!0)],64)}const ye=E(J,[["render",pe],["__scopeId","data-v-a26b70b2"]]);export{ye as default};
