import{_ as w,i as B,r as p,j as F,k as u,o as a,c as r,b as e,l as k,e as M,g as P,d as D,F as _,f as y,t as b,p as N,a as V,z as C}from"./index-a7a449ec.js";import{F as E,N as j,_ as O,a as U}from"./sidebar-071cb7ef.js";import{L as A}from"./loading-6fc6d92d.js";const q={components:{Footer:E,Navbar:j,Sidebar:O,Loading:A},setup(){const g=B(),i=p({name:"",permissions:{}}),d=p({}),s=p(!1),v=p({}),x=async()=>{try{const t={courseManagement:{title:"課程管理",list:{"course-management":{title:"課程管理",permissions:["list","create","edit","del"]},"course-list":{title:"課程列表",permissions:["list","create","edit","del"]},"course-category":{title:"分類管理",permissions:["list","create","edit","del"]},"course-tag":{title:"標籤管理",permissions:["list","create","edit","del"]},"course-instructor":{title:"講師管理",permissions:["list","create","edit","del"]}}},memberManagement:{title:"會員管理",list:{"member-management":{title:"會員管理",permissions:["list","create","edit","del"]},"member-list":{title:"會員列表",permissions:["list","create","edit","del"]}}},statisticsManagement:{title:"課程統計",list:{"course-statistics":{title:"課程統計",permissions:["list"]},"course-progress":{title:"學習進度統計",permissions:["list"]}}},examManagement:{title:"測驗管理",list:{"exam-management":{title:"測驗管理",permissions:["list","create","edit","del"]},"exam-statistics":{title:"課程測驗列表",permissions:["list"]}}},siteSettings:{title:"網站基本設定",list:{"site-settings":{title:"網站基本設定",permissions:["list","edit"]},"site-brand":{title:"品牌設定",permissions:["list","edit"]},"site-social":{title:"社群設定",permissions:["list","edit"]}}},layoutManagement:{title:"介紹頁面管理",list:{"layout-banner-management":{title:"首頁Banner管理",permissions:["list","create","edit","del"]},"content-faq":{title:"FAQ",permissions:["edit"]},"content-about":{title:"計劃緣起",permissions:["edit"]},"content-privacy":{title:"隱私權政策",permissions:["edit"]},"content-security":{title:"資安政策",permissions:["edit"]}}},permissionManagement:{title:"權限管理",list:{permissions_group:{title:"角色管理",permissions:["list","create","edit","del"]}}}};v.value=t,i.value.permissions=Object.keys(t).reduce((m,o)=>(Object.keys(t[o].list).forEach(l=>{m[l]=[]}),m),{})}catch(t){console.error("Error fetching permission options:",t)}},h=async()=>{s.value=!0;try{d.value={},await U.addPermission(i.value)?(console.log("Permission added successfully"),g.push("/permission")):(console.error("Failed to add permission"),alert("權限新增失敗，請稍後再試。"))}catch(t){console.error("Error adding permission:",t),t.response&&t.response.data&&(d.value=t.response.data.content||{}),alert("權限新增失敗："+(t.message||"未知錯誤"))}finally{s.value=!1}},f=()=>{g.push("/permission")};return F(async()=>{await x()}),{permissionData:i,permissionStructure:v,addPermission:h,goBack:f,errors:d,isLoading:s}}},z={class:"main-wrapper"},I={class:"page-wrapper"},Q={class:"page-content"},R={class:"row"},T={class:"col-12 stretch-card"},G={class:"mb-3"},H={class:"col-12 stretch-card"},J={class:"row"},W={class:"card h-100"},X={class:"card-body"},Y={class:"mb-4"},Z={class:"mb-3"},$={class:"d-flex flex-wrap"},K=["id","value","onUpdate:modelValue"],ee=["for"],se=["disabled"],te=["disabled"];function ie(g,i,d,s,v,x){const h=u("Sidebar"),f=u("Navbar"),t=u("Footer"),m=u("Loading");return a(),r(_,null,[e("div",z,[k(h),e("div",I,[k(f),e("div",Q,[e("div",R,[e("div",T,[e("h4",G,[M(e("input",{"onUpdate:modelValue":i[0]||(i[0]=o=>s.permissionData.name=o),class:"form-control",type:"text",placeholder:"權限名稱"},null,512),[[P,s.permissionData.name]])])]),e("div",H,[e("form",{onSubmit:i[2]||(i[2]=D((...o)=>s.addPermission&&s.addPermission(...o),["prevent"]))},[e("div",J,[(a(!0),r(_,null,y(s.permissionStructure,(o,l)=>(a(),r("div",{class:"col-md-3 mb-3",key:l},[e("div",W,[e("div",X,[e("div",Y,[e("h5",Z,b(o.title),1),(a(!0),r(_,null,y(o.list,(L,c)=>(a(),r("div",{key:c,class:"mb-3"},[e("p",null,b(L.title),1),e("div",$,[(a(!0),r(_,null,y(L.permissions,n=>(a(),r("div",{key:n,class:"form-check permissionItem me-3"},[M(e("input",{class:"form-check-input",type:"checkbox",id:`${l}-${c}-${n}`,value:n,"onUpdate:modelValue":S=>s.permissionData.permissions[c]=S},null,8,K),[[C,s.permissionData.permissions[c]]]),e("label",{class:"form-check-label",for:`${l}-${c}-${n}`},b(n==="list"?"列表":n==="create"?"新增":n==="edit"?"編輯":n==="del"?"刪除":n),9,ee)]))),128))])]))),128))])])])]))),128))]),e("button",{type:"submit",class:"btn btn-primary me-2",disabled:s.isLoading},b(s.isLoading?"新增中...":"新增權限"),9,se),e("button",{type:"button",class:"btn btn-secondary",onClick:i[1]||(i[1]=(...o)=>s.goBack&&s.goBack(...o)),disabled:s.isLoading}," 返回 ",8,te)],32)])])]),k(t)])]),s.isLoading?(a(),N(m,{key:0})):V("",!0)],64)}const re=w(q,[["render",ie]]);export{re as default};
