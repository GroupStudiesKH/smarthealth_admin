import{A as Zt,B as Ke,_ as Wt,p as Jt,u as Qt,r as V,i as er,j as me,o as G,c as K,k as ve,b as _,a as Ee,l as Oe,t as tr,F as rr,f as nr,d as or,e as ke,g as Re,y as ir,C as ar}from"./index-208bfc7c.js";import{F as lr,N as ur,_ as sr,a as J}from"./sidebar-ffb56a4c.js";import{C as fr,U as cr}from"./UploadAdapter-b66d9452.js";function ne(t){"@babel/helpers - typeof";return ne=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ne(t)}function Xe(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,hr(r.key),r)}}function pr(t,e,n){return e&&Xe(t.prototype,e),n&&Xe(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function hr(t){var e=dr(t,"string");return ne(e)=="symbol"?e:e+""}function dr(t,e){if(ne(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ne(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function yr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mr(t,e,n){return e=fe(e),vr(t,ze()?Reflect.construct(e,n||[],fe(t).constructor):e.apply(t,n))}function vr(t,e){if(e&&(ne(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gr(t)}function gr(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function br(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&se(t,e)}function Te(t){var e=typeof Map=="function"?new Map:void 0;return Te=function(r){if(r===null||!wr(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,o)}function o(){return _r(r,arguments,fe(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),se(o,r)},Te(t)}function _r(t,e,n){if(ze())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&se(o,n.prototype),o}function ze(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ze=function(){return!!t})()}function wr(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function se(t,e){return se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},se(t,e)}function fe(t){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},fe(t)}var ge=function(t){function e(n){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(yr(this,e),r=mr(this,e,[n]),r.originalRequest=l,r.originalResponse=s,r.causingError=o,o!=null&&(n+=", caused by ".concat(o.toString())),l!=null){var c=l.getHeader("X-Request-ID")||"n/a",f=l.getMethod(),y=l.getURL(),v=s?s.getStatus():"n/a",m=s?s.getBody()||"":"n/a";n+=", originated from request (method: ".concat(f,", url: ").concat(y,", response code: ").concat(v,", response text: ").concat(m,", request id: ").concat(c,")")}return r.message=n,r}return br(e,t),pr(e)}(Te(Error));function ce(t){"@babel/helpers - typeof";return ce=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(t)}function Sr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ye(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xr(r.key),r)}}function Ur(t,e,n){return e&&Ye(t.prototype,e),n&&Ye(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function xr(t){var e=Pr(t,"string");return ce(e)=="symbol"?e:e+""}function Pr(t,e){if(ce(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ce(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Er=function(){function t(){Sr(this,t)}return Ur(t,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(n){return Promise.resolve([])}},{key:"removeUpload",value:function(n){return Promise.resolve()}},{key:"addUpload",value:function(n,r){return Promise.resolve(null)}}])}();const Pt="3.7.7",Or=Pt,ie=typeof Buffer=="function",Ze=typeof TextDecoder=="function"?new TextDecoder:void 0,We=typeof TextEncoder=="function"?new TextEncoder:void 0,kr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",le=Array.prototype.slice.call(kr),be=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(le),Rr=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,j=String.fromCharCode.bind(String),Je=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Et=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Ot=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),kt=t=>{let e,n,r,o,l="";const s=t.length%3;for(let c=0;c<t.length;){if((n=t.charCodeAt(c++))>255||(r=t.charCodeAt(c++))>255||(o=t.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,l+=le[e>>18&63]+le[e>>12&63]+le[e>>6&63]+le[e&63]}return s?l.slice(0,s-3)+"===".substring(s):l},Be=typeof btoa=="function"?t=>btoa(t):ie?t=>Buffer.from(t,"binary").toString("base64"):kt,Le=ie?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(j.apply(null,t.subarray(r,r+4096)));return Be(n.join(""))},_e=(t,e=!1)=>e?Et(Le(t)):Le(t),jr=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?j(192|e>>>6)+j(128|e&63):j(224|e>>>12&15)+j(128|e>>>6&63)+j(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return j(240|e>>>18&7)+j(128|e>>>12&63)+j(128|e>>>6&63)+j(128|e&63)}},Tr=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Rt=t=>t.replace(Tr,jr),Qe=ie?t=>Buffer.from(t,"utf8").toString("base64"):We?t=>Le(We.encode(t)):t=>Be(Rt(t)),re=(t,e=!1)=>e?Et(Qe(t)):Qe(t),et=t=>re(t,!0),Lr=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Cr=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return j((n>>>10)+55296)+j((n&1023)+56320);case 3:return j((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return j((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},jt=t=>t.replace(Lr,Cr),Tt=t=>{if(t=t.replace(/\s+/g,""),!Rr.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let l=0;l<t.length;)e=be[t.charAt(l++)]<<18|be[t.charAt(l++)]<<12|(r=be[t.charAt(l++)])<<6|(o=be[t.charAt(l++)]),n+=r===64?j(e>>16&255):o===64?j(e>>16&255,e>>8&255):j(e>>16&255,e>>8&255,e&255);return n},qe=typeof atob=="function"?t=>atob(Ot(t)):ie?t=>Buffer.from(t,"base64").toString("binary"):Tt,Lt=ie?t=>Je(Buffer.from(t,"base64")):t=>Je(qe(t).split("").map(e=>e.charCodeAt(0))),Ct=t=>Lt(At(t)),Ar=ie?t=>Buffer.from(t,"base64").toString("utf8"):Ze?t=>Ze.decode(Lt(t)):t=>jt(qe(t)),At=t=>Ot(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),Ce=t=>Ar(At(t)),Ir=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},It=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),Dt=function(){const t=(e,n)=>Object.defineProperty(String.prototype,e,It(n));t("fromBase64",function(){return Ce(this)}),t("toBase64",function(e){return re(this,e)}),t("toBase64URI",function(){return re(this,!0)}),t("toBase64URL",function(){return re(this,!0)}),t("toUint8Array",function(){return Ct(this)})},Ft=function(){const t=(e,n)=>Object.defineProperty(Uint8Array.prototype,e,It(n));t("toBase64",function(e){return _e(this,e)}),t("toBase64URI",function(){return _e(this,!0)}),t("toBase64URL",function(){return _e(this,!0)})},Dr=()=>{Dt(),Ft()},Fr={version:Pt,VERSION:Or,atob:qe,atobPolyfill:Tt,btoa:Be,btoaPolyfill:kt,fromBase64:Ce,toBase64:re,encode:re,encodeURI:et,encodeURL:et,utob:Rt,btou:jt,decode:Ce,isValid:Ir,fromUint8Array:_e,toUint8Array:Ct,extendString:Dt,extendUint8Array:Ft,extendBuiltins:Dr};var Nr=function(e,n){if(n=n.split(":")[0],e=+e,!e)return!1;switch(n){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},$e={},Hr=Object.prototype.hasOwnProperty,zr;function tt(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch{return null}}function rt(t){try{return encodeURIComponent(t)}catch{return null}}function Br(t){for(var e=/([^=?#&]+)=?([^&]*)/g,n={},r;r=e.exec(t);){var o=tt(r[1]),l=tt(r[2]);o===null||l===null||o in n||(n[o]=l)}return n}function qr(t,e){e=e||"";var n=[],r,o;typeof e!="string"&&(e="?");for(o in t)if(Hr.call(t,o)){if(r=t[o],!r&&(r===null||r===zr||isNaN(r))&&(r=""),o=rt(o),r=rt(r),o===null||r===null)continue;n.push(o+"="+r)}return n.length?e+n.join("&"):""}$e.stringify=qr;$e.parse=Br;var Nt=Nr,Pe=$e,$r=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,Ht=/[\n\r\t]/g,Mr=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,zt=/:\d+$/,Vr=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Gr=/^[a-zA-Z]:/;function Me(t){return(t||"").toString().replace($r,"")}var Ae=[["#","hash"],["?","query"],function(e,n){return H(n.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],nt={hash:1,query:1};function Bt(t){var e;typeof window<"u"?e=window:typeof Ke<"u"?e=Ke:typeof self<"u"?e=self:e={};var n=e.location||{};t=t||n;var r={},o=typeof t,l;if(t.protocol==="blob:")r=new z(unescape(t.pathname),{});else if(o==="string"){r=new z(t,{});for(l in nt)delete r[l]}else if(o==="object"){for(l in t)l in nt||(r[l]=t[l]);r.slashes===void 0&&(r.slashes=Mr.test(t.href))}return r}function H(t){return t==="file:"||t==="ftp:"||t==="http:"||t==="https:"||t==="ws:"||t==="wss:"}function qt(t,e){t=Me(t),t=t.replace(Ht,""),e=e||{};var n=Vr.exec(t),r=n[1]?n[1].toLowerCase():"",o=!!n[2],l=!!n[3],s=0,c;return o?l?(c=n[2]+n[3]+n[4],s=n[2].length+n[3].length):(c=n[2]+n[4],s=n[2].length):l?(c=n[3]+n[4],s=n[3].length):c=n[4],r==="file:"?s>=2&&(c=c.slice(2)):H(r)?c=n[4]:r?o&&(c=c.slice(2)):s>=2&&H(e.protocol)&&(c=n[4]),{protocol:r,slashes:o||H(r),slashesCount:s,rest:c}}function Kr(t,e){if(t==="")return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,o=n[r-1],l=!1,s=0;r--;)n[r]==="."?n.splice(r,1):n[r]===".."?(n.splice(r,1),s++):s&&(r===0&&(l=!0),n.splice(r,1),s--);return l&&n.unshift(""),(o==="."||o==="..")&&n.push(""),n.join("/")}function z(t,e,n){if(t=Me(t),t=t.replace(Ht,""),!(this instanceof z))return new z(t,e,n);var r,o,l,s,c,f,y=Ae.slice(),v=typeof e,m=this,E=0;for(v!=="object"&&v!=="string"&&(n=e,e=null),n&&typeof n!="function"&&(n=Pe.parse),e=Bt(e),o=qt(t||"",e),r=!o.protocol&&!o.slashes,m.slashes=o.slashes||r&&e.slashes,m.protocol=o.protocol||e.protocol||"",t=o.rest,(o.protocol==="file:"&&(o.slashesCount!==2||Gr.test(t))||!o.slashes&&(o.protocol||o.slashesCount<2||!H(m.protocol)))&&(y[3]=[/(.*)/,"pathname"]);E<y.length;E++){if(s=y[E],typeof s=="function"){t=s(t,m);continue}l=s[0],f=s[1],l!==l?m[f]=t:typeof l=="string"?(c=l==="@"?t.lastIndexOf(l):t.indexOf(l),~c&&(typeof s[2]=="number"?(m[f]=t.slice(0,c),t=t.slice(c+s[2])):(m[f]=t.slice(c),t=t.slice(0,c)))):(c=l.exec(t))&&(m[f]=c[1],t=t.slice(0,c.index)),m[f]=m[f]||r&&s[3]&&e[f]||"",s[4]&&(m[f]=m[f].toLowerCase())}n&&(m.query=n(m.query)),r&&e.slashes&&m.pathname.charAt(0)!=="/"&&(m.pathname!==""||e.pathname!=="")&&(m.pathname=Kr(m.pathname,e.pathname)),m.pathname.charAt(0)!=="/"&&H(m.protocol)&&(m.pathname="/"+m.pathname),Nt(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(c=m.auth.indexOf(":"),~c?(m.username=m.auth.slice(0,c),m.username=encodeURIComponent(decodeURIComponent(m.username)),m.password=m.auth.slice(c+1),m.password=encodeURIComponent(decodeURIComponent(m.password))):m.username=encodeURIComponent(decodeURIComponent(m.auth)),m.auth=m.password?m.username+":"+m.password:m.username),m.origin=m.protocol!=="file:"&&H(m.protocol)&&m.host?m.protocol+"//"+m.host:"null",m.href=m.toString()}function Xr(t,e,n){var r=this;switch(t){case"query":typeof e=="string"&&e.length&&(e=(n||Pe.parse)(e)),r[t]=e;break;case"port":r[t]=e,Nt(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[t]="");break;case"hostname":r[t]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[t]=e,zt.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!n;break;case"pathname":case"hash":if(e){var o=t==="pathname"?"/":"#";r[t]=e.charAt(0)!==o?o+e:e}else r[t]=e;break;case"username":case"password":r[t]=encodeURIComponent(e);break;case"auth":var l=e.indexOf(":");~l?(r.username=e.slice(0,l),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(l+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var s=0;s<Ae.length;s++){var c=Ae[s];c[4]&&(r[c[1]]=r[c[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&H(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function Yr(t){(!t||typeof t!="function")&&(t=Pe.stringify);var e,n=this,r=n.host,o=n.protocol;o&&o.charAt(o.length-1)!==":"&&(o+=":");var l=o+(n.protocol&&n.slashes||H(n.protocol)?"//":"");return n.username?(l+=n.username,n.password&&(l+=":"+n.password),l+="@"):n.password?(l+=":"+n.password,l+="@"):n.protocol!=="file:"&&H(n.protocol)&&!r&&n.pathname!=="/"&&(l+="@"),(r[r.length-1]===":"||zt.test(n.hostname)&&!n.port)&&(r+=":"),l+=r+n.pathname,e=typeof n.query=="object"?t(n.query):n.query,e&&(l+=e.charAt(0)!=="?"?"?"+e:e),n.hash&&(l+=n.hash),l}z.prototype={set:Xr,toString:Yr};z.extractProtocol=qt;z.location=Bt;z.trimLeft=Me;z.qs=Pe;var Zr=z;const Wr=Zt(Zr);function Jr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,n=t==="x"?e:e&3|8;return n.toString(16)})}function Ie(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ie=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(u,i,a){u[i]=a.value},l=typeof Symbol=="function"?Symbol:{},s=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",f=l.toStringTag||"@@toStringTag";function y(u,i,a){return Object.defineProperty(u,i,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[i]}try{y({},"")}catch{y=function(a,p,d){return a[p]=d}}function v(u,i,a,p){var d=i&&i.prototype instanceof T?i:T,h=Object.create(d.prototype),b=new M(p||[]);return o(h,"_invoke",{value:N(u,a,b)}),h}function m(u,i,a){try{return{type:"normal",arg:u.call(i,a)}}catch(p){return{type:"throw",arg:p}}}e.wrap=v;var E="suspendedStart",X="suspendedYield",B="executing",I="completed",x={};function T(){}function O(){}function k(){}var A={};y(A,s,function(){return this});var q=Object.getPrototypeOf,F=q&&q(q(Y([])));F&&F!==n&&r.call(F,s)&&(A=F);var g=k.prototype=T.prototype=Object.create(A);function P(u){["next","throw","return"].forEach(function(i){y(u,i,function(a){return this._invoke(i,a)})})}function U(u,i){function a(d,h,b,w){var S=m(u[d],u,h);if(S.type!=="throw"){var L=S.arg,R=L.value;return R&&Z(R)=="object"&&r.call(R,"__await")?i.resolve(R.__await).then(function(C){a("next",C,b,w)},function(C){a("throw",C,b,w)}):i.resolve(R).then(function(C){L.value=C,b(L)},function(C){return a("throw",C,b,w)})}w(S.arg)}var p;o(this,"_invoke",{value:function(h,b){function w(){return new i(function(S,L){a(h,b,S,L)})}return p=p?p.then(w,w):w()}})}function N(u,i,a){var p=E;return function(d,h){if(p===B)throw Error("Generator is already running");if(p===I){if(d==="throw")throw h;return{value:t,done:!0}}for(a.method=d,a.arg=h;;){var b=a.delegate;if(b){var w=D(b,a);if(w){if(w===x)continue;return w}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(p===E)throw p=I,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);p=B;var S=m(u,i,a);if(S.type==="normal"){if(p=a.done?I:X,S.arg===x)continue;return{value:S.arg,done:a.done}}S.type==="throw"&&(p=I,a.method="throw",a.arg=S.arg)}}}function D(u,i){var a=i.method,p=u.iterator[a];if(p===t)return i.delegate=null,a==="throw"&&u.iterator.return&&(i.method="return",i.arg=t,D(u,i),i.method==="throw")||a!=="return"&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+a+"' method")),x;var d=m(p,u.iterator,i.arg);if(d.type==="throw")return i.method="throw",i.arg=d.arg,i.delegate=null,x;var h=d.arg;return h?h.done?(i[u.resultName]=h.value,i.next=u.nextLoc,i.method!=="return"&&(i.method="next",i.arg=t),i.delegate=null,x):h:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,x)}function ae(u){var i={tryLoc:u[0]};1 in u&&(i.catchLoc=u[1]),2 in u&&(i.finallyLoc=u[2],i.afterLoc=u[3]),this.tryEntries.push(i)}function $(u){var i=u.completion||{};i.type="normal",delete i.arg,u.completion=i}function M(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(ae,this),this.reset(!0)}function Y(u){if(u||u===""){var i=u[s];if(i)return i.call(u);if(typeof u.next=="function")return u;if(!isNaN(u.length)){var a=-1,p=function d(){for(;++a<u.length;)if(r.call(u,a))return d.value=u[a],d.done=!1,d;return d.value=t,d.done=!0,d};return p.next=p}}throw new TypeError(Z(u)+" is not iterable")}return O.prototype=k,o(g,"constructor",{value:k,configurable:!0}),o(k,"constructor",{value:O,configurable:!0}),O.displayName=y(k,f,"GeneratorFunction"),e.isGeneratorFunction=function(u){var i=typeof u=="function"&&u.constructor;return!!i&&(i===O||(i.displayName||i.name)==="GeneratorFunction")},e.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,k):(u.__proto__=k,y(u,f,"GeneratorFunction")),u.prototype=Object.create(g),u},e.awrap=function(u){return{__await:u}},P(U.prototype),y(U.prototype,c,function(){return this}),e.AsyncIterator=U,e.async=function(u,i,a,p,d){d===void 0&&(d=Promise);var h=new U(v(u,i,a,p),d);return e.isGeneratorFunction(i)?h:h.next().then(function(b){return b.done?b.value:h.next()})},P(g),y(g,f,"Generator"),y(g,s,function(){return this}),y(g,"toString",function(){return"[object Generator]"}),e.keys=function(u){var i=Object(u),a=[];for(var p in i)a.push(p);return a.reverse(),function d(){for(;a.length;){var h=a.pop();if(h in i)return d.value=h,d.done=!1,d}return d.done=!0,d}},e.values=Y,M.prototype={constructor:M,reset:function(i){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach($),!i)for(var a in this)a.charAt(0)==="t"&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=t)},stop:function(){this.done=!0;var i=this.tryEntries[0].completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var a=this;function p(L,R){return b.type="throw",b.arg=i,a.next=L,R&&(a.method="next",a.arg=t),!!R}for(var d=this.tryEntries.length-1;d>=0;--d){var h=this.tryEntries[d],b=h.completion;if(h.tryLoc==="root")return p("end");if(h.tryLoc<=this.prev){var w=r.call(h,"catchLoc"),S=r.call(h,"finallyLoc");if(w&&S){if(this.prev<h.catchLoc)return p(h.catchLoc,!0);if(this.prev<h.finallyLoc)return p(h.finallyLoc)}else if(w){if(this.prev<h.catchLoc)return p(h.catchLoc,!0)}else{if(!S)throw Error("try statement without catch or finally");if(this.prev<h.finallyLoc)return p(h.finallyLoc)}}}},abrupt:function(i,a){for(var p=this.tryEntries.length-1;p>=0;--p){var d=this.tryEntries[p];if(d.tryLoc<=this.prev&&r.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var h=d;break}}h&&(i==="break"||i==="continue")&&h.tryLoc<=a&&a<=h.finallyLoc&&(h=null);var b=h?h.completion:{};return b.type=i,b.arg=a,h?(this.method="next",this.next=h.finallyLoc,x):this.complete(b)},complete:function(i,a){if(i.type==="throw")throw i.arg;return i.type==="break"||i.type==="continue"?this.next=i.arg:i.type==="return"?(this.rval=this.arg=i.arg,this.method="return",this.next="end"):i.type==="normal"&&a&&(this.next=a),x},finish:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var p=this.tryEntries[a];if(p.finallyLoc===i)return this.complete(p.completion,p.afterLoc),$(p),x}},catch:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var p=this.tryEntries[a];if(p.tryLoc===i){var d=p.completion;if(d.type==="throw"){var h=d.arg;$(p)}return h}}throw Error("illegal catch attempt")},delegateYield:function(i,a,p){return this.delegate={iterator:Y(i),resultName:a,nextLoc:p},this.method==="next"&&(this.arg=t),x}},e}function ot(t,e,n,r,o,l,s){try{var c=t[l](s),f=c.value}catch(y){n(y);return}c.done?e(f):Promise.resolve(f).then(r,o)}function Qr(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var l=t.apply(e,n);function s(f){ot(l,r,o,s,c,"next",f)}function c(f){ot(l,r,o,s,c,"throw",f)}s(void 0)})}}function $t(t,e){return rn(t)||tn(t,e)||Mt(t,e)||en()}function en(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tn(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,o,l,s,c=[],f=!0,y=!1;try{if(l=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;f=!1}else for(;!(f=(r=l.call(n)).done)&&(c.push(r.value),c.length!==e);f=!0);}catch(v){y=!0,o=v}finally{try{if(!f&&n.return!=null&&(s=n.return(),Object(s)!==s))return}finally{if(y)throw o}}return c}}function rn(t){if(Array.isArray(t))return t}function Z(t){"@babel/helpers - typeof";return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(t)}function nn(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Mt(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(y){throw y},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,s=!1,c;return{s:function(){n=n.call(t)},n:function(){var y=n.next();return l=y.done,y},e:function(y){s=!0,c=y},f:function(){try{!l&&n.return!=null&&n.return()}finally{if(s)throw c}}}}function Mt(t,e){if(t){if(typeof t=="string")return it(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return it(t,e)}}function it(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function at(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function Q(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?at(Object(n),!0).forEach(function(r){on(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function on(t,e,n){return e=Vt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function an(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function lt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Vt(r.key),r)}}function ln(t,e,n){return e&&lt(t.prototype,e),n&&lt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Vt(t){var e=un(t,"string");return Z(e)=="symbol"?e:e+""}function un(t,e){if(Z(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Z(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var we="tus-v1",Se="ietf-draft-03",ue="ietf-draft-05",sn={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:Gt,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:we},Ue=function(){function t(e,n){an(this,t),"resume"in n&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=n,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return ln(t,[{key:"findPreviousUploads",value:function(){var n=this;return this.options.fingerprint(this.file,this.options).then(function(r){return n._urlStorage.findUploadsByFingerprint(r)})}},{key:"resumeFromPreviousUpload",value:function(n){this.url=n.uploadUrl||null,this._parallelUploadUrls=n.parallelUploadUrls||null,this._urlStorageKey=n.urlStorageKey}},{key:"start",value:function(){var n=this,r=this.file;if(!r){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(![we,Se,ue].includes(this.options.protocol)){this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var o=this.options.retryDelays;if(o!=null&&Object.prototype.toString.call(o)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var l=0,s=["uploadUrl","uploadSize","uploadLengthDeferred"];l<s.length;l++){var c=s[l];if(this.options[c]){this._emitError(new Error("tus: cannot use the ".concat(c," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(r,this.options).then(function(f){return n._fingerprint=f,n._source?n._source:n.options.fileReader.openFile(r,n.options.chunkSize)}).then(function(f){if(n._source=f,n.options.uploadLengthDeferred)n._size=null;else if(n.options.uploadSize!=null){if(n._size=Number(n.options.uploadSize),Number.isNaN(n._size)){n._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(n._size=n._source.size,n._size==null){n._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}n.options.parallelUploads>1||n._parallelUploadUrls!=null?n._startParallelUpload():n._startSingleUpload()}).catch(function(f){n._emitError(f)})}},{key:"_startParallelUpload",value:function(){var n,r=this,o=this._size,l=0;this._parallelUploads=[];var s=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,c=(n=this.options.parallelUploadBoundaries)!==null&&n!==void 0?n:cn(this._source.size,s);this._parallelUploadUrls&&c.forEach(function(v,m){v.uploadUrl=r._parallelUploadUrls[m]||null}),this._parallelUploadUrls=new Array(c.length);var f=c.map(function(v,m){var E=0;return r._source.slice(v.start,v.end).then(function(X){var B=X.value;return new Promise(function(I,x){var T=Q(Q({},r.options),{},{uploadUrl:v.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:r.options.metadataForPartialUploads,headers:Q(Q({},r.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:I,onError:x,onProgress:function(A){l=l-E+A,E=A,r._emitProgress(l,o)},onUploadUrlAvailable:function(){r._parallelUploadUrls[m]=O.url,r._parallelUploadUrls.filter(function(A){return!!A}).length===c.length&&r._saveUploadInUrlStorage()}}),O=new t(B,T);O.start(),r._parallelUploads.push(O)})})}),y;Promise.all(f).then(function(){y=r._openRequest("POST",r.options.endpoint),y.setHeader("Upload-Concat","final;".concat(r._parallelUploadUrls.join(" ")));var v=ut(r.options.metadata);return v!==""&&y.setHeader("Upload-Metadata",v),r._sendRequest(y,null)}).then(function(v){if(!ee(v.getStatus(),200)){r._emitHttpError(y,v,"tus: unexpected response while creating upload");return}var m=v.getHeader("Location");if(m==null){r._emitHttpError(y,v,"tus: invalid or missing Location header");return}r.url=pt(r.options.endpoint,m),"Created upload at ".concat(r.url),r._emitSuccess(v)}).catch(function(v){r._emitError(v)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(n){var r=this;if(this._parallelUploads!=null){var o=nn(this._parallelUploads),l;try{for(o.s();!(l=o.n()).done;){var s=l.value;s.abort(n)}}catch(c){o.e(c)}finally{o.f()}}return this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!n||this.url==null?Promise.resolve():t.terminate(this.url,this.options).then(function(){return r._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(n,r,o,l){this._emitError(new ge(o,l,n,r))}},{key:"_emitError",value:function(n){var r=this;if(!this._aborted){if(this.options.retryDelays!=null){var o=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(o&&(this._retryAttempt=0),ct(n,this._retryAttempt,this.options)){var l=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){r.start()},l);return}}if(typeof this.options.onError=="function")this.options.onError(n);else throw n}}},{key:"_emitSuccess",value:function(n){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess({lastResponse:n})}},{key:"_emitProgress",value:function(n,r){typeof this.options.onProgress=="function"&&this.options.onProgress(n,r)}},{key:"_emitChunkComplete",value:function(n,r,o){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(n,r,o)}},{key:"_createUpload",value:function(){var n=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var r=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?r.setHeader("Upload-Defer-Length","1"):r.setHeader("Upload-Length","".concat(this._size));var o=ut(this.options.metadata);o!==""&&r.setHeader("Upload-Metadata",o);var l;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,l=this._addChunkToRequest(r)):((this.options.protocol===Se||this.options.protocol===ue)&&r.setHeader("Upload-Complete","?0"),l=this._sendRequest(r,null)),l.then(function(s){if(!ee(s.getStatus(),200)){n._emitHttpError(r,s,"tus: unexpected response while creating upload");return}var c=s.getHeader("Location");if(c==null){n._emitHttpError(r,s,"tus: invalid or missing Location header");return}if(n.url=pt(n.options.endpoint,c),"Created upload at ".concat(n.url),typeof n.options.onUploadUrlAvailable=="function"&&n.options.onUploadUrlAvailable(),n._size===0){n._emitSuccess(s),n._source.close();return}n._saveUploadInUrlStorage().then(function(){n.options.uploadDataDuringCreation?n._handleUploadResponse(r,s):(n._offset=0,n._performUpload())})}).catch(function(s){n._emitHttpError(r,null,"tus: failed to create upload",s)})}},{key:"_resumeUpload",value:function(){var n=this,r=this._openRequest("HEAD",this.url),o=this._sendRequest(r,null);o.then(function(l){var s=l.getStatus();if(!ee(s,200)){if(s===423){n._emitHttpError(r,l,"tus: upload is currently locked; retry later");return}if(ee(s,400)&&n._removeFromUrlStorage(),!n.options.endpoint){n._emitHttpError(r,l,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}n.url=null,n._createUpload();return}var c=Number.parseInt(l.getHeader("Upload-Offset"),10);if(Number.isNaN(c)){n._emitHttpError(r,l,"tus: invalid or missing offset value");return}var f=Number.parseInt(l.getHeader("Upload-Length"),10);if(Number.isNaN(f)&&!n.options.uploadLengthDeferred&&n.options.protocol===we){n._emitHttpError(r,l,"tus: invalid or missing length value");return}typeof n.options.onUploadUrlAvailable=="function"&&n.options.onUploadUrlAvailable(),n._saveUploadInUrlStorage().then(function(){if(c===f){n._emitProgress(f,f),n._emitSuccess(l);return}n._offset=c,n._performUpload()})}).catch(function(l){n._emitHttpError(r,null,"tus: failed to resume upload",l)})}},{key:"_performUpload",value:function(){var n=this;if(!this._aborted){var r;this.options.overridePatchMethod?(r=this._openRequest("POST",this.url),r.setHeader("X-HTTP-Method-Override","PATCH")):r=this._openRequest("PATCH",this.url),r.setHeader("Upload-Offset","".concat(this._offset));var o=this._addChunkToRequest(r);o.then(function(l){if(!ee(l.getStatus(),200)){n._emitHttpError(r,l,"tus: unexpected response while uploading chunk");return}n._handleUploadResponse(r,l)}).catch(function(l){n._aborted||n._emitHttpError(r,null,"tus: failed to upload chunk at offset ".concat(n._offset),l)})}}},{key:"_addChunkToRequest",value:function(n){var r=this,o=this._offset,l=this._offset+this.options.chunkSize;return n.setProgressHandler(function(s){r._emitProgress(o+s,r._size)}),this.options.protocol===we?n.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===ue&&n.setHeader("Content-Type","application/partial-upload"),(l===Number.POSITIVE_INFINITY||l>this._size)&&!this.options.uploadLengthDeferred&&(l=this._size),this._source.slice(o,l).then(function(s){var c=s.value,f=s.done,y=c!=null&&c.size?c.size:0;r.options.uploadLengthDeferred&&f&&(r._size=r._offset+y,n.setHeader("Upload-Length","".concat(r._size)));var v=r._offset+y;return!r.options.uploadLengthDeferred&&f&&v!==r._size?Promise.reject(new Error("upload was configured with a size of ".concat(r._size," bytes, but the source is done after ").concat(v," bytes"))):c===null?r._sendRequest(n):((r.options.protocol===Se||r.options.protocol===ue)&&n.setHeader("Upload-Complete",f?"?1":"?0"),r._emitProgress(r._offset,r._size),r._sendRequest(n,c))})}},{key:"_handleUploadResponse",value:function(n,r){var o=Number.parseInt(r.getHeader("Upload-Offset"),10);if(Number.isNaN(o)){this._emitHttpError(n,r,"tus: invalid or missing offset value");return}if(this._emitProgress(o,this._size),this._emitChunkComplete(o-this._offset,o,this._size),this._offset=o,o===this._size){this._emitSuccess(r),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(n,r){var o=st(n,r,this.options);return this._req=o,o}},{key:"_removeFromUrlStorage",value:function(){var n=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(r){n._emitError(r)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var n=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var r={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?r.parallelUploadUrls=this._parallelUploadUrls:r.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,r).then(function(o){n._urlStorageKey=o})}},{key:"_sendRequest",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return ft(n,r,this.options)}}],[{key:"terminate",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=st("DELETE",n,r);return ft(o,null,r).then(function(l){if(l.getStatus()!==204)throw new ge("tus: unexpected response while terminating upload",null,o,l)}).catch(function(l){if(l instanceof ge||(l=new ge("tus: failed to terminate upload",l,o,null)),!ct(l,0,r))throw l;var s=r.retryDelays[0],c=r.retryDelays.slice(1),f=Q(Q({},r),{},{retryDelays:c});return new Promise(function(y){return setTimeout(y,s)}).then(function(){return t.terminate(n,f)})})}}])}();function ut(t){return Object.entries(t).map(function(e){var n=$t(e,2),r=n[0],o=n[1];return"".concat(r," ").concat(Fr.encode(String(o)))}).join(",")}function ee(t,e){return t>=e&&t<e+100}function st(t,e,n){var r=n.httpStack.createRequest(t,e);n.protocol===Se?r.setHeader("Upload-Draft-Interop-Version","5"):n.protocol===ue?r.setHeader("Upload-Draft-Interop-Version","6"):r.setHeader("Tus-Resumable","1.0.0");for(var o=n.headers||{},l=0,s=Object.entries(o);l<s.length;l++){var c=$t(s[l],2),f=c[0],y=c[1];r.setHeader(f,y)}if(n.addRequestId){var v=Jr();r.setHeader("X-Request-ID",v)}return r}function ft(t,e,n){return De.apply(this,arguments)}function De(){return De=Qr(Ie().mark(function t(e,n,r){var o;return Ie().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(typeof r.onBeforeRequest!="function"){s.next=3;break}return s.next=3,r.onBeforeRequest(e);case 3:return s.next=5,e.send(n);case 5:if(o=s.sent,typeof r.onAfterResponse!="function"){s.next=9;break}return s.next=9,r.onAfterResponse(e,o);case 9:return s.abrupt("return",o);case 10:case"end":return s.stop()}},t)})),De.apply(this,arguments)}function fn(){var t=!0;return typeof navigator<"u"&&navigator.onLine===!1&&(t=!1),t}function ct(t,e,n){return n.retryDelays==null||e>=n.retryDelays.length||t.originalRequest==null?!1:n&&typeof n.onShouldRetry=="function"?n.onShouldRetry(t,e,n):Gt(t)}function Gt(t){var e=t.originalResponse?t.originalResponse.getStatus():0;return(!ee(e,400)||e===409||e===423)&&fn()}function pt(t,e){return new Wr(e,t).toString()}function cn(t,e){for(var n=Math.floor(t/e),r=[],o=0;o<e;o++)r.push({start:n*o,end:n*(o+1)});return r[e-1].end=t,r}Ue.defaultOptions=sn;var Kt=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function pn(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.responseType="blob",r.onload=function(){var o=r.response;e(o)},r.onerror=function(o){n(o)},r.open("GET",t),r.send()})}var hn=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function dn(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){var o=new Uint8Array(r.result);e({value:o})},r.onerror=function(o){n(o)},r.readAsArrayBuffer(t)})}function pe(t){"@babel/helpers - typeof";return pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(t)}function yn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ht(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vn(r.key),r)}}function mn(t,e,n){return e&&ht(t.prototype,e),n&&ht(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function vn(t){var e=gn(t,"string");return pe(e)=="symbol"?e:e+""}function gn(t,e){if(pe(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(pe(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var dt=function(){function t(e){yn(this,t),this._file=e,this.size=e.size}return mn(t,[{key:"slice",value:function(n,r){if(hn())return dn(this._file.slice(n,r));var o=this._file.slice(n,r),l=r>=this.size;return Promise.resolve({value:o,done:l})}},{key:"close",value:function(){}}])}();function he(t){"@babel/helpers - typeof";return he=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(t)}function bn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wn(r.key),r)}}function _n(t,e,n){return e&&yt(t.prototype,e),n&&yt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function wn(t){var e=Sn(t,"string");return he(e)=="symbol"?e:e+""}function Sn(t,e){if(he(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(he(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mt(t){return t===void 0?0:t.size!==void 0?t.size:t.length}function Un(t,e){if(t.concat)return t.concat(e);if(t instanceof Blob)return new Blob([t,e],{type:t.type});if(t.set){var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n}throw new Error("Unknown data type")}var xn=function(){function t(e){bn(this,t),this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}return _n(t,[{key:"slice",value:function(n,r){return n<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(n,r)}},{key:"_readUntilEnoughDataOrDone",value:function(n,r){var o=this,l=r<=this._bufferOffset+mt(this._buffer);if(this._done||l){var s=this._getDataFromBuffer(n,r),c=s==null?this._done:!1;return Promise.resolve({value:s,done:c})}return this._reader.read().then(function(f){var y=f.value,v=f.done;return v?o._done=!0:o._buffer===void 0?o._buffer=y:o._buffer=Un(o._buffer,y),o._readUntilEnoughDataOrDone(n,r)})}},{key:"_getDataFromBuffer",value:function(n,r){n>this._bufferOffset&&(this._buffer=this._buffer.slice(n-this._bufferOffset),this._bufferOffset=n);var o=mt(this._buffer)===0;return this._done&&o?null:this._buffer.slice(0,r-n)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function W(t){"@babel/helpers - typeof";return W=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(t)}function Fe(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Fe=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(u,i,a){u[i]=a.value},l=typeof Symbol=="function"?Symbol:{},s=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",f=l.toStringTag||"@@toStringTag";function y(u,i,a){return Object.defineProperty(u,i,{value:a,enumerable:!0,configurable:!0,writable:!0}),u[i]}try{y({},"")}catch{y=function(a,p,d){return a[p]=d}}function v(u,i,a,p){var d=i&&i.prototype instanceof T?i:T,h=Object.create(d.prototype),b=new M(p||[]);return o(h,"_invoke",{value:N(u,a,b)}),h}function m(u,i,a){try{return{type:"normal",arg:u.call(i,a)}}catch(p){return{type:"throw",arg:p}}}e.wrap=v;var E="suspendedStart",X="suspendedYield",B="executing",I="completed",x={};function T(){}function O(){}function k(){}var A={};y(A,s,function(){return this});var q=Object.getPrototypeOf,F=q&&q(q(Y([])));F&&F!==n&&r.call(F,s)&&(A=F);var g=k.prototype=T.prototype=Object.create(A);function P(u){["next","throw","return"].forEach(function(i){y(u,i,function(a){return this._invoke(i,a)})})}function U(u,i){function a(d,h,b,w){var S=m(u[d],u,h);if(S.type!=="throw"){var L=S.arg,R=L.value;return R&&W(R)=="object"&&r.call(R,"__await")?i.resolve(R.__await).then(function(C){a("next",C,b,w)},function(C){a("throw",C,b,w)}):i.resolve(R).then(function(C){L.value=C,b(L)},function(C){return a("throw",C,b,w)})}w(S.arg)}var p;o(this,"_invoke",{value:function(h,b){function w(){return new i(function(S,L){a(h,b,S,L)})}return p=p?p.then(w,w):w()}})}function N(u,i,a){var p=E;return function(d,h){if(p===B)throw Error("Generator is already running");if(p===I){if(d==="throw")throw h;return{value:t,done:!0}}for(a.method=d,a.arg=h;;){var b=a.delegate;if(b){var w=D(b,a);if(w){if(w===x)continue;return w}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(p===E)throw p=I,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);p=B;var S=m(u,i,a);if(S.type==="normal"){if(p=a.done?I:X,S.arg===x)continue;return{value:S.arg,done:a.done}}S.type==="throw"&&(p=I,a.method="throw",a.arg=S.arg)}}}function D(u,i){var a=i.method,p=u.iterator[a];if(p===t)return i.delegate=null,a==="throw"&&u.iterator.return&&(i.method="return",i.arg=t,D(u,i),i.method==="throw")||a!=="return"&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+a+"' method")),x;var d=m(p,u.iterator,i.arg);if(d.type==="throw")return i.method="throw",i.arg=d.arg,i.delegate=null,x;var h=d.arg;return h?h.done?(i[u.resultName]=h.value,i.next=u.nextLoc,i.method!=="return"&&(i.method="next",i.arg=t),i.delegate=null,x):h:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,x)}function ae(u){var i={tryLoc:u[0]};1 in u&&(i.catchLoc=u[1]),2 in u&&(i.finallyLoc=u[2],i.afterLoc=u[3]),this.tryEntries.push(i)}function $(u){var i=u.completion||{};i.type="normal",delete i.arg,u.completion=i}function M(u){this.tryEntries=[{tryLoc:"root"}],u.forEach(ae,this),this.reset(!0)}function Y(u){if(u||u===""){var i=u[s];if(i)return i.call(u);if(typeof u.next=="function")return u;if(!isNaN(u.length)){var a=-1,p=function d(){for(;++a<u.length;)if(r.call(u,a))return d.value=u[a],d.done=!1,d;return d.value=t,d.done=!0,d};return p.next=p}}throw new TypeError(W(u)+" is not iterable")}return O.prototype=k,o(g,"constructor",{value:k,configurable:!0}),o(k,"constructor",{value:O,configurable:!0}),O.displayName=y(k,f,"GeneratorFunction"),e.isGeneratorFunction=function(u){var i=typeof u=="function"&&u.constructor;return!!i&&(i===O||(i.displayName||i.name)==="GeneratorFunction")},e.mark=function(u){return Object.setPrototypeOf?Object.setPrototypeOf(u,k):(u.__proto__=k,y(u,f,"GeneratorFunction")),u.prototype=Object.create(g),u},e.awrap=function(u){return{__await:u}},P(U.prototype),y(U.prototype,c,function(){return this}),e.AsyncIterator=U,e.async=function(u,i,a,p,d){d===void 0&&(d=Promise);var h=new U(v(u,i,a,p),d);return e.isGeneratorFunction(i)?h:h.next().then(function(b){return b.done?b.value:h.next()})},P(g),y(g,f,"Generator"),y(g,s,function(){return this}),y(g,"toString",function(){return"[object Generator]"}),e.keys=function(u){var i=Object(u),a=[];for(var p in i)a.push(p);return a.reverse(),function d(){for(;a.length;){var h=a.pop();if(h in i)return d.value=h,d.done=!1,d}return d.done=!0,d}},e.values=Y,M.prototype={constructor:M,reset:function(i){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach($),!i)for(var a in this)a.charAt(0)==="t"&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=t)},stop:function(){this.done=!0;var i=this.tryEntries[0].completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var a=this;function p(L,R){return b.type="throw",b.arg=i,a.next=L,R&&(a.method="next",a.arg=t),!!R}for(var d=this.tryEntries.length-1;d>=0;--d){var h=this.tryEntries[d],b=h.completion;if(h.tryLoc==="root")return p("end");if(h.tryLoc<=this.prev){var w=r.call(h,"catchLoc"),S=r.call(h,"finallyLoc");if(w&&S){if(this.prev<h.catchLoc)return p(h.catchLoc,!0);if(this.prev<h.finallyLoc)return p(h.finallyLoc)}else if(w){if(this.prev<h.catchLoc)return p(h.catchLoc,!0)}else{if(!S)throw Error("try statement without catch or finally");if(this.prev<h.finallyLoc)return p(h.finallyLoc)}}}},abrupt:function(i,a){for(var p=this.tryEntries.length-1;p>=0;--p){var d=this.tryEntries[p];if(d.tryLoc<=this.prev&&r.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var h=d;break}}h&&(i==="break"||i==="continue")&&h.tryLoc<=a&&a<=h.finallyLoc&&(h=null);var b=h?h.completion:{};return b.type=i,b.arg=a,h?(this.method="next",this.next=h.finallyLoc,x):this.complete(b)},complete:function(i,a){if(i.type==="throw")throw i.arg;return i.type==="break"||i.type==="continue"?this.next=i.arg:i.type==="return"?(this.rval=this.arg=i.arg,this.method="return",this.next="end"):i.type==="normal"&&a&&(this.next=a),x},finish:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var p=this.tryEntries[a];if(p.finallyLoc===i)return this.complete(p.completion,p.afterLoc),$(p),x}},catch:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var p=this.tryEntries[a];if(p.tryLoc===i){var d=p.completion;if(d.type==="throw"){var h=d.arg;$(p)}return h}}throw Error("illegal catch attempt")},delegateYield:function(i,a,p){return this.delegate={iterator:Y(i),resultName:a,nextLoc:p},this.method==="next"&&(this.arg=t),x}},e}function vt(t,e,n,r,o,l,s){try{var c=t[l](s),f=c.value}catch(y){n(y);return}c.done?e(f):Promise.resolve(f).then(r,o)}function Pn(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var l=t.apply(e,n);function s(f){vt(l,r,o,s,c,"next",f)}function c(f){vt(l,r,o,s,c,"throw",f)}s(void 0)})}}function En(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function gt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,kn(r.key),r)}}function On(t,e,n){return e&&gt(t.prototype,e),n&&gt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function kn(t){var e=Rn(t,"string");return W(e)=="symbol"?e:e+""}function Rn(t,e){if(W(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(W(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var jn=function(){function t(){En(this,t)}return On(t,[{key:"openFile",value:function(){var e=Pn(Fe().mark(function r(o,l){var s;return Fe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(Kt()&&o&&typeof o.uri<"u")){f.next=11;break}return f.prev=1,f.next=4,pn(o.uri);case 4:return s=f.sent,f.abrupt("return",new dt(s));case 8:throw f.prev=8,f.t0=f.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(f.t0));case 11:if(!(typeof o.slice=="function"&&typeof o.size<"u")){f.next=13;break}return f.abrupt("return",Promise.resolve(new dt(o)));case 13:if(typeof o.read!="function"){f.next=18;break}if(l=Number(l),Number.isFinite(l)){f.next=17;break}return f.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return f.abrupt("return",Promise.resolve(new xn(o,l)));case 18:return f.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return f.stop()}},r,null,[[1,8]])}));function n(r,o){return e.apply(this,arguments)}return n}()}])}();function Tn(t,e){return Kt()?Promise.resolve(Ln(t,e)):Promise.resolve(["tus-br",t.name,t.type,t.size,t.lastModified,e.endpoint].join("-"))}function Ln(t,e){var n=t.exif?Cn(JSON.stringify(t.exif)):"noexif";return["tus-rn",t.name||"noname",t.size||"nosize",n,e.endpoint].join("/")}function Cn(t){var e=0;if(t.length===0)return e;for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);e=(e<<5)-e+r,e&=e}return e}function de(t){"@babel/helpers - typeof";return de=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(t)}function Ve(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,An(r.key),r)}}function Ge(t,e,n){return e&&bt(t.prototype,e),n&&bt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function An(t){var e=In(t,"string");return de(e)=="symbol"?e:e+""}function In(t,e){if(de(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(de(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Dn=function(){function t(){Ve(this,t)}return Ge(t,[{key:"createRequest",value:function(n,r){return new Fn(n,r)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),Fn=function(){function t(e,n){Ve(this,t),this._xhr=new XMLHttpRequest,this._xhr.open(e,n,!0),this._method=e,this._url=n,this._headers={}}return Ge(t,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(n,r){this._xhr.setRequestHeader(n,r),this._headers[n]=r}},{key:"getHeader",value:function(n){return this._headers[n]}},{key:"setProgressHandler",value:function(n){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(r){r.lengthComputable&&n(r.loaded)})}},{key:"send",value:function(){var n=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(o,l){n._xhr.onload=function(){o(new Nn(n._xhr))},n._xhr.onerror=function(s){l(s)},n._xhr.send(r)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Nn=function(){function t(e){Ve(this,t),this._xhr=e}return Ge(t,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(n){return this._xhr.getResponseHeader(n)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function ye(t){"@babel/helpers - typeof";return ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(t)}function Hn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bn(r.key),r)}}function zn(t,e,n){return e&&_t(t.prototype,e),n&&_t(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Bn(t){var e=qn(t,"string");return ye(e)=="symbol"?e:e+""}function qn(t,e){if(ye(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ye(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Ne=!1;try{Ne="localStorage"in window;var je="tusSupport",wt=localStorage.getItem(je);localStorage.setItem(je,wt),wt===null&&localStorage.removeItem(je)}catch(t){if(t.code===t.SECURITY_ERR||t.code===t.QUOTA_EXCEEDED_ERR)Ne=!1;else throw t}var $n=Ne,Mn=function(){function t(){Hn(this,t)}return zn(t,[{key:"findAllUploads",value:function(){var n=this._findEntries("tus::");return Promise.resolve(n)}},{key:"findUploadsByFingerprint",value:function(n){var r=this._findEntries("tus::".concat(n,"::"));return Promise.resolve(r)}},{key:"removeUpload",value:function(n){return localStorage.removeItem(n),Promise.resolve()}},{key:"addUpload",value:function(n,r){var o=Math.round(Math.random()*1e12),l="tus::".concat(n,"::").concat(o);return localStorage.setItem(l,JSON.stringify(r)),Promise.resolve(l)}},{key:"_findEntries",value:function(n){for(var r=[],o=0;o<localStorage.length;o++){var l=localStorage.key(o);if(l.indexOf(n)===0)try{var s=JSON.parse(localStorage.getItem(l));s.urlStorageKey=l,r.push(s)}catch{}}return r}}])}();function oe(t){"@babel/helpers - typeof";return oe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(t)}function Vn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function St(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Yt(r.key),r)}}function Gn(t,e,n){return e&&St(t.prototype,e),n&&St(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Kn(t,e,n){return e=xe(e),Xn(t,Xt()?Reflect.construct(e,n||[],xe(t).constructor):e.apply(t,n))}function Xn(t,e){if(e&&(oe(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yn(t)}function Yn(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Xt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Xt=function(){return!!t})()}function xe(t){return xe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},xe(t)}function Zn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&He(t,e)}function He(t,e){return He=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},He(t,e)}function Ut(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function te(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Ut(Object(n),!0).forEach(function(r){Wn(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Ut(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Wn(t,e,n){return e=Yt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Yt(t){var e=Jn(t,"string");return oe(e)=="symbol"?e:e+""}function Jn(t,e){if(oe(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(oe(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var xt=te(te({},Ue.defaultOptions),{},{httpStack:new Dn,fileReader:new jn,urlStorage:$n?new Mn:new Er,fingerprint:Tn}),Qn=function(t){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Vn(this,e),r=te(te({},xt),r),Kn(this,e,[n,r])}return Zn(e,t),Gn(e,null,[{key:"terminate",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o=te(te({},xt),o),Ue.terminate(r,o)}}])}(Ue);const eo={components:{Footer:lr,Navbar:ur,Sidebar:sr},setup(){const t=Jt(),e=Qt(),n=V(null),r=e.params.courseId,o=e.params.chapterId,l=V(!1),s=V(0),c=V(!1),f=V(""),y=V({title:"",description:"",status:"",pdf_file_url:null,vimeo_id:null,player_embed_url:"",manage_link:"",vimeo_status:"",notes:[{time:"",content:""}]}),v=()=>{y.value.notes.push({time:"",content:""}),ar(()=>{const g=document.querySelector(".notes-container");g.scrollTo({top:g.scrollHeight,behavior:"smooth"})})},m=g=>{y.value.notes.splice(g,1)},E=()=>{try{J.removeVimeo({chapterId:o}),y.value.vimeo_id=null,y.value.player_embed_url="",y.value.manage_link="",y.value.vimeo_status=""}catch(g){console.log(g)}},X=async g=>{const P=g.target.files[0];if(P)try{c.value=!0,T.value=!0,f.value="正在獲取上傳憑證...";const U=await J.getVimeoID(o,{size:P.size}),N=new Qn(P,{uploadUrl:U.upload_link,headers:{Accept:"application/vnd.vimeo.*+json;version=3.4"},method:"PUT",chunkSize:512e4,onError:D=>{f.value=`上傳失敗: ${D.message}`,g.target.value=""},onProgress:D=>{s.value=D/P.size*100,f.value=`上傳中: ${s.value.toFixed(1)}%`},onSuccess:()=>{y.value.vimeo_id=U.vimeo_id,y.value.player_embed_url=U.player_embed_url,y.value.manage_link=U.manage_link,J.changeVimeoStatus({vimeoID:y.value.vimeo_id}),f.value="上傳完成",g.target.value="",T.value=!1}});f.value="開始上傳資料...",N.start()}catch(U){f.value=`上傳失敗: ${U.message}`,g.target.value=""}finally{c.value=!1,T.value=!1,setTimeout(()=>{s.value=0},3e3)}},B=async()=>{try{const g=await J.getChapter(r,o);y.value=g}catch(g){console.error("獲取章節數據失敗:",g),alert("獲取章節數據失敗")}},I=g=>{const P=document.querySelector('iframe[src*="vimeo.com"]');if(!P)return;P.contentWindow.postMessage({method:"getCurrentTime"},"*");const U=N=>{if(N.origin.includes("vimeo.com")&&N.data&&typeof N.data.value=="number"){const D=Math.floor(N.data.value),ae=String(Math.floor(D/3600)).padStart(2,"0"),$=String(Math.floor(D%3600/60)).padStart(2,"0"),M=String(D%60).padStart(2,"0");y.value.notes[g].time=`${ae}:${$}:${M}`,window.removeEventListener("message",U)}};window.addEventListener("message",U)},x=async()=>{l.value=!0;try{const g=y.value.notes.filter(U=>U.content&&U.content.trim()!==""),P={...y.value,notes:g};await J.updateChapter(r,o,P),t.push(`/course/${e.params.courseId}/chapters`)}catch(g){console.error("保存章節失敗:",g),alert("保存章節失敗")}finally{l.value=!1}},T=V(!1),O=V(""),k=()=>{t.push(`/course/${r}/chapters`)},A=async g=>{const P=g.target.files[0];if(P&&P.type==="application/pdf")try{T.value=!0,O.value="PDF上傳中...";const U=await J.chapterPDFUpload(P);U.status&&(y.value.pdf_file_url=U.content,O.value="")}catch(U){O.value="PDF上傳失敗："+U.message,g.target.value=""}finally{T.value=!1,setTimeout(()=>{O.value=""},3e3)}else O.value="請上傳PDF格式的檔案",g.target.value=""},q=()=>{y.value.pdf_file_url=null};er(async()=>{await B(),n.value=await fr.create(document.querySelector("#editor"),{removePlugins:["Markdown"],extraPlugins:[F],toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","blockQuote","imageUpload"],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"}]}}).then(g=>(g.model.document.on("change:data",()=>{y.value.description=g.getData()}),g)).catch(g=>{console.error(g)})});function F(g){g.plugins.get("FileRepository").createUploadAdapter=P=>new cr(P)}return{chapter:y,isUploading:T,isLoading:l,saveChapter:x,handlePdfUpload:A,handleVideoUpload:X,removePdf:q,removeVideo:E,addNote:v,removeNote:m,route:e,uploadStatusText:O,backToChapterList:k,videoUploadStatusText:f,setNoteTime:I}}},to={class:"main-wrapper"},ro={class:"page-wrapper"},no={class:"page-content"},oo={class:"row mb-4"},io={class:"col-12 mx-auto stretch-card"},ao={class:"card"},lo={class:"card-body"},uo={class:"row"},so={class:"col-md-6"},fo={key:0,class:"video-preview mb-3"},co=["src"],po={key:1},ho={key:1,class:"mt-2"},yo=["href"],mo={class:"col-md-6 video-column"},vo={class:"notes-container"},go={class:"d-flex align-items-center gap-2 mb-2"},bo=["onUpdate:modelValue"],_o=["onClick"],wo=["onClick"],So=["onUpdate:modelValue"],Uo={class:"mb-3"},xo={class:"mb-3"},Po=["innerHTML"],Eo={class:"mb-3"},Oo={key:0,class:"mt-2"},ko={class:"d-flex justify-content-end"};function Ro(t,e,n,r,o,l){const s=me("Sidebar"),c=me("Navbar"),f=me("router-link"),y=me("Footer");return G(),K("div",to,[ve(s),_("div",ro,[ve(c),_("div",no,[_("div",oo,[_("div",io,[_("div",ao,[_("div",lo,[e[12]||(e[12]=_("h6",{class:"card-title"},"編輯章節",-1)),_("div",uo,[_("div",so,[r.chapter.vimeo_id?(G(),K("div",fo,[r.chapter.vimeo_status=="vimeo_ready"?(G(),K("iframe",{key:0,src:r.chapter.player_embed_url,width:"100%",height:"600",frameborder:"0",allow:"autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media",title:"Untitled"},null,8,co)):(G(),K("p",po,"已上傳Vimeo，Vimeo影片處理中，您可以繼續編輯"))])):Ee("",!0),_("input",{type:"file",class:"form-control",accept:".mp4,.mov",onChange:e[0]||(e[0]=(...v)=>r.handleVideoUpload&&r.handleVideoUpload(...v))},null,32),Oe(" "+tr(r.videoUploadStatusText)+" ",1),r.chapter.vimeo_id?(G(),K("div",ho,[_("button",{type:"button",class:"btn btn-danger btn-sm",onClick:e[1]||(e[1]=(...v)=>r.removeVideo&&r.removeVideo(...v))}," 移除 "),_("a",{href:`https://vimeo.com${r.chapter.manage_link}`,target:"_blank",class:"m-2 btn btn-info btn-sm"},e[6]||(e[6]=[_("i",{class:"material-icons align-middle me-1"},"edit",-1),Oe(" Vimeo編輯 ")]),8,yo)])):Ee("",!0)]),_("div",mo,[_("div",vo,[(G(!0),K(rr,null,nr(r.chapter.notes,(v,m)=>(G(),K("div",{key:m,class:"mb-3 p-2 border-bottom"},[_("div",go,[ke(_("input",{type:"text",class:"form-control flex-grow-0","onUpdate:modelValue":E=>v.time=E,placeholder:"時間",style:{width:"120px"}},null,8,bo),[[Re,v.time]]),_("button",{class:"btn btn-outline-secondary btn-sm",onClick:E=>r.setNoteTime(m)}," 設為目前時間 ",8,_o),_("button",{class:"btn btn-outline-danger btn-sm",onClick:E=>r.removeNote(m)}," 刪除 ",8,wo)]),ke(_("textarea",{"onUpdate:modelValue":E=>v.content=E,class:"form-control w-100",rows:"3",placeholder:"筆記內容"},null,8,So),[[Re,v.content]])]))),128))]),_("button",{class:"btn btn-outline-primary btn-sm",type:"button",onClick:e[2]||(e[2]=(...v)=>r.addNote&&r.addNote(...v))}," 新增筆記 ")])]),_("form",{onSubmit:e[5]||(e[5]=or((...v)=>r.saveChapter&&r.saveChapter(...v),["prevent"]))},[_("div",Uo,[e[7]||(e[7]=_("label",{for:"title",class:"form-label"},"章節標題",-1)),ke(_("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[3]||(e[3]=v=>r.chapter.title=v),required:""},null,512),[[Re,r.chapter.title]])]),_("div",xo,[e[8]||(e[8]=_("label",{for:"editor",class:"form-label"},"章節內容",-1)),_("div",{id:"editor",innerHTML:r.chapter.description},null,8,Po)]),_("div",Eo,[e[9]||(e[9]=_("label",{class:"form-label"},"PDF檔案",-1)),_("input",{type:"file",class:"form-control",accept:".pdf",onChange:e[4]||(e[4]=(...v)=>r.handlePdfUpload&&r.handlePdfUpload(...v))},null,32),r.chapter.pdf_file_url&&!r.uploadStatusText?(G(),K("div",Oo)):Ee("",!0)]),_("div",ko,[ve(f,{to:`/course/${t.courseId}/chapters`,class:"btn btn-secondary me-2"},{default:ir(()=>e[10]||(e[10]=[Oe("取消")])),_:1},8,["to"]),e[11]||(e[11]=_("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])])])]),ve(y)])])}const Co=Wt(eo,[["render",Ro],["__scopeId","data-v-3f36f1aa"]]);export{Co as default};
