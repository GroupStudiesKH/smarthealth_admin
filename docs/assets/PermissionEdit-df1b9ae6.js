import{_ as x,p as E,u as F,r as v,i as N,j as y,o as n,c as i,k as w,b as o,e as P,g as B,d as O,F as D,f as S,t as h,z as I}from"./index-2efd86e2.js";import{F as L,N as M,_ as V,a as f}from"./sidebar-b1a3548c.js";const j={components:{Footer:L,Navbar:M,Sidebar:V},setup(){const m=E(),b=F().params.id,e=v({name:"",permissions:{}}),p=v({}),u=v(!1),c=v({}),g=async()=>{try{const s=await f.getPermissionOptions();c.value=s,e.value={id:"",name:"",permissions:Object.keys(s).reduce((a,l)=>(a[l]=[],a),{})}}catch(s){console.error("Error fetching permission options:",s)}},k=async()=>{try{const s=await f.getPermission(b);e.value={id:s.id,name:s.name,permissions:{...e.value.permissions,...s.permissions}},Object.keys(c.value).forEach(a=>{Object.keys(c.value[a].list).forEach(l=>{Array.isArray(e.value.permissions[l])||(e.value.permissions[l]=[])})}),console.log("Updated permissionData:",e.value)}catch(s){console.error("Error fetching permission data:",s)}},t=async()=>{u.value=!0;try{p.value={},await f.updatePermission(b,e.value)?(console.log("Permission updated successfully"),await _(),m.push("/permission")):(console.error("Failed to update permission"),alert("權限更新失敗，請稍後再試。"))}catch(s){console.error("Error updating permission:",s),s.response&&s.response.data&&(p.value=s.response.data.content||{}),alert("權限更新失敗："+(s.message||"未知錯誤"))}finally{u.value=!1}},d=()=>{m.push("/permission")},_=async()=>{try{const s=await f.adminMe();s?(sessionStorage.setItem("userData",JSON.stringify(s)),userData.value=s):console.error("Invalid response format:",s)}catch(s){console.error("Error fetching admin data:",s),m.push("/login"),localStorage.removeItem("access_token")}};return N(async()=>{await g(),await k()}),{permissionData:e,permissionStructure:c,updatePermission:t,goBack:d,errors:p,isLoading:u}}},U={class:"main-wrapper"},A={class:"page-wrapper"},C={class:"page-content"},R={class:"row"},z={class:"col-12 stretch-card"},J={class:"mb-3"},T={class:"col-12 stretch-card"},q={class:"row"},G={class:"card h-100"},H={class:"card-body"},Q={class:"mb-4"},W={class:"mb-3"},X={class:"d-flex flex-wrap"},Y=["id","checked","value","onUpdate:modelValue"],Z=["for"],$=["disabled"],K=["disabled"];function ss(m,r,b,e,p,u){const c=y("Sidebar"),g=y("Navbar"),k=y("Footer");return n(),i("div",U,[w(c),o("div",A,[w(g),o("div",C,[o("div",R,[o("div",z,[o("h4",J,[P(o("input",{"onUpdate:modelValue":r[0]||(r[0]=t=>e.permissionData.name=t),class:"form-control",type:"text"},null,512),[[B,e.permissionData.name]])])]),o("div",T,[o("form",{onSubmit:r[2]||(r[2]=O((...t)=>e.updatePermission&&e.updatePermission(...t),["prevent"]))},[o("div",q,[(n(!0),i(D,null,S(e.permissionStructure,(t,d)=>(n(),i("div",{class:"col-md-3 mb-3",key:d},[o("div",G,[o("div",H,[o("div",Q,[o("h5",W,h(t.title),1),(n(!0),i(D,null,S(t.list,(_,s)=>(n(),i("div",{key:s,class:"mb-3"},[o("p",null,h(_.title),1),o("div",X,[(n(!0),i(D,null,S(_.permissions,a=>(n(),i("div",{key:a,class:"form-check permissionItem me-3"},[P(o("input",{class:"form-check-input",type:"checkbox",id:`${d}-${s}-${a}`,checked:e.permissionData.permissions[s]&&e.permissionData.permissions[s].includes(a),value:a,"onUpdate:modelValue":l=>e.permissionData.permissions[s]=l},null,8,Y),[[I,e.permissionData.permissions[s]]]),o("label",{class:"form-check-label",for:`${d}-${s}-${a}`},h(a==="list"?"列表":a==="create"?"新增":a==="edit"?"編輯":a==="del"?"刪除":a),9,Z)]))),128))])]))),128))])])])]))),128))]),o("button",{type:"submit",class:"btn btn-primary me-2",disabled:e.isLoading},h(e.isLoading?"更新中...":"更新權限"),9,$),o("button",{type:"button",class:"btn btn-secondary",onClick:r[1]||(r[1]=(...t)=>e.goBack&&e.goBack(...t)),disabled:e.isLoading}," 返回 ",8,K)],32)])])]),w(k)])])}const as=x(j,[["render",ss]]);export{as as default};
