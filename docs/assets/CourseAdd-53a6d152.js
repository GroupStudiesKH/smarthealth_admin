import{_ as z,p as Q,r as u,i as G,j as U,o as r,c as n,b as e,k as _,d as J,l as m,e as p,g as T,t as i,a as d,v as V,y as K,n as X,F as Y}from"./index-91704278.js";import{F as Z,N as $,_ as ee,a as h}from"./sidebar-59fa5e24.js";import{C as se,U as oe}from"./UploadAdapter-302d26a5.js";import{s as ae}from"./vue-multiselect.css_vue_type_style_index_0_src_true_lang-aa38a355.js";const te={components:{Footer:Z,Navbar:$,Sidebar:ee,multiselect:ae},setup(){const k=Q(),s=u(null),w=u(null),o=u(!1),x=u(""),I=u({}),C=u(!1),y=u(!1),v=u(""),l=u({title:"",instructors:[],subtitle:"",has_certificate:!1,language:"",description:"",category:null,tags:[],is_mandatory:!1,credit:0,status:"publish",coverImage:null}),a=u([]),P=u([]),F=u([]),L=({name:t,position:c})=>`${t} (${c})`,N=async()=>{try{const t=await h.getInstructorsOption();F.value=t.map(c=>({id:c.id,name:c.name,position:c.position||""}))}catch(t){console.log(t)}},A=async()=>{try{const t=await h.getTags({type:"tag"});P.value=t.data}catch(t){console.log(t)}},q=async()=>{try{const t=await h.getTags({type:"category"});a.value=t.data}catch(t){console.log(t)}},R=async()=>{var t,c,g;try{const f={title:l.value.title,subtitle:l.value.subtitle,has_certificate:l.value.has_certificate,language:l.value.language,instructors:l.value.instructors.map(b=>b.id),description:l.value.description,tags:l.value.tags.map(b=>b.id),status:l.value.status,is_mandatory:l.value.is_mandatory,credit:l.value.credit,coverImage:l.value.coverImage,categories:(t=l.value.category)!=null&&t.id?[l.value.category.id]:[]};await h.createCourse(f),k.push({name:"courseList"})}catch(f){if(((g=(c=f.response)==null?void 0:c.data)==null?void 0:g.status)==="error")if(f.response.data.content){const b={};for(const[W,S]of Object.entries(f.response.data.content))b[W]=Array.isArray(S)?S[0].replace(/[\[\]"]/g,""):S;I.value=b;const O=Object.values(b).join("<br/>");M("新增失敗："+(O||"未知錯誤"))}else M("新增失敗："+(f.response.data.message||"儲存失敗"));else M("儲存失敗")}finally{C.value=!1}},M=t=>{v.value=t,y.value=!0},j=t=>{v.value=t,y.value=!0},E=()=>{y.value=!1},H=async t=>{const c=t.target.files[0];if(c)try{o.value=!0,x.value="上傳中...";const g=await h.courseImgUpload(c);l.value.coverImage=g.url,w.value=g.url,x.value="上傳完成"}catch(g){x.value="上傳失敗："+g.message,l.value.coverImage="",t.target.value=""}finally{o.value=!1}},B=()=>{w.value=null,l.value.coverImage=null};G(async()=>{try{A(),q(),N(),s.value=await se.create(document.querySelector("#editor"),{removePlugins:["Markdown"],extraPlugins:[D],toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","blockQuote","imageUpload"],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"}]}}).then(t=>(t.model.document.on("change:data",()=>{l.value.description=t.getData()}),t))}catch(t){console.error("初始化失敗:",t)}});function D(t){t.plugins.get("FileRepository").createUploadAdapter=c=>new oe(c)}return{course:l,categories:a,availableTags:P,saveCourse:R,handleCoverImageUpload:H,removeCoverImage:B,coverImagePreview:w,editor:s,availableInstructors:F,nameWithPos:L,errors:I,isLoading:C,showModal:y,modalMessage:v,showErrorModal:M,closeModal:E,showSuccessModal:j}}},le={class:"main-wrapper"},re={class:"page-wrapper"},ne={class:"page-content"},ie={class:"row mb-4"},de={class:"col-12 mx-auto stretch-card"},ce={class:"card"},ue={class:"card-body"},me={class:"mb-3"},ve={key:0,class:"invalid-feedback"},ge={class:"mb-3"},be={key:0,class:"invalid-feedback"},pe={class:"mb-3"},ye={key:0,class:"invalid-feedback"},fe={class:"mb-3"},_e={key:0,class:"invalid-feedback"},ke={class:"row"},he={class:"mb-3 col-6"},we={key:0,class:"invalid-feedback"},xe={class:"mb-3 col-6"},Ce={key:0,class:"invalid-feedback"},Me={class:"mb-3 col-6"},Ue={key:0,class:"invalid-feedback"},Ve={class:"mb-3 col-6"},Ie={key:0,class:"invalid-feedback"},Se={class:"mb-3"},Te={key:0,class:"invalid-feedback"},Pe={class:"mb-3"},Fe={key:0,class:"mb-2"},Le=["src"],Ne={class:"input-group"},Ae={key:1,class:"text-muted mt-2"},qe={class:"mb-3"},Re={key:0,class:"invalid-feedback"},je={class:"mb-3"},Ee={key:0,class:"invalid-feedback"},He={class:"modal-dialog"},Be={class:"modal-content"},De={class:"modal-header"},Oe=["innerHTML"],We={class:"modal-footer"},ze={key:0,class:"modal-backdrop"};function Qe(k,s,w,o,x,I){const C=U("Sidebar"),y=U("Navbar"),v=U("multiselect"),l=U("Footer");return r(),n(Y,null,[e("div",le,[_(C),e("div",re,[_(y),e("div",ne,[e("div",ie,[e("div",de,[e("div",ce,[e("div",ue,[s[34]||(s[34]=e("h6",{class:"card-title"},"新增課程",-1)),e("form",{onSubmit:s[13]||(s[13]=J((...a)=>o.saveCourse&&o.saveCourse(...a),["prevent"]))},[e("div",me,[s[16]||(s[16]=e("label",{class:"form-label"},[m("課程標題 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=a=>o.course.title=a),required:""},null,512),[[T,o.course.title]]),o.errors.title?(r(),n("div",ve,i(o.errors.title),1)):d("",!0)]),e("div",ge,[s[17]||(s[17]=e("label",{class:"form-label"},"副標題",-1)),p(e("input",{"onUpdate:modelValue":s[1]||(s[1]=a=>o.course.subtitle=a),type:"text",class:"form-control",maxlength:"100"},null,512),[[T,o.course.subtitle]]),o.errors.subtitle?(r(),n("div",be,i(o.errors.subtitle),1)):d("",!0)]),e("div",pe,[s[19]||(s[19]=e("label",{class:"form-label"},[m("是否有證書 "),e("span",{class:"text-danger"},"*")],-1)),p(e("select",{"onUpdate:modelValue":s[2]||(s[2]=a=>o.course.has_certificate=a),class:"form-select",required:""},s[18]||(s[18]=[e("option",{value:"0"},"否",-1),e("option",{value:"1"},"是",-1)]),512),[[V,o.course.has_certificate]]),o.errors.has_certificate?(r(),n("div",ye,i(o.errors.has_certificate),1)):d("",!0)]),e("div",fe,[s[21]||(s[21]=e("label",{class:"form-label"},[m("課程語言 "),e("span",{class:"text-danger"},"*")],-1)),p(e("select",{"onUpdate:modelValue":s[3]||(s[3]=a=>o.course.language=a),class:"form-select",required:""},s[20]||(s[20]=[e("option",{value:""},"請選擇語言",-1),e("option",{value:"中文"},"中文",-1),e("option",{value:"英文"},"英文",-1)]),512),[[V,o.course.language]]),o.errors.language?(r(),n("div",_e,i(o.errors.language),1)):d("",!0)]),e("div",ke,[e("div",he,[s[22]||(s[22]=e("label",{class:"form-label"},[m("講師 "),e("span",{class:"text-danger"},"*")],-1)),_(v,{modelValue:o.course.instructors,"onUpdate:modelValue":s[4]||(s[4]=a=>o.course.instructors=a),options:o.availableInstructors,"custom-label":o.nameWithPos,placeholder:"選擇講師",label:"name","track-by":"name",multiple:!0},{singleLabel:K(({option:a})=>[e("strong",null,i(a.name),1),m(" ("+i(a.position)+") ",1)]),_:1},8,["modelValue","options","custom-label"]),o.errors.language?(r(),n("div",we,i(o.errors.language),1)):d("",!0)]),e("div",xe,[s[24]||(s[24]=e("label",{class:"form-label"},[m("課程屬性 "),e("span",{class:"text-danger"},"*")],-1)),p(e("select",{class:"form-control","onUpdate:modelValue":s[5]||(s[5]=a=>o.course.is_mandatory=a)},s[23]||(s[23]=[e("option",{value:"1"},"必修",-1),e("option",{value:"0"},"選修",-1)]),512),[[V,o.course.is_mandatory]]),o.errors.is_mandatory?(r(),n("div",Ce,i(o.errors.is_mandatory),1)):d("",!0)]),e("div",Me,[s[25]||(s[25]=e("label",{class:"form-label"},[m("學分數 "),e("span",{class:"text-danger"},"*")],-1)),p(e("input",{type:"number",class:"form-control","onUpdate:modelValue":s[6]||(s[6]=a=>o.course.credit=a),min:"0",step:"1"},null,512),[[T,o.course.credit]]),o.errors.credit?(r(),n("div",Ue,i(o.errors.credit),1)):d("",!0)]),e("div",Ve,[s[26]||(s[26]=e("label",{class:"form-label"},[m("課程分類 "),e("span",{class:"text-danger"},"*")],-1)),_(v,{modelValue:o.course.category,"onUpdate:modelValue":s[7]||(s[7]=a=>o.course.category=a),options:o.categories,placeholder:"選擇分類",label:"name","track-by":"id"},null,8,["modelValue","options"]),o.errors.category?(r(),n("div",Ie,i(o.errors.category),1)):d("",!0)])]),e("div",Se,[s[27]||(s[27]=e("label",{class:"form-label"},[m("課程標籤 "),e("span",{class:"text-danger"},"*")],-1)),_(v,{modelValue:o.course.tags,"onUpdate:modelValue":s[8]||(s[8]=a=>o.course.tags=a),options:o.availableTags,placeholder:"選擇標籤",label:"name","track-by":"id",multiple:!0},null,8,["modelValue","options"]),o.errors.tags?(r(),n("div",Te,i(o.errors.tags),1)):d("",!0)]),e("div",Pe,[s[28]||(s[28]=e("label",{class:"form-label"},"課程封面",-1)),o.coverImagePreview?(r(),n("div",Fe,[e("img",{src:o.coverImagePreview,alt:"封面預覽",class:"img-thumbnail",style:{"max-width":"200px"}},null,8,Le),e("button",{type:"button",class:"btn btn-danger btn-sm ms-2",onClick:s[9]||(s[9]=(...a)=>o.removeCoverImage&&o.removeCoverImage(...a))}," 移除封面 ")])):d("",!0),e("div",Ne,[e("input",{type:"file",class:"form-control",accept:"image/*",onChange:s[10]||(s[10]=(...a)=>o.handleCoverImageUpload&&o.handleCoverImageUpload(...a))},null,32)]),k.isUploading?(r(),n("div",Ae,i(k.uploadStatusText),1)):d("",!0)]),e("div",qe,[s[29]||(s[29]=e("label",{class:"form-label"},[m("課程描述 "),e("span",{class:"text-danger"},"*")],-1)),s[30]||(s[30]=e("div",{id:"editor"},null,-1)),o.errors.is_mandatory?(r(),n("div",Re,i(o.errors.is_mandatory),1)):d("",!0)]),e("div",je,[s[32]||(s[32]=e("label",{class:"form-label"},[m("課程狀態 "),e("span",{class:"text-danger"},"*")],-1)),p(e("select",{class:"form-select","onUpdate:modelValue":s[11]||(s[11]=a=>o.course.status=a),required:""},s[31]||(s[31]=[e("option",{value:"publish"},"公開",-1),e("option",{value:"unpublish"},"非公開",-1)]),512),[[V,o.course.status]]),o.errors.status?(r(),n("div",Ee,i(o.errors.status),1)):d("",!0)]),s[33]||(s[33]=e("button",{type:"submit",class:"btn btn-primary me-2"}," 建立課程 ",-1)),e("button",{type:"button",class:"btn btn-light",onClick:s[12]||(s[12]=a=>k.router.push({name:"courseList"}))}," 取消 ")],32)])])])])]),_(l)])]),e("div",{class:X(["modal",{"d-block":o.showModal}]),tabindex:"-1"},[e("div",He,[e("div",Be,[e("div",De,[s[35]||(s[35]=e("h5",{class:"modal-title"},"提示",-1)),e("button",{type:"button",class:"btn-close",onClick:s[14]||(s[14]=(...a)=>o.closeModal&&o.closeModal(...a))})]),e("div",{class:"modal-body",innerHTML:o.modalMessage},null,8,Oe),e("div",We,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[15]||(s[15]=(...a)=>o.closeModal&&o.closeModal(...a))},"關閉")])])])],2),o.showModal?(r(),n("div",ze)):d("",!0)],64)}const Ye=z(te,[["render",Qe],["__scopeId","data-v-47266a8e"]]);export{Ye as default};
