import{_ as N,p as M,u as L,r as m,s as x,l as g,o as i,c as d,a as e,m as F,t as p,b as R,d as f,f as C,j as h,h as S,F as U,e as I,v as j,n as D}from"./index-05809435.js";import{F as E,N as O,_ as B}from"./sidebar-79652a8d.js";import{C as q}from"./ckeditor-c277b8db.js";const T={components:{Footer:E,Navbar:O,Sidebar:B},setup(){const u=M(),t=L(),w=m(null),o=m(!1),r=m(!1),c=m(""),l=m({title:"",content:"",status:"草稿",pdfFile:null,videoFile:null,videoPath:"",videoPreview:null,notes:[{time:"",content:""}]}),_=()=>{l.value.notes.push({time:"",content:""})},y=a=>{l.value.notes.splice(a,1)},s=a=>{const n=a.target.files[0];n&&(l.value.videoFile=n,l.value.videoPath=URL.createObjectURL(n),l.value.videoPreview=URL.createObjectURL(n))},b=()=>{l.value.videoFile=null,l.value.videoPath="",l.value.videoPreview=null},v=async a=>{try{l.value={title:"除了資料統一，規則統一，還要有應用程式市集",content:"本章節將介紹醫療資訊系統中資料統一和規則統一的重要性，以及應用程式市集在整體生態系統中的角色。透過實際案例分析，學員將了解如何建立完整的醫療資訊應用生態系統。",status:"已發布",pdfFile:null,videoFile:"/assets/video/除了資料統一，規則統一，還要有應用程式市集.mov",notes:[{time:"02:30",content:"健康的定義與概念"},{time:"05:45",content:"WHO對健康的詮釋"},{time:"08:15",content:"健康管理的重要性"},{time:"12:00",content:"健康管理的實踐方法"}]}}catch(n){console.error("獲取章節數據失敗:",n),c.value="獲取章節數據失敗，請稍後再試",r.value=!0}},k=async()=>{o.value=!0;try{console.log("保存章節:",l.value),c.value="保存成功",r.value=!0,u.push(`/course/${t.params.courseId}/chapters`)}catch(a){console.error("保存章節失敗:",a),c.value="保存失敗，請稍後再試",r.value=!0}finally{o.value=!1}},V=a=>{const n=a.target.files[0];n&&n.type==="application/pdf"?l.value.pdfFile=n:(c.value="請上傳PDF格式的檔案",r.value=!0,a.target.value="")},P=()=>{l.value.pdfFile=null};return x(async()=>{w.value=await q.create(document.querySelector("#editor")).catch(a=>{console.error(a)}),t.params.chapterId&&await v(t.params.chapterId)}),{chapter:l,isLoading:o,showModal:r,modalMessage:c,saveChapter:k,handlePdfUpload:V,handleVideoUpload:s,removePdf:P,removeVideo:b,addNote:_,removeNote:y,route:t}}},z={class:"main-wrapper"},H={class:"page-wrapper"},W={class:"page-content"},A={class:"row"},G={class:"col-md-12 grid-margin stretch-card"},J={class:"card"},K={class:"card-body"},Q={class:"card-title"},X={class:"mb-3"},Y={class:"mb-3"},Z={key:0,class:"mt-2"},$={class:"mb-3"},ee={key:0,class:"video-preview mb-3"},te={class:"video-player"},oe=["src"],se={class:"video-title mt-2"},le={key:1,class:"mt-2"},ae={class:"mb-3"},ne={class:"col-2"},ie=["onUpdate:modelValue"],de={class:"col-9"},re=["onUpdate:modelValue"],ce={class:"col-1"},ve=["onClick"],me={class:"mb-3"},pe=["disabled"],ue={class:"modal-dialog"},be={class:"modal-content"},fe={class:"modal-header"},he={class:"modal-body"},_e={class:"modal-footer"};function ye(u,t,w,o,r,c){const l=g("Sidebar"),_=g("Navbar"),y=g("Footer");return i(),d(U,null,[e("div",z,[F(l),e("div",H,[F(_),e("div",W,[e("div",A,[e("div",G,[e("div",J,[e("div",K,[e("h6",Q,p(o.route.params.chapterId?"編輯章節":"新增章節"),1),e("form",{onSubmit:t[8]||(t[8]=R((...s)=>o.saveChapter&&o.saveChapter(...s),["prevent"]))},[e("div",X,[t[11]||(t[11]=e("label",{for:"title",class:"form-label"},"章節標題",-1)),f(e("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":t[0]||(t[0]=s=>o.chapter.title=s),required:""},null,512),[[C,o.chapter.title]])]),t[18]||(t[18]=e("div",{class:"mb-3"},[e("label",{for:"editor",class:"form-label"},"章節內容"),e("div",{id:"editor"})],-1)),e("div",Y,[t[12]||(t[12]=e("label",{class:"form-label"},"PDF檔案",-1)),e("input",{type:"file",class:"form-control",accept:".pdf",onChange:t[1]||(t[1]=(...s)=>o.handlePdfUpload&&o.handlePdfUpload(...s))},null,32),o.chapter.pdfFile?(i(),d("div",Z,[e("span",null,p(o.chapter.pdfFile.name),1),e("button",{type:"button",class:"btn btn-danger btn-sm ms-2",onClick:t[2]||(t[2]=(...s)=>o.removePdf&&o.removePdf(...s))}," 移除 ")])):h("",!0)]),e("div",$,[t[14]||(t[14]=e("label",{class:"form-label"},"影片檔案",-1)),o.chapter.videoFile?(i(),d("div",ee,[e("div",te,[e("video",{ref:"videoPlayer",class:"w-100",controls:"",style:{"max-height":"300px","background-color":"#000"},src:typeof o.chapter.videoFile=="string"?o.chapter.videoFile:u.URL.createObjectURL(o.chapter.videoFile)},null,8,oe),e("div",se,p(typeof o.chapter.videoFile=="string"?o.chapter.videoFile.split("/").pop():o.chapter.videoFile.name),1)])])):h("",!0),e("input",{type:"file",class:"form-control",accept:".mp4,.mov",onChange:t[3]||(t[3]=(...s)=>o.handleVideoUpload&&o.handleVideoUpload(...s))},null,32),o.chapter.videoFile?(i(),d("div",le,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:t[4]||(t[4]=(...s)=>o.removeVideo&&o.removeVideo(...s))}," 移除 "),t[13]||(t[13]=e("button",{class:"m-2 btn btn-info btn-sm"},[e("i",{class:"material-icons align-middle me-1"},"edit"),S(" Vimeo編輯 ")],-1))])):h("",!0)]),e("div",ae,[t[15]||(t[15]=e("label",{class:"form-label"},"影片筆記",-1)),(i(!0),d(U,null,I(o.chapter.notes,(s,b)=>(i(),d("div",{key:b,class:"row mb-2"},[e("div",ne,[f(e("input",{type:"text",class:"form-control","onUpdate:modelValue":v=>s.time=v,placeholder:"mm:ss",pattern:"\\d{2}:\\d{2}",title:"請輸入正確的時間格式（分:秒）"},null,8,ie),[[C,s.time]])]),e("div",de,[f(e("input",{type:"text",class:"form-control","onUpdate:modelValue":v=>s.content=v,placeholder:"筆記內容"},null,8,re),[[C,s.content]])]),e("div",ce,[e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:v=>o.removeNote(b)}," 刪除 ",8,ve)])]))),128)),e("button",{type:"button",class:"btn btn-primary mt-2",onClick:t[5]||(t[5]=(...s)=>o.addNote&&o.addNote(...s))}," 新增筆記 ")]),e("div",me,[t[17]||(t[17]=e("label",{for:"status",class:"form-label"},"狀態",-1)),f(e("select",{class:"form-select",id:"status","onUpdate:modelValue":t[6]||(t[6]=s=>o.chapter.status=s)},t[16]||(t[16]=[e("option",{value:"草稿"},"草稿",-1),e("option",{value:"已發布"},"已發布",-1)]),512),[[j,o.chapter.status]])]),e("button",{type:"submit",class:"btn btn-primary me-2",disabled:o.isLoading},p(o.isLoading?"儲存中...":"儲存"),9,pe),e("button",{type:"button",class:"btn btn-secondary",onClick:t[7]||(t[7]=s=>u.router.back())}," 取消 ")],32)])])])])]),F(y)])]),o.showModal?(i(),d("div",{key:0,class:D(["modal fade",{show:o.showModal}]),id:"messageModal",tabindex:"-1"},[e("div",ue,[e("div",be,[e("div",fe,[t[19]||(t[19]=e("h5",{class:"modal-title"},"系統提示",-1)),e("button",{type:"button",class:"btn-close",onClick:t[9]||(t[9]=s=>o.showModal=!1)})]),e("div",he,p(o.modalMessage),1),e("div",_e,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[10]||(t[10]=s=>o.showModal=!1)}," 關閉 ")])])])],2)):h("",!0)],64)}const we=N(T,[["render",ye]]);export{we as default};
