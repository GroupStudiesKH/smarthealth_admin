import{_ as j,o as d,c as u,b as t,l as m,t as r,F as h,f as C,n as k,a as N,p as F,u as B,r as c,i as I,j as v,k as p,h as M,d as P,m as L}from"./index-25cf0606.js";import{F as z,N as T,_ as V,a as b}from"./sidebar-d63d104f.js";import{S as A}from"./StudentDetailModal-d5a825e6.js";import{L as U}from"./loading-af52cca8.js";const O={name:"ExamReviewModal",props:{show:{type:Boolean,required:!0},examData:{type:Object,required:!0}},emits:["update:show"],setup(R,{emit:e}){return{closeModal:()=>{e("update:show",!1)}}}},G={key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-hidden":"true"},H={class:"modal-dialog modal-lg",role:"document"},J={class:"modal-content"},K={class:"modal-header"},Q={class:"modal-body"},W={class:"exam-info mb-4"},X={class:"row"},Y={class:"col-md-6"},Z={class:"answer-list"},$={class:"table-responsive"},tt={class:"table"},et={key:0,class:"badge bg-success"},st={key:1,class:"badge bg-danger"};function ot(R,e,l,s,f,y){return l.show?(d(),u("div",G,[t("div",H,[t("div",J,[t("div",K,[e[1]||(e[1]=t("h5",{class:"modal-title"},"測驗閱卷詳情",-1)),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...i)=>s.closeModal&&s.closeModal(...i))})]),t("div",Q,[t("div",W,[t("div",X,[t("div",Y,[t("p",null,[e[2]||(e[2]=t("strong",null,"測驗名稱：",-1)),m(r(l.examData.examName),1)]),t("p",null,[e[3]||(e[3]=t("strong",null,"測驗時間：",-1)),m(r(l.examData.examTime),1)]),t("p",null,[e[4]||(e[4]=t("strong",null,"考試分數：",-1)),m(r(l.examData.score)+"分",1)])])])]),t("div",Z,[e[6]||(e[6]=t("h6",null,"作答詳情",-1)),t("div",$,[t("table",tt,[e[5]||(e[5]=t("thead",null,[t("tr",null,[t("th",null,"題號"),t("th",null,"題目"),t("th",null,"學生答案"),t("th",null,"正確答案"),t("th",null,"是否正確"),t("th",null,"填答時間")])],-1)),t("tbody",null,[(d(!0),u(h,null,C(l.examData.answers,i=>(d(),u("tr",{key:i.questionId,class:k({"table-success":i.isCorrect,"table-danger":!i.isCorrect})},[t("td",null,r(i.questionId),1),t("td",null,r(i.question),1),t("td",null,r(i.studentAnswer),1),t("td",null,r(i.correctAnswer),1),t("td",null,[i.isCorrect?(d(),u("span",et,"正確")):(d(),u("span",st,"錯誤"))]),t("td",null,r(i.answerTime),1)],2))),128))])])])])])])])])):N("",!0)}const lt=j(O,[["render",ot],["__scopeId","data-v-fab8bc24"]]);const at={components:{Footer:z,Navbar:T,Sidebar:V,StudentDetailModal:A,ExamReviewModal:lt,Loading:U},setup(){F();const e=B().params.id,l=c(!1),s=c(!1),f=c(null),y=c(!1),i=c(null),w=c({name:"",instructor:"",category:"",completionRate:0,averageScore:0,chapters:[],students:[]}),x=c([]),D=c(0),S=c(0),E=async()=>{try{l.value=!0;const a=await b.getCourseReport(e);w.value={name:a.title,instructor:a.instructors.join(", "),category:a.categories.join(", "),completionRate:a.completion_rate,averageScore:a.average_score,chapters:a.chapters.map(n=>({name:n.title,completionRate:n.completion_rate}))},l.value=!1}catch(a){l.value=!1,console.error("Error loading course report:",a)}},_=async()=>{try{l.value=!0;const a=await b.getCourseStudents(e,{page:g.value});x.value=a.students,D.value=a.total,S.value=a.totalPages,l.value=!1}catch(a){l.value=!1,console.error("Error loading students:",a)}},o=async()=>{l.value=!0,await b.getCourseReportExcel(e),l.value=!1};I(()=>{E(),_()});const g=c(1);return{courseDetail:w,currentPage:g,students:x,totalStudentPages:S,handlePageChange:async a=>{g.value=a,await _()},viewStudent:async a=>{try{l.value=!0;const n=await b.getCourseStudent(e,a);f.value={id:a,name:n.student_info.name,email:n.student_info.email,courseName:n.course_info.title,progress:n.course_info.progress,totalTime:`${n.student_info.total_study_hours}小時`,lastAccess:n.student_info.last_login,chapterProgress:n.chapters.map(q=>({title:q.title,progress:q.progress})),quizResults:n.quizResults},s.value=!0,l.value=!1}catch(n){console.error("Error fetching student details:",n)}},showStudentModal:s,selectedStudent:f,showExamModal:y,selectedExamData:i,viewExam:async a=>{try{l.value=!0;const n=await b.getStudentExamDetail({course_id:e,user_id:a});i.value=n,y.value=!0,l.value=!1}catch(n){console.error("Error fetching student details:",n),n.response&&n.response.status===404&&alert("此學生尚未進行考試")}},exportReport:o,courseId:e,loading:l}}},nt={class:"main-wrapper"},rt={class:"page-wrapper"},it={class:"page-content"},dt={class:"row"},ut={class:"col-md-12 grid-margin stretch-card"},ct={class:"card"},mt={class:"card-body"},gt={class:"d-flex justify-content-between align-items-center mb-3"},vt={class:"course-info mt-3"},_t={class:"row"},pt={class:"col-md-6"},bt={class:"col-md-6"},ht={class:"progress"},ft={class:"progress"},yt={class:"table-responsive"},wt={class:"table table-hover"},xt={class:"progress"},St={class:"table-responsive"},Ct={class:"table table-hover"},kt={class:"btn-group"},Rt=["onClick"],Dt=["onClick"],Et={key:0,class:"mt-3"},Mt={class:"pagination justify-content-center"},Pt=["onClick"];function Nt(R,e,l,s,f,y){var _;const i=v("Sidebar"),w=v("Navbar"),x=v("StudentDetailModal"),D=v("ExamReviewModal"),S=v("Footer"),E=v("Loading");return d(),u(h,null,[t("div",nt,[p(i),t("div",rt,[p(w),t("div",it,[t("div",dt,[t("div",ut,[t("div",ct,[t("div",mt,[t("div",gt,[e[6]||(e[6]=t("h6",{class:"card-title mb-0"},"課程詳細報表",-1)),t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=(...o)=>s.exportReport&&s.exportReport(...o))},e[5]||(e[5]=[t("i",{class:"material-icons align-middle me-1"},"file_download",-1),m(" 匯出報表 ")]))]),e[14]||(e[14]=t("hr",null,null,-1)),t("div",vt,[t("div",_t,[t("div",pt,[t("p",null,[e[7]||(e[7]=t("strong",null,"課程名稱：",-1)),m(r(s.courseDetail.name),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"講師：",-1)),m(r(s.courseDetail.instructor),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"課程分類：",-1)),m(r(s.courseDetail.category),1)])]),t("div",bt,[e[10]||(e[10]=t("strong",null,"平均完課率：",-1)),t("div",ht,[t("div",{class:"progress-bar bg-success",role:"progressbar",style:M({width:s.courseDetail.completionRate+"%"})},r(s.courseDetail.completionRate)+"% ",5)]),e[11]||(e[11]=t("strong",null,"平均成績：",-1)),t("div",ft,[t("div",{class:"progress-bar bg-info",role:"progressbar",style:M({width:s.courseDetail.averageScore+"%"})},r(s.courseDetail.averageScore)+"分 ",5)])])])]),e[15]||(e[15]=t("h6",{class:"card-subtitle mt-3"},"章節完成率",-1)),e[16]||(e[16]=t("hr",null,null,-1)),t("div",yt,[t("table",wt,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"章節名稱"),t("th",null,"完成率")])],-1)),t("tbody",null,[(d(!0),u(h,null,C(s.courseDetail.chapters,o=>(d(),u("tr",{key:o.name},[t("td",null,r(o.name),1),t("td",null,[t("div",xt,[t("div",{class:"progress-bar bg-success",role:"progressbar",style:M({width:o.completionRate+"%"})},r(o.completionRate)+"% ",5)])])]))),128))])])]),e[17]||(e[17]=t("h6",{class:"card-subtitle mt-3"},"參加學生列表",-1)),e[18]||(e[18]=t("hr",null,null,-1)),t("div",St,[t("table",Ct,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",null,"學生名稱"),t("th",null,"學生Email"),t("th",null,"操作")])],-1)),t("tbody",null,[(d(!0),u(h,null,C(s.students,o=>(d(),u("tr",{key:o.id},[t("td",null,r(o.name),1),t("td",null,r(o.email),1),t("td",null,[t("div",kt,[t("button",{class:"btn btn-primary btn-sm",onClick:g=>s.viewStudent(o.id)}," 檢視 ",8,Rt),t("button",{class:"btn btn-info btn-sm",onClick:g=>s.viewExam(o.id)}," 測驗閱卷詳情 ",8,Dt)])])]))),128))])])]),s.totalStudentPages>1?(d(),u("nav",Et,[t("ul",Mt,[t("li",{class:k(["page-item",{disabled:s.currentPage===1}])},[t("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=P(o=>s.handlePageChange(s.currentPage-1),["prevent"]))}," 上一頁 ")],2),(d(!0),u(h,null,C(s.totalStudentPages,o=>(d(),u("li",{key:o,class:k(["page-item",{active:s.currentPage===o}])},[t("a",{class:"page-link",href:"#",onClick:P(g=>s.handlePageChange(o),["prevent"])},r(o),9,Pt)],2))),128)),t("li",{class:k(["page-item",{disabled:s.currentPage===s.totalStudentPages}])},[t("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=P(o=>s.handlePageChange(s.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])):N("",!0),p(x,{show:s.showStudentModal,"onUpdate:show":e[3]||(e[3]=o=>s.showStudentModal=o),student:s.selectedStudent,"course-id":s.courseId,"student-id":(_=s.selectedStudent)==null?void 0:_.id},null,8,["show","student","course-id","student-id"]),p(D,{show:s.showExamModal,"onUpdate:show":e[4]||(e[4]=o=>s.showExamModal=o),examData:s.selectedExamData},null,8,["show","examData"])])])])])]),p(S)])]),s.loading?(d(),L(E,{key:0})):N("",!0)],64)}const Tt=j(at,[["render",Nt],["__scopeId","data-v-34e01f7e"]]);export{Tt as default};
