import{_ as x,i as N,r as l,j as V,k as b,o as e,c as t,b as a,l as k,d as C,e as f,g as M,n as d,t as n,a as m,v as E,F as D,f as U,s as P,p as F}from"./index-b90c0ad9.js";import{a as S}from"./api-service-e3b33b42.js";import{L as B}from"./loading-113a0e4d.js";import{F as T,N as q,_ as I}from"./sidebar-87f173a3.js";const J={components:{Footer:T,Navbar:q,Sidebar:I,Loading:B},setup(){N();const w=l([]),o=l({name:"",email:"",permission_group_id:"",new_password:""}),h=l(!1),s=l(!1),p=l(""),u=l(""),_=l({}),c=l(!1),y=async()=>{var r;try{c.value=!0,await S.adminEdit(o.value),sessionStorage.setItem("userData",JSON.stringify(o.value)),v("成功","使用者資料已成功更新"),c.value=!1,_.value={}}catch(g){_.value=((r=g.response)==null?void 0:r.data.content)||{},c.value=!1,v("錯誤","更新使用者資料失敗，請檢查輸入並再試一次")}},v=(r,g)=>{u.value=r,p.value=g,s.value=!0},i=()=>{s.value=!1},L=async()=>{try{const r=await S.getPermissionGroups();w.value=r}catch(r){console.error("Error fetching permission list:",r),v("錯誤","獲取權限列表失敗，請再試一次")}};return V(()=>{L();const r=sessionStorage.getItem("userData");r?o.value={...JSON.parse(r),password:"",password_confirmation:""}:console.error("User data not found in sessionStorage")}),{showPassword:h,userData:o,isLoading:c,adminEdit:y,permissionList:w,showModal:s,modalMessage:p,modalTitle:u,closeModal:i,errors:_}}},O={class:"main-wrapper"},j={class:"page-wrapper"},z={class:"page-content"},G={class:"row mb-4"},R={class:"col-12 col-lg-8 mx-auto stretch-card"},A={class:"card"},H={class:"card-body"},K={class:"mb-3"},Q={key:0,class:"invalid-feedback"},W={class:"mb-3"},X={class:"mb-3"},Y=["value"],Z={key:0,class:"invalid-feedback"},$={class:"mb-3"},ss={class:"input-group"},os=["type"],as={key:0,class:"invalid-feedback"},is={class:"mb-3"},rs={class:"input-group"},es=["type"],ts={key:0,class:"invalid-feedback"},ns={class:"modal-dialog"},ls={class:"modal-content"},ds={class:"modal-header"},ms={class:"modal-title"},cs={class:"modal-body"},_s={class:"modal-footer"},vs={key:1,class:"modal-backdrop fade show"};function fs(w,o,h,s,p,u){const _=b("Sidebar"),c=b("Navbar"),y=b("Footer"),v=b("Loading");return e(),t(D,null,[a("div",O,[k(_),a("div",j,[k(c),a("div",z,[a("div",G,[a("div",R,[a("div",A,[a("div",H,[o[17]||(o[17]=a("h6",{class:"card-title"},"編輯使用者資料",-1)),a("form",{onSubmit:o[7]||(o[7]=C((...i)=>s.adminEdit&&s.adminEdit(...i),["prevent"]))},[a("div",K,[o[10]||(o[10]=a("label",{for:"name",class:"form-label"},"姓名",-1)),f(a("input",{type:"text",class:d(["form-control",{"is-invalid":s.errors.name}]),id:"name","onUpdate:modelValue":o[0]||(o[0]=i=>s.userData.name=i),required:""},null,2),[[M,s.userData.name]]),s.errors.name?(e(),t("div",Q,n(s.errors.name[0]),1)):m("",!0)]),a("div",W,[o[11]||(o[11]=a("label",{for:"email",class:"form-label"},"電子郵件",-1)),f(a("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":o[1]||(o[1]=i=>s.userData.email=i),disabled:""},null,512),[[M,s.userData.email]])]),a("div",X,[o[13]||(o[13]=a("label",{for:"permission_group_id",class:"form-label"},"權限群組",-1)),f(a("select",{class:d(["form-select",{"is-invalid":s.errors.permission_group_id}]),id:"permission_group_id","onUpdate:modelValue":o[2]||(o[2]=i=>s.userData.permission_group_id=i),required:""},[o[12]||(o[12]=a("option",{value:""},"請選擇權限群組",-1)),(e(!0),t(D,null,U(s.permissionList,i=>(e(),t("option",{key:i.id,value:i.id},n(i.name),9,Y))),128))],2),[[E,s.userData.permission_group_id]]),s.errors.permission_group_id?(e(),t("div",Z,n(s.errors.permission_group_id[0]),1)):m("",!0)]),a("div",$,[o[14]||(o[14]=a("label",{for:"new_password",class:"form-label"},"更改密碼",-1)),a("div",ss,[f(a("input",{type:s.showPassword?"text":"password",class:d(["form-control",{"is-invalid":s.errors.password}]),id:"password","onUpdate:modelValue":o[3]||(o[3]=i=>s.userData.password=i)},null,10,os),[[P,s.userData.password]]),a("button",{class:"btn btn-outline-secondary",type:"button",onClick:o[4]||(o[4]=i=>s.showPassword=!s.showPassword)},[a("i",{class:d((s.showPassword,"material-icons"))},n(s.showPassword?"visibility_off":"visibility"),3)]),s.errors.password?(e(),t("div",as,n(s.errors.password[0]),1)):m("",!0)])]),a("div",is,[o[15]||(o[15]=a("label",{for:"password_confirmation",class:"form-label"},"確認密碼",-1)),a("div",rs,[f(a("input",{type:s.showPassword?"text":"password",class:d(["form-control",{"is-invalid":s.errors.password_confirmation}]),id:"password_confirmation","onUpdate:modelValue":o[5]||(o[5]=i=>s.userData.password_confirmation=i)},null,10,es),[[P,s.userData.password_confirmation]]),a("button",{class:"btn btn-outline-secondary",type:"button",onClick:o[6]||(o[6]=i=>s.showPassword=!s.showPassword)},[a("i",{class:d((s.showPassword,"material-icons"))},n(s.showPassword?"visibility_off":"visibility"),3)]),s.errors.password_confirmation?(e(),t("div",ts,n(s.errors.password_confirmation[0]),1)):m("",!0)])]),o[16]||(o[16]=a("button",{type:"submit",class:"btn btn-primary"}," 更新資料 ",-1))],32)])])])]),s.showModal?(e(),t("div",{key:0,class:d(["modal fade",{show:s.showModal}]),tabindex:"-1",style:{display:"block"}},[a("div",ns,[a("div",ls,[a("div",ds,[a("h5",ms,n(s.modalTitle),1),a("button",{type:"button",class:"btn-close",onClick:o[8]||(o[8]=(...i)=>s.closeModal&&s.closeModal(...i))})]),a("div",cs,[a("p",null,n(s.modalMessage),1)]),a("div",_s,[a("button",{type:"button",class:"btn btn-secondary",onClick:o[9]||(o[9]=(...i)=>s.closeModal&&s.closeModal(...i))}," 關閉 ")])])])],2)):m("",!0),s.showModal?(e(),t("div",vs)):m("",!0)]),k(y)])]),s.isLoading?(e(),F(v,{key:0})):m("",!0)],64)}const ys=x(J,[["render",fs]]);export{ys as default};
