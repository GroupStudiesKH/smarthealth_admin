import{_ as N,o as d,c as i,b as t,l as _,t as a,F as S,f as C,n as k,a as q,p as j,u as z,r as u,i as F,j as b,k as p,h as M,d as P}from"./index-56250ee1.js";import{F as I,N as B,_ as T,a as h}from"./sidebar-e7787657.js";import{S as V}from"./StudentDetailModal-d4f3d0ee.js";const A={name:"ExamReviewModal",props:{show:{type:Boolean,required:!0},examData:{type:Object,required:!0}},emits:["update:show"],setup(D,{emit:e}){return{closeModal:()=>{e("update:show",!1)}}}},U={key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-hidden":"true"},L={class:"modal-dialog modal-lg",role:"document"},O={class:"modal-content"},G={class:"modal-header"},H={class:"modal-body"},J={class:"exam-info mb-4"},K={class:"row"},Q={class:"col-md-6"},W={class:"answer-list"},X={class:"table-responsive"},Y={class:"table"},Z={key:0,class:"badge bg-success"},$={key:1,class:"badge bg-danger"};function tt(D,e,c,s,f,y){return c.show?(d(),i("div",U,[t("div",L,[t("div",O,[t("div",G,[e[1]||(e[1]=t("h5",{class:"modal-title"},"測驗閱卷詳情",-1)),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...r)=>s.closeModal&&s.closeModal(...r))})]),t("div",H,[t("div",J,[t("div",K,[t("div",Q,[t("p",null,[e[2]||(e[2]=t("strong",null,"測驗名稱：",-1)),_(a(c.examData.examName),1)]),t("p",null,[e[3]||(e[3]=t("strong",null,"測驗時間：",-1)),_(a(c.examData.examTime),1)]),t("p",null,[e[4]||(e[4]=t("strong",null,"考試分數：",-1)),_(a(c.examData.score)+"分",1)])])])]),t("div",W,[e[6]||(e[6]=t("h6",null,"作答詳情",-1)),t("div",X,[t("table",Y,[e[5]||(e[5]=t("thead",null,[t("tr",null,[t("th",null,"題號"),t("th",null,"題目"),t("th",null,"學生答案"),t("th",null,"正確答案"),t("th",null,"是否正確"),t("th",null,"填答時間")])],-1)),t("tbody",null,[(d(!0),i(S,null,C(c.examData.answers,r=>(d(),i("tr",{key:r.questionId,class:k({"table-success":r.isCorrect,"table-danger":!r.isCorrect})},[t("td",null,a(r.questionId),1),t("td",null,a(r.question),1),t("td",null,a(r.studentAnswer),1),t("td",null,a(r.correctAnswer),1),t("td",null,[r.isCorrect?(d(),i("span",Z,"正確")):(d(),i("span",$,"錯誤"))]),t("td",null,a(r.answerTime),1)],2))),128))])])])])])])])])):q("",!0)}const et=N(A,[["render",tt],["__scopeId","data-v-fab8bc24"]]);const st={components:{Footer:I,Navbar:B,Sidebar:T,StudentDetailModal:V,ExamReviewModal:et},setup(){j();const e=z().params.id,c=u(!1),s=u(null),f=u(!1),y=u(null),r=u({name:"",instructor:"",category:"",completionRate:0,averageScore:0,chapters:[],students:[]}),w=u([]),R=u(0),x=u(0),E=async()=>{try{const l=await h.getCourseReport(e);r.value={name:l.title,instructor:l.instructors.join(", "),category:l.categories.join(", "),completionRate:l.completion_rate,averageScore:l.average_score,chapters:l.chapters.map(n=>({name:n.title,completionRate:n.completion_rate}))}}catch(l){console.error("Error loading course report:",l)}},v=async()=>{try{const l=await h.getCourseStudents(e,{page:g.value});w.value=l.students,R.value=l.total,x.value=l.totalPages}catch(l){console.error("Error loading students:",l)}},o=()=>{h.getCourseReportExcel(e)};F(()=>{E(),v()});const g=u(1);return{courseDetail:r,currentPage:g,students:w,totalStudentPages:x,handlePageChange:async l=>{g.value=l,await v()},viewStudent:async l=>{try{const n=await h.getCourseStudent(e,l);s.value={id:l,name:n.student_info.name,email:n.student_info.email,courseName:n.course_info.title,progress:n.course_info.progress,totalTime:`${n.student_info.total_study_hours}小時`,lastAccess:n.student_info.last_login,chapterProgress:n.chapters.map(m=>({name:m.title,progress:m.progress,score:m.quiz_score})),quizResults:n.chapters.map(m=>({name:`${m.title}測驗`,score:m.quiz_score,date:m.quiz_completed_at||"-"}))},c.value=!0}catch(n){console.error("Error fetching student details:",n)}},showStudentModal:c,selectedStudent:s,showExamModal:f,selectedExamData:y,viewExam:async l=>{try{const n=await h.getStudentExamDetail({course_id:e,user_id:l});y.value=n,f.value=!0}catch(n){console.error("Error fetching student details:",n),n.response&&n.response.status===404&&alert("此學生尚未進行考試")}},exportReport:o,courseId:e}}},ot={class:"main-wrapper"},lt={class:"page-wrapper"},nt={class:"page-content"},at={class:"row"},rt={class:"col-md-12 grid-margin stretch-card"},dt={class:"card"},it={class:"card-body"},ct={class:"d-flex justify-content-between align-items-center mb-3"},ut={class:"course-info mt-3"},mt={class:"row"},_t={class:"col-md-6"},gt={class:"col-md-6"},vt={class:"progress"},bt={class:"progress"},pt={class:"table-responsive"},ht={class:"table table-hover"},ft={class:"progress"},yt={class:"table-responsive"},wt={class:"table table-hover"},xt={class:"btn-group"},St=["onClick"],Ct=["onClick"],kt={key:0,class:"mt-3"},Dt={class:"pagination justify-content-center"},Rt=["onClick"];function Et(D,e,c,s,f,y){var v;const r=b("Sidebar"),w=b("Navbar"),R=b("StudentDetailModal"),x=b("ExamReviewModal"),E=b("Footer");return d(),i("div",ot,[p(r),t("div",lt,[p(w),t("div",nt,[t("div",at,[t("div",rt,[t("div",dt,[t("div",it,[t("div",ct,[e[6]||(e[6]=t("h6",{class:"card-title mb-0"},"課程詳細報表",-1)),t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=(...o)=>s.exportReport&&s.exportReport(...o))},e[5]||(e[5]=[t("i",{class:"material-icons align-middle me-1"},"file_download",-1),_(" 匯出報表 ")]))]),e[14]||(e[14]=t("hr",null,null,-1)),t("div",ut,[t("div",mt,[t("div",_t,[t("p",null,[e[7]||(e[7]=t("strong",null,"課程名稱：",-1)),_(a(s.courseDetail.name),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"講師：",-1)),_(a(s.courseDetail.instructor),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"課程分類：",-1)),_(a(s.courseDetail.category),1)])]),t("div",gt,[e[10]||(e[10]=t("strong",null,"總完課率：",-1)),t("div",vt,[t("div",{class:"progress-bar bg-success",role:"progressbar",style:M({width:s.courseDetail.completionRate+"%"})},a(s.courseDetail.completionRate)+"% ",5)]),e[11]||(e[11]=t("strong",null,"平均成績：",-1)),t("div",bt,[t("div",{class:"progress-bar bg-info",role:"progressbar",style:M({width:s.courseDetail.averageScore+"%"})},a(s.courseDetail.averageScore)+"分 ",5)])])])]),e[15]||(e[15]=t("h6",{class:"card-subtitle mt-3"},"章節完成率",-1)),e[16]||(e[16]=t("hr",null,null,-1)),t("div",pt,[t("table",ht,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"章節名稱"),t("th",null,"完成率")])],-1)),t("tbody",null,[(d(!0),i(S,null,C(s.courseDetail.chapters,o=>(d(),i("tr",{key:o.name},[t("td",null,a(o.name),1),t("td",null,[t("div",ft,[t("div",{class:"progress-bar bg-success",role:"progressbar",style:M({width:o.completionRate+"%"})},a(o.completionRate)+"% ",5)])])]))),128))])])]),e[17]||(e[17]=t("h6",{class:"card-subtitle mt-3"},"參加學生列表",-1)),e[18]||(e[18]=t("hr",null,null,-1)),t("div",yt,[t("table",wt,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",null,"學生名稱"),t("th",null,"學生Email"),t("th",null,"操作")])],-1)),t("tbody",null,[(d(!0),i(S,null,C(s.students,o=>(d(),i("tr",{key:o.id},[t("td",null,a(o.name),1),t("td",null,a(o.email),1),t("td",null,[t("div",xt,[t("button",{class:"btn btn-primary btn-sm",onClick:g=>s.viewStudent(o.id)}," 檢視 ",8,St),t("button",{class:"btn btn-info btn-sm",onClick:g=>s.viewExam(o.id)}," 測驗閱卷詳情 ",8,Ct)])])]))),128))])])]),s.totalStudentPages>1?(d(),i("nav",kt,[t("ul",Dt,[t("li",{class:k(["page-item",{disabled:s.currentPage===1}])},[t("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=P(o=>s.handlePageChange(s.currentPage-1),["prevent"]))}," 上一頁 ")],2),(d(!0),i(S,null,C(s.totalStudentPages,o=>(d(),i("li",{key:o,class:k(["page-item",{active:s.currentPage===o}])},[t("a",{class:"page-link",href:"#",onClick:P(g=>s.handlePageChange(o),["prevent"])},a(o),9,Rt)],2))),128)),t("li",{class:k(["page-item",{disabled:s.currentPage===s.totalStudentPages}])},[t("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=P(o=>s.handlePageChange(s.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])):q("",!0),p(R,{show:s.showStudentModal,"onUpdate:show":e[3]||(e[3]=o=>s.showStudentModal=o),student:s.selectedStudent,"course-id":s.courseId,"student-id":(v=s.selectedStudent)==null?void 0:v.id},null,8,["show","student","course-id","student-id"]),p(x,{show:s.showExamModal,"onUpdate:show":e[4]||(e[4]=o=>s.showExamModal=o),examData:s.selectedExamData},null,8,["show","examData"])])])])])]),p(E)])])}const Ft=N(st,[["render",Et],["__scopeId","data-v-358de7fe"]]);export{Ft as default};
