import{_ as I,o as i,c as u,b as e,m,t as r,F as h,f as C,n as k,a as N,i as j,u as F,r as c,j as B,k as g,l as p,h as M,d as P,p as L}from"./index-b90c0ad9.js";import{F as z,N as T,_ as V}from"./sidebar-87f173a3.js";import{S as A}from"./StudentDetailModal-44e16c95.js";import{a as b}from"./api-service-e3b33b42.js";import{L as U}from"./loading-113a0e4d.js";const O={name:"ExamReviewModal",props:{show:{type:Boolean,required:!0},examData:{type:Object,required:!0}},emits:["update:show"],setup(R,{emit:t}){return{closeModal:()=>{t("update:show",!1)}}}},G={key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-hidden":"true"},H={class:"modal-dialog modal-lg",role:"document"},J={class:"modal-content"},K={class:"modal-header"},Q={class:"modal-body"},W={class:"exam-info mb-4"},X={class:"row"},Y={class:"col-md-6"},Z={class:"answer-list"},$={class:"table-responsive"},ee={class:"table"},te={key:0,class:"badge bg-success"},se={key:1,class:"badge bg-danger"};function oe(R,t,l,s,f,y){return l.show?(i(),u("div",G,[e("div",H,[e("div",J,[e("div",K,[t[1]||(t[1]=e("h5",{class:"modal-title"},"測驗閱卷詳情",-1)),e("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...d)=>s.closeModal&&s.closeModal(...d))})]),e("div",Q,[e("div",W,[e("div",X,[e("div",Y,[e("p",null,[t[2]||(t[2]=e("strong",null,"測驗名稱：",-1)),m(r(l.examData.examName),1)]),e("p",null,[t[3]||(t[3]=e("strong",null,"測驗時間：",-1)),m(r(l.examData.examTime),1)]),e("p",null,[t[4]||(t[4]=e("strong",null,"考試分數：",-1)),m(r(l.examData.score)+"分",1)])])])]),e("div",Z,[t[6]||(t[6]=e("h6",null,"作答詳情",-1)),e("div",$,[e("table",ee,[t[5]||(t[5]=e("thead",null,[e("tr",null,[e("th",null,"題號"),e("th",null,"題目"),e("th",null,"學生答案"),e("th",null,"正確答案"),e("th",null,"是否正確"),e("th",null,"填答時間")])],-1)),e("tbody",null,[(i(!0),u(h,null,C(l.examData.answers,d=>(i(),u("tr",{key:d.questionId,class:k({"table-success":d.isCorrect,"table-danger":!d.isCorrect})},[e("td",null,r(d.questionId),1),e("td",null,r(d.question),1),e("td",null,r(d.studentAnswer),1),e("td",null,r(d.correctAnswer),1),e("td",null,[d.isCorrect?(i(),u("span",te,"正確")):(i(),u("span",se,"錯誤"))]),e("td",null,r(d.answerTime),1)],2))),128))])])])])])])])])):N("",!0)}const le=I(O,[["render",oe],["__scopeId","data-v-fab8bc24"]]);const ae={components:{Footer:z,Navbar:T,Sidebar:V,StudentDetailModal:A,ExamReviewModal:le,Loading:U},setup(){j();const t=F().params.id,l=c(!1),s=c(!1),f=c(null),y=c(!1),d=c(null),w=c({name:"",instructor:"",category:"",completionRate:0,averageScore:0,chapters:[],students:[]}),x=c([]),D=c(0),S=c(0),E=async()=>{try{l.value=!0;const a=await b.getCourseReport(t);w.value={name:a.title,instructor:a.instructors.join(", "),category:a.categories.join(", "),completionRate:a.completion_rate,averageScore:a.average_score,chapters:a.chapters.map(n=>({name:n.title,completionRate:n.completion_rate}))},l.value=!1}catch(a){l.value=!1,console.error("Error loading course report:",a)}},_=async()=>{try{l.value=!0;const a=await b.getCourseStudents(t,{page:v.value});x.value=a.students,D.value=a.total,S.value=a.totalPages,l.value=!1}catch(a){l.value=!1,console.error("Error loading students:",a)}},o=async()=>{l.value=!0,await b.getCourseReportExcel(t),l.value=!1};B(()=>{E(),_()});const v=c(1);return{courseDetail:w,currentPage:v,students:x,totalStudentPages:S,handlePageChange:async a=>{v.value=a,await _()},viewStudent:async a=>{try{l.value=!0;const n=await b.getCourseStudent(t,a);f.value={id:a,name:n.student_info.name,email:n.student_info.email,courseName:n.course_info.title,progress:n.course_info.progress,totalTime:`${n.student_info.total_study_hours}小時`,lastAccess:n.student_info.last_login,chapterProgress:n.chapters.map(q=>({title:q.title,progress:q.progress})),quizResults:n.quizResults,examIsPassed:n.examIsPassed},s.value=!0,l.value=!1}catch(n){l.value=!1,console.error("Error fetching student details:",n)}},showStudentModal:s,selectedStudent:f,showExamModal:y,selectedExamData:d,viewExam:async a=>{try{l.value=!0;const n=await b.getStudentExamDetail({course_id:t,user_id:a});d.value=n,y.value=!0,l.value=!1}catch(n){console.error("Error fetching student details:",n),n.response&&n.response.status===404&&(l.value=!1,alert("此學生尚未進行考試"))}},exportReport:o,courseId:t,loading:l}}},ne={class:"main-wrapper"},re={class:"page-wrapper"},de={class:"page-content"},ie={class:"row"},ue={class:"col-md-12 grid-margin stretch-card"},ce={class:"card"},me={class:"card-body"},ve={class:"d-flex justify-content-between align-items-center mb-3"},ge={class:"course-info mt-3"},_e={class:"row"},pe={class:"col-md-6"},be={class:"col-md-6"},he={class:"progress"},fe={class:"progress"},ye={class:"table-responsive"},we={class:"table table-hover"},xe={class:"progress"},Se={class:"table-responsive"},Ce={class:"table table-hover"},ke={class:"btn-group"},Re=["onClick"],De=["onClick"],Ee={key:0,class:"mt-3"},Me={class:"pagination justify-content-center"},Pe=["onClick"];function Ne(R,t,l,s,f,y){var _;const d=g("Sidebar"),w=g("Navbar"),x=g("StudentDetailModal"),D=g("ExamReviewModal"),S=g("Footer"),E=g("Loading");return i(),u(h,null,[e("div",ne,[p(d),e("div",re,[p(w),e("div",de,[e("div",ie,[e("div",ue,[e("div",ce,[e("div",me,[e("div",ve,[t[6]||(t[6]=e("h6",{class:"card-title mb-0"},"課程詳細報表",-1)),e("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...o)=>s.exportReport&&s.exportReport(...o))},t[5]||(t[5]=[e("i",{class:"material-icons align-middle me-1"},"file_download",-1),m(" 匯出報表 ")]))]),t[14]||(t[14]=e("hr",null,null,-1)),e("div",ge,[e("div",_e,[e("div",pe,[e("p",null,[t[7]||(t[7]=e("strong",null,"課程名稱：",-1)),m(r(s.courseDetail.name),1)]),e("p",null,[t[8]||(t[8]=e("strong",null,"講師：",-1)),m(r(s.courseDetail.instructor),1)]),e("p",null,[t[9]||(t[9]=e("strong",null,"課程分類：",-1)),m(r(s.courseDetail.category),1)])]),e("div",be,[t[10]||(t[10]=e("strong",null,"平均完課率：",-1)),e("div",he,[e("div",{class:"progress-bar bg-success",role:"progressbar",style:M({width:s.courseDetail.completionRate+"%"})},r(s.courseDetail.completionRate)+"% ",5)]),t[11]||(t[11]=e("strong",null,"平均成績：",-1)),e("div",fe,[e("div",{class:"progress-bar bg-info",role:"progressbar",style:M({width:s.courseDetail.averageScore+"%"})},r(s.courseDetail.averageScore)+"分 ",5)])])])]),t[15]||(t[15]=e("h6",{class:"card-subtitle mt-3"},"章節完成率",-1)),t[16]||(t[16]=e("hr",null,null,-1)),e("div",ye,[e("table",we,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",null,"章節名稱"),e("th",null,"完成率")])],-1)),e("tbody",null,[(i(!0),u(h,null,C(s.courseDetail.chapters,o=>(i(),u("tr",{key:o.name},[e("td",null,r(o.name),1),e("td",null,[e("div",xe,[e("div",{class:"progress-bar bg-success",role:"progressbar",style:M({width:o.completionRate+"%"})},r(o.completionRate)+"% ",5)])])]))),128))])])]),t[17]||(t[17]=e("h6",{class:"card-subtitle mt-3"},"參加學生列表",-1)),t[18]||(t[18]=e("hr",null,null,-1)),e("div",Se,[e("table",Ce,[t[13]||(t[13]=e("thead",null,[e("tr",null,[e("th",null,"學生名稱"),e("th",null,"學生Email"),e("th",null,"操作")])],-1)),e("tbody",null,[(i(!0),u(h,null,C(s.students,o=>(i(),u("tr",{key:o.id},[e("td",null,r(o.name),1),e("td",null,r(o.email),1),e("td",null,[e("div",ke,[e("button",{class:"btn btn-primary btn-sm",onClick:v=>s.viewStudent(o.id)}," 檢視 ",8,Re),e("button",{class:"btn btn-info btn-sm",onClick:v=>s.viewExam(o.id)}," 測驗閱卷詳情 ",8,De)])])]))),128))])])]),s.totalStudentPages>1?(i(),u("nav",Ee,[e("ul",Me,[e("li",{class:k(["page-item",{disabled:s.currentPage===1}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=P(o=>s.handlePageChange(s.currentPage-1),["prevent"]))}," 上一頁 ")],2),(i(!0),u(h,null,C(s.totalStudentPages,o=>(i(),u("li",{key:o,class:k(["page-item",{active:s.currentPage===o}])},[e("a",{class:"page-link",href:"#",onClick:P(v=>s.handlePageChange(o),["prevent"])},r(o),9,Pe)],2))),128)),e("li",{class:k(["page-item",{disabled:s.currentPage===s.totalStudentPages}])},[e("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=P(o=>s.handlePageChange(s.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])):N("",!0),p(x,{show:s.showStudentModal,"onUpdate:show":t[3]||(t[3]=o=>s.showStudentModal=o),student:s.selectedStudent,"course-id":s.courseId,"student-id":(_=s.selectedStudent)==null?void 0:_.id},null,8,["show","student","course-id","student-id"]),p(D,{show:s.showExamModal,"onUpdate:show":t[4]||(t[4]=o=>s.showExamModal=o),examData:s.selectedExamData},null,8,["show","examData"])])])])])]),p(S)])]),s.loading?(i(),L(E,{key:0})):N("",!0)],64)}const Ve=I(ae,[["render",Ne],["__scopeId","data-v-37c96ade"]]);export{Ve as default};
