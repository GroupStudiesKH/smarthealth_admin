import{_ as B,r as d,w as D,o as r,c,a as x,b as e,t as b,d as V,e as M,v as T,F as h,f as q,g as I,n as E,h as R,u as G,i as J,j as F,k as j,l as A,m as z}from"./index-5d17c262.js";import{a as S,F as K,N as W,_ as X}from"./sidebar-7a9b5971.js";import{L as Y}from"./loading-0d0dfa95.js";const Z={name:"QuestionModal",props:{show:{type:Boolean,required:!0},questionID:{type:String,required:!0},chapterOptions:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!1}},emits:["update:show","save"],setup(y,{emit:o}){const l=d({id:"",chapter_id:"",question:"",type:"true_false",note:"",options:[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]}),t=d("true_false"),g=d(y.chapterOptions),k=d(y.questionID);D(()=>y.questionID,a=>{k.value=a,a?s(a):l.value={id:"",chapter_id:"",question:"",type:"true_false",note:"",options:[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]}});const n={true_false:"是非題",single_choice:"單選題",multiple_choice:"多選題"},m=d(!1),p=d(""),Q=d({}),v=a=>{p.value=a,m.value=!0},s=async a=>{try{l.value={id:"",chapter:"",question:"",type:"true_false",note:"",options:[]};const _=await S.getQuestion(a);l.value=_,t.value=_.type}catch{v("獲取題目失敗")}};D(()=>t.value,a=>{a==="true_false"?l.value.options=[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]:a!==l.value.type&&(l.value.options=[]),l.value.type=a});const f=a=>{l.value.type==="true_false"||l.value.type==="single_choice"?l.value.options.forEach((_,i)=>{_.is_correct=i===a}):l.value.options[a].is_correct=!l.value.options[a].is_correct},L=()=>{l.value.options.push({option_text:"",option_index:l.value.options.length,is_correct:!1})},N=a=>{l.value.options.splice(a,1),l.value.options.forEach((_,i)=>{_.option_index=i})},O=(a,_)=>{l.value.options[a].option_text=_},C=()=>{o("update:show",!1)};return{questionForm:l,questionTypes:n,chapterOptions:g,addOption:L,removeOption:N,updateOption:O,closeModal:C,saveQuestion:async()=>{var a,_;try{y.isEdit?await S.updateQuestion(k.value,l.value):await S.addQuestion(l.value),o("save",l.value),C()}catch(i){if(((_=(a=i.response)==null?void 0:a.data)==null?void 0:_.status)==="error")if(i.response.data.content){const u={};for(const[H,U]of Object.entries(i.response.data.content))u[H]=Array.isArray(U)?U[0].replace(/[\[\]"]/g,""):U;Q.value=u;const w=Object.values(u).join("<br/>");v("橫幅更新失敗："+(w||"未知錯誤"))}else v("橫幅更新失敗："+(i.response.data.message||"儲存失敗"));else v("儲存失敗")}},questionType:t,setAnswer:f,showModal:m,modalMessage:p,showErrorModal:v}}},$={key:0,class:"modal-backdrop fade show"},ee={key:1,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-hidden":"true"},te={class:"modal-dialog modal-lg",role:"document"},oe={class:"modal-content"},se={class:"modal-header"},ne={class:"modal-title"},le={class:"modal-body"},ae={class:"mb-3"},ie=["value"],re={class:"mb-3"},de=["value"],ce={class:"mb-3"},ue={class:"mb-3"},me={class:"options-container"},pe={class:"form-check flex-grow-1"},ve=["type","checked","onChange"],_e=["onUpdate:modelValue","placeholder","onInput"],be=["onClick"],fe={class:"mb-3"},he={class:"modal-footer"},ye={class:"modal-dialog"},ge={class:"modal-content"},ke={class:"modal-header"},we=["innerHTML"],xe={class:"modal-footer"},Me={key:2,class:"modal-backdrop fade show"};function Qe(y,o,l,t,g,k){return r(),c(h,null,[l.show?(r(),c("div",$)):x("",!0),l.show?(r(),c("div",ee,[e("div",te,[e("div",oe,[e("div",se,[e("h5",ne,b(l.isEdit?"編輯題目":"新增題目"),1),e("button",{type:"button",class:"btn-close",onClick:o[0]||(o[0]=(...n)=>t.closeModal&&t.closeModal(...n))})]),e("div",le,[e("form",{onSubmit:o[7]||(o[7]=V((...n)=>t.saveQuestion&&t.saveQuestion(...n),["prevent"]))},[e("div",ae,[o[10]||(o[10]=e("label",{class:"form-label"},"題型",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":o[1]||(o[1]=n=>t.questionType=n)},[(r(!0),c(h,null,q(t.questionTypes,(n,m)=>(r(),c("option",{key:m,value:m},b(n),9,ie))),128))],512),[[T,t.questionType]])]),e("div",re,[o[12]||(o[12]=e("label",{class:"form-label"},"所屬範圍",-1)),M(e("select",{class:"form-select","onUpdate:modelValue":o[2]||(o[2]=n=>t.questionForm.chapter_id=n),required:""},[o[11]||(o[11]=e("option",{value:""},"請選擇章節/考試範圍",-1)),(r(!0),c(h,null,q(t.chapterOptions,n=>(r(),c("option",{key:n.id,value:n.id},b(n.title),9,de))),128))],512),[[T,t.questionForm.chapter_id]])]),e("div",ce,[o[13]||(o[13]=e("label",{class:"form-label"},"題目內容",-1)),M(e("textarea",{class:"form-control","onUpdate:modelValue":o[3]||(o[3]=n=>t.questionForm.question=n),rows:"3",required:""},null,512),[[I,t.questionForm.question]])]),e("div",ue,[o[14]||(o[14]=e("label",{class:"form-label"},"選項與答案",-1)),e("div",me,[(r(!0),c(h,null,q(t.questionForm.options,(n,m)=>(r(),c("div",{key:m,class:"option-item mb-2 d-flex align-items-center"},[e("div",pe,[e("input",{type:t.questionForm.type==="multiple_choice"?"checkbox":"radio",name:"answer",class:"form-check-input",checked:n.is_correct,onChange:p=>t.setAnswer(m)},null,40,ve),M(e("input",{type:"text",class:"form-control d-inline-block ms-2",style:{width:"calc(100% - 30px)"},"onUpdate:modelValue":p=>n.option_text=p,placeholder:"選項"+(m+1),onInput:p=>t.updateOption(m,p.target.value)},null,40,_e),[[I,n.option_text]])]),t.questionForm.type!=="true_false"&&t.questionForm.options.length>1?(r(),c("button",{key:0,type:"button",class:"btn btn-outline-danger btn-sm ms-2",onClick:p=>t.removeOption(m)}," 刪除 ",8,be)):x("",!0)]))),128))]),t.questionForm.type!=="true_false"?(r(),c("button",{key:0,type:"button",class:"btn btn-outline-primary btn-sm mt-2",onClick:o[4]||(o[4]=(...n)=>t.addOption&&t.addOption(...n))}," 新增選項 ")):x("",!0)]),e("div",fe,[o[15]||(o[15]=e("label",{class:"form-label"},"備註",-1)),M(e("textarea",{class:"form-control","onUpdate:modelValue":o[5]||(o[5]=n=>t.questionForm.note=n),rows:"2"},null,512),[[I,t.questionForm.note]])]),e("div",he,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[6]||(o[6]=(...n)=>t.closeModal&&t.closeModal(...n))}," 取消 "),o[16]||(o[16]=e("button",{type:"submit",class:"btn btn-primary"},"保存",-1))])],32)])])])])):x("",!0),e("div",{class:E(["modal fade",{show:t.showModal}]),tabindex:"-1",style:R({display:t.showModal?"block":"none"})},[e("div",ye,[e("div",ge,[e("div",ke,[o[17]||(o[17]=e("h5",{class:"modal-title"},"錯誤提示",-1)),e("button",{type:"button",class:"btn-close",onClick:o[8]||(o[8]=n=>t.showModal=!1)})]),e("div",{class:"modal-body",innerHTML:t.modalMessage},null,8,we),e("div",xe,[e("button",{type:"button",class:"btn btn-secondary",onClick:o[9]||(o[9]=n=>t.showModal=!1)}," 關閉 ")])])])],6),t.showModal?(r(),c("div",Me)):x("",!0)],64)}const Ce=B(Z,[["render",Qe],["__scopeId","data-v-276e61e7"]]);const qe={components:{Footer:K,Navbar:W,Sidebar:X,QuestionModal:Ce,Loading:Y},setup(){const o=G().params.id,l=d(""),t=d(""),g=d(1),k=d(10),n=d(0),m=d(10),p=d([]),Q=d([]),v=d(!1),s=d([]),f=async()=>{try{const i={course_id:o,chapter_id:t.value,status:"",search:l.value,page:g.value,pageSize:k.value};v.value=!0;const u=await S.getQuestionLists(i);v.value=!1,p.value=[{id:"",title:"全部"},...u.chapterLists],Q.value=u.chapterLists,s.value=u.questions,n.value=u.total,m.value=u.totalPages}catch(i){console.error("獲取題目列表失敗：",i)}};D([g],()=>{f()}),J(()=>{f()});const L=i=>{var u;return i.type==="true_false"?(u=i.correctOptions[0])==null?void 0:u.option_text:i.correctOptions.map(w=>w.option_text).join(", ")},N=async i=>{try{if(confirm("確定要刪除此題目嗎？")){const u=s.value.findIndex(w=>w.id===i);u!==-1&&s.value.splice(u,1),v.value=!0,await S.delQuestion(i),v.value=!1}}catch(u){console.error("刪除題目失敗：",u)}},O=d(!1),C=d(null),P=d(!1);return{questions:s,searchQuery:l,selectedChapter:t,currentPage:g,pageSize:k,total:n,totalPages:m,formatAnswer:L,deleteQuestion:N,editQuestion:async i=>{s.value.find(w=>w.id===i)&&(P.value=!0,O.value=!0,C.value=i)},addQuestion:()=>{P.value=!1,O.value=!0,C.value=null},showQuestionModal:O,questionID:C,isEditMode:P,chapterOptions:p,chapterModalOptions:Q,fetchQuestions:f,loading:v}}},Oe={class:"main-wrapper"},Fe={class:"page-wrapper"},Ee={class:"page-content"},Se={class:"row"},Pe={class:"col-md-12 grid-margin stretch-card"},Ve={class:"card"},Ie={class:"card-body"},Le={class:"d-flex justify-content-between align-items-center mb-4"},Ne={class:"row mb-3"},Ue={class:"col-md-5"},je={class:"col-md-5"},Ae=["value"],De={class:"col-md-2"},Te={class:"table-responsive"},ze={class:"table table-hover"},Be=["onClick"],He=["onClick"],Re={class:"d-flex justify-content-between align-items-center mt-4"},Ge={class:"text-muted"},Je={class:"pagination mb-0"},Ke=["onClick"];function We(y,o,l,t,g,k){const n=F("Sidebar"),m=F("Navbar"),p=F("Footer"),Q=F("QuestionModal"),v=F("Loading");return r(),c(h,null,[e("div",Oe,[j(n),e("div",Fe,[j(m),e("div",Ee,[e("div",Se,[e("div",Pe,[e("div",Ve,[e("div",Ie,[e("div",Le,[o[8]||(o[8]=e("h6",{class:"card-title mb-0"},"題目管理",-1)),e("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=(...s)=>t.addQuestion&&t.addQuestion(...s))},o[7]||(o[7]=[e("i",{class:"material-icons align-middle me-1"},"add",-1),A(" 新增題目 ")]))]),e("div",Ne,[e("div",Ue,[M(e("input",{type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>t.searchQuery=s),placeholder:"搜尋題目內容或答案..."},null,512),[[I,t.searchQuery]])]),e("div",je,[M(e("select",{class:"form-select","onUpdate:modelValue":o[2]||(o[2]=s=>t.selectedChapter=s)},[(r(!0),c(h,null,q(t.chapterOptions,s=>(r(),c("option",{key:s.id,value:s.id},b(s.title),9,Ae))),128))],512),[[T,t.selectedChapter]])]),e("div",De,[e("button",{class:"btn btn-primary",onClick:o[3]||(o[3]=(...s)=>t.fetchQuestions&&t.fetchQuestions(...s))}," 搜尋 ")])]),e("div",Te,[e("table",ze,[o[11]||(o[11]=e("thead",null,[e("tr",null,[e("th",null,"題型"),e("th",null,"題目內容"),e("th",null,"答案"),e("th",null,"註解"),e("th",null,"所屬章節/考試"),e("th",null,"操作")])],-1)),e("tbody",null,[(r(!0),c(h,null,q(t.questions,s=>(r(),c("tr",{key:s.id},[e("td",null,[e("span",{class:E(["badge",{"bg-primary":s.type==="single_choice","bg-success":s.type==="multiple_choice","bg-info":s.type==="true_false"}])},b(s.type==="true_false"?"是非題":s.type==="single_choice"?"單選題":s.type==="multiple_choice"?"多選題":s.type),3)]),e("td",null,b(s.question),1),e("td",null,b(t.formatAnswer(s)),1),e("td",null,b(s.note),1),e("td",null,b(s.chapterName),1),e("td",null,[e("button",{class:"btn btn-primary btn-sm me-2",onClick:f=>t.editQuestion(s.id)},o[9]||(o[9]=[e("i",{class:"material-icons align-middle"},"edit",-1),A(" 編輯 ")]),8,Be),e("button",{class:"btn btn-danger btn-sm",onClick:f=>t.deleteQuestion(s.id)},o[10]||(o[10]=[e("i",{class:"material-icons align-middle"},"delete",-1),A(" 刪除 ")]),8,He)])]))),128))])])]),e("div",Re,[e("div",Ge," 顯示 "+b((t.currentPage-1)*t.pageSize+1)+" 到 "+b(Math.min(t.currentPage*t.pageSize,t.total))+" 筆，共 "+b(t.total)+" 筆 ",1),e("nav",null,[e("ul",Je,[e("li",{class:E(["page-item",{disabled:t.currentPage===1}])},[e("a",{class:"page-link",href:"#",onClick:o[4]||(o[4]=V(s=>t.currentPage--,["prevent"])),"aria-label":"Previous"},o[12]||(o[12]=[e("span",{"aria-hidden":"true"},"«",-1)]))],2),(r(!0),c(h,null,q(t.totalPages,s=>(r(),c("li",{key:s,class:E(["page-item",{active:s===t.currentPage}])},[e("a",{class:"page-link",href:"#",onClick:V(f=>t.currentPage=s,["prevent"])},b(s),9,Ke)],2))),128)),e("li",{class:E(["page-item",{disabled:t.currentPage===t.totalPages}])},[e("a",{class:"page-link",href:"#",onClick:o[5]||(o[5]=V(s=>t.currentPage++,["prevent"])),"aria-label":"Next"},o[13]||(o[13]=[e("span",{"aria-hidden":"true"},"»",-1)]))],2)])])])])])])])]),j(p),t.chapterModalOptions.length>0?(r(),z(Q,{key:0,show:t.showQuestionModal,"onUpdate:show":o[6]||(o[6]=s=>t.showQuestionModal=s),questionID:t.questionID,chapterOptions:t.chapterModalOptions,isEdit:t.isEditMode,onSave:t.fetchQuestions},null,8,["show","questionID","chapterOptions","isEdit","onSave"])):x("",!0)])]),t.loading?(r(),z(v,{key:0})):x("",!0)],64)}const $e=B(qe,[["render",We],["__scopeId","data-v-a0a88cea"]]);export{$e as default};
