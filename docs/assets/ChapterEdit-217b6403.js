import{A as Wt,B as Ge,_ as Jt,p as Qt,u as er,r as Y,i as tr,j as Pe,o as z,c as B,k as Ee,b as _,a as me,l as Ke,t as Xe,F as rr,f as nr,n as or,d as ir,e as Oe,g as ke,C as ar}from"./index-7e071105.js";import{F as lr,N as sr,_ as ur,a as W}from"./sidebar-bb7b1f1a.js";import{C as fr,U as cr}from"./UploadAdapter-9b182869.js";function oe(t){"@babel/helpers - typeof";return oe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(t)}function Ye(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,hr(r.key),r)}}function pr(t,e,n){return e&&Ye(t.prototype,e),n&&Ye(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function hr(t){var e=dr(t,"string");return oe(e)=="symbol"?e:e+""}function dr(t,e){if(oe(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(oe(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function yr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mr(t,e,n){return e=fe(e),vr(t,He()?Reflect.construct(e,n||[],fe(t).constructor):e.apply(t,n))}function vr(t,e){if(e&&(oe(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return gr(t)}function gr(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function br(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ue(t,e)}function je(t){var e=typeof Map=="function"?new Map:void 0;return je=function(r){if(r===null||!wr(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,o)}function o(){return _r(r,arguments,fe(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),ue(o,r)},je(t)}function _r(t,e,n){if(He())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&ue(o,n.prototype),o}function He(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(He=function(){return!!t})()}function wr(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function ue(t,e){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},ue(t,e)}function fe(t){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},fe(t)}var ve=function(t){function e(n){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(yr(this,e),r=mr(this,e,[n]),r.originalRequest=l,r.originalResponse=u,r.causingError=o,o!=null&&(n+=", caused by ".concat(o.toString())),l!=null){var p=l.getHeader("X-Request-ID")||"n/a",f=l.getMethod(),c=l.getURL(),b=u?u.getStatus():"n/a",m=u?u.getBody()||"":"n/a";n+=", originated from request (method: ".concat(f,", url: ").concat(c,", response code: ").concat(b,", response text: ").concat(m,", request id: ").concat(p,")")}return r.message=n,r}return br(e,t),pr(e)}(je(Error));function ce(t){"@babel/helpers - typeof";return ce=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(t)}function Sr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ze(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xr(r.key),r)}}function Ur(t,e,n){return e&&Ze(t.prototype,e),n&&Ze(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function xr(t){var e=Pr(t,"string");return ce(e)=="symbol"?e:e+""}function Pr(t,e){if(ce(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ce(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Er=function(){function t(){Sr(this,t)}return Ur(t,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(n){return Promise.resolve([])}},{key:"removeUpload",value:function(n){return Promise.resolve()}},{key:"addUpload",value:function(n,r){return Promise.resolve(null)}}])}();const Et="3.7.7",Or=Et,ae=typeof Buffer=="function",We=typeof TextDecoder=="function"?new TextDecoder:void 0,Je=typeof TextEncoder=="function"?new TextEncoder:void 0,kr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",le=Array.prototype.slice.call(kr),ge=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(le),Rr=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,R=String.fromCharCode.bind(String),Qe=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Ot=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),kt=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),Rt=t=>{let e,n,r,o,l="";const u=t.length%3;for(let p=0;p<t.length;){if((n=t.charCodeAt(p++))>255||(r=t.charCodeAt(p++))>255||(o=t.charCodeAt(p++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,l+=le[e>>18&63]+le[e>>12&63]+le[e>>6&63]+le[e&63]}return u?l.slice(0,u-3)+"===".substring(u):l},ze=typeof btoa=="function"?t=>btoa(t):ae?t=>Buffer.from(t,"binary").toString("base64"):Rt,Te=ae?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(R.apply(null,t.subarray(r,r+4096)));return ze(n.join(""))},be=(t,e=!1)=>e?Ot(Te(t)):Te(t),jr=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?R(192|e>>>6)+R(128|e&63):R(224|e>>>12&15)+R(128|e>>>6&63)+R(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return R(240|e>>>18&7)+R(128|e>>>12&63)+R(128|e>>>6&63)+R(128|e&63)}},Tr=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,jt=t=>t.replace(Tr,jr),et=ae?t=>Buffer.from(t,"utf8").toString("base64"):Je?t=>Te(Je.encode(t)):t=>ze(jt(t)),ne=(t,e=!1)=>e?Ot(et(t)):et(t),tt=t=>ne(t,!0),Cr=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Lr=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return R((n>>>10)+55296)+R((n&1023)+56320);case 3:return R((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return R((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},Tt=t=>t.replace(Cr,Lr),Ct=t=>{if(t=t.replace(/\s+/g,""),!Rr.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let l=0;l<t.length;)e=ge[t.charAt(l++)]<<18|ge[t.charAt(l++)]<<12|(r=ge[t.charAt(l++)])<<6|(o=ge[t.charAt(l++)]),n+=r===64?R(e>>16&255):o===64?R(e>>16&255,e>>8&255):R(e>>16&255,e>>8&255,e&255);return n},Be=typeof atob=="function"?t=>atob(kt(t)):ae?t=>Buffer.from(t,"base64").toString("binary"):Ct,Lt=ae?t=>Qe(Buffer.from(t,"base64")):t=>Qe(Be(t).split("").map(e=>e.charCodeAt(0))),At=t=>Lt(It(t)),Ar=ae?t=>Buffer.from(t,"base64").toString("utf8"):We?t=>We.decode(Lt(t)):t=>Tt(Be(t)),It=t=>kt(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),Ce=t=>Ar(It(t)),Ir=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},Dt=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),Ft=function(){const t=(e,n)=>Object.defineProperty(String.prototype,e,Dt(n));t("fromBase64",function(){return Ce(this)}),t("toBase64",function(e){return ne(this,e)}),t("toBase64URI",function(){return ne(this,!0)}),t("toBase64URL",function(){return ne(this,!0)}),t("toUint8Array",function(){return At(this)})},Nt=function(){const t=(e,n)=>Object.defineProperty(Uint8Array.prototype,e,Dt(n));t("toBase64",function(e){return be(this,e)}),t("toBase64URI",function(){return be(this,!0)}),t("toBase64URL",function(){return be(this,!0)})},Dr=()=>{Ft(),Nt()},Fr={version:Et,VERSION:Or,atob:Be,atobPolyfill:Ct,btoa:ze,btoaPolyfill:Rt,fromBase64:Ce,toBase64:ne,encode:ne,encodeURI:tt,encodeURL:tt,utob:jt,btou:Tt,decode:Ce,isValid:Ir,fromUint8Array:be,toUint8Array:At,extendString:Ft,extendUint8Array:Nt,extendBuiltins:Dr};var Nr=function(e,n){if(n=n.split(":")[0],e=+e,!e)return!1;switch(n){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},qe={},Hr=Object.prototype.hasOwnProperty,zr;function rt(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch{return null}}function nt(t){try{return encodeURIComponent(t)}catch{return null}}function Br(t){for(var e=/([^=?#&]+)=?([^&]*)/g,n={},r;r=e.exec(t);){var o=rt(r[1]),l=rt(r[2]);o===null||l===null||o in n||(n[o]=l)}return n}function qr(t,e){e=e||"";var n=[],r,o;typeof e!="string"&&(e="?");for(o in t)if(Hr.call(t,o)){if(r=t[o],!r&&(r===null||r===zr||isNaN(r))&&(r=""),o=nt(o),r=nt(r),o===null||r===null)continue;n.push(o+"="+r)}return n.length?e+n.join("&"):""}qe.stringify=qr;qe.parse=Br;var Ht=Nr,xe=qe,$r=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,zt=/[\n\r\t]/g,Mr=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,Bt=/:\d+$/,Vr=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Gr=/^[a-zA-Z]:/;function $e(t){return(t||"").toString().replace($r,"")}var Le=[["#","hash"],["?","query"],function(e,n){return $(n.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ot={hash:1,query:1};function qt(t){var e;typeof window<"u"?e=window:typeof Ge<"u"?e=Ge:typeof self<"u"?e=self:e={};var n=e.location||{};t=t||n;var r={},o=typeof t,l;if(t.protocol==="blob:")r=new M(unescape(t.pathname),{});else if(o==="string"){r=new M(t,{});for(l in ot)delete r[l]}else if(o==="object"){for(l in t)l in ot||(r[l]=t[l]);r.slashes===void 0&&(r.slashes=Mr.test(t.href))}return r}function $(t){return t==="file:"||t==="ftp:"||t==="http:"||t==="https:"||t==="ws:"||t==="wss:"}function $t(t,e){t=$e(t),t=t.replace(zt,""),e=e||{};var n=Vr.exec(t),r=n[1]?n[1].toLowerCase():"",o=!!n[2],l=!!n[3],u=0,p;return o?l?(p=n[2]+n[3]+n[4],u=n[2].length+n[3].length):(p=n[2]+n[4],u=n[2].length):l?(p=n[3]+n[4],u=n[3].length):p=n[4],r==="file:"?u>=2&&(p=p.slice(2)):$(r)?p=n[4]:r?o&&(p=p.slice(2)):u>=2&&$(e.protocol)&&(p=n[4]),{protocol:r,slashes:o||$(r),slashesCount:u,rest:p}}function Kr(t,e){if(t==="")return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,o=n[r-1],l=!1,u=0;r--;)n[r]==="."?n.splice(r,1):n[r]===".."?(n.splice(r,1),u++):u&&(r===0&&(l=!0),n.splice(r,1),u--);return l&&n.unshift(""),(o==="."||o==="..")&&n.push(""),n.join("/")}function M(t,e,n){if(t=$e(t),t=t.replace(zt,""),!(this instanceof M))return new M(t,e,n);var r,o,l,u,p,f,c=Le.slice(),b=typeof e,m=this,L=0;for(b!=="object"&&b!=="string"&&(n=e,e=null),n&&typeof n!="function"&&(n=xe.parse),e=qt(e),o=$t(t||"",e),r=!o.protocol&&!o.slashes,m.slashes=o.slashes||r&&e.slashes,m.protocol=o.protocol||e.protocol||"",t=o.rest,(o.protocol==="file:"&&(o.slashesCount!==2||Gr.test(t))||!o.slashes&&(o.protocol||o.slashesCount<2||!$(m.protocol)))&&(c[3]=[/(.*)/,"pathname"]);L<c.length;L++){if(u=c[L],typeof u=="function"){t=u(t,m);continue}l=u[0],f=u[1],l!==l?m[f]=t:typeof l=="string"?(p=l==="@"?t.lastIndexOf(l):t.indexOf(l),~p&&(typeof u[2]=="number"?(m[f]=t.slice(0,p),t=t.slice(p+u[2])):(m[f]=t.slice(p),t=t.slice(0,p)))):(p=l.exec(t))&&(m[f]=p[1],t=t.slice(0,p.index)),m[f]=m[f]||r&&u[3]&&e[f]||"",u[4]&&(m[f]=m[f].toLowerCase())}n&&(m.query=n(m.query)),r&&e.slashes&&m.pathname.charAt(0)!=="/"&&(m.pathname!==""||e.pathname!=="")&&(m.pathname=Kr(m.pathname,e.pathname)),m.pathname.charAt(0)!=="/"&&$(m.protocol)&&(m.pathname="/"+m.pathname),Ht(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(p=m.auth.indexOf(":"),~p?(m.username=m.auth.slice(0,p),m.username=encodeURIComponent(decodeURIComponent(m.username)),m.password=m.auth.slice(p+1),m.password=encodeURIComponent(decodeURIComponent(m.password))):m.username=encodeURIComponent(decodeURIComponent(m.auth)),m.auth=m.password?m.username+":"+m.password:m.username),m.origin=m.protocol!=="file:"&&$(m.protocol)&&m.host?m.protocol+"//"+m.host:"null",m.href=m.toString()}function Xr(t,e,n){var r=this;switch(t){case"query":typeof e=="string"&&e.length&&(e=(n||xe.parse)(e)),r[t]=e;break;case"port":r[t]=e,Ht(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[t]="");break;case"hostname":r[t]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[t]=e,Bt.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!n;break;case"pathname":case"hash":if(e){var o=t==="pathname"?"/":"#";r[t]=e.charAt(0)!==o?o+e:e}else r[t]=e;break;case"username":case"password":r[t]=encodeURIComponent(e);break;case"auth":var l=e.indexOf(":");~l?(r.username=e.slice(0,l),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(l+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var u=0;u<Le.length;u++){var p=Le[u];p[4]&&(r[p[1]]=r[p[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&$(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function Yr(t){(!t||typeof t!="function")&&(t=xe.stringify);var e,n=this,r=n.host,o=n.protocol;o&&o.charAt(o.length-1)!==":"&&(o+=":");var l=o+(n.protocol&&n.slashes||$(n.protocol)?"//":"");return n.username?(l+=n.username,n.password&&(l+=":"+n.password),l+="@"):n.password?(l+=":"+n.password,l+="@"):n.protocol!=="file:"&&$(n.protocol)&&!r&&n.pathname!=="/"&&(l+="@"),(r[r.length-1]===":"||Bt.test(n.hostname)&&!n.port)&&(r+=":"),l+=r+n.pathname,e=typeof n.query=="object"?t(n.query):n.query,e&&(l+=e.charAt(0)!=="?"?"?"+e:e),n.hash&&(l+=n.hash),l}M.prototype={set:Xr,toString:Yr};M.extractProtocol=$t;M.location=qt;M.trimLeft=$e;M.qs=xe;var Zr=M;const Wr=Wt(Zr);function Jr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,n=t==="x"?e:e&3|8;return n.toString(16)})}function Ae(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ae=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(s,i,a){s[i]=a.value},l=typeof Symbol=="function"?Symbol:{},u=l.iterator||"@@iterator",p=l.asyncIterator||"@@asyncIterator",f=l.toStringTag||"@@toStringTag";function c(s,i,a){return Object.defineProperty(s,i,{value:a,enumerable:!0,configurable:!0,writable:!0}),s[i]}try{c({},"")}catch{c=function(a,h,y){return a[h]=y}}function b(s,i,a,h){var y=i&&i.prototype instanceof F?i:F,d=Object.create(y.prototype),g=new K(h||[]);return o(d,"_invoke",{value:E(s,a,g)}),d}function m(s,i,a){try{return{type:"normal",arg:s.call(i,a)}}catch(h){return{type:"throw",arg:h}}}e.wrap=b;var L="suspendedStart",Z="suspendedYield",q="executing",I="completed",U={};function F(){}function O(){}function P(){}var A={};c(A,u,function(){return this});var V=Object.getPrototypeOf,N=V&&V(V(X([])));N&&N!==n&&r.call(N,u)&&(A=N);var j=P.prototype=F.prototype=Object.create(A);function v(s){["next","throw","return"].forEach(function(i){c(s,i,function(a){return this._invoke(i,a)})})}function x(s,i){function a(y,d,g,w){var S=m(s[y],s,d);if(S.type!=="throw"){var T=S.arg,k=T.value;return k&&J(k)=="object"&&r.call(k,"__await")?i.resolve(k.__await).then(function(C){a("next",C,g,w)},function(C){a("throw",C,g,w)}):i.resolve(k).then(function(C){T.value=C,g(T)},function(C){return a("throw",C,g,w)})}w(S.arg)}var h;o(this,"_invoke",{value:function(d,g){function w(){return new i(function(S,T){a(d,g,S,T)})}return h=h?h.then(w,w):w()}})}function E(s,i,a){var h=L;return function(y,d){if(h===q)throw Error("Generator is already running");if(h===I){if(y==="throw")throw d;return{value:t,done:!0}}for(a.method=y,a.arg=d;;){var g=a.delegate;if(g){var w=D(g,a);if(w){if(w===U)continue;return w}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(h===L)throw h=I,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);h=q;var S=m(s,i,a);if(S.type==="normal"){if(h=a.done?I:Z,S.arg===U)continue;return{value:S.arg,done:a.done}}S.type==="throw"&&(h=I,a.method="throw",a.arg=S.arg)}}}function D(s,i){var a=i.method,h=s.iterator[a];if(h===t)return i.delegate=null,a==="throw"&&s.iterator.return&&(i.method="return",i.arg=t,D(s,i),i.method==="throw")||a!=="return"&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+a+"' method")),U;var y=m(h,s.iterator,i.arg);if(y.type==="throw")return i.method="throw",i.arg=y.arg,i.delegate=null,U;var d=y.arg;return d?d.done?(i[s.resultName]=d.value,i.next=s.nextLoc,i.method!=="return"&&(i.method="next",i.arg=t),i.delegate=null,U):d:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,U)}function H(s){var i={tryLoc:s[0]};1 in s&&(i.catchLoc=s[1]),2 in s&&(i.finallyLoc=s[2],i.afterLoc=s[3]),this.tryEntries.push(i)}function G(s){var i=s.completion||{};i.type="normal",delete i.arg,s.completion=i}function K(s){this.tryEntries=[{tryLoc:"root"}],s.forEach(H,this),this.reset(!0)}function X(s){if(s||s===""){var i=s[u];if(i)return i.call(s);if(typeof s.next=="function")return s;if(!isNaN(s.length)){var a=-1,h=function y(){for(;++a<s.length;)if(r.call(s,a))return y.value=s[a],y.done=!1,y;return y.value=t,y.done=!0,y};return h.next=h}}throw new TypeError(J(s)+" is not iterable")}return O.prototype=P,o(j,"constructor",{value:P,configurable:!0}),o(P,"constructor",{value:O,configurable:!0}),O.displayName=c(P,f,"GeneratorFunction"),e.isGeneratorFunction=function(s){var i=typeof s=="function"&&s.constructor;return!!i&&(i===O||(i.displayName||i.name)==="GeneratorFunction")},e.mark=function(s){return Object.setPrototypeOf?Object.setPrototypeOf(s,P):(s.__proto__=P,c(s,f,"GeneratorFunction")),s.prototype=Object.create(j),s},e.awrap=function(s){return{__await:s}},v(x.prototype),c(x.prototype,p,function(){return this}),e.AsyncIterator=x,e.async=function(s,i,a,h,y){y===void 0&&(y=Promise);var d=new x(b(s,i,a,h),y);return e.isGeneratorFunction(i)?d:d.next().then(function(g){return g.done?g.value:d.next()})},v(j),c(j,f,"Generator"),c(j,u,function(){return this}),c(j,"toString",function(){return"[object Generator]"}),e.keys=function(s){var i=Object(s),a=[];for(var h in i)a.push(h);return a.reverse(),function y(){for(;a.length;){var d=a.pop();if(d in i)return y.value=d,y.done=!1,y}return y.done=!0,y}},e.values=X,K.prototype={constructor:K,reset:function(i){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(G),!i)for(var a in this)a.charAt(0)==="t"&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=t)},stop:function(){this.done=!0;var i=this.tryEntries[0].completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var a=this;function h(T,k){return g.type="throw",g.arg=i,a.next=T,k&&(a.method="next",a.arg=t),!!k}for(var y=this.tryEntries.length-1;y>=0;--y){var d=this.tryEntries[y],g=d.completion;if(d.tryLoc==="root")return h("end");if(d.tryLoc<=this.prev){var w=r.call(d,"catchLoc"),S=r.call(d,"finallyLoc");if(w&&S){if(this.prev<d.catchLoc)return h(d.catchLoc,!0);if(this.prev<d.finallyLoc)return h(d.finallyLoc)}else if(w){if(this.prev<d.catchLoc)return h(d.catchLoc,!0)}else{if(!S)throw Error("try statement without catch or finally");if(this.prev<d.finallyLoc)return h(d.finallyLoc)}}}},abrupt:function(i,a){for(var h=this.tryEntries.length-1;h>=0;--h){var y=this.tryEntries[h];if(y.tryLoc<=this.prev&&r.call(y,"finallyLoc")&&this.prev<y.finallyLoc){var d=y;break}}d&&(i==="break"||i==="continue")&&d.tryLoc<=a&&a<=d.finallyLoc&&(d=null);var g=d?d.completion:{};return g.type=i,g.arg=a,d?(this.method="next",this.next=d.finallyLoc,U):this.complete(g)},complete:function(i,a){if(i.type==="throw")throw i.arg;return i.type==="break"||i.type==="continue"?this.next=i.arg:i.type==="return"?(this.rval=this.arg=i.arg,this.method="return",this.next="end"):i.type==="normal"&&a&&(this.next=a),U},finish:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var h=this.tryEntries[a];if(h.finallyLoc===i)return this.complete(h.completion,h.afterLoc),G(h),U}},catch:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var h=this.tryEntries[a];if(h.tryLoc===i){var y=h.completion;if(y.type==="throw"){var d=y.arg;G(h)}return d}}throw Error("illegal catch attempt")},delegateYield:function(i,a,h){return this.delegate={iterator:X(i),resultName:a,nextLoc:h},this.method==="next"&&(this.arg=t),U}},e}function it(t,e,n,r,o,l,u){try{var p=t[l](u),f=p.value}catch(c){n(c);return}p.done?e(f):Promise.resolve(f).then(r,o)}function Qr(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var l=t.apply(e,n);function u(f){it(l,r,o,u,p,"next",f)}function p(f){it(l,r,o,u,p,"throw",f)}u(void 0)})}}function Mt(t,e){return rn(t)||tn(t,e)||Vt(t,e)||en()}function en(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function tn(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,o,l,u,p=[],f=!0,c=!1;try{if(l=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;f=!1}else for(;!(f=(r=l.call(n)).done)&&(p.push(r.value),p.length!==e);f=!0);}catch(b){c=!0,o=b}finally{try{if(!f&&n.return!=null&&(u=n.return(),Object(u)!==u))return}finally{if(c)throw o}}return p}}function rn(t){if(Array.isArray(t))return t}function J(t){"@babel/helpers - typeof";return J=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(t)}function nn(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Vt(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(c){throw c},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,u=!1,p;return{s:function(){n=n.call(t)},n:function(){var c=n.next();return l=c.done,c},e:function(c){u=!0,p=c},f:function(){try{!l&&n.return!=null&&n.return()}finally{if(u)throw p}}}}function Vt(t,e){if(t){if(typeof t=="string")return at(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return at(t,e)}}function at(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function ee(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?lt(Object(n),!0).forEach(function(r){on(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function on(t,e,n){return e=Gt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function an(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Gt(r.key),r)}}function ln(t,e,n){return e&&st(t.prototype,e),n&&st(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Gt(t){var e=sn(t,"string");return J(e)=="symbol"?e:e+""}function sn(t,e){if(J(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(J(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var _e="tus-v1",we="ietf-draft-03",se="ietf-draft-05",un={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:Kt,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:_e},Se=function(){function t(e,n){an(this,t),"resume"in n&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=n,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return ln(t,[{key:"findPreviousUploads",value:function(){var n=this;return this.options.fingerprint(this.file,this.options).then(function(r){return n._urlStorage.findUploadsByFingerprint(r)})}},{key:"resumeFromPreviousUpload",value:function(n){this.url=n.uploadUrl||null,this._parallelUploadUrls=n.parallelUploadUrls||null,this._urlStorageKey=n.urlStorageKey}},{key:"start",value:function(){var n=this,r=this.file;if(!r){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(![_e,we,se].includes(this.options.protocol)){this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var o=this.options.retryDelays;if(o!=null&&Object.prototype.toString.call(o)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var l=0,u=["uploadUrl","uploadSize","uploadLengthDeferred"];l<u.length;l++){var p=u[l];if(this.options[p]){this._emitError(new Error("tus: cannot use the ".concat(p," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(r,this.options).then(function(f){return n._fingerprint=f,n._source?n._source:n.options.fileReader.openFile(r,n.options.chunkSize)}).then(function(f){if(n._source=f,n.options.uploadLengthDeferred)n._size=null;else if(n.options.uploadSize!=null){if(n._size=Number(n.options.uploadSize),Number.isNaN(n._size)){n._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(n._size=n._source.size,n._size==null){n._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}n.options.parallelUploads>1||n._parallelUploadUrls!=null?n._startParallelUpload():n._startSingleUpload()}).catch(function(f){n._emitError(f)})}},{key:"_startParallelUpload",value:function(){var n,r=this,o=this._size,l=0;this._parallelUploads=[];var u=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,p=(n=this.options.parallelUploadBoundaries)!==null&&n!==void 0?n:cn(this._source.size,u);this._parallelUploadUrls&&p.forEach(function(b,m){b.uploadUrl=r._parallelUploadUrls[m]||null}),this._parallelUploadUrls=new Array(p.length);var f=p.map(function(b,m){var L=0;return r._source.slice(b.start,b.end).then(function(Z){var q=Z.value;return new Promise(function(I,U){var F=ee(ee({},r.options),{},{uploadUrl:b.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:r.options.metadataForPartialUploads,headers:ee(ee({},r.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:I,onError:U,onProgress:function(A){l=l-L+A,L=A,r._emitProgress(l,o)},onUploadUrlAvailable:function(){r._parallelUploadUrls[m]=O.url,r._parallelUploadUrls.filter(function(A){return!!A}).length===p.length&&r._saveUploadInUrlStorage()}}),O=new t(q,F);O.start(),r._parallelUploads.push(O)})})}),c;Promise.all(f).then(function(){c=r._openRequest("POST",r.options.endpoint),c.setHeader("Upload-Concat","final;".concat(r._parallelUploadUrls.join(" ")));var b=ut(r.options.metadata);return b!==""&&c.setHeader("Upload-Metadata",b),r._sendRequest(c,null)}).then(function(b){if(!te(b.getStatus(),200)){r._emitHttpError(c,b,"tus: unexpected response while creating upload");return}var m=b.getHeader("Location");if(m==null){r._emitHttpError(c,b,"tus: invalid or missing Location header");return}r.url=ht(r.options.endpoint,m),"Created upload at ".concat(r.url),r._emitSuccess(b)}).catch(function(b){r._emitError(b)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(n){var r=this;if(this._parallelUploads!=null){var o=nn(this._parallelUploads),l;try{for(o.s();!(l=o.n()).done;){var u=l.value;u.abort(n)}}catch(p){o.e(p)}finally{o.f()}}return this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!n||this.url==null?Promise.resolve():t.terminate(this.url,this.options).then(function(){return r._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(n,r,o,l){this._emitError(new ve(o,l,n,r))}},{key:"_emitError",value:function(n){var r=this;if(!this._aborted){if(this.options.retryDelays!=null){var o=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(o&&(this._retryAttempt=0),pt(n,this._retryAttempt,this.options)){var l=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){r.start()},l);return}}if(typeof this.options.onError=="function")this.options.onError(n);else throw n}}},{key:"_emitSuccess",value:function(n){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess({lastResponse:n})}},{key:"_emitProgress",value:function(n,r){typeof this.options.onProgress=="function"&&this.options.onProgress(n,r)}},{key:"_emitChunkComplete",value:function(n,r,o){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(n,r,o)}},{key:"_createUpload",value:function(){var n=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var r=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?r.setHeader("Upload-Defer-Length","1"):r.setHeader("Upload-Length","".concat(this._size));var o=ut(this.options.metadata);o!==""&&r.setHeader("Upload-Metadata",o);var l;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,l=this._addChunkToRequest(r)):((this.options.protocol===we||this.options.protocol===se)&&r.setHeader("Upload-Complete","?0"),l=this._sendRequest(r,null)),l.then(function(u){if(!te(u.getStatus(),200)){n._emitHttpError(r,u,"tus: unexpected response while creating upload");return}var p=u.getHeader("Location");if(p==null){n._emitHttpError(r,u,"tus: invalid or missing Location header");return}if(n.url=ht(n.options.endpoint,p),"Created upload at ".concat(n.url),typeof n.options.onUploadUrlAvailable=="function"&&n.options.onUploadUrlAvailable(),n._size===0){n._emitSuccess(u),n._source.close();return}n._saveUploadInUrlStorage().then(function(){n.options.uploadDataDuringCreation?n._handleUploadResponse(r,u):(n._offset=0,n._performUpload())})}).catch(function(u){n._emitHttpError(r,null,"tus: failed to create upload",u)})}},{key:"_resumeUpload",value:function(){var n=this,r=this._openRequest("HEAD",this.url),o=this._sendRequest(r,null);o.then(function(l){var u=l.getStatus();if(!te(u,200)){if(u===423){n._emitHttpError(r,l,"tus: upload is currently locked; retry later");return}if(te(u,400)&&n._removeFromUrlStorage(),!n.options.endpoint){n._emitHttpError(r,l,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}n.url=null,n._createUpload();return}var p=Number.parseInt(l.getHeader("Upload-Offset"),10);if(Number.isNaN(p)){n._emitHttpError(r,l,"tus: invalid or missing offset value");return}var f=Number.parseInt(l.getHeader("Upload-Length"),10);if(Number.isNaN(f)&&!n.options.uploadLengthDeferred&&n.options.protocol===_e){n._emitHttpError(r,l,"tus: invalid or missing length value");return}typeof n.options.onUploadUrlAvailable=="function"&&n.options.onUploadUrlAvailable(),n._saveUploadInUrlStorage().then(function(){if(p===f){n._emitProgress(f,f),n._emitSuccess(l);return}n._offset=p,n._performUpload()})}).catch(function(l){n._emitHttpError(r,null,"tus: failed to resume upload",l)})}},{key:"_performUpload",value:function(){var n=this;if(!this._aborted){var r;this.options.overridePatchMethod?(r=this._openRequest("POST",this.url),r.setHeader("X-HTTP-Method-Override","PATCH")):r=this._openRequest("PATCH",this.url),r.setHeader("Upload-Offset","".concat(this._offset));var o=this._addChunkToRequest(r);o.then(function(l){if(!te(l.getStatus(),200)){n._emitHttpError(r,l,"tus: unexpected response while uploading chunk");return}n._handleUploadResponse(r,l)}).catch(function(l){n._aborted||n._emitHttpError(r,null,"tus: failed to upload chunk at offset ".concat(n._offset),l)})}}},{key:"_addChunkToRequest",value:function(n){var r=this,o=this._offset,l=this._offset+this.options.chunkSize;return n.setProgressHandler(function(u){r._emitProgress(o+u,r._size)}),this.options.protocol===_e?n.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===se&&n.setHeader("Content-Type","application/partial-upload"),(l===Number.POSITIVE_INFINITY||l>this._size)&&!this.options.uploadLengthDeferred&&(l=this._size),this._source.slice(o,l).then(function(u){var p=u.value,f=u.done,c=p!=null&&p.size?p.size:0;r.options.uploadLengthDeferred&&f&&(r._size=r._offset+c,n.setHeader("Upload-Length","".concat(r._size)));var b=r._offset+c;return!r.options.uploadLengthDeferred&&f&&b!==r._size?Promise.reject(new Error("upload was configured with a size of ".concat(r._size," bytes, but the source is done after ").concat(b," bytes"))):p===null?r._sendRequest(n):((r.options.protocol===we||r.options.protocol===se)&&n.setHeader("Upload-Complete",f?"?1":"?0"),r._emitProgress(r._offset,r._size),r._sendRequest(n,p))})}},{key:"_handleUploadResponse",value:function(n,r){var o=Number.parseInt(r.getHeader("Upload-Offset"),10);if(Number.isNaN(o)){this._emitHttpError(n,r,"tus: invalid or missing offset value");return}if(this._emitProgress(o,this._size),this._emitChunkComplete(o-this._offset,o,this._size),this._offset=o,o===this._size){this._emitSuccess(r),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(n,r){var o=ft(n,r,this.options);return this._req=o,o}},{key:"_removeFromUrlStorage",value:function(){var n=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(r){n._emitError(r)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var n=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var r={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?r.parallelUploadUrls=this._parallelUploadUrls:r.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,r).then(function(o){n._urlStorageKey=o})}},{key:"_sendRequest",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return ct(n,r,this.options)}}],[{key:"terminate",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=ft("DELETE",n,r);return ct(o,null,r).then(function(l){if(l.getStatus()!==204)throw new ve("tus: unexpected response while terminating upload",null,o,l)}).catch(function(l){if(l instanceof ve||(l=new ve("tus: failed to terminate upload",l,o,null)),!pt(l,0,r))throw l;var u=r.retryDelays[0],p=r.retryDelays.slice(1),f=ee(ee({},r),{},{retryDelays:p});return new Promise(function(c){return setTimeout(c,u)}).then(function(){return t.terminate(n,f)})})}}])}();function ut(t){return Object.entries(t).map(function(e){var n=Mt(e,2),r=n[0],o=n[1];return"".concat(r," ").concat(Fr.encode(String(o)))}).join(",")}function te(t,e){return t>=e&&t<e+100}function ft(t,e,n){var r=n.httpStack.createRequest(t,e);n.protocol===we?r.setHeader("Upload-Draft-Interop-Version","5"):n.protocol===se?r.setHeader("Upload-Draft-Interop-Version","6"):r.setHeader("Tus-Resumable","1.0.0");for(var o=n.headers||{},l=0,u=Object.entries(o);l<u.length;l++){var p=Mt(u[l],2),f=p[0],c=p[1];r.setHeader(f,c)}if(n.addRequestId){var b=Jr();r.setHeader("X-Request-ID",b)}return r}function ct(t,e,n){return Ie.apply(this,arguments)}function Ie(){return Ie=Qr(Ae().mark(function t(e,n,r){var o;return Ae().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(typeof r.onBeforeRequest!="function"){u.next=3;break}return u.next=3,r.onBeforeRequest(e);case 3:return u.next=5,e.send(n);case 5:if(o=u.sent,typeof r.onAfterResponse!="function"){u.next=9;break}return u.next=9,r.onAfterResponse(e,o);case 9:return u.abrupt("return",o);case 10:case"end":return u.stop()}},t)})),Ie.apply(this,arguments)}function fn(){var t=!0;return typeof navigator<"u"&&navigator.onLine===!1&&(t=!1),t}function pt(t,e,n){return n.retryDelays==null||e>=n.retryDelays.length||t.originalRequest==null?!1:n&&typeof n.onShouldRetry=="function"?n.onShouldRetry(t,e,n):Kt(t)}function Kt(t){var e=t.originalResponse?t.originalResponse.getStatus():0;return(!te(e,400)||e===409||e===423)&&fn()}function ht(t,e){return new Wr(e,t).toString()}function cn(t,e){for(var n=Math.floor(t/e),r=[],o=0;o<e;o++)r.push({start:n*o,end:n*(o+1)});return r[e-1].end=t,r}Se.defaultOptions=un;var Xt=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function pn(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.responseType="blob",r.onload=function(){var o=r.response;e(o)},r.onerror=function(o){n(o)},r.open("GET",t),r.send()})}var hn=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function dn(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){var o=new Uint8Array(r.result);e({value:o})},r.onerror=function(o){n(o)},r.readAsArrayBuffer(t)})}function pe(t){"@babel/helpers - typeof";return pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(t)}function yn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,vn(r.key),r)}}function mn(t,e,n){return e&&dt(t.prototype,e),n&&dt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function vn(t){var e=gn(t,"string");return pe(e)=="symbol"?e:e+""}function gn(t,e){if(pe(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(pe(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var yt=function(){function t(e){yn(this,t),this._file=e,this.size=e.size}return mn(t,[{key:"slice",value:function(n,r){if(hn())return dn(this._file.slice(n,r));var o=this._file.slice(n,r),l=r>=this.size;return Promise.resolve({value:o,done:l})}},{key:"close",value:function(){}}])}();function he(t){"@babel/helpers - typeof";return he=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(t)}function bn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,wn(r.key),r)}}function _n(t,e,n){return e&&mt(t.prototype,e),n&&mt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function wn(t){var e=Sn(t,"string");return he(e)=="symbol"?e:e+""}function Sn(t,e){if(he(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(he(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function vt(t){return t===void 0?0:t.size!==void 0?t.size:t.length}function Un(t,e){if(t.concat)return t.concat(e);if(t instanceof Blob)return new Blob([t,e],{type:t.type});if(t.set){var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n}throw new Error("Unknown data type")}var xn=function(){function t(e){bn(this,t),this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}return _n(t,[{key:"slice",value:function(n,r){return n<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(n,r)}},{key:"_readUntilEnoughDataOrDone",value:function(n,r){var o=this,l=r<=this._bufferOffset+vt(this._buffer);if(this._done||l){var u=this._getDataFromBuffer(n,r),p=u==null?this._done:!1;return Promise.resolve({value:u,done:p})}return this._reader.read().then(function(f){var c=f.value,b=f.done;return b?o._done=!0:o._buffer===void 0?o._buffer=c:o._buffer=Un(o._buffer,c),o._readUntilEnoughDataOrDone(n,r)})}},{key:"_getDataFromBuffer",value:function(n,r){n>this._bufferOffset&&(this._buffer=this._buffer.slice(n-this._bufferOffset),this._bufferOffset=n);var o=vt(this._buffer)===0;return this._done&&o?null:this._buffer.slice(0,r-n)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function Q(t){"@babel/helpers - typeof";return Q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(t)}function De(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */De=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(s,i,a){s[i]=a.value},l=typeof Symbol=="function"?Symbol:{},u=l.iterator||"@@iterator",p=l.asyncIterator||"@@asyncIterator",f=l.toStringTag||"@@toStringTag";function c(s,i,a){return Object.defineProperty(s,i,{value:a,enumerable:!0,configurable:!0,writable:!0}),s[i]}try{c({},"")}catch{c=function(a,h,y){return a[h]=y}}function b(s,i,a,h){var y=i&&i.prototype instanceof F?i:F,d=Object.create(y.prototype),g=new K(h||[]);return o(d,"_invoke",{value:E(s,a,g)}),d}function m(s,i,a){try{return{type:"normal",arg:s.call(i,a)}}catch(h){return{type:"throw",arg:h}}}e.wrap=b;var L="suspendedStart",Z="suspendedYield",q="executing",I="completed",U={};function F(){}function O(){}function P(){}var A={};c(A,u,function(){return this});var V=Object.getPrototypeOf,N=V&&V(V(X([])));N&&N!==n&&r.call(N,u)&&(A=N);var j=P.prototype=F.prototype=Object.create(A);function v(s){["next","throw","return"].forEach(function(i){c(s,i,function(a){return this._invoke(i,a)})})}function x(s,i){function a(y,d,g,w){var S=m(s[y],s,d);if(S.type!=="throw"){var T=S.arg,k=T.value;return k&&Q(k)=="object"&&r.call(k,"__await")?i.resolve(k.__await).then(function(C){a("next",C,g,w)},function(C){a("throw",C,g,w)}):i.resolve(k).then(function(C){T.value=C,g(T)},function(C){return a("throw",C,g,w)})}w(S.arg)}var h;o(this,"_invoke",{value:function(d,g){function w(){return new i(function(S,T){a(d,g,S,T)})}return h=h?h.then(w,w):w()}})}function E(s,i,a){var h=L;return function(y,d){if(h===q)throw Error("Generator is already running");if(h===I){if(y==="throw")throw d;return{value:t,done:!0}}for(a.method=y,a.arg=d;;){var g=a.delegate;if(g){var w=D(g,a);if(w){if(w===U)continue;return w}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(h===L)throw h=I,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);h=q;var S=m(s,i,a);if(S.type==="normal"){if(h=a.done?I:Z,S.arg===U)continue;return{value:S.arg,done:a.done}}S.type==="throw"&&(h=I,a.method="throw",a.arg=S.arg)}}}function D(s,i){var a=i.method,h=s.iterator[a];if(h===t)return i.delegate=null,a==="throw"&&s.iterator.return&&(i.method="return",i.arg=t,D(s,i),i.method==="throw")||a!=="return"&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+a+"' method")),U;var y=m(h,s.iterator,i.arg);if(y.type==="throw")return i.method="throw",i.arg=y.arg,i.delegate=null,U;var d=y.arg;return d?d.done?(i[s.resultName]=d.value,i.next=s.nextLoc,i.method!=="return"&&(i.method="next",i.arg=t),i.delegate=null,U):d:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,U)}function H(s){var i={tryLoc:s[0]};1 in s&&(i.catchLoc=s[1]),2 in s&&(i.finallyLoc=s[2],i.afterLoc=s[3]),this.tryEntries.push(i)}function G(s){var i=s.completion||{};i.type="normal",delete i.arg,s.completion=i}function K(s){this.tryEntries=[{tryLoc:"root"}],s.forEach(H,this),this.reset(!0)}function X(s){if(s||s===""){var i=s[u];if(i)return i.call(s);if(typeof s.next=="function")return s;if(!isNaN(s.length)){var a=-1,h=function y(){for(;++a<s.length;)if(r.call(s,a))return y.value=s[a],y.done=!1,y;return y.value=t,y.done=!0,y};return h.next=h}}throw new TypeError(Q(s)+" is not iterable")}return O.prototype=P,o(j,"constructor",{value:P,configurable:!0}),o(P,"constructor",{value:O,configurable:!0}),O.displayName=c(P,f,"GeneratorFunction"),e.isGeneratorFunction=function(s){var i=typeof s=="function"&&s.constructor;return!!i&&(i===O||(i.displayName||i.name)==="GeneratorFunction")},e.mark=function(s){return Object.setPrototypeOf?Object.setPrototypeOf(s,P):(s.__proto__=P,c(s,f,"GeneratorFunction")),s.prototype=Object.create(j),s},e.awrap=function(s){return{__await:s}},v(x.prototype),c(x.prototype,p,function(){return this}),e.AsyncIterator=x,e.async=function(s,i,a,h,y){y===void 0&&(y=Promise);var d=new x(b(s,i,a,h),y);return e.isGeneratorFunction(i)?d:d.next().then(function(g){return g.done?g.value:d.next()})},v(j),c(j,f,"Generator"),c(j,u,function(){return this}),c(j,"toString",function(){return"[object Generator]"}),e.keys=function(s){var i=Object(s),a=[];for(var h in i)a.push(h);return a.reverse(),function y(){for(;a.length;){var d=a.pop();if(d in i)return y.value=d,y.done=!1,y}return y.done=!0,y}},e.values=X,K.prototype={constructor:K,reset:function(i){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(G),!i)for(var a in this)a.charAt(0)==="t"&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=t)},stop:function(){this.done=!0;var i=this.tryEntries[0].completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var a=this;function h(T,k){return g.type="throw",g.arg=i,a.next=T,k&&(a.method="next",a.arg=t),!!k}for(var y=this.tryEntries.length-1;y>=0;--y){var d=this.tryEntries[y],g=d.completion;if(d.tryLoc==="root")return h("end");if(d.tryLoc<=this.prev){var w=r.call(d,"catchLoc"),S=r.call(d,"finallyLoc");if(w&&S){if(this.prev<d.catchLoc)return h(d.catchLoc,!0);if(this.prev<d.finallyLoc)return h(d.finallyLoc)}else if(w){if(this.prev<d.catchLoc)return h(d.catchLoc,!0)}else{if(!S)throw Error("try statement without catch or finally");if(this.prev<d.finallyLoc)return h(d.finallyLoc)}}}},abrupt:function(i,a){for(var h=this.tryEntries.length-1;h>=0;--h){var y=this.tryEntries[h];if(y.tryLoc<=this.prev&&r.call(y,"finallyLoc")&&this.prev<y.finallyLoc){var d=y;break}}d&&(i==="break"||i==="continue")&&d.tryLoc<=a&&a<=d.finallyLoc&&(d=null);var g=d?d.completion:{};return g.type=i,g.arg=a,d?(this.method="next",this.next=d.finallyLoc,U):this.complete(g)},complete:function(i,a){if(i.type==="throw")throw i.arg;return i.type==="break"||i.type==="continue"?this.next=i.arg:i.type==="return"?(this.rval=this.arg=i.arg,this.method="return",this.next="end"):i.type==="normal"&&a&&(this.next=a),U},finish:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var h=this.tryEntries[a];if(h.finallyLoc===i)return this.complete(h.completion,h.afterLoc),G(h),U}},catch:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var h=this.tryEntries[a];if(h.tryLoc===i){var y=h.completion;if(y.type==="throw"){var d=y.arg;G(h)}return d}}throw Error("illegal catch attempt")},delegateYield:function(i,a,h){return this.delegate={iterator:X(i),resultName:a,nextLoc:h},this.method==="next"&&(this.arg=t),U}},e}function gt(t,e,n,r,o,l,u){try{var p=t[l](u),f=p.value}catch(c){n(c);return}p.done?e(f):Promise.resolve(f).then(r,o)}function Pn(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var l=t.apply(e,n);function u(f){gt(l,r,o,u,p,"next",f)}function p(f){gt(l,r,o,u,p,"throw",f)}u(void 0)})}}function En(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,kn(r.key),r)}}function On(t,e,n){return e&&bt(t.prototype,e),n&&bt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function kn(t){var e=Rn(t,"string");return Q(e)=="symbol"?e:e+""}function Rn(t,e){if(Q(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Q(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var jn=function(){function t(){En(this,t)}return On(t,[{key:"openFile",value:function(){var e=Pn(De().mark(function r(o,l){var u;return De().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(Xt()&&o&&typeof o.uri<"u")){f.next=11;break}return f.prev=1,f.next=4,pn(o.uri);case 4:return u=f.sent,f.abrupt("return",new yt(u));case 8:throw f.prev=8,f.t0=f.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(f.t0));case 11:if(!(typeof o.slice=="function"&&typeof o.size<"u")){f.next=13;break}return f.abrupt("return",Promise.resolve(new yt(o)));case 13:if(typeof o.read!="function"){f.next=18;break}if(l=Number(l),Number.isFinite(l)){f.next=17;break}return f.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return f.abrupt("return",Promise.resolve(new xn(o,l)));case 18:return f.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return f.stop()}},r,null,[[1,8]])}));function n(r,o){return e.apply(this,arguments)}return n}()}])}();function Tn(t,e){return Xt()?Promise.resolve(Cn(t,e)):Promise.resolve(["tus-br",t.name,t.type,t.size,t.lastModified,e.endpoint].join("-"))}function Cn(t,e){var n=t.exif?Ln(JSON.stringify(t.exif)):"noexif";return["tus-rn",t.name||"noname",t.size||"nosize",n,e.endpoint].join("/")}function Ln(t){var e=0;if(t.length===0)return e;for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);e=(e<<5)-e+r,e&=e}return e}function de(t){"@babel/helpers - typeof";return de=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(t)}function Me(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,An(r.key),r)}}function Ve(t,e,n){return e&&_t(t.prototype,e),n&&_t(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function An(t){var e=In(t,"string");return de(e)=="symbol"?e:e+""}function In(t,e){if(de(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(de(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Dn=function(){function t(){Me(this,t)}return Ve(t,[{key:"createRequest",value:function(n,r){return new Fn(n,r)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),Fn=function(){function t(e,n){Me(this,t),this._xhr=new XMLHttpRequest,this._xhr.open(e,n,!0),this._method=e,this._url=n,this._headers={}}return Ve(t,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(n,r){this._xhr.setRequestHeader(n,r),this._headers[n]=r}},{key:"getHeader",value:function(n){return this._headers[n]}},{key:"setProgressHandler",value:function(n){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(r){r.lengthComputable&&n(r.loaded)})}},{key:"send",value:function(){var n=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(o,l){n._xhr.onload=function(){o(new Nn(n._xhr))},n._xhr.onerror=function(u){l(u)},n._xhr.send(r)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Nn=function(){function t(e){Me(this,t),this._xhr=e}return Ve(t,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(n){return this._xhr.getResponseHeader(n)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function ye(t){"@babel/helpers - typeof";return ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(t)}function Hn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Bn(r.key),r)}}function zn(t,e,n){return e&&wt(t.prototype,e),n&&wt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Bn(t){var e=qn(t,"string");return ye(e)=="symbol"?e:e+""}function qn(t,e){if(ye(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ye(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Fe=!1;try{Fe="localStorage"in window;var Re="tusSupport",St=localStorage.getItem(Re);localStorage.setItem(Re,St),St===null&&localStorage.removeItem(Re)}catch(t){if(t.code===t.SECURITY_ERR||t.code===t.QUOTA_EXCEEDED_ERR)Fe=!1;else throw t}var $n=Fe,Mn=function(){function t(){Hn(this,t)}return zn(t,[{key:"findAllUploads",value:function(){var n=this._findEntries("tus::");return Promise.resolve(n)}},{key:"findUploadsByFingerprint",value:function(n){var r=this._findEntries("tus::".concat(n,"::"));return Promise.resolve(r)}},{key:"removeUpload",value:function(n){return localStorage.removeItem(n),Promise.resolve()}},{key:"addUpload",value:function(n,r){var o=Math.round(Math.random()*1e12),l="tus::".concat(n,"::").concat(o);return localStorage.setItem(l,JSON.stringify(r)),Promise.resolve(l)}},{key:"_findEntries",value:function(n){for(var r=[],o=0;o<localStorage.length;o++){var l=localStorage.key(o);if(l.indexOf(n)===0)try{var u=JSON.parse(localStorage.getItem(l));u.urlStorageKey=l,r.push(u)}catch{}}return r}}])}();function ie(t){"@babel/helpers - typeof";return ie=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(t)}function Vn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Zt(r.key),r)}}function Gn(t,e,n){return e&&Ut(t.prototype,e),n&&Ut(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Kn(t,e,n){return e=Ue(e),Xn(t,Yt()?Reflect.construct(e,n||[],Ue(t).constructor):e.apply(t,n))}function Xn(t,e){if(e&&(ie(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Yn(t)}function Yn(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yt=function(){return!!t})()}function Ue(t){return Ue=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Ue(t)}function Zn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ne(t,e)}function Ne(t,e){return Ne=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},Ne(t,e)}function xt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function re(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?xt(Object(n),!0).forEach(function(r){Wn(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Wn(t,e,n){return e=Zt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Zt(t){var e=Jn(t,"string");return ie(e)=="symbol"?e:e+""}function Jn(t,e){if(ie(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ie(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Pt=re(re({},Se.defaultOptions),{},{httpStack:new Dn,fileReader:new jn,urlStorage:$n?new Mn:new Er,fingerprint:Tn}),Qn=function(t){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Vn(this,e),r=re(re({},Pt),r),Kn(this,e,[n,r])}return Zn(e,t),Gn(e,null,[{key:"terminate",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o=re(re({},Pt),o),Se.terminate(r,o)}}])}(Se);const eo={components:{Footer:lr,Navbar:sr,Sidebar:ur},setup(){const t=Qt(),e=er(),n=Y(null),r=e.params.courseId,o=e.params.chapterId,l=Y(!1),u=Y(0),p=Y(!1),f=Y(""),c=Y({title:"",description:"",status:"",pdf_file_url:null,vimeo_id:null,player_embed_url:"",manage_link:"",vimeo_status:"",notes:[{time:"",content:""}]}),b=()=>{c.value.notes.push({time:"",content:""}),ar(()=>{const v=document.querySelector(".notes-container");v.scrollTo({top:v.scrollHeight,behavior:"smooth"})})},m=v=>{c.value.notes.splice(v,1)},L=()=>{try{W.removeVimeo({chapterId:o}),c.value.vimeo_id=null,c.value.player_embed_url="",c.value.manage_link="",c.value.vimeo_status=""}catch(v){console.log(v)}},Z=async v=>{const x=v.target.files[0];if(x)try{p.value=!0,O.value=!0,f.value="正在獲取上傳憑證...";const E=await W.getVimeoID(o,{size:x.size}),D=new Qn(x,{uploadUrl:E.upload_link,headers:{Accept:"application/vnd.vimeo.*+json;version=3.4"},method:"PUT",chunkSize:512e4,onError:H=>{f.value=`上傳失敗: ${H.message}`,v.target.value=""},onProgress:H=>{u.value=H/x.size*100,f.value=`上傳中: ${u.value.toFixed(1)}%`},onSuccess:()=>{c.value.vimeo_id=E.vimeo_id,c.value.player_embed_url=E.player_embed_url,c.value.manage_link=E.manage_link,W.changeVimeoStatus({vimeoID:c.value.vimeo_id}),f.value="上傳完成",v.target.value="",O.value=!1,setInterval(q,1e4)}});f.value="開始上傳資料...",D.start()}catch(E){f.value=`上傳失敗: ${E.message}`,v.target.value=""}finally{p.value=!1,O.value=!1,setTimeout(()=>{u.value=0},3e3)}},q=async()=>{try{const v=await W.getVimeoUpdateStatus(o);c.value.vimeo_status=v.vimeo_status,c.value.vimeo_status=="vimeo_ready"&&clearInterval(q)}catch(v){console.log(v)}},I=async()=>{try{const v=await W.getChapter(r,o);c.value=v}catch(v){console.error("獲取章節數據失敗:",v),alert("獲取章節數據失敗")}},U=v=>{const x=document.querySelector('iframe[src*="vimeo.com"]');if(!x)return;x.contentWindow.postMessage({method:"getCurrentTime"},"*");const E=D=>{if(D.origin.includes("vimeo.com")&&D.data&&typeof D.data.value=="number"){const H=Math.floor(D.data.value),G=String(Math.floor(H/3600)).padStart(2,"0"),K=String(Math.floor(H%3600/60)).padStart(2,"0"),X=String(H%60).padStart(2,"0");c.value.notes[v].time=`${G}:${K}:${X}`,window.removeEventListener("message",E)}};window.addEventListener("message",E)},F=async()=>{l.value=!0;try{const v=c.value.notes.filter(E=>E.content&&E.content.trim()!==""),x={...c.value,notes:v};await W.updateChapter(r,o,x),t.push(`/course/${e.params.courseId}/chapters`)}catch(v){console.error("保存章節失敗:",v),alert("保存章節失敗")}finally{l.value=!1}},O=Y(!1),P=Y(""),A=()=>{t.push(`/course/${r}/chapters`)},V=async v=>{const x=v.target.files[0];if(x&&x.type==="application/pdf")try{O.value=!0,P.value="PDF上傳中...";const E=await W.chapterPDFUpload(x);E.status&&(c.value.pdf_file_url=E.content,P.value="")}catch(E){P.value="PDF上傳失敗："+E.message,v.target.value=""}finally{O.value=!1,setTimeout(()=>{P.value=""},3e3)}else P.value="請上傳PDF格式的檔案",v.target.value=""},N=()=>{c.value.pdf_file_url=null};tr(async()=>{await I(),n.value=await fr.create(document.querySelector("#editor"),{removePlugins:["Markdown"],extraPlugins:[j],toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","blockQuote","imageUpload"],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"}]}}).then(v=>(v.model.document.on("change:data",()=>{c.value.description=v.getData()}),v)).catch(v=>{console.error(v)})});function j(v){v.plugins.get("FileRepository").createUploadAdapter=x=>new cr(x)}return{chapter:c,isUploading:O,isLoading:l,saveChapter:F,handlePdfUpload:V,handleVideoUpload:Z,removePdf:N,removeVideo:L,addNote:b,removeNote:m,route:e,uploadStatusText:P,backToChapterList:A,videoUploadStatusText:f,setNoteTime:U}}},to={class:"main-wrapper"},ro={class:"page-wrapper"},no={class:"page-content"},oo={class:"row mb-4"},io={class:"col-12 mx-auto stretch-card"},ao={class:"card"},lo={class:"card-body"},so={class:"row"},uo={class:"col-md-6 video-preview"},fo={key:0,class:"mb-3"},co=["src"],po={key:1},ho={key:1,class:"mt-2"},yo=["href"],mo={class:"col-md-6 video-column"},vo={key:0,class:"notes-container"},go={class:"d-flex align-items-center gap-2 mb-2"},bo=["onUpdate:modelValue"],_o=["onClick"],wo=["onClick"],So=["onUpdate:modelValue"],Uo={key:1,class:"notes-container"},xo={key:2,class:"text-center text-danger"},Po={class:"mb-3"},Eo={class:"mb-3"},Oo=["innerHTML"],ko={class:"mb-3"},Ro={key:0,class:"mt-2"},jo=["href"],To={class:"d-flex justify-content-end"};function Co(t,e,n,r,o,l){const u=Pe("Sidebar"),p=Pe("Navbar"),f=Pe("Footer");return z(),B("div",to,[Ee(u),_("div",ro,[Ee(p),_("div",no,[_("div",oo,[_("div",io,[_("div",ao,[_("div",lo,[e[13]||(e[13]=_("h6",{class:"card-title"},"編輯章節",-1)),_("div",so,[_("div",uo,[r.chapter.vimeo_id?(z(),B("div",fo,[r.chapter.vimeo_status=="vimeo_ready"?(z(),B("iframe",{key:0,src:r.chapter.player_embed_url,width:"100%",height:"600",frameborder:"0",allow:"autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media",title:"Untitled"},null,8,co)):(z(),B("p",po,"已上傳Vimeo，Vimeo影片處理中，您可以繼續編輯"))])):me("",!0),_("input",{type:"file",class:"form-control",accept:".mp4,.mov",onChange:e[0]||(e[0]=(...c)=>r.handleVideoUpload&&r.handleVideoUpload(...c))},null,32),Ke(" "+Xe(r.videoUploadStatusText)+" ",1),r.chapter.vimeo_id?(z(),B("div",ho,[_("button",{type:"button",class:"btn btn-danger btn-sm",onClick:e[1]||(e[1]=(...c)=>r.removeVideo&&r.removeVideo(...c))}," 移除 "),_("a",{href:`https://vimeo.com${r.chapter.manage_link}`,target:"_blank",class:"m-2 btn btn-info btn-sm"},e[7]||(e[7]=[_("i",{class:"material-icons align-middle me-1"},"edit",-1),Ke(" Vimeo編輯 ")]),8,yo)])):me("",!0)]),_("div",mo,[r.chapter.notes.length>0?(z(),B("div",vo,[(z(!0),B(rr,null,nr(r.chapter.notes,(c,b)=>(z(),B("div",{key:b,class:"mb-3 p-2 border-bottom"},[_("div",go,[Oe(_("input",{type:"text",class:"form-control flex-grow-0","onUpdate:modelValue":m=>c.time=m,placeholder:"時間",style:{width:"120px"}},null,8,bo),[[ke,c.time]]),_("button",{class:"btn btn-outline-secondary btn-sm",onClick:m=>r.setNoteTime(b)}," 設為目前時間 ",8,_o),_("button",{class:"btn btn-outline-danger btn-sm",onClick:m=>r.removeNote(b)}," 刪除 ",8,wo)]),Oe(_("textarea",{"onUpdate:modelValue":m=>c.content=m,class:"form-control w-100",rows:"3",placeholder:"筆記內容"},null,8,So),[[ke,c.content]])]))),128))])):(z(),B("div",Uo,e[8]||(e[8]=[_("div",{class:"d-flex align-items-center justify-content-center h-100 text-muted"},[_("h3",{class:"empty_note"},"尚未新增筆記")],-1)]))),_("button",{class:or(["btn btn-outline-primary btn-sm my-2",r.chapter.vimeo_status!="vimeo_ready"?"btn-disabled":""]),type:"button",onClick:e[2]||(e[2]=(...c)=>r.addNote&&r.addNote(...c))}," 新增筆記 ",2),r.chapter.vimeo_status!="vimeo_ready"?(z(),B("small",xo,"影片尚未上傳，或在處理中，無法新增筆記")):me("",!0)])]),e[14]||(e[14]=_("hr",null,null,-1)),_("form",{onSubmit:e[6]||(e[6]=ir((...c)=>r.saveChapter&&r.saveChapter(...c),["prevent"])),class:"mt-3"},[_("div",Po,[e[9]||(e[9]=_("label",{for:"title",class:"form-label"},"章節標題",-1)),Oe(_("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[3]||(e[3]=c=>r.chapter.title=c),required:""},null,512),[[ke,r.chapter.title]])]),_("div",Eo,[e[10]||(e[10]=_("label",{for:"editor",class:"form-label"},"章節內容",-1)),_("div",{id:"editor",innerHTML:r.chapter.description},null,8,Oo)]),_("div",ko,[e[11]||(e[11]=_("label",{class:"form-label"},"PDF檔案",-1)),_("input",{type:"file",class:"form-control",accept:".pdf",onChange:e[4]||(e[4]=(...c)=>r.handlePdfUpload&&r.handlePdfUpload(...c))},null,32),r.chapter.pdf_file_url&&!r.uploadStatusText?(z(),B("div",Ro,[_("a",{href:r.chapter.pdf_file_url,target:"_blank"},"上傳檔案："+Xe(typeof r.chapter.pdf_file_url=="string"?r.chapter.pdf_file_url.split("/").pop():r.chapter.pdf_file_url.name),9,jo)])):me("",!0)]),_("div",To,[_("div",{onClick:e[5]||(e[5]=(...c)=>r.backToChapterList&&r.backToChapterList(...c)),class:"btn btn-secondary me-2"},"取消"),e[12]||(e[12]=_("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])])])]),Ee(f)])])}const Do=Jt(eo,[["render",Co],["__scopeId","data-v-087a9bf7"]]);export{Do as default};
