import{A as Jt,B as Xe,_ as Qt,i as er,u as tr,r as X,j as rr,k as ve,o as F,c as z,b,l as Oe,t as ke,m as Re,a as le,F as Ye,f as nr,n as or,d as ir,e as ge,g as je,v as ar,p as lr,C as sr}from"./index-dd0c0eb2.js";import{F as ur,N as fr,_ as cr}from"./sidebar-0cb9a7ca.js";import{a as W}from"./api-service-a37f4a4e.js";import{C as pr,U as hr}from"./UploadAdapter-f02fc123.js";import{L as dr}from"./loading-196c643f.js";function oe(t){"@babel/helpers - typeof";return oe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(t)}function Ze(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,mr(r.key),r)}}function yr(t,e,n){return e&&Ze(t.prototype,e),n&&Ze(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function mr(t){var e=vr(t,"string");return oe(e)=="symbol"?e:e+""}function vr(t,e){if(oe(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(oe(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function gr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function br(t,e,n){return e=ce(e),_r(t,Be()?Reflect.construct(e,n||[],ce(t).constructor):e.apply(t,n))}function _r(t,e){if(e&&(oe(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return wr(t)}function wr(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Sr(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fe(t,e)}function Le(t){var e=typeof Map=="function"?new Map:void 0;return Le=function(r){if(r===null||!xr(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,o)}function o(){return Ur(r,arguments,ce(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),fe(o,r)},Le(t)}function Ur(t,e,n){if(Be())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&fe(o,n.prototype),o}function Be(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Be=function(){return!!t})()}function xr(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function fe(t,e){return fe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},fe(t,e)}function ce(t){return ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},ce(t)}var be=function(t){function e(n){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(gr(this,e),r=br(this,e,[n]),r.originalRequest=a,r.originalResponse=u,r.causingError=o,o!=null&&(n+=", caused by ".concat(o.toString())),a!=null){var c=a.getHeader("X-Request-ID")||"n/a",f=a.getMethod(),v=a.getURL(),y=u?u.getStatus():"n/a",m=u?u.getBody()||"":"n/a";n+=", originated from request (method: ".concat(f,", url: ").concat(v,", response code: ").concat(y,", response text: ").concat(m,", request id: ").concat(c,")")}return r.message=n,r}return Sr(e,t),yr(e)}(Le(Error));function pe(t){"@babel/helpers - typeof";return pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(t)}function Pr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function We(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Or(r.key),r)}}function Er(t,e,n){return e&&We(t.prototype,e),n&&We(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Or(t){var e=kr(t,"string");return pe(e)=="symbol"?e:e+""}function kr(t,e){if(pe(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(pe(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Rr=function(){function t(){Pr(this,t)}return Er(t,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(n){return Promise.resolve([])}},{key:"removeUpload",value:function(n){return Promise.resolve()}},{key:"addUpload",value:function(n,r){return Promise.resolve(null)}}])}();const Ot="3.7.7",jr=Ot,ae=typeof Buffer=="function",Je=typeof TextDecoder=="function"?new TextDecoder:void 0,Qe=typeof TextEncoder=="function"?new TextEncoder:void 0,Tr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",se=Array.prototype.slice.call(Tr),_e=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(se),Lr=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,j=String.fromCharCode.bind(String),et=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),kt=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),Rt=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),jt=t=>{let e,n,r,o,a="";const u=t.length%3;for(let c=0;c<t.length;){if((n=t.charCodeAt(c++))>255||(r=t.charCodeAt(c++))>255||(o=t.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,a+=se[e>>18&63]+se[e>>12&63]+se[e>>6&63]+se[e&63]}return u?a.slice(0,u-3)+"===".substring(u):a},qe=typeof btoa=="function"?t=>btoa(t):ae?t=>Buffer.from(t,"binary").toString("base64"):jt,Ce=ae?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(j.apply(null,t.subarray(r,r+4096)));return qe(n.join(""))},we=(t,e=!1)=>e?kt(Ce(t)):Ce(t),Cr=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?j(192|e>>>6)+j(128|e&63):j(224|e>>>12&15)+j(128|e>>>6&63)+j(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return j(240|e>>>18&7)+j(128|e>>>12&63)+j(128|e>>>6&63)+j(128|e&63)}},Ar=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,Tt=t=>t.replace(Ar,Cr),tt=ae?t=>Buffer.from(t,"utf8").toString("base64"):Qe?t=>Ce(Qe.encode(t)):t=>qe(Tt(t)),ne=(t,e=!1)=>e?kt(tt(t)):tt(t),rt=t=>ne(t,!0),Ir=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Dr=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return j((n>>>10)+55296)+j((n&1023)+56320);case 3:return j((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return j((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},Lt=t=>t.replace(Ir,Dr),Ct=t=>{if(t=t.replace(/\s+/g,""),!Lr.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let a=0;a<t.length;)e=_e[t.charAt(a++)]<<18|_e[t.charAt(a++)]<<12|(r=_e[t.charAt(a++)])<<6|(o=_e[t.charAt(a++)]),n+=r===64?j(e>>16&255):o===64?j(e>>16&255,e>>8&255):j(e>>16&255,e>>8&255,e&255);return n},$e=typeof atob=="function"?t=>atob(Rt(t)):ae?t=>Buffer.from(t,"base64").toString("binary"):Ct,At=ae?t=>et(Buffer.from(t,"base64")):t=>et($e(t).split("").map(e=>e.charCodeAt(0))),It=t=>At(Dt(t)),Fr=ae?t=>Buffer.from(t,"base64").toString("utf8"):Je?t=>Je.decode(At(t)):t=>Lt($e(t)),Dt=t=>Rt(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),Ae=t=>Fr(Dt(t)),Nr=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},Ft=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),Nt=function(){const t=(e,n)=>Object.defineProperty(String.prototype,e,Ft(n));t("fromBase64",function(){return Ae(this)}),t("toBase64",function(e){return ne(this,e)}),t("toBase64URI",function(){return ne(this,!0)}),t("toBase64URL",function(){return ne(this,!0)}),t("toUint8Array",function(){return It(this)})},Ht=function(){const t=(e,n)=>Object.defineProperty(Uint8Array.prototype,e,Ft(n));t("toBase64",function(e){return we(this,e)}),t("toBase64URI",function(){return we(this,!0)}),t("toBase64URL",function(){return we(this,!0)})},Hr=()=>{Nt(),Ht()},zr={version:Ot,VERSION:jr,atob:$e,atobPolyfill:Ct,btoa:qe,btoaPolyfill:jt,fromBase64:Ae,toBase64:ne,encode:ne,encodeURI:rt,encodeURL:rt,utob:Tt,btou:Lt,decode:Ae,isValid:Nr,fromUint8Array:we,toUint8Array:It,extendString:Nt,extendUint8Array:Ht,extendBuiltins:Hr};var Br=function(e,n){if(n=n.split(":")[0],e=+e,!e)return!1;switch(n){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},Me={},qr=Object.prototype.hasOwnProperty,$r;function nt(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch{return null}}function ot(t){try{return encodeURIComponent(t)}catch{return null}}function Mr(t){for(var e=/([^=?#&]+)=?([^&]*)/g,n={},r;r=e.exec(t);){var o=nt(r[1]),a=nt(r[2]);o===null||a===null||o in n||(n[o]=a)}return n}function Vr(t,e){e=e||"";var n=[],r,o;typeof e!="string"&&(e="?");for(o in t)if(qr.call(t,o)){if(r=t[o],!r&&(r===null||r===$r||isNaN(r))&&(r=""),o=ot(o),r=ot(r),o===null||r===null)continue;n.push(o+"="+r)}return n.length?e+n.join("&"):""}Me.stringify=Vr;Me.parse=Mr;var zt=Br,Ee=Me,Gr=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,Bt=/[\n\r\t]/g,Kr=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,qt=/:\d+$/,Xr=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Yr=/^[a-zA-Z]:/;function Ve(t){return(t||"").toString().replace(Gr,"")}var Ie=[["#","hash"],["?","query"],function(e,n){return q(n.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],it={hash:1,query:1};function $t(t){var e;typeof window<"u"?e=window:typeof Xe<"u"?e=Xe:typeof self<"u"?e=self:e={};var n=e.location||{};t=t||n;var r={},o=typeof t,a;if(t.protocol==="blob:")r=new $(unescape(t.pathname),{});else if(o==="string"){r=new $(t,{});for(a in it)delete r[a]}else if(o==="object"){for(a in t)a in it||(r[a]=t[a]);r.slashes===void 0&&(r.slashes=Kr.test(t.href))}return r}function q(t){return t==="file:"||t==="ftp:"||t==="http:"||t==="https:"||t==="ws:"||t==="wss:"}function Mt(t,e){t=Ve(t),t=t.replace(Bt,""),e=e||{};var n=Xr.exec(t),r=n[1]?n[1].toLowerCase():"",o=!!n[2],a=!!n[3],u=0,c;return o?a?(c=n[2]+n[3]+n[4],u=n[2].length+n[3].length):(c=n[2]+n[4],u=n[2].length):a?(c=n[3]+n[4],u=n[3].length):c=n[4],r==="file:"?u>=2&&(c=c.slice(2)):q(r)?c=n[4]:r?o&&(c=c.slice(2)):u>=2&&q(e.protocol)&&(c=n[4]),{protocol:r,slashes:o||q(r),slashesCount:u,rest:c}}function Zr(t,e){if(t==="")return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,o=n[r-1],a=!1,u=0;r--;)n[r]==="."?n.splice(r,1):n[r]===".."?(n.splice(r,1),u++):u&&(r===0&&(a=!0),n.splice(r,1),u--);return a&&n.unshift(""),(o==="."||o==="..")&&n.push(""),n.join("/")}function $(t,e,n){if(t=Ve(t),t=t.replace(Bt,""),!(this instanceof $))return new $(t,e,n);var r,o,a,u,c,f,v=Ie.slice(),y=typeof e,m=this,E=0;for(y!=="object"&&y!=="string"&&(n=e,e=null),n&&typeof n!="function"&&(n=Ee.parse),e=$t(e),o=Mt(t||"",e),r=!o.protocol&&!o.slashes,m.slashes=o.slashes||r&&e.slashes,m.protocol=o.protocol||e.protocol||"",t=o.rest,(o.protocol==="file:"&&(o.slashesCount!==2||Yr.test(t))||!o.slashes&&(o.protocol||o.slashesCount<2||!q(m.protocol)))&&(v[3]=[/(.*)/,"pathname"]);E<v.length;E++){if(u=v[E],typeof u=="function"){t=u(t,m);continue}a=u[0],f=u[1],a!==a?m[f]=t:typeof a=="string"?(c=a==="@"?t.lastIndexOf(a):t.indexOf(a),~c&&(typeof u[2]=="number"?(m[f]=t.slice(0,c),t=t.slice(c+u[2])):(m[f]=t.slice(c),t=t.slice(0,c)))):(c=a.exec(t))&&(m[f]=c[1],t=t.slice(0,c.index)),m[f]=m[f]||r&&u[3]&&e[f]||"",u[4]&&(m[f]=m[f].toLowerCase())}n&&(m.query=n(m.query)),r&&e.slashes&&m.pathname.charAt(0)!=="/"&&(m.pathname!==""||e.pathname!=="")&&(m.pathname=Zr(m.pathname,e.pathname)),m.pathname.charAt(0)!=="/"&&q(m.protocol)&&(m.pathname="/"+m.pathname),zt(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(c=m.auth.indexOf(":"),~c?(m.username=m.auth.slice(0,c),m.username=encodeURIComponent(decodeURIComponent(m.username)),m.password=m.auth.slice(c+1),m.password=encodeURIComponent(decodeURIComponent(m.password))):m.username=encodeURIComponent(decodeURIComponent(m.auth)),m.auth=m.password?m.username+":"+m.password:m.username),m.origin=m.protocol!=="file:"&&q(m.protocol)&&m.host?m.protocol+"//"+m.host:"null",m.href=m.toString()}function Wr(t,e,n){var r=this;switch(t){case"query":typeof e=="string"&&e.length&&(e=(n||Ee.parse)(e)),r[t]=e;break;case"port":r[t]=e,zt(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[t]="");break;case"hostname":r[t]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[t]=e,qt.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!n;break;case"pathname":case"hash":if(e){var o=t==="pathname"?"/":"#";r[t]=e.charAt(0)!==o?o+e:e}else r[t]=e;break;case"username":case"password":r[t]=encodeURIComponent(e);break;case"auth":var a=e.indexOf(":");~a?(r.username=e.slice(0,a),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(a+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var u=0;u<Ie.length;u++){var c=Ie[u];c[4]&&(r[c[1]]=r[c[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&q(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function Jr(t){(!t||typeof t!="function")&&(t=Ee.stringify);var e,n=this,r=n.host,o=n.protocol;o&&o.charAt(o.length-1)!==":"&&(o+=":");var a=o+(n.protocol&&n.slashes||q(n.protocol)?"//":"");return n.username?(a+=n.username,n.password&&(a+=":"+n.password),a+="@"):n.password?(a+=":"+n.password,a+="@"):n.protocol!=="file:"&&q(n.protocol)&&!r&&n.pathname!=="/"&&(a+="@"),(r[r.length-1]===":"||qt.test(n.hostname)&&!n.port)&&(r+=":"),a+=r+n.pathname,e=typeof n.query=="object"?t(n.query):n.query,e&&(a+=e.charAt(0)!=="?"?"?"+e:e),n.hash&&(a+=n.hash),a}$.prototype={set:Wr,toString:Jr};$.extractProtocol=Mt;$.location=$t;$.trimLeft=Ve;$.qs=Ee;var Qr=$;const en=Jt(Qr);function tn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,n=t==="x"?e:e&3|8;return n.toString(16)})}function De(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */De=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(s,i,l){s[i]=l.value},a=typeof Symbol=="function"?Symbol:{},u=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",f=a.toStringTag||"@@toStringTag";function v(s,i,l){return Object.defineProperty(s,i,{value:l,enumerable:!0,configurable:!0,writable:!0}),s[i]}try{v({},"")}catch{v=function(l,p,d){return l[p]=d}}function y(s,i,l,p){var d=i&&i.prototype instanceof N?i:N,h=Object.create(d.prototype),_=new G(p||[]);return o(h,"_invoke",{value:k(s,l,_)}),h}function m(s,i,l){try{return{type:"normal",arg:s.call(i,l)}}catch(p){return{type:"throw",arg:p}}}e.wrap=y;var E="suspendedStart",Y="suspendedYield",M="executing",D="completed",U={};function N(){}function T(){}function x(){}var O={};v(O,u,function(){return this});var V=Object.getPrototypeOf,H=V&&V(V(K([])));H&&H!==n&&r.call(H,u)&&(O=H);var L=x.prototype=N.prototype=Object.create(O);function Z(s){["next","throw","return"].forEach(function(i){v(s,i,function(l){return this._invoke(i,l)})})}function g(s,i){function l(d,h,_,w){var S=m(s[d],s,h);if(S.type!=="throw"){var A=S.arg,R=A.value;return R&&J(R)=="object"&&r.call(R,"__await")?i.resolve(R.__await).then(function(I){l("next",I,_,w)},function(I){l("throw",I,_,w)}):i.resolve(R).then(function(I){A.value=I,_(A)},function(I){return l("throw",I,_,w)})}w(S.arg)}var p;o(this,"_invoke",{value:function(h,_){function w(){return new i(function(S,A){l(h,_,S,A)})}return p=p?p.then(w,w):w()}})}function k(s,i,l){var p=E;return function(d,h){if(p===M)throw Error("Generator is already running");if(p===D){if(d==="throw")throw h;return{value:t,done:!0}}for(l.method=d,l.arg=h;;){var _=l.delegate;if(_){var w=P(_,l);if(w){if(w===U)continue;return w}}if(l.method==="next")l.sent=l._sent=l.arg;else if(l.method==="throw"){if(p===E)throw p=D,l.arg;l.dispatchException(l.arg)}else l.method==="return"&&l.abrupt("return",l.arg);p=M;var S=m(s,i,l);if(S.type==="normal"){if(p=l.done?D:Y,S.arg===U)continue;return{value:S.arg,done:l.done}}S.type==="throw"&&(p=D,l.method="throw",l.arg=S.arg)}}}function P(s,i){var l=i.method,p=s.iterator[l];if(p===t)return i.delegate=null,l==="throw"&&s.iterator.return&&(i.method="return",i.arg=t,P(s,i),i.method==="throw")||l!=="return"&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+l+"' method")),U;var d=m(p,s.iterator,i.arg);if(d.type==="throw")return i.method="throw",i.arg=d.arg,i.delegate=null,U;var h=d.arg;return h?h.done?(i[s.resultName]=h.value,i.next=s.nextLoc,i.method!=="return"&&(i.method="next",i.arg=t),i.delegate=null,U):h:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,U)}function B(s){var i={tryLoc:s[0]};1 in s&&(i.catchLoc=s[1]),2 in s&&(i.finallyLoc=s[2],i.afterLoc=s[3]),this.tryEntries.push(i)}function C(s){var i=s.completion||{};i.type="normal",delete i.arg,s.completion=i}function G(s){this.tryEntries=[{tryLoc:"root"}],s.forEach(B,this),this.reset(!0)}function K(s){if(s||s===""){var i=s[u];if(i)return i.call(s);if(typeof s.next=="function")return s;if(!isNaN(s.length)){var l=-1,p=function d(){for(;++l<s.length;)if(r.call(s,l))return d.value=s[l],d.done=!1,d;return d.value=t,d.done=!0,d};return p.next=p}}throw new TypeError(J(s)+" is not iterable")}return T.prototype=x,o(L,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:T,configurable:!0}),T.displayName=v(x,f,"GeneratorFunction"),e.isGeneratorFunction=function(s){var i=typeof s=="function"&&s.constructor;return!!i&&(i===T||(i.displayName||i.name)==="GeneratorFunction")},e.mark=function(s){return Object.setPrototypeOf?Object.setPrototypeOf(s,x):(s.__proto__=x,v(s,f,"GeneratorFunction")),s.prototype=Object.create(L),s},e.awrap=function(s){return{__await:s}},Z(g.prototype),v(g.prototype,c,function(){return this}),e.AsyncIterator=g,e.async=function(s,i,l,p,d){d===void 0&&(d=Promise);var h=new g(y(s,i,l,p),d);return e.isGeneratorFunction(i)?h:h.next().then(function(_){return _.done?_.value:h.next()})},Z(L),v(L,f,"Generator"),v(L,u,function(){return this}),v(L,"toString",function(){return"[object Generator]"}),e.keys=function(s){var i=Object(s),l=[];for(var p in i)l.push(p);return l.reverse(),function d(){for(;l.length;){var h=l.pop();if(h in i)return d.value=h,d.done=!1,d}return d.done=!0,d}},e.values=K,G.prototype={constructor:G,reset:function(i){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!i)for(var l in this)l.charAt(0)==="t"&&r.call(this,l)&&!isNaN(+l.slice(1))&&(this[l]=t)},stop:function(){this.done=!0;var i=this.tryEntries[0].completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var l=this;function p(A,R){return _.type="throw",_.arg=i,l.next=A,R&&(l.method="next",l.arg=t),!!R}for(var d=this.tryEntries.length-1;d>=0;--d){var h=this.tryEntries[d],_=h.completion;if(h.tryLoc==="root")return p("end");if(h.tryLoc<=this.prev){var w=r.call(h,"catchLoc"),S=r.call(h,"finallyLoc");if(w&&S){if(this.prev<h.catchLoc)return p(h.catchLoc,!0);if(this.prev<h.finallyLoc)return p(h.finallyLoc)}else if(w){if(this.prev<h.catchLoc)return p(h.catchLoc,!0)}else{if(!S)throw Error("try statement without catch or finally");if(this.prev<h.finallyLoc)return p(h.finallyLoc)}}}},abrupt:function(i,l){for(var p=this.tryEntries.length-1;p>=0;--p){var d=this.tryEntries[p];if(d.tryLoc<=this.prev&&r.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var h=d;break}}h&&(i==="break"||i==="continue")&&h.tryLoc<=l&&l<=h.finallyLoc&&(h=null);var _=h?h.completion:{};return _.type=i,_.arg=l,h?(this.method="next",this.next=h.finallyLoc,U):this.complete(_)},complete:function(i,l){if(i.type==="throw")throw i.arg;return i.type==="break"||i.type==="continue"?this.next=i.arg:i.type==="return"?(this.rval=this.arg=i.arg,this.method="return",this.next="end"):i.type==="normal"&&l&&(this.next=l),U},finish:function(i){for(var l=this.tryEntries.length-1;l>=0;--l){var p=this.tryEntries[l];if(p.finallyLoc===i)return this.complete(p.completion,p.afterLoc),C(p),U}},catch:function(i){for(var l=this.tryEntries.length-1;l>=0;--l){var p=this.tryEntries[l];if(p.tryLoc===i){var d=p.completion;if(d.type==="throw"){var h=d.arg;C(p)}return h}}throw Error("illegal catch attempt")},delegateYield:function(i,l,p){return this.delegate={iterator:K(i),resultName:l,nextLoc:p},this.method==="next"&&(this.arg=t),U}},e}function at(t,e,n,r,o,a,u){try{var c=t[a](u),f=c.value}catch(v){n(v);return}c.done?e(f):Promise.resolve(f).then(r,o)}function rn(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function u(f){at(a,r,o,u,c,"next",f)}function c(f){at(a,r,o,u,c,"throw",f)}u(void 0)})}}function Vt(t,e){return an(t)||on(t,e)||Gt(t,e)||nn()}function nn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function on(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,o,a,u,c=[],f=!0,v=!1;try{if(a=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;f=!1}else for(;!(f=(r=a.call(n)).done)&&(c.push(r.value),c.length!==e);f=!0);}catch(y){v=!0,o=y}finally{try{if(!f&&n.return!=null&&(u=n.return(),Object(u)!==u))return}finally{if(v)throw o}}return c}}function an(t){if(Array.isArray(t))return t}function J(t){"@babel/helpers - typeof";return J=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J(t)}function ln(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Gt(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(v){throw v},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,u=!1,c;return{s:function(){n=n.call(t)},n:function(){var v=n.next();return a=v.done,v},e:function(v){u=!0,c=v},f:function(){try{!a&&n.return!=null&&n.return()}finally{if(u)throw c}}}}function Gt(t,e){if(t){if(typeof t=="string")return lt(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lt(t,e)}}function lt(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function st(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function ee(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?st(Object(n),!0).forEach(function(r){sn(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function sn(t,e,n){return e=Kt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function un(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Kt(r.key),r)}}function fn(t,e,n){return e&&ut(t.prototype,e),n&&ut(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Kt(t){var e=cn(t,"string");return J(e)=="symbol"?e:e+""}function cn(t,e){if(J(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(J(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Se="tus-v1",Ue="ietf-draft-03",ue="ietf-draft-05",pn={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:Xt,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:Se},xe=function(){function t(e,n){un(this,t),"resume"in n&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=n,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return fn(t,[{key:"findPreviousUploads",value:function(){var n=this;return this.options.fingerprint(this.file,this.options).then(function(r){return n._urlStorage.findUploadsByFingerprint(r)})}},{key:"resumeFromPreviousUpload",value:function(n){this.url=n.uploadUrl||null,this._parallelUploadUrls=n.parallelUploadUrls||null,this._urlStorageKey=n.urlStorageKey}},{key:"start",value:function(){var n=this,r=this.file;if(!r){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(![Se,Ue,ue].includes(this.options.protocol)){this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var o=this.options.retryDelays;if(o!=null&&Object.prototype.toString.call(o)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var a=0,u=["uploadUrl","uploadSize","uploadLengthDeferred"];a<u.length;a++){var c=u[a];if(this.options[c]){this._emitError(new Error("tus: cannot use the ".concat(c," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(r,this.options).then(function(f){return n._fingerprint=f,n._source?n._source:n.options.fileReader.openFile(r,n.options.chunkSize)}).then(function(f){if(n._source=f,n.options.uploadLengthDeferred)n._size=null;else if(n.options.uploadSize!=null){if(n._size=Number(n.options.uploadSize),Number.isNaN(n._size)){n._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(n._size=n._source.size,n._size==null){n._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}n.options.parallelUploads>1||n._parallelUploadUrls!=null?n._startParallelUpload():n._startSingleUpload()}).catch(function(f){n._emitError(f)})}},{key:"_startParallelUpload",value:function(){var n,r=this,o=this._size,a=0;this._parallelUploads=[];var u=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,c=(n=this.options.parallelUploadBoundaries)!==null&&n!==void 0?n:dn(this._source.size,u);this._parallelUploadUrls&&c.forEach(function(y,m){y.uploadUrl=r._parallelUploadUrls[m]||null}),this._parallelUploadUrls=new Array(c.length);var f=c.map(function(y,m){var E=0;return r._source.slice(y.start,y.end).then(function(Y){var M=Y.value;return new Promise(function(D,U){var N=ee(ee({},r.options),{},{uploadUrl:y.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:r.options.metadataForPartialUploads,headers:ee(ee({},r.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:D,onError:U,onProgress:function(O){a=a-E+O,E=O,r._emitProgress(a,o)},onUploadUrlAvailable:function(){r._parallelUploadUrls[m]=T.url,r._parallelUploadUrls.filter(function(O){return!!O}).length===c.length&&r._saveUploadInUrlStorage()}}),T=new t(M,N);T.start(),r._parallelUploads.push(T)})})}),v;Promise.all(f).then(function(){v=r._openRequest("POST",r.options.endpoint),v.setHeader("Upload-Concat","final;".concat(r._parallelUploadUrls.join(" ")));var y=ft(r.options.metadata);return y!==""&&v.setHeader("Upload-Metadata",y),r._sendRequest(v,null)}).then(function(y){if(!te(y.getStatus(),200)){r._emitHttpError(v,y,"tus: unexpected response while creating upload");return}var m=y.getHeader("Location");if(m==null){r._emitHttpError(v,y,"tus: invalid or missing Location header");return}r.url=dt(r.options.endpoint,m),"Created upload at ".concat(r.url),r._emitSuccess(y)}).catch(function(y){r._emitError(y)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(n){var r=this;if(this._parallelUploads!=null){var o=ln(this._parallelUploads),a;try{for(o.s();!(a=o.n()).done;){var u=a.value;u.abort(n)}}catch(c){o.e(c)}finally{o.f()}}return this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!n||this.url==null?Promise.resolve():t.terminate(this.url,this.options).then(function(){return r._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(n,r,o,a){this._emitError(new be(o,a,n,r))}},{key:"_emitError",value:function(n){var r=this;if(!this._aborted){if(this.options.retryDelays!=null){var o=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(o&&(this._retryAttempt=0),ht(n,this._retryAttempt,this.options)){var a=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){r.start()},a);return}}if(typeof this.options.onError=="function")this.options.onError(n);else throw n}}},{key:"_emitSuccess",value:function(n){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess({lastResponse:n})}},{key:"_emitProgress",value:function(n,r){typeof this.options.onProgress=="function"&&this.options.onProgress(n,r)}},{key:"_emitChunkComplete",value:function(n,r,o){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(n,r,o)}},{key:"_createUpload",value:function(){var n=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var r=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?r.setHeader("Upload-Defer-Length","1"):r.setHeader("Upload-Length","".concat(this._size));var o=ft(this.options.metadata);o!==""&&r.setHeader("Upload-Metadata",o);var a;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,a=this._addChunkToRequest(r)):((this.options.protocol===Ue||this.options.protocol===ue)&&r.setHeader("Upload-Complete","?0"),a=this._sendRequest(r,null)),a.then(function(u){if(!te(u.getStatus(),200)){n._emitHttpError(r,u,"tus: unexpected response while creating upload");return}var c=u.getHeader("Location");if(c==null){n._emitHttpError(r,u,"tus: invalid or missing Location header");return}if(n.url=dt(n.options.endpoint,c),"Created upload at ".concat(n.url),typeof n.options.onUploadUrlAvailable=="function"&&n.options.onUploadUrlAvailable(),n._size===0){n._emitSuccess(u),n._source.close();return}n._saveUploadInUrlStorage().then(function(){n.options.uploadDataDuringCreation?n._handleUploadResponse(r,u):(n._offset=0,n._performUpload())})}).catch(function(u){n._emitHttpError(r,null,"tus: failed to create upload",u)})}},{key:"_resumeUpload",value:function(){var n=this,r=this._openRequest("HEAD",this.url),o=this._sendRequest(r,null);o.then(function(a){var u=a.getStatus();if(!te(u,200)){if(u===423){n._emitHttpError(r,a,"tus: upload is currently locked; retry later");return}if(te(u,400)&&n._removeFromUrlStorage(),!n.options.endpoint){n._emitHttpError(r,a,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}n.url=null,n._createUpload();return}var c=Number.parseInt(a.getHeader("Upload-Offset"),10);if(Number.isNaN(c)){n._emitHttpError(r,a,"tus: invalid or missing offset value");return}var f=Number.parseInt(a.getHeader("Upload-Length"),10);if(Number.isNaN(f)&&!n.options.uploadLengthDeferred&&n.options.protocol===Se){n._emitHttpError(r,a,"tus: invalid or missing length value");return}typeof n.options.onUploadUrlAvailable=="function"&&n.options.onUploadUrlAvailable(),n._saveUploadInUrlStorage().then(function(){if(c===f){n._emitProgress(f,f),n._emitSuccess(a);return}n._offset=c,n._performUpload()})}).catch(function(a){n._emitHttpError(r,null,"tus: failed to resume upload",a)})}},{key:"_performUpload",value:function(){var n=this;if(!this._aborted){var r;this.options.overridePatchMethod?(r=this._openRequest("POST",this.url),r.setHeader("X-HTTP-Method-Override","PATCH")):r=this._openRequest("PATCH",this.url),r.setHeader("Upload-Offset","".concat(this._offset));var o=this._addChunkToRequest(r);o.then(function(a){if(!te(a.getStatus(),200)){n._emitHttpError(r,a,"tus: unexpected response while uploading chunk");return}n._handleUploadResponse(r,a)}).catch(function(a){n._aborted||n._emitHttpError(r,null,"tus: failed to upload chunk at offset ".concat(n._offset),a)})}}},{key:"_addChunkToRequest",value:function(n){var r=this,o=this._offset,a=this._offset+this.options.chunkSize;return n.setProgressHandler(function(u){r._emitProgress(o+u,r._size)}),this.options.protocol===Se?n.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===ue&&n.setHeader("Content-Type","application/partial-upload"),(a===Number.POSITIVE_INFINITY||a>this._size)&&!this.options.uploadLengthDeferred&&(a=this._size),this._source.slice(o,a).then(function(u){var c=u.value,f=u.done,v=c!=null&&c.size?c.size:0;r.options.uploadLengthDeferred&&f&&(r._size=r._offset+v,n.setHeader("Upload-Length","".concat(r._size)));var y=r._offset+v;return!r.options.uploadLengthDeferred&&f&&y!==r._size?Promise.reject(new Error("upload was configured with a size of ".concat(r._size," bytes, but the source is done after ").concat(y," bytes"))):c===null?r._sendRequest(n):((r.options.protocol===Ue||r.options.protocol===ue)&&n.setHeader("Upload-Complete",f?"?1":"?0"),r._emitProgress(r._offset,r._size),r._sendRequest(n,c))})}},{key:"_handleUploadResponse",value:function(n,r){var o=Number.parseInt(r.getHeader("Upload-Offset"),10);if(Number.isNaN(o)){this._emitHttpError(n,r,"tus: invalid or missing offset value");return}if(this._emitProgress(o,this._size),this._emitChunkComplete(o-this._offset,o,this._size),this._offset=o,o===this._size){this._emitSuccess(r),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(n,r){var o=ct(n,r,this.options);return this._req=o,o}},{key:"_removeFromUrlStorage",value:function(){var n=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(r){n._emitError(r)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var n=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var r={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?r.parallelUploadUrls=this._parallelUploadUrls:r.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,r).then(function(o){n._urlStorageKey=o})}},{key:"_sendRequest",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return pt(n,r,this.options)}}],[{key:"terminate",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=ct("DELETE",n,r);return pt(o,null,r).then(function(a){if(a.getStatus()!==204)throw new be("tus: unexpected response while terminating upload",null,o,a)}).catch(function(a){if(a instanceof be||(a=new be("tus: failed to terminate upload",a,o,null)),!ht(a,0,r))throw a;var u=r.retryDelays[0],c=r.retryDelays.slice(1),f=ee(ee({},r),{},{retryDelays:c});return new Promise(function(v){return setTimeout(v,u)}).then(function(){return t.terminate(n,f)})})}}])}();function ft(t){return Object.entries(t).map(function(e){var n=Vt(e,2),r=n[0],o=n[1];return"".concat(r," ").concat(zr.encode(String(o)))}).join(",")}function te(t,e){return t>=e&&t<e+100}function ct(t,e,n){var r=n.httpStack.createRequest(t,e);n.protocol===Ue?r.setHeader("Upload-Draft-Interop-Version","5"):n.protocol===ue?r.setHeader("Upload-Draft-Interop-Version","6"):r.setHeader("Tus-Resumable","1.0.0");for(var o=n.headers||{},a=0,u=Object.entries(o);a<u.length;a++){var c=Vt(u[a],2),f=c[0],v=c[1];r.setHeader(f,v)}if(n.addRequestId){var y=tn();r.setHeader("X-Request-ID",y)}return r}function pt(t,e,n){return Fe.apply(this,arguments)}function Fe(){return Fe=rn(De().mark(function t(e,n,r){var o;return De().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(typeof r.onBeforeRequest!="function"){u.next=3;break}return u.next=3,r.onBeforeRequest(e);case 3:return u.next=5,e.send(n);case 5:if(o=u.sent,typeof r.onAfterResponse!="function"){u.next=9;break}return u.next=9,r.onAfterResponse(e,o);case 9:return u.abrupt("return",o);case 10:case"end":return u.stop()}},t)})),Fe.apply(this,arguments)}function hn(){var t=!0;return typeof navigator<"u"&&navigator.onLine===!1&&(t=!1),t}function ht(t,e,n){return n.retryDelays==null||e>=n.retryDelays.length||t.originalRequest==null?!1:n&&typeof n.onShouldRetry=="function"?n.onShouldRetry(t,e,n):Xt(t)}function Xt(t){var e=t.originalResponse?t.originalResponse.getStatus():0;return(!te(e,400)||e===409||e===423)&&hn()}function dt(t,e){return new en(e,t).toString()}function dn(t,e){for(var n=Math.floor(t/e),r=[],o=0;o<e;o++)r.push({start:n*o,end:n*(o+1)});return r[e-1].end=t,r}xe.defaultOptions=pn;var Yt=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function yn(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.responseType="blob",r.onload=function(){var o=r.response;e(o)},r.onerror=function(o){n(o)},r.open("GET",t),r.send()})}var mn=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function vn(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){var o=new Uint8Array(r.result);e({value:o})},r.onerror=function(o){n(o)},r.readAsArrayBuffer(t)})}function he(t){"@babel/helpers - typeof";return he=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(t)}function gn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function yt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_n(r.key),r)}}function bn(t,e,n){return e&&yt(t.prototype,e),n&&yt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _n(t){var e=wn(t,"string");return he(e)=="symbol"?e:e+""}function wn(t,e){if(he(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(he(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var mt=function(){function t(e){gn(this,t),this._file=e,this.size=e.size}return bn(t,[{key:"slice",value:function(n,r){if(mn())return vn(this._file.slice(n,r));var o=this._file.slice(n,r),a=r>=this.size;return Promise.resolve({value:o,done:a})}},{key:"close",value:function(){}}])}();function de(t){"@babel/helpers - typeof";return de=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(t)}function Sn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,xn(r.key),r)}}function Un(t,e,n){return e&&vt(t.prototype,e),n&&vt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function xn(t){var e=Pn(t,"string");return de(e)=="symbol"?e:e+""}function Pn(t,e){if(de(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(de(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function gt(t){return t===void 0?0:t.size!==void 0?t.size:t.length}function En(t,e){if(t.concat)return t.concat(e);if(t instanceof Blob)return new Blob([t,e],{type:t.type});if(t.set){var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n}throw new Error("Unknown data type")}var On=function(){function t(e){Sn(this,t),this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}return Un(t,[{key:"slice",value:function(n,r){return n<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(n,r)}},{key:"_readUntilEnoughDataOrDone",value:function(n,r){var o=this,a=r<=this._bufferOffset+gt(this._buffer);if(this._done||a){var u=this._getDataFromBuffer(n,r),c=u==null?this._done:!1;return Promise.resolve({value:u,done:c})}return this._reader.read().then(function(f){var v=f.value,y=f.done;return y?o._done=!0:o._buffer===void 0?o._buffer=v:o._buffer=En(o._buffer,v),o._readUntilEnoughDataOrDone(n,r)})}},{key:"_getDataFromBuffer",value:function(n,r){n>this._bufferOffset&&(this._buffer=this._buffer.slice(n-this._bufferOffset),this._bufferOffset=n);var o=gt(this._buffer)===0;return this._done&&o?null:this._buffer.slice(0,r-n)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function Q(t){"@babel/helpers - typeof";return Q=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(t)}function Ne(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ne=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(s,i,l){s[i]=l.value},a=typeof Symbol=="function"?Symbol:{},u=a.iterator||"@@iterator",c=a.asyncIterator||"@@asyncIterator",f=a.toStringTag||"@@toStringTag";function v(s,i,l){return Object.defineProperty(s,i,{value:l,enumerable:!0,configurable:!0,writable:!0}),s[i]}try{v({},"")}catch{v=function(l,p,d){return l[p]=d}}function y(s,i,l,p){var d=i&&i.prototype instanceof N?i:N,h=Object.create(d.prototype),_=new G(p||[]);return o(h,"_invoke",{value:k(s,l,_)}),h}function m(s,i,l){try{return{type:"normal",arg:s.call(i,l)}}catch(p){return{type:"throw",arg:p}}}e.wrap=y;var E="suspendedStart",Y="suspendedYield",M="executing",D="completed",U={};function N(){}function T(){}function x(){}var O={};v(O,u,function(){return this});var V=Object.getPrototypeOf,H=V&&V(V(K([])));H&&H!==n&&r.call(H,u)&&(O=H);var L=x.prototype=N.prototype=Object.create(O);function Z(s){["next","throw","return"].forEach(function(i){v(s,i,function(l){return this._invoke(i,l)})})}function g(s,i){function l(d,h,_,w){var S=m(s[d],s,h);if(S.type!=="throw"){var A=S.arg,R=A.value;return R&&Q(R)=="object"&&r.call(R,"__await")?i.resolve(R.__await).then(function(I){l("next",I,_,w)},function(I){l("throw",I,_,w)}):i.resolve(R).then(function(I){A.value=I,_(A)},function(I){return l("throw",I,_,w)})}w(S.arg)}var p;o(this,"_invoke",{value:function(h,_){function w(){return new i(function(S,A){l(h,_,S,A)})}return p=p?p.then(w,w):w()}})}function k(s,i,l){var p=E;return function(d,h){if(p===M)throw Error("Generator is already running");if(p===D){if(d==="throw")throw h;return{value:t,done:!0}}for(l.method=d,l.arg=h;;){var _=l.delegate;if(_){var w=P(_,l);if(w){if(w===U)continue;return w}}if(l.method==="next")l.sent=l._sent=l.arg;else if(l.method==="throw"){if(p===E)throw p=D,l.arg;l.dispatchException(l.arg)}else l.method==="return"&&l.abrupt("return",l.arg);p=M;var S=m(s,i,l);if(S.type==="normal"){if(p=l.done?D:Y,S.arg===U)continue;return{value:S.arg,done:l.done}}S.type==="throw"&&(p=D,l.method="throw",l.arg=S.arg)}}}function P(s,i){var l=i.method,p=s.iterator[l];if(p===t)return i.delegate=null,l==="throw"&&s.iterator.return&&(i.method="return",i.arg=t,P(s,i),i.method==="throw")||l!=="return"&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+l+"' method")),U;var d=m(p,s.iterator,i.arg);if(d.type==="throw")return i.method="throw",i.arg=d.arg,i.delegate=null,U;var h=d.arg;return h?h.done?(i[s.resultName]=h.value,i.next=s.nextLoc,i.method!=="return"&&(i.method="next",i.arg=t),i.delegate=null,U):h:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,U)}function B(s){var i={tryLoc:s[0]};1 in s&&(i.catchLoc=s[1]),2 in s&&(i.finallyLoc=s[2],i.afterLoc=s[3]),this.tryEntries.push(i)}function C(s){var i=s.completion||{};i.type="normal",delete i.arg,s.completion=i}function G(s){this.tryEntries=[{tryLoc:"root"}],s.forEach(B,this),this.reset(!0)}function K(s){if(s||s===""){var i=s[u];if(i)return i.call(s);if(typeof s.next=="function")return s;if(!isNaN(s.length)){var l=-1,p=function d(){for(;++l<s.length;)if(r.call(s,l))return d.value=s[l],d.done=!1,d;return d.value=t,d.done=!0,d};return p.next=p}}throw new TypeError(Q(s)+" is not iterable")}return T.prototype=x,o(L,"constructor",{value:x,configurable:!0}),o(x,"constructor",{value:T,configurable:!0}),T.displayName=v(x,f,"GeneratorFunction"),e.isGeneratorFunction=function(s){var i=typeof s=="function"&&s.constructor;return!!i&&(i===T||(i.displayName||i.name)==="GeneratorFunction")},e.mark=function(s){return Object.setPrototypeOf?Object.setPrototypeOf(s,x):(s.__proto__=x,v(s,f,"GeneratorFunction")),s.prototype=Object.create(L),s},e.awrap=function(s){return{__await:s}},Z(g.prototype),v(g.prototype,c,function(){return this}),e.AsyncIterator=g,e.async=function(s,i,l,p,d){d===void 0&&(d=Promise);var h=new g(y(s,i,l,p),d);return e.isGeneratorFunction(i)?h:h.next().then(function(_){return _.done?_.value:h.next()})},Z(L),v(L,f,"Generator"),v(L,u,function(){return this}),v(L,"toString",function(){return"[object Generator]"}),e.keys=function(s){var i=Object(s),l=[];for(var p in i)l.push(p);return l.reverse(),function d(){for(;l.length;){var h=l.pop();if(h in i)return d.value=h,d.done=!1,d}return d.done=!0,d}},e.values=K,G.prototype={constructor:G,reset:function(i){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!i)for(var l in this)l.charAt(0)==="t"&&r.call(this,l)&&!isNaN(+l.slice(1))&&(this[l]=t)},stop:function(){this.done=!0;var i=this.tryEntries[0].completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var l=this;function p(A,R){return _.type="throw",_.arg=i,l.next=A,R&&(l.method="next",l.arg=t),!!R}for(var d=this.tryEntries.length-1;d>=0;--d){var h=this.tryEntries[d],_=h.completion;if(h.tryLoc==="root")return p("end");if(h.tryLoc<=this.prev){var w=r.call(h,"catchLoc"),S=r.call(h,"finallyLoc");if(w&&S){if(this.prev<h.catchLoc)return p(h.catchLoc,!0);if(this.prev<h.finallyLoc)return p(h.finallyLoc)}else if(w){if(this.prev<h.catchLoc)return p(h.catchLoc,!0)}else{if(!S)throw Error("try statement without catch or finally");if(this.prev<h.finallyLoc)return p(h.finallyLoc)}}}},abrupt:function(i,l){for(var p=this.tryEntries.length-1;p>=0;--p){var d=this.tryEntries[p];if(d.tryLoc<=this.prev&&r.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var h=d;break}}h&&(i==="break"||i==="continue")&&h.tryLoc<=l&&l<=h.finallyLoc&&(h=null);var _=h?h.completion:{};return _.type=i,_.arg=l,h?(this.method="next",this.next=h.finallyLoc,U):this.complete(_)},complete:function(i,l){if(i.type==="throw")throw i.arg;return i.type==="break"||i.type==="continue"?this.next=i.arg:i.type==="return"?(this.rval=this.arg=i.arg,this.method="return",this.next="end"):i.type==="normal"&&l&&(this.next=l),U},finish:function(i){for(var l=this.tryEntries.length-1;l>=0;--l){var p=this.tryEntries[l];if(p.finallyLoc===i)return this.complete(p.completion,p.afterLoc),C(p),U}},catch:function(i){for(var l=this.tryEntries.length-1;l>=0;--l){var p=this.tryEntries[l];if(p.tryLoc===i){var d=p.completion;if(d.type==="throw"){var h=d.arg;C(p)}return h}}throw Error("illegal catch attempt")},delegateYield:function(i,l,p){return this.delegate={iterator:K(i),resultName:l,nextLoc:p},this.method==="next"&&(this.arg=t),U}},e}function bt(t,e,n,r,o,a,u){try{var c=t[a](u),f=c.value}catch(v){n(v);return}c.done?e(f):Promise.resolve(f).then(r,o)}function kn(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var a=t.apply(e,n);function u(f){bt(a,r,o,u,c,"next",f)}function c(f){bt(a,r,o,u,c,"throw",f)}u(void 0)})}}function Rn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Tn(r.key),r)}}function jn(t,e,n){return e&&_t(t.prototype,e),n&&_t(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Tn(t){var e=Ln(t,"string");return Q(e)=="symbol"?e:e+""}function Ln(t,e){if(Q(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Q(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Cn=function(){function t(){Rn(this,t)}return jn(t,[{key:"openFile",value:function(){var e=kn(Ne().mark(function r(o,a){var u;return Ne().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(Yt()&&o&&typeof o.uri<"u")){f.next=11;break}return f.prev=1,f.next=4,yn(o.uri);case 4:return u=f.sent,f.abrupt("return",new mt(u));case 8:throw f.prev=8,f.t0=f.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(f.t0));case 11:if(!(typeof o.slice=="function"&&typeof o.size<"u")){f.next=13;break}return f.abrupt("return",Promise.resolve(new mt(o)));case 13:if(typeof o.read!="function"){f.next=18;break}if(a=Number(a),Number.isFinite(a)){f.next=17;break}return f.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return f.abrupt("return",Promise.resolve(new On(o,a)));case 18:return f.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return f.stop()}},r,null,[[1,8]])}));function n(r,o){return e.apply(this,arguments)}return n}()}])}();function An(t,e){return Yt()?Promise.resolve(In(t,e)):Promise.resolve(["tus-br",t.name,t.type,t.size,t.lastModified,e.endpoint].join("-"))}function In(t,e){var n=t.exif?Dn(JSON.stringify(t.exif)):"noexif";return["tus-rn",t.name||"noname",t.size||"nosize",n,e.endpoint].join("/")}function Dn(t){var e=0;if(t.length===0)return e;for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);e=(e<<5)-e+r,e&=e}return e}function ye(t){"@babel/helpers - typeof";return ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(t)}function Ge(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Fn(r.key),r)}}function Ke(t,e,n){return e&&wt(t.prototype,e),n&&wt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Fn(t){var e=Nn(t,"string");return ye(e)=="symbol"?e:e+""}function Nn(t,e){if(ye(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ye(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Hn=function(){function t(){Ge(this,t)}return Ke(t,[{key:"createRequest",value:function(n,r){return new zn(n,r)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),zn=function(){function t(e,n){Ge(this,t),this._xhr=new XMLHttpRequest,this._xhr.open(e,n,!0),this._method=e,this._url=n,this._headers={}}return Ke(t,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(n,r){this._xhr.setRequestHeader(n,r),this._headers[n]=r}},{key:"getHeader",value:function(n){return this._headers[n]}},{key:"setProgressHandler",value:function(n){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(r){r.lengthComputable&&n(r.loaded)})}},{key:"send",value:function(){var n=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(o,a){n._xhr.onload=function(){o(new Bn(n._xhr))},n._xhr.onerror=function(u){a(u)},n._xhr.send(r)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Bn=function(){function t(e){Ge(this,t),this._xhr=e}return Ke(t,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(n){return this._xhr.getResponseHeader(n)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function me(t){"@babel/helpers - typeof";return me=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},me(t)}function qn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function St(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Mn(r.key),r)}}function $n(t,e,n){return e&&St(t.prototype,e),n&&St(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Mn(t){var e=Vn(t,"string");return me(e)=="symbol"?e:e+""}function Vn(t,e){if(me(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(me(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var He=!1;try{He="localStorage"in window;var Te="tusSupport",Ut=localStorage.getItem(Te);localStorage.setItem(Te,Ut),Ut===null&&localStorage.removeItem(Te)}catch(t){if(t.code===t.SECURITY_ERR||t.code===t.QUOTA_EXCEEDED_ERR)He=!1;else throw t}var Gn=He,Kn=function(){function t(){qn(this,t)}return $n(t,[{key:"findAllUploads",value:function(){var n=this._findEntries("tus::");return Promise.resolve(n)}},{key:"findUploadsByFingerprint",value:function(n){var r=this._findEntries("tus::".concat(n,"::"));return Promise.resolve(r)}},{key:"removeUpload",value:function(n){return localStorage.removeItem(n),Promise.resolve()}},{key:"addUpload",value:function(n,r){var o=Math.round(Math.random()*1e12),a="tus::".concat(n,"::").concat(o);return localStorage.setItem(a,JSON.stringify(r)),Promise.resolve(a)}},{key:"_findEntries",value:function(n){for(var r=[],o=0;o<localStorage.length;o++){var a=localStorage.key(o);if(a.indexOf(n)===0)try{var u=JSON.parse(localStorage.getItem(a));u.urlStorageKey=a,r.push(u)}catch{}}return r}}])}();function ie(t){"@babel/helpers - typeof";return ie=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ie(t)}function Xn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function xt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Wt(r.key),r)}}function Yn(t,e,n){return e&&xt(t.prototype,e),n&&xt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Zn(t,e,n){return e=Pe(e),Wn(t,Zt()?Reflect.construct(e,n||[],Pe(t).constructor):e.apply(t,n))}function Wn(t,e){if(e&&(ie(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Jn(t)}function Jn(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Zt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Zt=function(){return!!t})()}function Pe(t){return Pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Pe(t)}function Qn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ze(t,e)}function ze(t,e){return ze=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},ze(t,e)}function Pt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function re(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?Pt(Object(n),!0).forEach(function(r){eo(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Pt(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function eo(t,e,n){return e=Wt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Wt(t){var e=to(t,"string");return ie(e)=="symbol"?e:e+""}function to(t,e){if(ie(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ie(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Et=re(re({},xe.defaultOptions),{},{httpStack:new Hn,fileReader:new Cn,urlStorage:Gn?new Kn:new Rr,fingerprint:An}),ro=function(t){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Xn(this,e),r=re(re({},Et),r),Zn(this,e,[n,r])}return Qn(e,t),Yn(e,null,[{key:"terminate",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o=re(re({},Et),o),xe.terminate(r,o)}}])}(xe);const no={components:{Footer:ur,Navbar:fr,Sidebar:cr,Loading:dr},setup(){const t=er(),e=tr(),n=X(null),r=e.params.courseId,o=e.params.chapterId,a=X(!1),u=X(0),c=X(!1),f=X(""),v=X({id:0,title:""}),y=X({title:"",description:"",status:"",pdf_file_url:null,vimeo_id:null,player_embed_url:"",manage_link:"",vimeo_status:"",notes:[{time:"",content:""}]}),m=()=>{y.value.notes.push({time:"",content:""}),sr(()=>{const g=document.querySelector(".notes-container");g.scrollTo({top:g.scrollHeight,behavior:"smooth"})})},E=g=>{y.value.notes.splice(g,1)},Y=()=>{try{W.removeVimeo({chapterId:o}),y.value.vimeo_id=null,y.value.player_embed_url="",y.value.manage_link="",y.value.vimeo_status=""}catch(g){console.log(g)}},M=async g=>{const k=g.target.files[0];if(k)try{c.value=!0,x.value=!0,f.value="正在獲取上傳憑證...";const P=await W.getVimeoID(o,{size:k.size}),B=new ro(k,{uploadUrl:P.upload_link,headers:{Accept:"application/vnd.vimeo.*+json;version=3.4"},method:"PUT",chunkSize:512e4,onError:C=>{f.value=`上傳失敗: ${C.message}`,g.target.value=""},onProgress:C=>{u.value=C/k.size*100,f.value=`上傳中: ${u.value.toFixed(1)}%`},onSuccess:()=>{y.value.vimeo_id=P.vimeo_id,y.value.player_embed_url=P.player_embed_url,y.value.manage_link=P.manage_link,W.changeVimeoStatus({vimeoID:y.value.vimeo_id}),f.value="上傳完成",g.target.value="",x.value=!1,setInterval(D,1e4)}});f.value="開始上傳資料...",B.start()}catch(P){f.value=`上傳失敗: ${P.message}`,g.target.value=""}finally{c.value=!1,x.value=!1,setTimeout(()=>{u.value=0},3e3)}},D=async()=>{try{const g=await W.getVimeoUpdateStatus(o);y.value.vimeo_status=g.vimeo_status,y.value.vimeo_status=="vimeo_ready"&&clearInterval(D)}catch(g){console.log(g)}},U=async()=>{try{const g=await W.getChapter(r,o);y.value=g.chapter,v.value=g.course}catch(g){console.error("獲取章節數據失敗:",g),alert("獲取章節數據失敗")}},N=g=>{const k=document.querySelector('iframe[src*="vimeo.com"]');if(!k)return;k.contentWindow.postMessage({method:"getCurrentTime"},"*");const P=B=>{if(B.origin.includes("vimeo.com")&&B.data&&typeof B.data.value=="number"){const C=Math.floor(B.data.value),G=String(Math.floor(C/3600)).padStart(2,"0"),K=String(Math.floor(C%3600/60)).padStart(2,"0"),s=String(C%60).padStart(2,"0");y.value.notes[g].time=`${G}:${K}:${s}`,window.removeEventListener("message",P)}};window.addEventListener("message",P)},T=async()=>{a.value=!0;try{const g=y.value.notes.filter(P=>P.content&&P.content.trim()!==""),k={...y.value,notes:g};await W.updateChapter(r,o,k),t.push(`/course/${e.params.courseId}/chapters`)}catch(g){console.error("保存章節失敗:",g),alert("保存章節失敗")}finally{a.value=!1}},x=X(!1),O=X(""),V=()=>{t.push(`/course/${r}/chapters`)},H=async g=>{const k=g.target.files[0];if(k&&k.type==="application/pdf")try{x.value=!0,O.value="PDF上傳中...";const P=await W.chapterPDFUpload(k);P.status&&(y.value.pdf_file_url=P.content,O.value="")}catch(P){O.value="PDF上傳失敗："+P.message,g.target.value=""}finally{x.value=!1,setTimeout(()=>{O.value=""},3e3)}else O.value="請上傳PDF格式的檔案",g.target.value=""},L=()=>{y.value.pdf_file_url=null};rr(async()=>{a.value=!0,await U(),a.value=!1,n.value=await pr.create(document.querySelector("#editor"),{removePlugins:["Markdown"],extraPlugins:[Z],toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","blockQuote","imageUpload"],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"}]}}).then(g=>(g.model.document.on("change:data",()=>{y.value.description=g.getData()}),g)).catch(g=>{console.error(g)})});function Z(g){g.plugins.get("FileRepository").createUploadAdapter=k=>new hr(k)}return{chapter:y,course:v,isUploading:x,isLoading:a,saveChapter:T,handlePdfUpload:H,handleVideoUpload:M,removePdf:L,removeVideo:Y,addNote:m,removeNote:E,route:e,uploadStatusText:O,backToChapterList:V,videoUploadStatusText:f,setNoteTime:N}}},oo={class:"main-wrapper"},io={class:"page-wrapper"},ao={class:"page-content"},lo={class:"row mb-4"},so={class:"col-12 mx-auto stretch-card"},uo={class:"card"},fo={class:"card-body"},co={class:"d-flex justify-content-between align-items-center mb-4"},po={class:"card-title"},ho={class:"d-flex gap-2"},yo={class:"row"},mo={class:"col-md-6 video-preview"},vo={key:0,class:"mb-3"},go=["src"],bo={key:1},_o={key:1,class:"mt-2"},wo=["href"],So={class:"col-md-6 video-column"},Uo={key:0,class:"notes-container"},xo={class:"d-flex align-items-center gap-2 mb-2"},Po=["onUpdate:modelValue"],Eo=["onClick"],Oo=["onClick"],ko=["onUpdate:modelValue"],Ro={key:1,class:"notes-container"},jo={key:2,class:"text-center text-danger"},To={class:"mb-3"},Lo={class:"mb-3"},Co=["innerHTML"],Ao={class:"mb-3"},Io={key:0,class:"mt-2"},Do=["href"],Fo={class:"mb-3"},No={class:"d-flex justify-content-end"};function Ho(t,e,n,r,o,a){const u=ve("Sidebar"),c=ve("Navbar"),f=ve("Footer"),v=ve("Loading");return F(),z(Ye,null,[b("div",oo,[Oe(u),b("div",io,[Oe(c),b("div",ao,[b("div",lo,[b("div",so,[b("div",uo,[b("div",fo,[b("div",co,[b("h6",po,ke(r.course.title)+" 編輯章節",1),b("div",ho,[b("button",{type:"button",class:"btn btn-secondary",onClick:e[0]||(e[0]=(...y)=>r.backToChapterList&&r.backToChapterList(...y))},e[9]||(e[9]=[b("i",{class:"link-icon","data-feather":"plus"},null,-1),Re(" 返回章節 ")]))])]),b("div",yo,[b("div",mo,[r.chapter.vimeo_id?(F(),z("div",vo,[r.chapter.vimeo_status=="vimeo_ready"?(F(),z("iframe",{key:0,src:r.chapter.player_embed_url,width:"100%",height:"600",frameborder:"0",allow:"autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media",title:"Untitled"},null,8,go)):(F(),z("p",bo,"已上傳Vimeo，Vimeo影片處理中，您可以繼續編輯"))])):le("",!0),b("input",{type:"file",class:"form-control",accept:".mp4,.mov",onChange:e[1]||(e[1]=(...y)=>r.handleVideoUpload&&r.handleVideoUpload(...y))},null,32),Re(" "+ke(r.videoUploadStatusText)+" ",1),r.chapter.vimeo_id?(F(),z("div",_o,[b("button",{type:"button",class:"btn btn-danger btn-sm",onClick:e[2]||(e[2]=(...y)=>r.removeVideo&&r.removeVideo(...y))}," 移除 "),b("a",{href:`https://vimeo.com${r.chapter.manage_link}`,target:"_blank",class:"m-2 btn btn-info btn-sm"},e[10]||(e[10]=[b("i",{class:"material-icons align-middle me-1"},"edit",-1),Re(" Vimeo編輯 ")]),8,wo)])):le("",!0)]),b("div",So,[r.chapter.notes.length>0?(F(),z("div",Uo,[(F(!0),z(Ye,null,nr(r.chapter.notes,(y,m)=>(F(),z("div",{key:m,class:"mb-3 p-2 border-bottom"},[b("div",xo,[ge(b("input",{type:"text",class:"form-control flex-grow-0","onUpdate:modelValue":E=>y.time=E,placeholder:"時間",style:{width:"120px"}},null,8,Po),[[je,y.time]]),b("button",{class:"btn btn-outline-secondary btn-sm",onClick:E=>r.setNoteTime(m)}," 設為目前時間 ",8,Eo),b("button",{class:"btn btn-outline-danger btn-sm",onClick:E=>r.removeNote(m)}," 刪除 ",8,Oo)]),ge(b("textarea",{"onUpdate:modelValue":E=>y.content=E,class:"form-control w-100",rows:"3",placeholder:"筆記內容"},null,8,ko),[[je,y.content]])]))),128))])):(F(),z("div",Ro,e[11]||(e[11]=[b("div",{class:"d-flex align-items-center justify-content-center h-100 text-muted"},[b("h3",{class:"empty_note"},"尚未新增筆記")],-1)]))),b("button",{class:or(["btn btn-outline-primary btn-sm my-2",r.chapter.vimeo_status!="vimeo_ready"?"btn-disabled":""]),type:"button",onClick:e[3]||(e[3]=(...y)=>r.addNote&&r.addNote(...y))}," 新增筆記 ",2),r.chapter.vimeo_status!="vimeo_ready"?(F(),z("small",jo,"影片尚未上傳，或在處理中，無法新增筆記")):le("",!0)])]),e[18]||(e[18]=b("hr",null,null,-1)),b("form",{onSubmit:e[8]||(e[8]=ir((...y)=>r.saveChapter&&r.saveChapter(...y),["prevent"])),class:"mt-3"},[b("div",To,[e[12]||(e[12]=b("label",{for:"title",class:"form-label"},"章節標題",-1)),ge(b("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[4]||(e[4]=y=>r.chapter.title=y),required:""},null,512),[[je,r.chapter.title]])]),b("div",Lo,[e[13]||(e[13]=b("label",{for:"editor",class:"form-label"},"章節內容",-1)),b("div",{id:"editor",innerHTML:r.chapter.description},null,8,Co)]),b("div",Ao,[e[14]||(e[14]=b("label",{class:"form-label"},"PDF檔案",-1)),b("input",{type:"file",class:"form-control",accept:".pdf",onChange:e[5]||(e[5]=(...y)=>r.handlePdfUpload&&r.handlePdfUpload(...y))},null,32),r.chapter.pdf_file_url&&!r.uploadStatusText?(F(),z("div",Io,[b("a",{href:r.chapter.pdf_file_url,target:"_blank"},"上傳檔案："+ke(typeof r.chapter.pdf_file_url=="string"?r.chapter.pdf_file_url.split("/").pop():r.chapter.pdf_file_url.name),9,Do)])):le("",!0)]),b("div",Fo,[e[16]||(e[16]=b("label",{for:"status",class:"form-label"},"狀態",-1)),ge(b("select",{class:"form-select",id:"status","onUpdate:modelValue":e[6]||(e[6]=y=>r.chapter.status=y)},e[15]||(e[15]=[b("option",{value:"publish"},"顯示",-1),b("option",{value:"unpublish"},"隱藏",-1)]),512),[[ar,r.chapter.status]])]),b("div",No,[b("div",{onClick:e[7]||(e[7]=(...y)=>r.backToChapterList&&r.backToChapterList(...y)),class:"btn btn-secondary me-2"}," 取消 "),e[17]||(e[17]=b("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])])])]),Oe(f)])]),r.isLoading?(F(),lr(v,{key:0})):le("",!0)],64)}const Vo=Qt(no,[["render",Ho],["__scopeId","data-v-993523bf"]]);export{Vo as default};
