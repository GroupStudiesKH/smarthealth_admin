import{_ as P,p as q,u as R,r as u,i as T,j as M,o as l,c as s,b as a,k as B,d as A,l as V,e as _,g as b,n as r,t as d,a as i,v as H,F as O}from"./index-7e071105.js";import{F as z,N as G,_ as J,a as C}from"./sidebar-bb7b1f1a.js";const K={components:{Footer:z,Navbar:G,Sidebar:J},setup(){const D=q(),w=R().params.id,t=u({title:"",subtitle_1:"",subtitle_2:"",content:"",action_link_href:"",action_link_text:"",action_link2_href:"",action_link2_text:"",status:"active",image:null,sort:null}),y=u({}),x=u(!1),m=u(!1),k=u(""),v=u(null),o=async()=>{try{t.value=await C.bannerShow(w),t.value.img_url&&(v.value=t.value.img_url)}catch(c){console.error("Error fetching banner data:",c),p("獲取橫幅數據失敗，請稍後再試。")}},U=async()=>{var c,f;x.value=!0;try{y.value={};const n=new FormData;n.append("title",t.value.title),n.append("subtitle_1",t.value.subtitle_1??""),n.append("subtitle_2",t.value.subtitle_2??""),n.append("content",t.value.content??""),n.append("action_link_href",t.value.action_link_href??""),n.append("action_link_text",t.value.action_link_text??""),n.append("action_link2_href",t.value.action_link2_href??""),n.append("action_link2_text",t.value.action_link2_text??""),n.append("status",t.value.status),n.append("sort",t.value.sort??0),t.value.image instanceof File&&n.append("image",t.value.image),await C.editBanner(w,n),F("橫幅更新成功"),D.push("/layout/banner")}catch(n){if(((f=(c=n.response)==null?void 0:c.data)==null?void 0:f.status)==="error")if(n.response.data.content){const g={};for(const[E,h]of Object.entries(n.response.data.content))g[E]=Array.isArray(h)?h[0].replace(/[\[\]"]/g,""):h;y.value=g;const L=Object.values(g).join("<br/>");p("橫幅更新失敗："+(L||"未知錯誤"))}else p("橫幅更新失敗："+(n.response.data.message||"儲存失敗"));else p("儲存失敗")}finally{x.value=!1}},p=c=>{k.value=c,m.value=!0},F=c=>{k.value=c,m.value=!0},S=()=>{m.value=!1},j=()=>{D.push("/layout/banner")},I=c=>{const f=c.target.files[0];if(f){t.value.image=f;const n=new FileReader;n.onload=g=>{v.value=g.target.result},n.readAsDataURL(f)}},N=()=>{t.value.image=null,v.value=null};return T(()=>{o()}),{bannerData:t,updateBanner:U,goBack:j,errors:y,isLoading:x,showModal:m,modalMessage:k,closeModal:S,handleImageChange:I,imagePreview:v,clearImage:N}}},Q={class:"main-wrapper"},W={class:"page-wrapper"},X={class:"page-content"},Y={class:"row"},Z={class:"col-12"},$={class:"card"},tt={class:"card-body"},et={class:"row"},at={class:"col-md-6"},ot={class:"mb-3"},nt={key:0,class:"invalid-feedback"},lt={class:"mb-3"},st={key:0,class:"invalid-feedback"},it={class:"mb-3"},rt={key:0,class:"invalid-feedback"},dt={class:"mb-3"},ct={key:0,class:"invalid-feedback"},_t={class:"col-md-6"},bt={class:"mb-3"},mt={key:0,class:"invalid-feedback"},vt={class:"mb-3"},ft={key:0,class:"invalid-feedback"},ut={class:"mb-3"},kt={key:0,class:"invalid-feedback"},gt={class:"mb-3"},yt={key:0,class:"invalid-feedback"},xt={class:"col-md-6"},pt={class:"mb-3"},Dt={key:0,class:"invalid-feedback"},wt={class:"mb-3"},ht=["required"],Mt={key:0,class:"invalid-feedback"},Bt={key:1,class:"mt-2"},Vt=["src"],Ct={class:"mb-3"},Ut={key:0,class:"invalid-feedback"},Ft={class:"mt-4"},St=["disabled"],jt=["disabled"],It={class:"modal-dialog"},Nt={class:"modal-content"},Lt={class:"modal-header"},Et=["innerHTML"],Pt={class:"modal-footer"};function qt(D,e,w,t,y,x){const m=M("Sidebar"),k=M("Navbar"),v=M("Footer");return l(),s(O,null,[a("div",Q,[B(m),a("div",W,[B(k),a("div",X,[a("div",Y,[a("div",Z,[a("div",$,[a("div",tt,[e[31]||(e[31]=a("h4",{class:"card-title mb-4"},"編輯橫幅",-1)),a("form",{onSubmit:e[13]||(e[13]=A((...o)=>t.updateBanner&&t.updateBanner(...o),["prevent"])),enctype:"multipart/form-data",class:"w-100"},[a("div",et,[a("div",at,[a("div",ot,[e[17]||(e[17]=a("label",{for:"title",class:"form-label"},[V("標題 "),a("span",{class:"text-danger"},"*")],-1)),_(a("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.title}]),id:"title","onUpdate:modelValue":e[0]||(e[0]=o=>t.bannerData.title=o),required:""},null,2),[[b,t.bannerData.title]]),t.errors.title?(l(),s("div",nt,d(t.errors.title),1)):i("",!0)]),a("div",lt,[e[18]||(e[18]=a("label",{for:"subtitle_1",class:"form-label"},"副標題1",-1)),_(a("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.subtitle_1}]),id:"subtitle_1","onUpdate:modelValue":e[1]||(e[1]=o=>t.bannerData.subtitle_1=o)},null,2),[[b,t.bannerData.subtitle_1]]),t.errors.subtitle_1?(l(),s("div",st,d(t.errors.subtitle_1),1)):i("",!0)]),a("div",it,[e[19]||(e[19]=a("label",{for:"subtitle_2",class:"form-label"},"副標題2",-1)),_(a("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.subtitle_2}]),id:"subtitle_2","onUpdate:modelValue":e[2]||(e[2]=o=>t.bannerData.subtitle_2=o)},null,2),[[b,t.bannerData.subtitle_2]]),t.errors.subtitle_2?(l(),s("div",rt,d(t.errors.subtitle_2),1)):i("",!0)]),a("div",dt,[e[20]||(e[20]=a("label",{for:"content",class:"form-label"},[V("內容 "),a("span",{class:"text-danger"},"*")],-1)),_(a("textarea",{class:r(["form-control",{"is-invalid":t.errors.content}]),id:"content","onUpdate:modelValue":e[3]||(e[3]=o=>t.bannerData.content=o),required:""},null,2),[[b,t.bannerData.content]]),t.errors.content?(l(),s("div",ct,d(t.errors.content),1)):i("",!0)])]),a("div",_t,[a("div",bt,[e[21]||(e[21]=a("label",{for:"action_link_href",class:"form-label"},"行動連結網址",-1)),_(a("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.action_link_href}]),id:"action_link_href","onUpdate:modelValue":e[4]||(e[4]=o=>t.bannerData.action_link_href=o)},null,2),[[b,t.bannerData.action_link_href]]),t.errors.action_link_href?(l(),s("div",mt,d(t.errors.action_link_href),1)):i("",!0)]),a("div",vt,[e[22]||(e[22]=a("label",{for:"action_link_text",class:"form-label"},"行動連結文字",-1)),_(a("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.action_link_text}]),id:"action_link_text","onUpdate:modelValue":e[5]||(e[5]=o=>t.bannerData.action_link_text=o)},null,2),[[b,t.bannerData.action_link_text]]),t.errors.action_link_text?(l(),s("div",ft,d(t.errors.action_link_text),1)):i("",!0)]),a("div",ut,[e[23]||(e[23]=a("label",{for:"action_link2_href",class:"form-label"},"行動連結2網址",-1)),_(a("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.action_link2_href}]),id:"action_link2_href","onUpdate:modelValue":e[6]||(e[6]=o=>t.bannerData.action_link2_href=o)},null,2),[[b,t.bannerData.action_link2_href]]),t.errors.action_link2_href?(l(),s("div",kt,d(t.errors.action_link2_href),1)):i("",!0)]),a("div",gt,[e[24]||(e[24]=a("label",{for:"action_link2_text",class:"form-label"},"行動連結2文字",-1)),_(a("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.action_link2_text}]),id:"action_link2_text","onUpdate:modelValue":e[7]||(e[7]=o=>t.bannerData.action_link2_text=o)},null,2),[[b,t.bannerData.action_link2_text]]),t.errors.action_link2_text?(l(),s("div",yt,d(t.errors.action_link2_text),1)):i("",!0)])]),a("div",xt,[a("div",pt,[e[26]||(e[26]=a("label",{for:"status",class:"form-label"},"狀態",-1)),_(a("select",{class:r(["form-select",{"is-invalid":t.errors.status}]),id:"status","onUpdate:modelValue":e[8]||(e[8]=o=>t.bannerData.status=o)},e[25]||(e[25]=[a("option",{value:"active"},"啟用",-1),a("option",{value:"inactive"},"未啟用",-1)]),2),[[H,t.bannerData.status]]),t.errors.status?(l(),s("div",Dt,d(t.errors.status),1)):i("",!0)]),a("div",wt,[e[28]||(e[28]=a("label",{for:"image",class:"form-label"},[V("圖片 "),a("span",{class:"text-danger"},"*")],-1)),a("input",{type:"file",class:r(["form-control",{"is-invalid":t.errors.image}]),id:"image",onChange:e[9]||(e[9]=(...o)=>t.handleImageChange&&t.handleImageChange(...o)),required:!t.imagePreview,accept:".jpg,.jpeg,.gif,.png,.webp"},null,42,ht),e[29]||(e[29]=a("small",{class:"form-text text-muted"},"只能上傳 jpg、jpeg、gif、png 或 webp 格式的圖片",-1)),t.errors.image?(l(),s("div",Mt,d(t.errors.image),1)):i("",!0),t.imagePreview?(l(),s("div",Bt,[a("img",{src:t.imagePreview,alt:"Banner Preview",class:"img-fluid",style:{"max-width":"200px"}},null,8,Vt),e[27]||(e[27]=a("br",null,null,-1)),a("button",{type:"button",class:"btn btn-sm btn-danger mt-2",onClick:e[10]||(e[10]=(...o)=>t.clearImage&&t.clearImage(...o))},"清除圖片")])):i("",!0)]),a("div",Ct,[e[30]||(e[30]=a("label",{for:"sort",class:"form-label"},"排序",-1)),_(a("input",{type:"number",class:r(["form-control",{"is-invalid":t.errors.sort}]),id:"sort","onUpdate:modelValue":e[11]||(e[11]=o=>t.bannerData.sort=o)},null,2),[[b,t.bannerData.sort]]),t.errors.sort?(l(),s("div",Ut,d(t.errors.sort),1)):i("",!0)])])]),a("div",Ft,[a("button",{type:"submit",class:"btn btn-primary me-2",disabled:t.isLoading},d(t.isLoading?"更新中...":"更新橫幅"),9,St),a("button",{type:"button",class:"btn btn-secondary",onClick:e[12]||(e[12]=(...o)=>t.goBack&&t.goBack(...o)),disabled:t.isLoading}," 返回 ",8,jt)])],32)])])])])]),B(v)])]),t.showModal?(l(),s("div",{key:0,class:"modal-backdrop",onClick:e[14]||(e[14]=(...o)=>t.closeModal&&t.closeModal(...o))})):i("",!0),a("div",{class:r(["modal",{"d-block":t.showModal}]),tabindex:"-1"},[a("div",It,[a("div",Nt,[a("div",Lt,[e[32]||(e[32]=a("h5",{class:"modal-title"},"提示",-1)),a("button",{type:"button",class:"btn-close",onClick:e[15]||(e[15]=(...o)=>t.closeModal&&t.closeModal(...o))})]),a("div",{class:"modal-body",innerHTML:t.modalMessage},null,8,Et),a("div",Pt,[a("button",{type:"button",class:"btn btn-secondary",onClick:e[16]||(e[16]=(...o)=>t.closeModal&&t.closeModal(...o))},"關閉")])])])],2)],64)}const At=P(K,[["render",qt],["__scopeId","data-v-eba2ae26"]]);export{At as default};
