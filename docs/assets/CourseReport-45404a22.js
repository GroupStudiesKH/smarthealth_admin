import{_ as N,o as i,c as d,b as t,l as m,t as a,F as x,f as S,n as C,a as q,p as j,u as F,r as u,i as I,j as v,k as b,h as E,d as M}from"./index-29c103aa.js";import{F as z,N as B,_ as T,a as p}from"./sidebar-e64f0f03.js";import{S as V}from"./StudentDetailModal-475fc114.js";const A={name:"ExamReviewModal",props:{show:{type:Boolean,required:!0},examData:{type:Object,required:!0}},emits:["update:show"],setup(k,{emit:e}){return{closeModal:()=>{e("update:show",!1)}}}},U={key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-hidden":"true"},L={class:"modal-dialog modal-lg",role:"document"},O={class:"modal-content"},G={class:"modal-header"},H={class:"modal-body"},J={class:"exam-info mb-4"},K={class:"row"},Q={class:"col-md-6"},W={class:"answer-list"},X={class:"table-responsive"},Y={class:"table"},Z={key:0,class:"badge bg-success"},$={key:1,class:"badge bg-danger"};function tt(k,e,c,s,h,y){return c.show?(i(),d("div",U,[t("div",L,[t("div",O,[t("div",G,[e[1]||(e[1]=t("h5",{class:"modal-title"},"測驗閱卷詳情",-1)),t("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...r)=>s.closeModal&&s.closeModal(...r))})]),t("div",H,[t("div",J,[t("div",K,[t("div",Q,[t("p",null,[e[2]||(e[2]=t("strong",null,"測驗名稱：",-1)),m(a(c.examData.examName),1)]),t("p",null,[e[3]||(e[3]=t("strong",null,"測驗時間：",-1)),m(a(c.examData.examTime),1)]),t("p",null,[e[4]||(e[4]=t("strong",null,"考試分數：",-1)),m(a(c.examData.score)+"分",1)])])])]),t("div",W,[e[6]||(e[6]=t("h6",null,"作答詳情",-1)),t("div",X,[t("table",Y,[e[5]||(e[5]=t("thead",null,[t("tr",null,[t("th",null,"題號"),t("th",null,"題目"),t("th",null,"學生答案"),t("th",null,"正確答案"),t("th",null,"是否正確"),t("th",null,"填答時間")])],-1)),t("tbody",null,[(i(!0),d(x,null,S(c.examData.answers,r=>(i(),d("tr",{key:r.questionId,class:C({"table-success":r.isCorrect,"table-danger":!r.isCorrect})},[t("td",null,a(r.questionId),1),t("td",null,a(r.question),1),t("td",null,a(r.studentAnswer),1),t("td",null,a(r.correctAnswer),1),t("td",null,[r.isCorrect?(i(),d("span",Z,"正確")):(i(),d("span",$,"錯誤"))]),t("td",null,a(r.answerTime),1)],2))),128))])])])])])])])])):q("",!0)}const et=N(A,[["render",tt],["__scopeId","data-v-fab8bc24"]]);const st={components:{Footer:z,Navbar:B,Sidebar:T,StudentDetailModal:V,ExamReviewModal:et},setup(){j();const e=F().params.id,c=u(!1),s=u(null),h=u(!1),y=u(null),r=u({name:"",instructor:"",category:"",completionRate:0,averageScore:0,chapters:[],students:[]}),f=u([]),R=u(0),w=u(0),D=async()=>{try{const l=await p.getCourseReport(e);r.value={name:l.title,instructor:l.instructors.join(", "),category:l.categories.join(", "),completionRate:l.completion_rate,averageScore:l.average_score,chapters:l.chapters.map(n=>({name:n.title,completionRate:n.completion_rate}))}}catch(l){console.error("Error loading course report:",l)}},_=async()=>{try{const l=await p.getCourseStudents(e,{page:g.value});f.value=l.students,R.value=l.total,w.value=l.totalPages}catch(l){console.error("Error loading students:",l)}},o=()=>{p.getCourseReportExcel(e)};I(()=>{D(),_()});const g=u(1);return{courseDetail:r,currentPage:g,students:f,totalStudentPages:w,handlePageChange:async l=>{g.value=l,await _()},viewStudent:async l=>{try{const n=await p.getCourseStudent(e,l);s.value={id:l,name:n.student_info.name,email:n.student_info.email,courseName:n.course_info.title,progress:n.course_info.progress,totalTime:`${n.student_info.total_study_hours}小時`,lastAccess:n.student_info.last_login,chapterProgress:n.chapters.map(P=>({title:P.title,progress:P.progress})),quizResults:n.quizResults},c.value=!0}catch(n){console.error("Error fetching student details:",n)}},showStudentModal:c,selectedStudent:s,showExamModal:h,selectedExamData:y,viewExam:async l=>{try{const n=await p.getStudentExamDetail({course_id:e,user_id:l});y.value=n,h.value=!0}catch(n){console.error("Error fetching student details:",n),n.response&&n.response.status===404&&alert("此學生尚未進行考試")}},exportReport:o,courseId:e}}},ot={class:"main-wrapper"},lt={class:"page-wrapper"},nt={class:"page-content"},at={class:"row"},rt={class:"col-md-12 grid-margin stretch-card"},it={class:"card"},dt={class:"card-body"},ct={class:"d-flex justify-content-between align-items-center mb-3"},ut={class:"course-info mt-3"},mt={class:"row"},gt={class:"col-md-6"},_t={class:"col-md-6"},vt={class:"progress"},bt={class:"progress"},pt={class:"table-responsive"},ht={class:"table table-hover"},yt={class:"progress"},ft={class:"table-responsive"},wt={class:"table table-hover"},xt={class:"btn-group"},St=["onClick"],Ct=["onClick"],kt={key:0,class:"mt-3"},Rt={class:"pagination justify-content-center"},Dt=["onClick"];function Et(k,e,c,s,h,y){var _;const r=v("Sidebar"),f=v("Navbar"),R=v("StudentDetailModal"),w=v("ExamReviewModal"),D=v("Footer");return i(),d("div",ot,[b(r),t("div",lt,[b(f),t("div",nt,[t("div",at,[t("div",rt,[t("div",it,[t("div",dt,[t("div",ct,[e[6]||(e[6]=t("h6",{class:"card-title mb-0"},"課程詳細報表",-1)),t("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=(...o)=>s.exportReport&&s.exportReport(...o))},e[5]||(e[5]=[t("i",{class:"material-icons align-middle me-1"},"file_download",-1),m(" 匯出報表 ")]))]),e[14]||(e[14]=t("hr",null,null,-1)),t("div",ut,[t("div",mt,[t("div",gt,[t("p",null,[e[7]||(e[7]=t("strong",null,"課程名稱：",-1)),m(a(s.courseDetail.name),1)]),t("p",null,[e[8]||(e[8]=t("strong",null,"講師：",-1)),m(a(s.courseDetail.instructor),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"課程分類：",-1)),m(a(s.courseDetail.category),1)])]),t("div",_t,[e[10]||(e[10]=t("strong",null,"平均完課率：",-1)),t("div",vt,[t("div",{class:"progress-bar bg-success",role:"progressbar",style:E({width:s.courseDetail.completionRate+"%"})},a(s.courseDetail.completionRate)+"% ",5)]),e[11]||(e[11]=t("strong",null,"平均成績：",-1)),t("div",bt,[t("div",{class:"progress-bar bg-info",role:"progressbar",style:E({width:s.courseDetail.averageScore+"%"})},a(s.courseDetail.averageScore)+"分 ",5)])])])]),e[15]||(e[15]=t("h6",{class:"card-subtitle mt-3"},"章節完成率",-1)),e[16]||(e[16]=t("hr",null,null,-1)),t("div",pt,[t("table",ht,[e[12]||(e[12]=t("thead",null,[t("tr",null,[t("th",null,"章節名稱"),t("th",null,"完成率")])],-1)),t("tbody",null,[(i(!0),d(x,null,S(s.courseDetail.chapters,o=>(i(),d("tr",{key:o.name},[t("td",null,a(o.name),1),t("td",null,[t("div",yt,[t("div",{class:"progress-bar bg-success",role:"progressbar",style:E({width:o.completionRate+"%"})},a(o.completionRate)+"% ",5)])])]))),128))])])]),e[17]||(e[17]=t("h6",{class:"card-subtitle mt-3"},"參加學生列表",-1)),e[18]||(e[18]=t("hr",null,null,-1)),t("div",ft,[t("table",wt,[e[13]||(e[13]=t("thead",null,[t("tr",null,[t("th",null,"學生名稱"),t("th",null,"學生Email"),t("th",null,"操作")])],-1)),t("tbody",null,[(i(!0),d(x,null,S(s.students,o=>(i(),d("tr",{key:o.id},[t("td",null,a(o.name),1),t("td",null,a(o.email),1),t("td",null,[t("div",xt,[t("button",{class:"btn btn-primary btn-sm",onClick:g=>s.viewStudent(o.id)}," 檢視 ",8,St),t("button",{class:"btn btn-info btn-sm",onClick:g=>s.viewExam(o.id)}," 測驗閱卷詳情 ",8,Ct)])])]))),128))])])]),s.totalStudentPages>1?(i(),d("nav",kt,[t("ul",Rt,[t("li",{class:C(["page-item",{disabled:s.currentPage===1}])},[t("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=M(o=>s.handlePageChange(s.currentPage-1),["prevent"]))}," 上一頁 ")],2),(i(!0),d(x,null,S(s.totalStudentPages,o=>(i(),d("li",{key:o,class:C(["page-item",{active:s.currentPage===o}])},[t("a",{class:"page-link",href:"#",onClick:M(g=>s.handlePageChange(o),["prevent"])},a(o),9,Dt)],2))),128)),t("li",{class:C(["page-item",{disabled:s.currentPage===s.totalStudentPages}])},[t("a",{class:"page-link",href:"#",onClick:e[2]||(e[2]=M(o=>s.handlePageChange(s.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])):q("",!0),b(R,{show:s.showStudentModal,"onUpdate:show":e[3]||(e[3]=o=>s.showStudentModal=o),student:s.selectedStudent,"course-id":s.courseId,"student-id":(_=s.selectedStudent)==null?void 0:_.id},null,8,["show","student","course-id","student-id"]),b(w,{show:s.showExamModal,"onUpdate:show":e[4]||(e[4]=o=>s.showExamModal=o),examData:s.selectedExamData},null,8,["show","examData"])])])])])]),b(D)])])}const It=N(st,[["render",Et],["__scopeId","data-v-63c56eb4"]]);export{It as default};
