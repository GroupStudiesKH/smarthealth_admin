import{_ as M,p as P,u as E,r as b,s as F,l as k,o as r,c as n,m as y,a as t,d as D,f as B,b as N,F as S,e as x,t as h,x as I}from"./index-2084911f.js";import{F as L,N as V,_ as A,a as w}from"./sidebar-d4d14e1c.js";const O={components:{Footer:L,Navbar:V,Sidebar:A},setup(){const d=P(),v=E().params.id,e=b({name:"",permissions:{}}),m=b({}),p=b(!1),l=b({}),f=async()=>{try{const s={courseManagement:{title:"課程管理",list:{"course-management":{title:"課程管理",permissions:["list","create","edit","del"]},"course-list":{title:"課程列表",permissions:["list","create","edit","del"]},"course-category":{title:"分類管理",permissions:["list","create","edit","del"]},"course-tag":{title:"標籤管理",permissions:["list","create","edit","del"]},"course-instructor":{title:"講師管理",permissions:["list","create","edit","del"]}}},memberManagement:{title:"會員管理",list:{"member-management":{title:"會員管理",permissions:["list","create","edit","del"]},"member-list":{title:"會員列表",permissions:["list","create","edit","del"]}}},statisticsManagement:{title:"課程統計",list:{"course-statistics":{title:"課程統計",permissions:["list"]},"course-progress":{title:"學習進度統計",permissions:["list"]}}},examManagement:{title:"測驗管理",list:{"exam-management":{title:"測驗管理",permissions:["list","create","edit","del"]},"exam-statistics":{title:"課程測驗列表",permissions:["list"]}}},siteSettings:{title:"網站基本設定",list:{"site-settings":{title:"網站基本設定",permissions:["list","edit"]},"site-brand":{title:"品牌設定",permissions:["list","edit"]},"site-social":{title:"社群設定",permissions:["list","edit"]}}},layoutManagement:{title:"介紹頁面管理",list:{"layout-banner-management":{title:"首頁Banner管理",permissions:["list","create","edit","del"]},"content-faq":{title:"FAQ",permissions:["edit"]},"content-about":{title:"計劃緣起",permissions:["edit"]},"content-privacy":{title:"隱私權政策",permissions:["edit"]},"content-security":{title:"資安政策",permissions:["edit"]}}},permissionManagement:{title:"權限管理",list:{permissions_group:{title:"角色管理",permissions:["list","create","edit","del"]}}}};l.value=s}catch(s){console.error("Error fetching permission options:",s)}},g=async()=>{try{const s={id:v,name:"測試權限組",permissions:{"course-management":["list","create"],"course-list":["list"],"member-management":["list","edit"],"member-list":["list"],"course-statistics":["list"],"layout-banner-management":["list","edit"],"content-faq":["edit"],permissions_group:["list"]}};e.value={id:s.id,name:s.name,permissions:{...e.value.permissions,...s.permissions}},Object.keys(l.value).forEach(i=>{Object.keys(l.value[i].list).forEach(_=>{Array.isArray(e.value.permissions[_])||(e.value.permissions[_]=[])})})}catch(s){console.error("Error fetching permission data:",s)}},o=async()=>{p.value=!0;try{m.value={},await w.updatePermission(v,e.value)?(console.log("Permission updated successfully"),await u(),d.push("/permission")):(console.error("Failed to update permission"),alert("權限更新失敗，請稍後再試。"))}catch(s){console.error("Error updating permission:",s),s.response&&s.response.data&&(m.value=s.response.data.content||{}),alert("權限更新失敗："+(s.message||"未知錯誤"))}finally{p.value=!1}},c=()=>{d.push("/permission")},u=async()=>{try{const s=await w.adminMe();s?(sessionStorage.setItem("userData",JSON.stringify(s)),userData.value=s):console.error("Invalid response format:",s)}catch(s){console.error("Error fetching admin data:",s),d.push("/login"),localStorage.removeItem("access_token")}};return F(async()=>{await f(),await g()}),{permissionData:e,permissionStructure:l,updatePermission:o,goBack:c,errors:m,isLoading:p}}},C={class:"main-wrapper"},U={class:"page-wrapper"},j={class:"page-content"},q={class:"row"},R={class:"col-12 stretch-card"},J={class:"mb-3"},Q={class:"col-12 stretch-card"},T={class:"row"},z={class:"card h-100"},G={class:"card-body"},H={class:"mb-4"},W={class:"mb-3"},X={class:"d-flex flex-wrap"},Y=["id","checked","value","onUpdate:modelValue"],Z=["for"],$=["disabled"],K=["disabled"];function ss(d,a,v,e,m,p){const l=k("Sidebar"),f=k("Navbar"),g=k("Footer");return r(),n("div",C,[y(l),t("div",U,[y(f),t("div",j,[t("div",q,[t("div",R,[t("h4",J,[D(t("input",{"onUpdate:modelValue":a[0]||(a[0]=o=>e.permissionData.name=o),class:"form-control",type:"text"},null,512),[[B,e.permissionData.name]])])]),t("div",Q,[t("form",{onSubmit:a[2]||(a[2]=N((...o)=>e.updatePermission&&e.updatePermission(...o),["prevent"]))},[t("div",T,[(r(!0),n(S,null,x(e.permissionStructure,(o,c)=>(r(),n("div",{class:"col-md-3 mb-3",key:c},[t("div",z,[t("div",G,[t("div",H,[t("h5",W,h(o.title),1),(r(!0),n(S,null,x(o.list,(u,s)=>(r(),n("div",{key:s,class:"mb-3"},[t("p",null,h(u.title),1),t("div",X,[(r(!0),n(S,null,x(u.permissions,i=>(r(),n("div",{key:i,class:"form-check permissionItem me-3"},[D(t("input",{class:"form-check-input",type:"checkbox",id:`${c}-${s}-${i}`,checked:e.permissionData.permissions[s]&&e.permissionData.permissions[s].includes(i),value:i,"onUpdate:modelValue":_=>e.permissionData.permissions[s]=_},null,8,Y),[[I,e.permissionData.permissions[s]]]),t("label",{class:"form-check-label",for:`${c}-${s}-${i}`},h(i==="list"?"列表":i==="create"?"新增":i==="edit"?"編輯":i==="del"?"刪除":i),9,Z)]))),128))])]))),128))])])])]))),128))]),t("button",{type:"submit",class:"btn btn-primary me-2",disabled:e.isLoading},h(e.isLoading?"更新中...":"更新權限"),9,$),t("button",{type:"button",class:"btn btn-secondary",onClick:a[1]||(a[1]=(...o)=>e.goBack&&e.goBack(...o)),disabled:e.isLoading}," 返回 ",8,K)],32)])])]),y(g)])])}const is=M(O,[["render",ss]]);export{is as default};
