import{_ as j,i as B,u as M,r as l,H as O,j as L,w as Q,k as p,o as r,c as i,b as t,l as P,e as T,g as E,v as U,F as y,f as x,m as f,t as n,a as w,n as C,d as h,p as H}from"./index-b26c6ec2.js";import{F as I,N as q,_ as A}from"./sidebar-3b8b7882.js";import{a as z}from"./api-service-28558cf5.js";import{L as G}from"./loading-4e587441.js";const J={components:{Footer:I,Navbar:q,Sidebar:A,Loading:G},setup(){const F=B();M();const e=l(!1),m=l([]),o=l(1),R=l(10),g=l(""),v=l(""),k=O(()=>[...new Set(m.value.map(a=>a.category))]),c=l(""),d=l("asc"),s=async a=>{await b(a)},b=async a=>{c.value===a?d.value=d.value==="asc"?"desc":"asc":(c.value=a,d.value="asc"),await _()},V=async()=>{try{e.value=!0;const a={category_id:v.value,status:"",search:g.value,sort_field:c.value,sort_order:d.value};await z.downloadStatsExcel(a),e.value=!1}catch(a){e.value=!1,console.error("下載報表失敗:",a)}},N=l(1),D=l(0),_=async()=>{e.value=!0;try{const a={category_id:v.value,status:"",search:g.value,page:o.value,pageSize:R.value,sort_field:c.value,sort_order:d.value},S=await z.getStats(a);m.value=S.courses.map(u=>({id:u.id,name:u.title,instructor:u.instructors.join(", "),category:u.categories.join(", "),completionRate:u.completion_rate,averageScore:u.average_score,students_count:u.student_count})),D.value=S.total,N.value=S.totalPages}catch(a){console.error("獲取統計數據失敗:",a)}finally{e.value=!1}};return L(()=>{_()}),Q([g,v],()=>{o.value=1,_()}),{courses:m,categories:k,searchQuery:g,selectedCategory:v,viewDetails:a=>{F.push(`/statistics/course-report/${a}`)},currentPage:o,totalPages:N,goToPage:a=>{o.value=a,_()},toggleSort:s,loading:e,sortField:c,sortOrder:d,exportReport:V}}},K={class:"main-wrapper"},W={class:"page-wrapper"},X={class:"page-content"},Y={class:"row"},Z={class:"col-md-12 grid-margin stretch-card"},$={class:"card"},tt={class:"card-body"},et={class:"row mb-3"},ot={class:"col-md-6"},st={class:"col-md-3"},at=["value"],rt={class:"col-md-3 text-end"},nt={class:"table-responsive"},lt={class:"table table-hover"},it={key:0,class:"material-icons align-middle",style:{"font-size":"16px"}},dt={key:0,class:"material-icons align-middle",style:{"font-size":"16px"}},ct={key:0,class:"material-icons align-middle",style:{"font-size":"16px"}},ut=["onClick"],vt={class:"d-flex justify-content-center mt-4"},gt={class:"pagination"},mt=["onClick"];function _t(F,e,m,o,R,g){const v=p("Sidebar"),k=p("Navbar"),c=p("Footer"),d=p("loading");return r(),i(y,null,[t("div",K,[P(v),t("div",W,[P(k),t("div",X,[t("div",Y,[t("div",Z,[t("div",$,[t("div",tt,[e[17]||(e[17]=t("h6",{class:"card-title"},"學習進度統計",-1)),t("div",et,[t("div",ot,[T(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=s=>o.searchQuery=s),placeholder:"搜尋課程名稱或講師..."},null,512),[[E,o.searchQuery]])]),t("div",st,[T(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=s=>o.selectedCategory=s)},[e[8]||(e[8]=t("option",{value:""},"所有分類",-1)),(r(!0),i(y,null,x(o.categories,s=>(r(),i("option",{key:s,value:s},n(s),9,at))),128))],512),[[U,o.selectedCategory]])]),t("div",rt,[t("button",{class:"btn btn-primary",onClick:e[2]||(e[2]=(...s)=>o.exportReport&&o.exportReport(...s))},e[9]||(e[9]=[t("i",{class:"material-icons align-middle me-1"},"file_download",-1),f(" 匯出報表 ")]))])]),t("div",nt,[t("table",lt,[t("thead",null,[t("tr",null,[e[13]||(e[13]=t("th",null,"課程名稱",-1)),e[14]||(e[14]=t("th",null,"課程講師",-1)),e[15]||(e[15]=t("th",null,"分類",-1)),t("th",{onClick:e[3]||(e[3]=s=>o.toggleSort("completionRate")),style:{cursor:"pointer"}},[e[10]||(e[10]=f(" 完課率 ")),o.sortField==="completionRate"?(r(),i("i",it,n(o.sortOrder==="asc"?"arrow_upward":"arrow_downward"),1)):w("",!0)]),t("th",{onClick:e[4]||(e[4]=s=>o.toggleSort("averageScore")),style:{cursor:"pointer"}},[e[11]||(e[11]=f(" 平均分數 ")),o.sortField==="averageScore"?(r(),i("i",dt,n(o.sortOrder==="asc"?"arrow_upward":"arrow_downward"),1)):w("",!0)]),t("th",{onClick:e[5]||(e[5]=s=>o.toggleSort("students_count")),style:{cursor:"pointer"}},[e[12]||(e[12]=f(" 上課人數 ")),o.sortField==="students_count"?(r(),i("i",ct,n(o.sortOrder==="asc"?"arrow_upward":"arrow_downward"),1)):w("",!0)]),e[16]||(e[16]=t("th",null,"操作",-1))])]),t("tbody",null,[(r(!0),i(y,null,x(o.courses,s=>(r(),i("tr",{key:s.id},[t("td",null,n(s.name),1),t("td",null,n(s.instructor),1),t("td",null,n(s.category),1),t("td",null,n(s.completionRate)+"%",1),t("td",null,n(s.averageScore)+"分",1),t("td",null,n(s.students_count)+"人",1),t("td",null,[t("button",{class:"btn btn-primary btn-sm",onClick:b=>o.viewDetails(s.id)}," 檢視詳細 ",8,ut)])]))),128))])])]),t("div",vt,[t("nav",null,[t("ul",gt,[t("li",{class:C(["page-item",{disabled:o.currentPage===1}])},[t("a",{class:"page-link",href:"#",onClick:e[6]||(e[6]=h(s=>o.goToPage(o.currentPage-1),["prevent"]))}," 上一頁 ")],2),(r(!0),i(y,null,x(o.totalPages,s=>(r(),i("li",{key:s,class:C(["page-item",{active:o.currentPage===s}])},[t("a",{class:"page-link",href:"#",onClick:h(b=>o.goToPage(s),["prevent"])},n(s),9,mt)],2))),128)),t("li",{class:C(["page-item",{disabled:o.currentPage===o.totalPages}])},[t("a",{class:"page-link",href:"#",onClick:e[7]||(e[7]=h(s=>o.goToPage(o.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])])])])])])]),P(c)])]),o.loading?(r(),H(d,{key:0})):w("",!0)],64)}const St=j(J,[["render",_t],["__scopeId","data-v-0437ff8d"]]);export{St as default};
