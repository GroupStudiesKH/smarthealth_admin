import{_ as T,r as c,w as A,o as d,c as u,a as M,b as t,t as v,d as S,e as g,v as D,F as k,f as Q,g as P,n as O,h as H,u as R,i as G,j as E,k as U,l as j,m as J}from"./index-9daaab36.js";import{a as F,F as K,N as W,_ as X}from"./sidebar-a960fed0.js";const Y={name:"QuestionModal",props:{show:{type:Boolean,required:!0},questionID:{type:String,required:!0},chapterOptions:{type:Array,default:()=>[]},isEdit:{type:Boolean,default:!1}},emits:["update:show","save"],setup(f,{emit:o}){const l=c({id:"",chapter_id:"",question:"",type:"true_false",note:"",options:[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]}),e=c("true_false"),h=c(f.chapterOptions),y=c(f.questionID);A(()=>f.questionID,i=>{y.value=i,i?b(i):l.value={id:"",chapter_id:"",question:"",type:"true_false",note:"",options:[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]}});const n={true_false:"是非題",single_choice:"單選題",multiple_choice:"多選題"},m=c(!1),p=c(""),w=c({}),s=i=>{p.value=i,m.value=!0},b=async i=>{try{l.value={id:"",chapter:"",question:"",type:"true_false",note:"",options:[]};const a=await F.getQuestion(i);l.value=a,e.value=a.type}catch{s("獲取題目失敗")}};A(()=>e.value,i=>{i==="true_false"?l.value.options=[{option_text:"是",option_index:0,is_correct:!0},{option_text:"否",option_index:1,is_correct:!1}]:i!==l.value.type&&(l.value.options=[]),l.value.type=i});const V=i=>{l.value.type==="true_false"||l.value.type==="single_choice"?l.value.options.forEach((a,r)=>{a.is_correct=r===i}):l.value.options[i].is_correct=!l.value.options[i].is_correct},I=()=>{l.value.options.push({option_text:"",option_index:l.value.options.length,is_correct:!1})},C=i=>{l.value.options.splice(i,1),l.value.options.forEach((a,r)=>{a.option_index=r})},q=(i,a)=>{l.value.options[i].option_text=a},x=()=>{o("update:show",!1)};return{questionForm:l,questionTypes:n,chapterOptions:h,addOption:I,removeOption:C,updateOption:q,closeModal:x,saveQuestion:async()=>{var i,a;try{f.isEdit?await F.updateQuestion(y.value,l.value):await F.addQuestion(l.value),o("save",l.value),x()}catch(r){if(((a=(i=r.response)==null?void 0:i.data)==null?void 0:a.status)==="error")if(r.response.data.content){const _={};for(const[L,N]of Object.entries(r.response.data.content))_[L]=Array.isArray(N)?N[0].replace(/[\[\]"]/g,""):N;w.value=_;const B=Object.values(_).join("<br/>");s("橫幅更新失敗："+(B||"未知錯誤"))}else s("橫幅更新失敗："+(r.response.data.message||"儲存失敗"));else s("儲存失敗")}},questionType:e,setAnswer:V,showModal:m,modalMessage:p,showErrorModal:s}}},Z={key:0,class:"modal-backdrop fade show"},$={key:1,class:"modal fade show d-block",tabindex:"-1",role:"dialog","aria-hidden":"true"},tt={class:"modal-dialog modal-lg",role:"document"},et={class:"modal-content"},ot={class:"modal-header"},st={class:"modal-title"},nt={class:"modal-body"},lt={class:"mb-3"},at=["value"],it={class:"mb-3"},rt=["value"],dt={class:"mb-3"},ct={class:"mb-3"},ut={class:"options-container"},mt={class:"form-check flex-grow-1"},pt=["type","checked","onChange"],vt=["onUpdate:modelValue","placeholder","onInput"],_t=["onClick"],bt={class:"mb-3"},ft={class:"modal-footer"},ht={class:"modal-dialog"},yt={class:"modal-content"},gt={class:"modal-header"},kt=["innerHTML"],wt={class:"modal-footer"},xt={key:2,class:"modal-backdrop fade show"};function Mt(f,o,l,e,h,y){return d(),u(k,null,[l.show?(d(),u("div",Z)):M("",!0),l.show?(d(),u("div",$,[t("div",tt,[t("div",et,[t("div",ot,[t("h5",st,v(l.isEdit?"編輯題目":"新增題目"),1),t("button",{type:"button",class:"btn-close",onClick:o[0]||(o[0]=(...n)=>e.closeModal&&e.closeModal(...n))})]),t("div",nt,[t("form",{onSubmit:o[7]||(o[7]=S((...n)=>e.saveQuestion&&e.saveQuestion(...n),["prevent"]))},[t("div",lt,[o[10]||(o[10]=t("label",{class:"form-label"},"題型",-1)),g(t("select",{class:"form-select","onUpdate:modelValue":o[1]||(o[1]=n=>e.questionType=n)},[(d(!0),u(k,null,Q(e.questionTypes,(n,m)=>(d(),u("option",{key:m,value:m},v(n),9,at))),128))],512),[[D,e.questionType]])]),t("div",it,[o[12]||(o[12]=t("label",{class:"form-label"},"所屬範圍",-1)),g(t("select",{class:"form-select","onUpdate:modelValue":o[2]||(o[2]=n=>e.questionForm.chapter_id=n),required:""},[o[11]||(o[11]=t("option",{value:""},"請選擇章節/考試範圍",-1)),(d(!0),u(k,null,Q(e.chapterOptions,n=>(d(),u("option",{key:n.id,value:n.id},v(n.title),9,rt))),128))],512),[[D,e.questionForm.chapter_id]])]),t("div",dt,[o[13]||(o[13]=t("label",{class:"form-label"},"題目內容",-1)),g(t("textarea",{class:"form-control","onUpdate:modelValue":o[3]||(o[3]=n=>e.questionForm.question=n),rows:"3",required:""},null,512),[[P,e.questionForm.question]])]),t("div",ct,[o[14]||(o[14]=t("label",{class:"form-label"},"選項與答案",-1)),t("div",ut,[(d(!0),u(k,null,Q(e.questionForm.options,(n,m)=>(d(),u("div",{key:m,class:"option-item mb-2 d-flex align-items-center"},[t("div",mt,[t("input",{type:e.questionForm.type==="multiple_choice"?"checkbox":"radio",name:"answer",class:"form-check-input",checked:n.is_correct,onChange:p=>e.setAnswer(m)},null,40,pt),g(t("input",{type:"text",class:"form-control d-inline-block ms-2",style:{width:"calc(100% - 30px)"},"onUpdate:modelValue":p=>n.option_text=p,placeholder:"選項"+(m+1),onInput:p=>e.updateOption(m,p.target.value)},null,40,vt),[[P,n.option_text]])]),e.questionForm.type!=="true_false"&&e.questionForm.options.length>1?(d(),u("button",{key:0,type:"button",class:"btn btn-outline-danger btn-sm ms-2",onClick:p=>e.removeOption(m)}," 刪除 ",8,_t)):M("",!0)]))),128))]),e.questionForm.type!=="true_false"?(d(),u("button",{key:0,type:"button",class:"btn btn-outline-primary btn-sm mt-2",onClick:o[4]||(o[4]=(...n)=>e.addOption&&e.addOption(...n))}," 新增選項 ")):M("",!0)]),t("div",bt,[o[15]||(o[15]=t("label",{class:"form-label"},"備註",-1)),g(t("textarea",{class:"form-control","onUpdate:modelValue":o[5]||(o[5]=n=>e.questionForm.note=n),rows:"2"},null,512),[[P,e.questionForm.note]])]),t("div",ft,[t("button",{type:"button",class:"btn btn-secondary",onClick:o[6]||(o[6]=(...n)=>e.closeModal&&e.closeModal(...n))}," 取消 "),o[16]||(o[16]=t("button",{type:"submit",class:"btn btn-primary"},"保存",-1))])],32)])])])])):M("",!0),t("div",{class:O(["modal fade",{show:e.showModal}]),tabindex:"-1",style:H({display:e.showModal?"block":"none"})},[t("div",ht,[t("div",yt,[t("div",gt,[o[17]||(o[17]=t("h5",{class:"modal-title"},"錯誤提示",-1)),t("button",{type:"button",class:"btn-close",onClick:o[8]||(o[8]=n=>e.showModal=!1)})]),t("div",{class:"modal-body",innerHTML:e.modalMessage},null,8,kt),t("div",wt,[t("button",{type:"button",class:"btn btn-secondary",onClick:o[9]||(o[9]=n=>e.showModal=!1)}," 關閉 ")])])])],6),e.showModal?(d(),u("div",xt)):M("",!0)],64)}const Qt=T(Y,[["render",Mt],["__scopeId","data-v-276e61e7"]]);const Ct={components:{Footer:K,Navbar:W,Sidebar:X,QuestionModal:Qt},setup(){const o=R().params.id,l=c(""),e=c(""),h=c(1),y=c(10),n=c(0),m=c(10),p=c([]),w=c([]),s=c([]),b=async()=>{try{const a={course_id:o,chapter_id:e.value,status:"",search:l.value,page:h.value,pageSize:y.value},r=await F.getQuestionLists(a);p.value=[{id:"",title:"全部"},...r.chapterLists],w.value=r.chapterLists,s.value=r.questions,n.value=r.total,m.value=r.totalPages}catch(a){console.error("獲取題目列表失敗：",a)}};A([h],()=>{b()}),G(()=>{b()});const V=a=>{var r;return a.type==="true_false"?(r=a.correctOptions[0])==null?void 0:r.option_text:a.correctOptions.map(_=>_.option_text).join(", ")},I=async a=>{try{if(confirm("確定要刪除此題目嗎？")){const r=s.value.findIndex(_=>_.id===a);r!==-1&&s.value.splice(r,1),await F.delQuestion(a)}}catch(r){console.error("刪除題目失敗：",r)}},C=c(!1),q=c(null),x=c(!1);return{questions:s,searchQuery:l,selectedChapter:e,currentPage:h,pageSize:y,total:n,totalPages:m,formatAnswer:V,deleteQuestion:I,editQuestion:async a=>{s.value.find(_=>_.id===a)&&(x.value=!0,C.value=!0,q.value=a)},addQuestion:()=>{x.value=!1,C.value=!0,q.value=null},showQuestionModal:C,questionID:q,isEditMode:x,chapterOptions:p,chapterModalOptions:w,fetchQuestions:b}}},qt={class:"main-wrapper"},Ot={class:"page-wrapper"},Ft={class:"page-content"},Et={class:"row"},St={class:"col-md-12 grid-margin stretch-card"},Pt={class:"card"},Vt={class:"card-body"},It={class:"d-flex justify-content-between align-items-center mb-4"},Nt={class:"row mb-3"},Ut={class:"col-md-5"},jt={class:"col-md-5"},At=["value"],Dt={class:"col-md-2"},Tt={class:"table-responsive"},zt={class:"table table-hover"},Bt=["onClick"],Lt=["onClick"],Ht={class:"d-flex justify-content-between align-items-center mt-4"},Rt={class:"text-muted"},Gt={class:"pagination mb-0"},Jt=["onClick"];function Kt(f,o,l,e,h,y){const n=E("Sidebar"),m=E("Navbar"),p=E("Footer"),w=E("QuestionModal");return d(),u("div",qt,[U(n),t("div",Ot,[U(m),t("div",Ft,[t("div",Et,[t("div",St,[t("div",Pt,[t("div",Vt,[t("div",It,[o[8]||(o[8]=t("h6",{class:"card-title mb-0"},"題目管理",-1)),t("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=(...s)=>e.addQuestion&&e.addQuestion(...s))},o[7]||(o[7]=[t("i",{class:"material-icons align-middle me-1"},"add",-1),j(" 新增題目 ")]))]),t("div",Nt,[t("div",Ut,[g(t("input",{type:"text",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>e.searchQuery=s),placeholder:"搜尋題目內容或答案..."},null,512),[[P,e.searchQuery]])]),t("div",jt,[g(t("select",{class:"form-select","onUpdate:modelValue":o[2]||(o[2]=s=>e.selectedChapter=s)},[(d(!0),u(k,null,Q(e.chapterOptions,s=>(d(),u("option",{key:s.id,value:s.id},v(s.title),9,At))),128))],512),[[D,e.selectedChapter]])]),t("div",Dt,[t("button",{class:"btn btn-primary",onClick:o[3]||(o[3]=(...s)=>e.fetchQuestions&&e.fetchQuestions(...s))}," 搜尋 ")])]),t("div",Tt,[t("table",zt,[o[11]||(o[11]=t("thead",null,[t("tr",null,[t("th",null,"題型"),t("th",null,"題目內容"),t("th",null,"答案"),t("th",null,"註解"),t("th",null,"所屬章節/考試"),t("th",null,"操作")])],-1)),t("tbody",null,[(d(!0),u(k,null,Q(e.questions,s=>(d(),u("tr",{key:s.id},[t("td",null,[t("span",{class:O(["badge",{"bg-primary":s.type==="single_choice","bg-success":s.type==="multiple_choice","bg-info":s.type==="true_false"}])},v(s.type==="true_false"?"是非題":s.type==="single_choice"?"單選題":s.type==="multiple_choice"?"多選題":s.type),3)]),t("td",null,v(s.question),1),t("td",null,v(e.formatAnswer(s)),1),t("td",null,v(s.note),1),t("td",null,v(s.chapterName),1),t("td",null,[t("button",{class:"btn btn-primary btn-sm me-2",onClick:b=>e.editQuestion(s.id)},o[9]||(o[9]=[t("i",{class:"material-icons align-middle"},"edit",-1),j(" 編輯 ")]),8,Bt),t("button",{class:"btn btn-danger btn-sm",onClick:b=>e.deleteQuestion(s.id)},o[10]||(o[10]=[t("i",{class:"material-icons align-middle"},"delete",-1),j(" 刪除 ")]),8,Lt)])]))),128))])])]),t("div",Ht,[t("div",Rt," 顯示 "+v((e.currentPage-1)*e.pageSize+1)+" 到 "+v(Math.min(e.currentPage*e.pageSize,e.total))+" 筆，共 "+v(e.total)+" 筆 ",1),t("nav",null,[t("ul",Gt,[t("li",{class:O(["page-item",{disabled:e.currentPage===1}])},[t("a",{class:"page-link",href:"#",onClick:o[4]||(o[4]=S(s=>e.currentPage--,["prevent"])),"aria-label":"Previous"},o[12]||(o[12]=[t("span",{"aria-hidden":"true"},"«",-1)]))],2),(d(!0),u(k,null,Q(e.totalPages,s=>(d(),u("li",{key:s,class:O(["page-item",{active:s===e.currentPage}])},[t("a",{class:"page-link",href:"#",onClick:S(b=>e.currentPage=s,["prevent"])},v(s),9,Jt)],2))),128)),t("li",{class:O(["page-item",{disabled:e.currentPage===e.totalPages}])},[t("a",{class:"page-link",href:"#",onClick:o[5]||(o[5]=S(s=>e.currentPage++,["prevent"])),"aria-label":"Next"},o[13]||(o[13]=[t("span",{"aria-hidden":"true"},"»",-1)]))],2)])])])])])])])]),U(p),e.chapterModalOptions.length>0?(d(),J(w,{key:0,show:e.showQuestionModal,"onUpdate:show":o[6]||(o[6]=s=>e.showQuestionModal=s),questionID:e.questionID,chapterOptions:e.chapterModalOptions,isEdit:e.isEditMode,onSave:e.fetchQuestions},null,8,["show","questionID","chapterOptions","isEdit","onSave"])):M("",!0)])])}const Yt=T(Ct,[["render",Kt],["__scopeId","data-v-7243fccd"]]);export{Yt as default};
