import{_ as j,i as B,r as l,j as D,H as M,k as y,o as n,c as r,b as t,l as C,e as F,g as O,v as R,F as f,f as w,m as T,t as i,a as b,n as h,d as P,p as Q}from"./index-b90c0ad9.js";import{F as A,N as U,_ as H}from"./sidebar-87f173a3.js";import{a as L}from"./api-service-e3b33b42.js";import{L as q}from"./loading-113a0e4d.js";const G={components:{Footer:A,Navbar:U,Sidebar:H,Loading:q},setup(){const m=B(),e=l(""),c=l(!1),o=async()=>{try{c.value=!0;const a=await L.getTagsOption("category");_.value=[{id:"",name:"全部"},...a],c.value=!1}catch(a){c.value=!1,console.error("獲取分類失敗:",a)}},x=a=>{m.push(`/exam/edit/${a}`)},p=l(""),u=l("asc"),k=a=>{p.value===a?u.value=u.value==="asc"?"desc":"asc":(p.value=a,u.value="asc")},v=l([]),_=l([]),s=l(""),g=l(1),V=l(10),S=l(1),E=async()=>{try{const a={category_id:s.value==="全部"?"":s.value,search:e.value,page:g.value,pageSize:V.value};c.value=!0;const N=await L.getExamLists(a);v.value=N.courses.map(d=>({id:d.id,courseName:d.title,instructor:d.instructors.join(", "),category:d.categories.join(", "),averageScore:d.averageScore,participantsCount:d.participantsCount,createdAt:d.created_at})),S.value=N.totalPages,c.value=!1}catch(a){console.error("獲取測驗列表失敗:",a),c.value=!1}finally{c.value=!1}};D(()=>{E(),o()});const z=M(()=>v.value);return{examData:v,currentPageExams:z,searchQuery:e,selectedCategory:s,categories:_,currentPage:g,totalPages:S,editExam:a=>{m.push(`/exam/edit/${a}`)},viewResult:a=>{m.push(`/exam/result/${a}`)},goToPage:a=>{g.value=a},goToExamEdit:x,toggleSort:k,sortField:p,sortOrder:u,fetchExams:E,loading:c}}},I={class:"main-wrapper"},J={class:"page-wrapper"},K={class:"page-content"},W={class:"row"},X={class:"col-md-12 grid-margin stretch-card"},Y={class:"card"},Z={class:"card-body"},$={class:"row mb-3"},tt={class:"col-md-5"},et={class:"col-md-5"},ot=["value"],st={class:"col-md-2"},at={class:"table-responsive"},nt={class:"table table-hover"},rt={key:0,class:"material-icons align-middle",style:{"font-size":"16px"}},lt={key:0,class:"material-icons align-middle",style:{"font-size":"16px"}},it={key:0},ct={key:1},dt=["onClick"],ut=["onClick"],gt={key:0,class:"mt-3"},vt={class:"pagination justify-content-center"},mt=["onClick"];function pt(m,e,c,o,x,p){const u=y("Sidebar"),k=y("Navbar"),v=y("Footer"),_=y("Loading");return n(),r(f,null,[t("div",I,[C(u),t("div",J,[C(k),t("div",K,[t("div",W,[t("div",X,[t("div",Y,[t("div",Z,[e[16]||(e[16]=t("h6",{class:"card-title"},"課程測驗列表",-1)),t("div",$,[t("div",tt,[F(t("input",{type:"text",class:"form-control mb-2","onUpdate:modelValue":e[0]||(e[0]=s=>o.searchQuery=s),placeholder:"搜尋課程名稱或講師..."},null,512),[[O,o.searchQuery]])]),t("div",et,[F(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=s=>o.selectedCategory=s)},[(n(!0),r(f,null,w(o.categories,s=>(n(),r("option",{key:s.id,value:s.id},i(s.name),9,ot))),128))],512),[[R,o.selectedCategory]])]),t("div",st,[t("button",{class:"btn btn-primary w-100",onClick:e[2]||(e[2]=(...s)=>o.fetchExams&&o.fetchExams(...s))}," 搜尋 ")])]),t("div",at,[t("table",nt,[t("thead",null,[t("tr",null,[e[9]||(e[9]=t("th",null,"課程名稱",-1)),e[10]||(e[10]=t("th",null,"課程講師",-1)),e[11]||(e[11]=t("th",null,"分類",-1)),t("th",{onClick:e[3]||(e[3]=s=>o.toggleSort("averageScore")),style:{cursor:"pointer"}},[e[7]||(e[7]=T(" 平均分數 ")),o.sortField==="averageScore"?(n(),r("i",rt,i(o.sortOrder==="asc"?"arrow_upward":"arrow_downward"),1)):b("",!0)]),t("th",{onClick:e[4]||(e[4]=s=>o.toggleSort("participantsCount")),style:{cursor:"pointer"}},[e[8]||(e[8]=T(" 參與人數 ")),o.sortField==="participantsCount"?(n(),r("i",lt,i(o.sortOrder==="asc"?"arrow_upward":"arrow_downward"),1)):b("",!0)]),e[12]||(e[12]=t("th",null,"建立時間",-1)),e[13]||(e[13]=t("th",null,"操作",-1))])]),t("tbody",null,[o.loading?(n(),r("tr",it,e[14]||(e[14]=[t("td",{colspan:"7",class:"text-center"},"載入中...",-1)]))):o.currentPageExams.length===0?(n(),r("tr",ct,e[15]||(e[15]=[t("td",{colspan:"7",class:"text-center"},"無資料",-1)]))):(n(!0),r(f,{key:2},w(o.currentPageExams,s=>(n(),r("tr",{key:s.id},[t("td",null,i(s.courseName),1),t("td",null,i(s.instructor),1),t("td",null,i(s.category),1),t("td",null,i(s.averageScore),1),t("td",null,i(s.participantsCount),1),t("td",null,i(s.createdAt),1),t("td",null,[t("button",{class:"btn btn-primary btn-sm me-2",onClick:g=>o.editExam(s.id)}," 編輯題目 ",8,dt),t("button",{class:"btn btn-info btn-sm",onClick:g=>o.viewResult(s.id)}," 檢視結果 ",8,ut)])]))),128))])])]),o.totalPages>1?(n(),r("nav",gt,[t("ul",vt,[t("li",{class:h(["page-item",{disabled:o.currentPage===1}])},[t("a",{class:"page-link",href:"#",onClick:e[5]||(e[5]=P(s=>o.goToPage(o.currentPage-1),["prevent"]))}," 上一頁 ")],2),(n(!0),r(f,null,w(o.totalPages,s=>(n(),r("li",{key:s,class:h(["page-item",{active:o.currentPage===s}])},[t("a",{class:"page-link",href:"#",onClick:P(g=>o.goToPage(s),["prevent"])},i(s),9,mt)],2))),128)),t("li",{class:h(["page-item",{disabled:o.currentPage===o.totalPages}])},[t("a",{class:"page-link",href:"#",onClick:e[6]||(e[6]=P(s=>o.goToPage(o.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])):b("",!0)])])])])]),C(v)])]),o.loading?(n(),Q(_,{key:0})):b("",!0)],64)}const ht=j(G,[["render",pt]]);export{ht as default};
