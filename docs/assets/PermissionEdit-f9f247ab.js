import{_ as x,i as E,u as N,r as _,j as B,k as v,o as i,c as l,b as o,l as D,e as L,g as F,d as O,F as f,f as S,t as h,p as V,a as I,z as M}from"./index-9ad84de7.js";import{a as b}from"./api-service-a37f4a4e.js";import{F as j,N as C,_ as U}from"./sidebar-3e85bcbd.js";import{L as A}from"./loading-c9ce64e9.js";const R={components:{Footer:j,Navbar:C,Sidebar:U,Loading:A},setup(){const u=E(),g=N().params.id,e=_({name:"",permissions:{}}),p=_({}),r=_(!1),d=_({}),k=async()=>{try{r.value=!0;const s=await b.getPermissionOptions();d.value=s,e.value={id:"",name:"",permissions:Object.keys(s).reduce((t,a)=>(t[a]=[],t),{})},r.value=!1}catch(s){r.value=!1,console.error("Error fetching permission options:",s)}},y=async()=>{try{r.value=!0;const s=await b.getPermission(g);e.value={id:s.id,name:s.name,permissions:{...e.value.permissions,...s.permissions}},Object.keys(d.value).forEach(t=>{Object.keys(d.value[t].list).forEach(a=>{Array.isArray(e.value.permissions[a])||(e.value.permissions[a]=[])})}),console.log("Updated permissionData:",e.value),r.value=!1}catch(s){r.value=!1,console.error("Error fetching permission data:",s)}},w=async()=>{r.value=!0;try{p.value={},await b.updatePermission(g,e.value)?(console.log("Permission updated successfully"),await m(),u.push("/permission")):(console.error("Failed to update permission"),alert("權限更新失敗，請稍後再試。"))}catch(s){console.error("Error updating permission:",s),s.response&&s.response.data&&(p.value=s.response.data.content||{}),alert("權限更新失敗："+(s.message||"未知錯誤"))}finally{r.value=!1}},n=()=>{u.push("/permission")},m=async()=>{try{const s=await b.adminMe();s?(sessionStorage.setItem("userData",JSON.stringify(s)),userData.value=s):console.error("Invalid response format:",s)}catch(s){console.error("Error fetching admin data:",s),u.push("/login"),localStorage.removeItem("access_token")}};return B(async()=>{await k(),await y()}),{permissionData:e,permissionStructure:d,updatePermission:w,goBack:n,errors:p,isLoading:r}}},z={class:"main-wrapper"},J={class:"page-wrapper"},T={class:"page-content"},q={class:"row"},G={class:"col-12 stretch-card"},H={class:"mb-3"},Q={class:"col-12 stretch-card"},W={class:"row"},X={class:"card h-100"},Y={class:"card-body"},Z={class:"mb-4"},$={class:"mb-3"},K={class:"d-flex flex-wrap"},ss=["id","checked","value","onUpdate:modelValue"],es=["for"],os=["disabled"],as=["disabled"];function ts(u,c,g,e,p,r){const d=v("Sidebar"),k=v("Navbar"),y=v("Footer"),w=v("Loading");return i(),l(f,null,[o("div",z,[D(d),o("div",J,[D(k),o("div",T,[o("div",q,[o("div",G,[o("h4",H,[L(o("input",{"onUpdate:modelValue":c[0]||(c[0]=n=>e.permissionData.name=n),class:"form-control",type:"text"},null,512),[[F,e.permissionData.name]])])]),o("div",Q,[o("form",{onSubmit:c[2]||(c[2]=O((...n)=>e.updatePermission&&e.updatePermission(...n),["prevent"]))},[o("div",W,[(i(!0),l(f,null,S(e.permissionStructure,(n,m)=>(i(),l("div",{class:"col-md-3 mb-3",key:m},[o("div",X,[o("div",Y,[o("div",Z,[o("h5",$,h(n.title),1),(i(!0),l(f,null,S(n.list,(s,t)=>(i(),l("div",{key:t,class:"mb-3"},[o("p",null,h(s.title),1),o("div",K,[(i(!0),l(f,null,S(s.permissions,a=>(i(),l("div",{key:a,class:"form-check permissionItem me-3"},[L(o("input",{class:"form-check-input",type:"checkbox",id:`${m}-${t}-${a}`,checked:e.permissionData.permissions[t]&&e.permissionData.permissions[t].includes(a),value:a,"onUpdate:modelValue":P=>e.permissionData.permissions[t]=P},null,8,ss),[[M,e.permissionData.permissions[t]]]),o("label",{class:"form-check-label",for:`${m}-${t}-${a}`},h(a==="list"?"列表":a==="create"?"新增":a==="edit"?"編輯":a==="del"?"刪除":a),9,es)]))),128))])]))),128))])])])]))),128))]),o("button",{type:"submit",class:"btn btn-primary me-2",disabled:e.isLoading},h(e.isLoading?"更新中...":"更新權限"),9,os),o("button",{type:"button",class:"btn btn-secondary",onClick:c[1]||(c[1]=(...n)=>e.goBack&&e.goBack(...n)),disabled:e.isLoading}," 返回 ",8,as)],32)])])]),D(y)])]),e.isLoading?(i(),V(w,{key:0})):I("",!0)],64)}const ls=x(R,[["render",ts]]);export{ls as default};
