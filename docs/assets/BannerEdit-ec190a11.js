import{_ as P,p as q,u as R,r as k,i as T,j as D,o as l,c as s,b as e,k as V,d as A,l as C,e as _,g as b,n as r,t as d,a as i,v as H,m as O,F as z}from"./index-25cf0606.js";import{F as G,N as J,_ as K,a as L}from"./sidebar-d63d104f.js";import{L as Q}from"./loading-af52cca8.js";const W={components:{Footer:G,Navbar:J,Sidebar:K,Loading:Q},setup(){const w=q(),h=R().params.id,t=k({title:"",subtitle_1:"",subtitle_2:"",content:"",action_link_href:"",action_link_text:"",action_link2_href:"",action_link2_text:"",status:"active",image:null,sort:null}),x=k({}),m=k(!1),v=k(!1),g=k(""),f=k(null),M=async()=>{try{m.value=!0,t.value=await L.bannerShow(h),t.value.img_url&&(f.value=t.value.img_url),m.value=!1}catch(c){m.value=!1,console.error("Error fetching banner data:",c),p("獲取橫幅數據失敗，請稍後再試。")}},o=async()=>{var c,u;m.value=!0;try{x.value={};const n=new FormData;n.append("title",t.value.title),n.append("subtitle_1",t.value.subtitle_1??""),n.append("subtitle_2",t.value.subtitle_2??""),n.append("content",t.value.content??""),n.append("action_link_href",t.value.action_link_href??""),n.append("action_link_text",t.value.action_link_text??""),n.append("action_link2_href",t.value.action_link2_href??""),n.append("action_link2_text",t.value.action_link2_text??""),n.append("status",t.value.status),n.append("sort",t.value.sort??0),t.value.image instanceof File&&n.append("image",t.value.image),await L.editBanner(h,n),U("橫幅更新成功"),w.push("/layout/banner")}catch(n){if(((u=(c=n.response)==null?void 0:c.data)==null?void 0:u.status)==="error")if(n.response.data.content){const y={};for(const[E,B]of Object.entries(n.response.data.content))y[E]=Array.isArray(B)?B[0].replace(/[\[\]"]/g,""):B;x.value=y;const N=Object.values(y).join("<br/>");p("橫幅更新失敗："+(N||"未知錯誤"))}else p("橫幅更新失敗："+(n.response.data.message||"儲存失敗"));else p("儲存失敗")}finally{m.value=!1}},p=c=>{g.value=c,v.value=!0},U=c=>{g.value=c,v.value=!0},F=()=>{v.value=!1},S=()=>{w.push("/layout/banner")},j=c=>{const u=c.target.files[0];if(u){t.value.image=u;const n=new FileReader;n.onload=y=>{f.value=y.target.result},n.readAsDataURL(u)}},I=()=>{t.value.image=null,f.value=null};return T(()=>{M()}),{bannerData:t,updateBanner:o,goBack:S,errors:x,isLoading:m,showModal:v,modalMessage:g,closeModal:F,handleImageChange:j,imagePreview:f,clearImage:I}}},X={class:"main-wrapper"},Y={class:"page-wrapper"},Z={class:"page-content"},$={class:"row"},tt={class:"col-12"},at={class:"card"},et={class:"card-body"},ot={class:"row"},nt={class:"col-md-6"},lt={class:"mb-3"},st={key:0,class:"invalid-feedback"},it={class:"mb-3"},rt={key:0,class:"invalid-feedback"},dt={class:"mb-3"},ct={key:0,class:"invalid-feedback"},_t={class:"mb-3"},bt={key:0,class:"invalid-feedback"},mt={class:"col-md-6"},vt={class:"mb-3"},ft={key:0,class:"invalid-feedback"},ut={class:"mb-3"},kt={key:0,class:"invalid-feedback"},gt={class:"mb-3"},yt={key:0,class:"invalid-feedback"},xt={class:"mb-3"},pt={key:0,class:"invalid-feedback"},Dt={class:"col-md-6"},wt={class:"mb-3"},ht={key:0,class:"invalid-feedback"},Mt={class:"mb-3"},Bt=["required"],Vt={key:0,class:"invalid-feedback"},Ct={key:1,class:"mt-2"},Lt=["src"],Ut={class:"mb-3"},Ft={key:0,class:"invalid-feedback"},St={class:"mt-4"},jt=["disabled"],It=["disabled"],Nt={class:"modal-dialog"},Et={class:"modal-content"},Pt={class:"modal-header"},qt=["innerHTML"],Rt={class:"modal-footer"};function Tt(w,a,h,t,x,m){const v=D("Sidebar"),g=D("Navbar"),f=D("Footer"),M=D("Loading");return l(),s(z,null,[e("div",X,[V(v),e("div",Y,[V(g),e("div",Z,[e("div",$,[e("div",tt,[e("div",at,[e("div",et,[a[31]||(a[31]=e("h4",{class:"card-title mb-4"},"編輯橫幅",-1)),e("form",{onSubmit:a[13]||(a[13]=A((...o)=>t.updateBanner&&t.updateBanner(...o),["prevent"])),enctype:"multipart/form-data",class:"w-100"},[e("div",ot,[e("div",nt,[e("div",lt,[a[17]||(a[17]=e("label",{for:"title",class:"form-label"},[C("標題 "),e("span",{class:"text-danger"},"*")],-1)),_(e("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.title}]),id:"title","onUpdate:modelValue":a[0]||(a[0]=o=>t.bannerData.title=o),required:""},null,2),[[b,t.bannerData.title]]),t.errors.title?(l(),s("div",st,d(t.errors.title),1)):i("",!0)]),e("div",it,[a[18]||(a[18]=e("label",{for:"subtitle_1",class:"form-label"},"副標題1",-1)),_(e("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.subtitle_1}]),id:"subtitle_1","onUpdate:modelValue":a[1]||(a[1]=o=>t.bannerData.subtitle_1=o)},null,2),[[b,t.bannerData.subtitle_1]]),t.errors.subtitle_1?(l(),s("div",rt,d(t.errors.subtitle_1),1)):i("",!0)]),e("div",dt,[a[19]||(a[19]=e("label",{for:"subtitle_2",class:"form-label"},"副標題2",-1)),_(e("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.subtitle_2}]),id:"subtitle_2","onUpdate:modelValue":a[2]||(a[2]=o=>t.bannerData.subtitle_2=o)},null,2),[[b,t.bannerData.subtitle_2]]),t.errors.subtitle_2?(l(),s("div",ct,d(t.errors.subtitle_2),1)):i("",!0)]),e("div",_t,[a[20]||(a[20]=e("label",{for:"content",class:"form-label"},[C("內容 "),e("span",{class:"text-danger"},"*")],-1)),_(e("textarea",{class:r(["form-control",{"is-invalid":t.errors.content}]),id:"content","onUpdate:modelValue":a[3]||(a[3]=o=>t.bannerData.content=o),required:""},null,2),[[b,t.bannerData.content]]),t.errors.content?(l(),s("div",bt,d(t.errors.content),1)):i("",!0)])]),e("div",mt,[e("div",vt,[a[21]||(a[21]=e("label",{for:"action_link_href",class:"form-label"},"行動連結網址",-1)),_(e("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.action_link_href}]),id:"action_link_href","onUpdate:modelValue":a[4]||(a[4]=o=>t.bannerData.action_link_href=o)},null,2),[[b,t.bannerData.action_link_href]]),t.errors.action_link_href?(l(),s("div",ft,d(t.errors.action_link_href),1)):i("",!0)]),e("div",ut,[a[22]||(a[22]=e("label",{for:"action_link_text",class:"form-label"},"行動連結文字",-1)),_(e("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.action_link_text}]),id:"action_link_text","onUpdate:modelValue":a[5]||(a[5]=o=>t.bannerData.action_link_text=o)},null,2),[[b,t.bannerData.action_link_text]]),t.errors.action_link_text?(l(),s("div",kt,d(t.errors.action_link_text),1)):i("",!0)]),e("div",gt,[a[23]||(a[23]=e("label",{for:"action_link2_href",class:"form-label"},"行動連結2網址",-1)),_(e("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.action_link2_href}]),id:"action_link2_href","onUpdate:modelValue":a[6]||(a[6]=o=>t.bannerData.action_link2_href=o)},null,2),[[b,t.bannerData.action_link2_href]]),t.errors.action_link2_href?(l(),s("div",yt,d(t.errors.action_link2_href),1)):i("",!0)]),e("div",xt,[a[24]||(a[24]=e("label",{for:"action_link2_text",class:"form-label"},"行動連結2文字",-1)),_(e("input",{type:"text",class:r(["form-control",{"is-invalid":t.errors.action_link2_text}]),id:"action_link2_text","onUpdate:modelValue":a[7]||(a[7]=o=>t.bannerData.action_link2_text=o)},null,2),[[b,t.bannerData.action_link2_text]]),t.errors.action_link2_text?(l(),s("div",pt,d(t.errors.action_link2_text),1)):i("",!0)])]),e("div",Dt,[e("div",wt,[a[26]||(a[26]=e("label",{for:"status",class:"form-label"},"狀態",-1)),_(e("select",{class:r(["form-select",{"is-invalid":t.errors.status}]),id:"status","onUpdate:modelValue":a[8]||(a[8]=o=>t.bannerData.status=o)},a[25]||(a[25]=[e("option",{value:"active"},"啟用",-1),e("option",{value:"inactive"},"未啟用",-1)]),2),[[H,t.bannerData.status]]),t.errors.status?(l(),s("div",ht,d(t.errors.status),1)):i("",!0)]),e("div",Mt,[a[28]||(a[28]=e("label",{for:"image",class:"form-label"},[C("圖片 "),e("span",{class:"text-danger"},"*")],-1)),e("input",{type:"file",class:r(["form-control",{"is-invalid":t.errors.image}]),id:"image",onChange:a[9]||(a[9]=(...o)=>t.handleImageChange&&t.handleImageChange(...o)),required:!t.imagePreview,accept:".jpg,.jpeg,.gif,.png,.webp"},null,42,Bt),a[29]||(a[29]=e("small",{class:"form-text text-muted"},"只能上傳 jpg、jpeg、gif、png 或 webp 格式的圖片",-1)),t.errors.image?(l(),s("div",Vt,d(t.errors.image),1)):i("",!0),t.imagePreview?(l(),s("div",Ct,[e("img",{src:t.imagePreview,alt:"Banner Preview",class:"img-fluid",style:{"max-width":"200px"}},null,8,Lt),a[27]||(a[27]=e("br",null,null,-1)),e("button",{type:"button",class:"btn btn-sm btn-danger mt-2",onClick:a[10]||(a[10]=(...o)=>t.clearImage&&t.clearImage(...o))},"清除圖片")])):i("",!0)]),e("div",Ut,[a[30]||(a[30]=e("label",{for:"sort",class:"form-label"},"排序",-1)),_(e("input",{type:"number",class:r(["form-control",{"is-invalid":t.errors.sort}]),id:"sort","onUpdate:modelValue":a[11]||(a[11]=o=>t.bannerData.sort=o)},null,2),[[b,t.bannerData.sort]]),t.errors.sort?(l(),s("div",Ft,d(t.errors.sort),1)):i("",!0)])])]),e("div",St,[e("button",{type:"submit",class:"btn btn-primary me-2",disabled:t.isLoading},d(t.isLoading?"更新中...":"更新橫幅"),9,jt),e("button",{type:"button",class:"btn btn-secondary",onClick:a[12]||(a[12]=(...o)=>t.goBack&&t.goBack(...o)),disabled:t.isLoading}," 返回 ",8,It)])],32)])])])])]),V(f)])]),t.showModal?(l(),s("div",{key:0,class:"modal-backdrop",onClick:a[14]||(a[14]=(...o)=>t.closeModal&&t.closeModal(...o))})):i("",!0),e("div",{class:r(["modal",{"d-block":t.showModal}]),tabindex:"-1"},[e("div",Nt,[e("div",Et,[e("div",Pt,[a[32]||(a[32]=e("h5",{class:"modal-title"},"提示",-1)),e("button",{type:"button",class:"btn-close",onClick:a[15]||(a[15]=(...o)=>t.closeModal&&t.closeModal(...o))})]),e("div",{class:"modal-body",innerHTML:t.modalMessage},null,8,qt),e("div",Rt,[e("button",{type:"button",class:"btn btn-secondary",onClick:a[16]||(a[16]=(...o)=>t.closeModal&&t.closeModal(...o))},"關閉")])])])],2),t.isLoading?(l(),O(M,{key:1})):i("",!0)],64)}const zt=P(W,[["render",Tt],["__scopeId","data-v-3d0993bc"]]);export{zt as default};
