import{_ as V,r as d,j as B,i as E,u as T,k as v,o as l,c as i,b as t,l as f,e as S,g as M,v as N,F as m,f as C,y as Q,p as U,a as j,t as r,m as z,n as O}from"./index-b90c0ad9.js";import{a as x}from"./api-service-e3b33b42.js";import{F as R,N as I,_ as q}from"./sidebar-87f173a3.js";import{L as A}from"./loading-113a0e4d.js";const G={components:{Footer:R,Navbar:I,Sidebar:q,Loading:A},setup(){const u=d([]),s=d(!0),k=d([]),a=async()=>{try{const o=await x.getTagsOption("category");k.value=o}catch(o){console.error("獲取分類失敗:",o)}};B(()=>{y(),a()});const F=async()=>{s.value=!0,await y(),s.value=!1},w=E();T();const b=d(""),h=d(""),p=d(""),g=d([{label:"已上架",value:"publish"},{label:"未上架",value:"draft"},{label:"審核中",value:"pending"}]),y=async()=>{try{const o={category_id:h.value,status:p.value,search:b.value,pageSize:99},_=await x.getCourses(o);u.value=_.courses.map(n=>{var D;return{id:n.id,title:n.title,tags:n.tags,category:n.categories[0]||"",instructor:n.instructors.join(","),status_raw:n.status,status:((D=g.value.find(L=>L.value===n.status))==null?void 0:D.label)||n.status,publishDate:new Date(n.created_at).toISOString().split("T")[0]}})}catch(o){console.error("获取课程失败:",o)}finally{s.value=!1}};return{courses:u,router:w,searchQuery:b,selectedCategory:h,selectedStatus:p,statuses:g,handleFilter:F,handleEdit:o=>{w.push(`/course/edit/${o}`)},handleDelete:async o=>{if(confirm("確定要刪除此課程嗎？")){s.value=!0;try{await x.delCourse(o),u.value=u.value.filter(_=>_.id!==o)}catch(_){alert(`刪除失敗: ${_.message}`)}finally{s.value=!1}}},loading:s,categories:k}}},H={class:"main-wrapper"},J={class:"page-wrapper"},K={class:"page-content"},P={class:"row mb-3"},W={class:"col-md-12"},X={class:"card"},Y={class:"card-body"},Z={class:"row align-items-center"},$={class:"col-md-3"},tt={class:"col-md-3"},et=["value"],st={class:"col-md-2"},at=["value"],ot={class:"col-md-4"},lt=["disabled"],nt={class:"row"},it={class:"col-md-12 grid-margin stretch-card"},rt={class:"card"},dt={class:"card-body"},ct={class:"table-responsive"},ut={class:"table table-hover"},_t=["onClick"],vt=["onClick"],mt=["onClick"];function bt(u,s,k,a,F,w){const b=v("Sidebar"),h=v("Navbar"),p=v("router-link"),g=v("Footer"),y=v("Loading");return l(),i(m,null,[t("div",H,[f(b),t("div",J,[f(h),t("div",K,[t("div",P,[t("div",W,[t("div",X,[t("div",Y,[t("div",Z,[t("div",$,[S(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=e=>a.searchQuery=e),placeholder:"搜尋課程名稱或講師"},null,512),[[M,a.searchQuery]])]),t("div",tt,[S(t("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=e=>a.selectedCategory=e)},[s[4]||(s[4]=t("option",{value:""},"所有分類",-1)),(l(!0),i(m,null,C(a.categories,e=>(l(),i("option",{key:e.id,value:e.id},r(e.name),9,et))),128))],512),[[N,a.selectedCategory]])]),t("div",st,[S(t("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=e=>a.selectedStatus=e)},[s[5]||(s[5]=t("option",{value:""},"所有狀態",-1)),(l(!0),i(m,null,C(a.statuses,e=>(l(),i("option",{key:e.value,value:e.value},r(e.label),9,at))),128))],512),[[N,a.selectedStatus]])]),t("div",ot,[t("button",{class:"btn btn-primary mx-2",onClick:s[3]||(s[3]=(...e)=>a.handleFilter&&a.handleFilter(...e)),disabled:a.loading}," 篩選 ",8,lt),f(p,{to:"/course/add",class:"btn btn-secondary"},{default:Q(()=>s[6]||(s[6]=[z(" 新增課程 ")])),_:1})])])])])])]),t("div",nt,[t("div",it,[t("div",rt,[t("div",dt,[t("div",ct,[t("table",ut,[s[7]||(s[7]=t("thead",null,[t("tr",null,[t("th",null,"課程名稱"),t("th",null,"上架時間"),t("th",null,"講師"),t("th",null,"分類"),t("th",null,"標籤"),t("th",null,"狀態"),t("th",null,"操作")])],-1)),t("tbody",null,[(l(!0),i(m,null,C(a.courses,e=>(l(),i("tr",{key:e.id},[t("td",null,r(e.title),1),t("td",null,r(e.publishDate),1),t("td",null,r(e.instructor),1),t("td",null,r(e.category),1),t("td",null,[(l(!0),i(m,null,C(e.tags,c=>(l(),i("span",{key:c,class:"badge bg-primary me-1"},r(c),1))),128))]),t("td",null,[t("span",{class:O(["badge",{"bg-success":e.status==="已上架","bg-warning":e.status==="審核中","bg-secondary":e.status==="未上架"}])},r(e.status),3)]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:c=>a.handleEdit(e.id)}," 編輯 ",8,_t),t("button",{class:"btn btn-sm btn-outline-info me-2",onClick:c=>a.router.push(`/course/${e.id}/chapters`)}," 章節管理 ",8,vt),t("button",{class:"btn btn-sm btn-outline-danger",onClick:c=>a.handleDelete(e.id)}," 刪除 ",8,mt)])]))),128))])])])])])])])]),f(g)])]),a.loading?(l(),U(y,{key:0})):j("",!0)],64)}const ft=V(G,[["render",bt],["__scopeId","data-v-bede28f4"]]);export{ft as default};
