import{_ as w,p as x,u as S,r as d,i as F,j as m,o as h,c as v,k as b,b as a,t as u,d as L,e as y,g as T,v as D}from"./index-9daaab36.js";import{F as M,N,_ as A,a as k}from"./sidebar-a960fed0.js";import{C as H,U as I}from"./UploadAdapter-a785c227.js";const V={components:{Footer:M,Navbar:N,Sidebar:A},setup(){const f=x(),e=S(),g=d(null),t=e.params.courseId;e.params.chapterId;const c=d(!1),r=d({title:"",description:"",status:"",pdf_file_url:null}),_=async()=>{c.value=!0;try{await k.createChapter(t,r.value),f.push(`/course/${e.params.courseId}/chapters`)}catch(o){console.error("保存章節失敗:",o),alert("保存章節失敗")}finally{c.value=!1}},i=d(!1),l=d(""),s=async o=>{const n=o.target.files[0];if(n&&n.type==="application/pdf")try{i.value=!0,l.value="PDF上傳中...";const p=await k.chapterPDFUpload(n);p.status&&(r.value.pdf_file_url=p.content,l.value="")}catch(p){l.value="PDF上傳失敗："+p.message,o.target.value=""}finally{i.value=!1,setTimeout(()=>{l.value=""},3e3)}else l.value="請上傳PDF格式的檔案",o.target.value=""},C=()=>{r.value.pdf_file_url=null},P=()=>{f.push(`/course/${t}/chapters`)};F(async()=>{g.value=await H.create(document.querySelector("#editor"),{removePlugins:["Markdown"],extraPlugins:[U],toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","blockQuote","imageUpload"],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"}]}}).then(o=>(o.model.document.on("change:data",()=>{r.value.description=o.getData()}),o)).catch(o=>{console.error(o)})});function U(o){o.plugins.get("FileRepository").createUploadAdapter=n=>new I(n)}return{chapter:r,isUploading:i,isLoading:c,saveChapter:_,handlePdfUpload:s,removePdf:C,route:e,uploadStatusText:l,backToChapterList:P}}},B={class:"main-wrapper"},R={class:"page-wrapper"},q={class:"page-content"},E={class:"row"},j={class:"col-md-12 grid-margin stretch-card"},Q={class:"card"},z={class:"card-body"},G={class:"card-title"},J={class:"mb-3"},K={class:"mb-3"},O=["innerHTML"],W={class:"mb-3"},X={key:0,class:"mt-2"},Y=["href"],Z={key:1,class:"text-muted mt-2"},$={class:"mb-3"},ee=["disabled"];function te(f,e,g,t,c,r){const _=m("Sidebar"),i=m("Navbar"),l=m("Footer");return h(),v("div",B,[b(_),a("div",R,[b(i),a("div",q,[a("div",E,[a("div",j,[a("div",Q,[a("div",z,[a("h6",G,u(t.route.params.chapterId?"編輯章節":"新增章節"),1),a("form",{onSubmit:e[5]||(e[5]=L((...s)=>t.saveChapter&&t.saveChapter(...s),["prevent"]))},[a("div",J,[e[6]||(e[6]=a("label",{for:"title",class:"form-label"},"章節標題",-1)),y(a("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[0]||(e[0]=s=>t.chapter.title=s),required:""},null,512),[[T,t.chapter.title]])]),a("div",K,[e[7]||(e[7]=a("label",{for:"editor",class:"form-label"},"章節內容",-1)),a("div",{id:"editor",innerHTML:t.chapter.description},null,8,O)]),a("div",W,[e[8]||(e[8]=a("label",{class:"form-label"},"PDF檔案",-1)),a("input",{type:"file",class:"form-control",accept:".pdf",onChange:e[1]||(e[1]=(...s)=>t.handlePdfUpload&&t.handlePdfUpload(...s))},null,32),t.chapter.pdf_file_url&&!t.uploadStatusText?(h(),v("div",X,[a("a",{href:t.chapter.pdf_file_url,target:"_blank"},"上傳檔案："+u(typeof t.chapter.pdf_file_url=="string"?t.chapter.pdf_file_url.split("/").pop():t.chapter.pdf_file_url.name),9,Y),a("button",{type:"button",class:"btn btn-danger btn-sm ms-2",onClick:e[2]||(e[2]=(...s)=>t.removePdf&&t.removePdf(...s))}," 移除 ")])):(h(),v("div",Z,u(t.uploadStatusText),1))]),a("div",$,[e[10]||(e[10]=a("label",{for:"status",class:"form-label"},"狀態",-1)),y(a("select",{class:"form-select",id:"status","onUpdate:modelValue":e[3]||(e[3]=s=>t.chapter.status=s)},e[9]||(e[9]=[a("option",{value:"publish"},"顯示",-1),a("option",{value:"unpublish"},"隱藏",-1)]),512),[[D,t.chapter.status]])]),a("button",{type:"submit",class:"btn btn-primary me-2",disabled:t.isLoading||t.isUploading},u(t.isLoading?"儲存中...":"儲存"),9,ee),a("button",{type:"button",class:"btn btn-secondary",onClick:e[4]||(e[4]=s=>t.backToChapterList())}," 取消 ")],32)])])])])]),b(l)])])}const le=w(V,[["render",te],["__scopeId","data-v-e58b67e9"]]);export{le as default};
