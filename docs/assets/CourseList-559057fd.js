import{_ as V,r,i as E,p as T,u as B,j as m,o,c as i,k as p,b as t,e as w,g as L,v as F,F as g,f as y,y as M,t as d,l as Q,n as U}from"./index-6761c57d.js";import{F as j,N as z,_ as I,a as D}from"./sidebar-38b40803.js";const O={components:{Footer:j,Navbar:z,Sidebar:I},setup(){const u=r([]),s=r(!0),f=r([]),a=async()=>{try{const l=await D.getTagsOption("category");f.value=l}catch(l){console.error("獲取分類失敗:",l)}};E(()=>{e(),a()});const S=async()=>{s.value=!0,await e(),s.value=!1},C=T();B();const _=r(""),v=r(""),b=r(""),h=r([{label:"已上架",value:"publish"},{label:"未上架",value:"draft"},{label:"審核中",value:"pending"}]),e=async()=>{try{const l={category_id:v.value,status:b.value,search:_.value,pageSize:99},k=await D.getCourses(l);u.value=k.courses.map(n=>{var x;return{id:n.id,title:n.title,tags:n.tags,category:n.categories[0]||"",instructor:n.instructors.join(","),status_raw:n.status,status:((x=h.value.find(N=>N.value===n.status))==null?void 0:x.label)||n.status,publishDate:new Date(n.created_at).toISOString().split("T")[0]}})}catch(l){console.error("获取课程失败:",l)}finally{s.value=!1}};return{courses:u,router:C,searchQuery:_,selectedCategory:v,selectedStatus:b,statuses:h,handleFilter:S,handleEdit:l=>{C.push(`/course/edit/${l}`)},handleDelete:l=>{confirm("確定要刪除此課程嗎？")&&(u.value=u.value.filter(k=>k.id!==l))},loading:s,categories:f}}},R={class:"main-wrapper"},q={class:"page-wrapper"},A={class:"page-content"},G={class:"row mb-3"},H={class:"col-md-12"},J={class:"card"},K={class:"card-body"},P={class:"row align-items-center"},W={class:"col-md-3"},X={class:"col-md-3"},Y=["value"],Z={class:"col-md-3"},$=["value"],tt={class:"col-md-2"},et=["disabled"],st={class:"row"},at={class:"col-md-12 grid-margin stretch-card"},lt={class:"card"},nt={class:"card-body"},ot={class:"table-responsive"},it={class:"table table-hover"},dt=["onClick"],rt=["onClick"],ct=["onClick"];function ut(u,s,f,a,S,C){const _=m("Sidebar"),v=m("Navbar"),b=m("router-link"),h=m("Footer");return o(),i("div",R,[p(_),t("div",q,[p(v),t("div",A,[t("div",G,[t("div",H,[t("div",J,[t("div",K,[t("div",P,[t("div",W,[w(t("input",{type:"text",class:"form-control","onUpdate:modelValue":s[0]||(s[0]=e=>a.searchQuery=e),placeholder:"搜尋課程名稱或講師"},null,512),[[L,a.searchQuery]])]),t("div",X,[w(t("select",{class:"form-select","onUpdate:modelValue":s[1]||(s[1]=e=>a.selectedCategory=e)},[s[4]||(s[4]=t("option",{value:""},"所有分類",-1)),(o(!0),i(g,null,y(a.categories,e=>(o(),i("option",{key:e.id,value:e.id},d(e.name),9,Y))),128))],512),[[F,a.selectedCategory]])]),t("div",Z,[w(t("select",{class:"form-select","onUpdate:modelValue":s[2]||(s[2]=e=>a.selectedStatus=e)},[s[5]||(s[5]=t("option",{value:""},"所有狀態",-1)),(o(!0),i(g,null,y(a.statuses,e=>(o(),i("option",{key:e.value,value:e.value},d(e.label),9,$))),128))],512),[[F,a.selectedStatus]])]),t("div",tt,[t("button",{class:"btn btn-primary mx-2",onClick:s[3]||(s[3]=(...e)=>a.handleFilter&&a.handleFilter(...e)),disabled:a.loading}," 篩選 ",8,et),p(b,{to:"/course/add",class:"btn btn-secondary"},{default:M(()=>s[6]||(s[6]=[Q(" 新增課程 ")])),_:1})])])])])])]),t("div",st,[t("div",at,[t("div",lt,[t("div",nt,[t("div",ot,[t("table",it,[s[7]||(s[7]=t("thead",null,[t("tr",null,[t("th",null,"課程名稱"),t("th",null,"上架時間"),t("th",null,"講師"),t("th",null,"分類"),t("th",null,"標籤"),t("th",null,"狀態"),t("th",null,"操作")])],-1)),t("tbody",null,[(o(!0),i(g,null,y(a.courses,e=>(o(),i("tr",{key:e.id},[t("td",null,d(e.title),1),t("td",null,d(e.publishDate),1),t("td",null,d(e.instructor),1),t("td",null,d(e.category),1),t("td",null,[(o(!0),i(g,null,y(e.tags,c=>(o(),i("span",{key:c,class:"badge bg-primary me-1"},d(c),1))),128))]),t("td",null,[t("span",{class:U(["badge",{"bg-success":e.status==="已上架","bg-warning":e.status==="審核中","bg-secondary":e.status==="未上架"}])},d(e.status),3)]),t("td",null,[t("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:c=>a.handleEdit(e.id)}," 編輯 ",8,dt),t("button",{class:"btn btn-sm btn-outline-info me-2",onClick:c=>a.router.push(`/course/${e.id}/chapters`)}," 章節管理 ",8,rt),t("button",{class:"btn btn-sm btn-outline-danger",onClick:c=>a.handleDelete(e.id)}," 刪除 ",8,ct)])]))),128))])])])])])])])]),p(h)])])}const ht=V(O,[["render",ut],["__scopeId","data-v-81153034"]]);export{ht as default};
