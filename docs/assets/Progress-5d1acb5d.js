import{_ as j,p as M,u as O,r as n,H as B,i as Q,w as E,j as b,o as l,c as i,k,b as t,e as T,g as U,v as H,F as S,f as P,l as p,t as r,a as x,n as C,d as h}from"./index-d33ba55e.js";import{F as I,N as L,_ as q,a as z}from"./sidebar-0183ccb3.js";const A={components:{Footer:I,Navbar:L,Sidebar:q},setup(){const F=M();O();const e=n([]),v=n(1),o=n(10),g=n(""),m=n(""),y=B(()=>[...new Set(e.value.map(a=>a.category))]),c=n(""),d=n("asc"),s=async a=>{await f(a)},f=async a=>{c.value===a?d.value=d.value==="asc"?"desc":"asc":(c.value=a,d.value="asc"),await _()},V=async()=>{try{const a={category_id:m.value,status:"",search:g.value,sort_field:c.value,sort_order:d.value};await z.downloadStatsExcel(a)}catch(a){console.error("下載報表失敗:",a)}},R=n(1),N=n(!1),D=n(0),_=async()=>{N.value=!0;try{const a={category_id:m.value,status:"",search:g.value,page:v.value,pageSize:o.value,sort_field:c.value,sort_order:d.value},w=await z.getStats(a);e.value=w.courses.map(u=>({id:u.id,name:u.title,instructor:u.instructors.join(", "),category:u.categories.join(", "),completionRate:u.completion_rate,averageScore:u.average_score,students_count:u.student_count})),D.value=w.total,R.value=w.totalPages}catch(a){console.error("獲取統計數據失敗:",a)}finally{N.value=!1}};return Q(()=>{_()}),E([g,m],()=>{v.value=1,_()}),{courses:e,categories:y,searchQuery:g,selectedCategory:m,viewDetails:a=>{F.push(`/statistics/course-report/${a}`)},currentPage:v,totalPages:R,goToPage:a=>{v.value=a,_()},toggleSort:s,sortField:c,sortOrder:d,exportReport:V}}},G={class:"main-wrapper"},J={class:"page-wrapper"},K={class:"page-content"},W={class:"row"},X={class:"col-md-12 grid-margin stretch-card"},Y={class:"card"},Z={class:"card-body"},$={class:"row mb-3"},tt={class:"col-md-6"},et={class:"col-md-3"},ot=["value"],st={class:"col-md-3 text-end"},at={class:"table-responsive"},rt={class:"table table-hover"},nt={key:0,class:"material-icons align-middle",style:{"font-size":"16px"}},lt={key:0,class:"material-icons align-middle",style:{"font-size":"16px"}},it={key:0,class:"material-icons align-middle",style:{"font-size":"16px"}},dt=["onClick"],ct={class:"d-flex justify-content-center mt-4"},ut={class:"pagination"},vt=["onClick"];function gt(F,e,v,o,g,m){const y=b("Sidebar"),c=b("Navbar"),d=b("Footer");return l(),i("div",G,[k(y),t("div",J,[k(c),t("div",K,[t("div",W,[t("div",X,[t("div",Y,[t("div",Z,[e[17]||(e[17]=t("h6",{class:"card-title"},"學習進度統計",-1)),t("div",$,[t("div",tt,[T(t("input",{type:"text",class:"form-control","onUpdate:modelValue":e[0]||(e[0]=s=>o.searchQuery=s),placeholder:"搜尋課程名稱或講師..."},null,512),[[U,o.searchQuery]])]),t("div",et,[T(t("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=s=>o.selectedCategory=s)},[e[8]||(e[8]=t("option",{value:""},"所有分類",-1)),(l(!0),i(S,null,P(o.categories,s=>(l(),i("option",{key:s,value:s},r(s),9,ot))),128))],512),[[H,o.selectedCategory]])]),t("div",st,[t("button",{class:"btn btn-primary",onClick:e[2]||(e[2]=(...s)=>o.exportReport&&o.exportReport(...s))},e[9]||(e[9]=[t("i",{class:"material-icons align-middle me-1"},"file_download",-1),p(" 匯出報表 ")]))])]),t("div",at,[t("table",rt,[t("thead",null,[t("tr",null,[e[13]||(e[13]=t("th",null,"課程名稱",-1)),e[14]||(e[14]=t("th",null,"課程講師",-1)),e[15]||(e[15]=t("th",null,"分類",-1)),t("th",{onClick:e[3]||(e[3]=s=>o.toggleSort("completionRate")),style:{cursor:"pointer"}},[e[10]||(e[10]=p(" 完課率 ")),o.sortField==="completionRate"?(l(),i("i",nt,r(o.sortOrder==="asc"?"arrow_upward":"arrow_downward"),1)):x("",!0)]),t("th",{onClick:e[4]||(e[4]=s=>o.toggleSort("averageScore")),style:{cursor:"pointer"}},[e[11]||(e[11]=p(" 平均分數 ")),o.sortField==="averageScore"?(l(),i("i",lt,r(o.sortOrder==="asc"?"arrow_upward":"arrow_downward"),1)):x("",!0)]),t("th",{onClick:e[5]||(e[5]=s=>o.toggleSort("students_count")),style:{cursor:"pointer"}},[e[12]||(e[12]=p(" 上課人數 ")),o.sortField==="students_count"?(l(),i("i",it,r(o.sortOrder==="asc"?"arrow_upward":"arrow_downward"),1)):x("",!0)]),e[16]||(e[16]=t("th",null,"操作",-1))])]),t("tbody",null,[(l(!0),i(S,null,P(o.courses,s=>(l(),i("tr",{key:s.id},[t("td",null,r(s.name),1),t("td",null,r(s.instructor),1),t("td",null,r(s.category),1),t("td",null,r(s.completionRate)+"%",1),t("td",null,r(s.averageScore)+"分",1),t("td",null,r(s.students_count)+"人",1),t("td",null,[t("button",{class:"btn btn-primary btn-sm",onClick:f=>o.viewDetails(s.id)}," 檢視詳細 ",8,dt)])]))),128))])])]),t("div",ct,[t("nav",null,[t("ul",ut,[t("li",{class:C(["page-item",{disabled:o.currentPage===1}])},[t("a",{class:"page-link",href:"#",onClick:e[6]||(e[6]=h(s=>o.goToPage(o.currentPage-1),["prevent"]))}," 上一頁 ")],2),(l(!0),i(S,null,P(o.totalPages,s=>(l(),i("li",{key:s,class:C(["page-item",{active:o.currentPage===s}])},[t("a",{class:"page-link",href:"#",onClick:h(f=>o.goToPage(s),["prevent"])},r(s),9,vt)],2))),128)),t("li",{class:C(["page-item",{disabled:o.currentPage===o.totalPages}])},[t("a",{class:"page-link",href:"#",onClick:e[7]||(e[7]=h(s=>o.goToPage(o.currentPage+1),["prevent"]))}," 下一頁 ")],2)])])])])])])])]),k(d)])])}const ft=j(A,[["render",gt],["__scopeId","data-v-2ffa00fc"]]);export{ft as default};
