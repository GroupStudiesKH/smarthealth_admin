import{A as Wt,B as Ke,_ as Jt,p as Qt,u as er,r as K,i as tr,j as me,o as N,c as H,k as ve,b as _,a as ge,l as Oe,t as Xe,F as rr,f as nr,n as or,d as ir,e as ke,g as Re,y as ar,C as lr}from"./index-adc0a2d3.js";import{F as sr,N as ur,_ as fr,a as J}from"./sidebar-d8222704.js";import{C as cr,U as pr}from"./UploadAdapter-ad657ee3.js";function ne(t){"@babel/helpers - typeof";return ne=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ne(t)}function Ye(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,dr(r.key),r)}}function hr(t,e,n){return e&&Ye(t.prototype,e),n&&Ye(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function dr(t){var e=yr(t,"string");return ne(e)=="symbol"?e:e+""}function yr(t,e){if(ne(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ne(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function mr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function vr(t,e,n){return e=fe(e),gr(t,ze()?Reflect.construct(e,n||[],fe(t).constructor):e.apply(t,n))}function gr(t,e){if(e&&(ne(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return br(t)}function br(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _r(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ue(t,e)}function Te(t){var e=typeof Map=="function"?new Map:void 0;return Te=function(r){if(r===null||!Sr(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(typeof e<"u"){if(e.has(r))return e.get(r);e.set(r,o)}function o(){return wr(r,arguments,fe(this).constructor)}return o.prototype=Object.create(r.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),ue(o,r)},Te(t)}function wr(t,e,n){if(ze())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,e);var o=new(t.bind.apply(t,r));return n&&ue(o,n.prototype),o}function ze(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(ze=function(){return!!t})()}function Sr(t){try{return Function.toString.call(t).indexOf("[native code]")!==-1}catch{return typeof t=="function"}}function ue(t,e){return ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},ue(t,e)}function fe(t){return fe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},fe(t)}var be=function(t){function e(n){var r,o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,l=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,u=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(mr(this,e),r=vr(this,e,[n]),r.originalRequest=l,r.originalResponse=u,r.causingError=o,o!=null&&(n+=", caused by ".concat(o.toString())),l!=null){var c=l.getHeader("X-Request-ID")||"n/a",f=l.getMethod(),y=l.getURL(),v=u?u.getStatus():"n/a",m=u?u.getBody()||"":"n/a";n+=", originated from request (method: ".concat(f,", url: ").concat(y,", response code: ").concat(v,", response text: ").concat(m,", request id: ").concat(c,")")}return r.message=n,r}return _r(e,t),hr(e)}(Te(Error));function ce(t){"@babel/helpers - typeof";return ce=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ce(t)}function Ur(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ze(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Pr(r.key),r)}}function xr(t,e,n){return e&&Ze(t.prototype,e),n&&Ze(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Pr(t){var e=Er(t,"string");return ce(e)=="symbol"?e:e+""}function Er(t,e){if(ce(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ce(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Or=function(){function t(){Ur(this,t)}return xr(t,[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(n){return Promise.resolve([])}},{key:"removeUpload",value:function(n){return Promise.resolve()}},{key:"addUpload",value:function(n,r){return Promise.resolve(null)}}])}();const Et="3.7.7",kr=Et,ie=typeof Buffer=="function",We=typeof TextDecoder=="function"?new TextDecoder:void 0,Je=typeof TextEncoder=="function"?new TextEncoder:void 0,Rr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",le=Array.prototype.slice.call(Rr),_e=(t=>{let e={};return t.forEach((n,r)=>e[n]=r),e})(le),jr=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,j=String.fromCharCode.bind(String),Qe=typeof Uint8Array.from=="function"?Uint8Array.from.bind(Uint8Array):t=>new Uint8Array(Array.prototype.slice.call(t,0)),Ot=t=>t.replace(/=/g,"").replace(/[+\/]/g,e=>e=="+"?"-":"_"),kt=t=>t.replace(/[^A-Za-z0-9\+\/]/g,""),Rt=t=>{let e,n,r,o,l="";const u=t.length%3;for(let c=0;c<t.length;){if((n=t.charCodeAt(c++))>255||(r=t.charCodeAt(c++))>255||(o=t.charCodeAt(c++))>255)throw new TypeError("invalid character found");e=n<<16|r<<8|o,l+=le[e>>18&63]+le[e>>12&63]+le[e>>6&63]+le[e&63]}return u?l.slice(0,u-3)+"===".substring(u):l},Be=typeof btoa=="function"?t=>btoa(t):ie?t=>Buffer.from(t,"binary").toString("base64"):Rt,Ce=ie?t=>Buffer.from(t).toString("base64"):t=>{let n=[];for(let r=0,o=t.length;r<o;r+=4096)n.push(j.apply(null,t.subarray(r,r+4096)));return Be(n.join(""))},we=(t,e=!1)=>e?Ot(Ce(t)):Ce(t),Tr=t=>{if(t.length<2){var e=t.charCodeAt(0);return e<128?t:e<2048?j(192|e>>>6)+j(128|e&63):j(224|e>>>12&15)+j(128|e>>>6&63)+j(128|e&63)}else{var e=65536+(t.charCodeAt(0)-55296)*1024+(t.charCodeAt(1)-56320);return j(240|e>>>18&7)+j(128|e>>>12&63)+j(128|e>>>6&63)+j(128|e&63)}},Cr=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,jt=t=>t.replace(Cr,Tr),et=ie?t=>Buffer.from(t,"utf8").toString("base64"):Je?t=>Ce(Je.encode(t)):t=>Be(jt(t)),re=(t,e=!1)=>e?Ot(et(t)):et(t),tt=t=>re(t,!0),Lr=/[\xC0-\xDF][\x80-\xBF]|[\xE0-\xEF][\x80-\xBF]{2}|[\xF0-\xF7][\x80-\xBF]{3}/g,Ar=t=>{switch(t.length){case 4:var e=(7&t.charCodeAt(0))<<18|(63&t.charCodeAt(1))<<12|(63&t.charCodeAt(2))<<6|63&t.charCodeAt(3),n=e-65536;return j((n>>>10)+55296)+j((n&1023)+56320);case 3:return j((15&t.charCodeAt(0))<<12|(63&t.charCodeAt(1))<<6|63&t.charCodeAt(2));default:return j((31&t.charCodeAt(0))<<6|63&t.charCodeAt(1))}},Tt=t=>t.replace(Lr,Ar),Ct=t=>{if(t=t.replace(/\s+/g,""),!jr.test(t))throw new TypeError("malformed base64.");t+="==".slice(2-(t.length&3));let e,n="",r,o;for(let l=0;l<t.length;)e=_e[t.charAt(l++)]<<18|_e[t.charAt(l++)]<<12|(r=_e[t.charAt(l++)])<<6|(o=_e[t.charAt(l++)]),n+=r===64?j(e>>16&255):o===64?j(e>>16&255,e>>8&255):j(e>>16&255,e>>8&255,e&255);return n},qe=typeof atob=="function"?t=>atob(kt(t)):ie?t=>Buffer.from(t,"base64").toString("binary"):Ct,Lt=ie?t=>Qe(Buffer.from(t,"base64")):t=>Qe(qe(t).split("").map(e=>e.charCodeAt(0))),At=t=>Lt(It(t)),Ir=ie?t=>Buffer.from(t,"base64").toString("utf8"):We?t=>We.decode(Lt(t)):t=>Tt(qe(t)),It=t=>kt(t.replace(/[-_]/g,e=>e=="-"?"+":"/")),Le=t=>Ir(It(t)),Dr=t=>{if(typeof t!="string")return!1;const e=t.replace(/\s+/g,"").replace(/={0,2}$/,"");return!/[^\s0-9a-zA-Z\+/]/.test(e)||!/[^\s0-9a-zA-Z\-_]/.test(e)},Dt=t=>({value:t,enumerable:!1,writable:!0,configurable:!0}),Ft=function(){const t=(e,n)=>Object.defineProperty(String.prototype,e,Dt(n));t("fromBase64",function(){return Le(this)}),t("toBase64",function(e){return re(this,e)}),t("toBase64URI",function(){return re(this,!0)}),t("toBase64URL",function(){return re(this,!0)}),t("toUint8Array",function(){return At(this)})},Nt=function(){const t=(e,n)=>Object.defineProperty(Uint8Array.prototype,e,Dt(n));t("toBase64",function(e){return we(this,e)}),t("toBase64URI",function(){return we(this,!0)}),t("toBase64URL",function(){return we(this,!0)})},Fr=()=>{Ft(),Nt()},Nr={version:Et,VERSION:kr,atob:qe,atobPolyfill:Ct,btoa:Be,btoaPolyfill:Rt,fromBase64:Le,toBase64:re,encode:re,encodeURI:tt,encodeURL:tt,utob:jt,btou:Tt,decode:Le,isValid:Dr,fromUint8Array:we,toUint8Array:At,extendString:Ft,extendUint8Array:Nt,extendBuiltins:Fr};var Hr=function(e,n){if(n=n.split(":")[0],e=+e,!e)return!1;switch(n){case"http":case"ws":return e!==80;case"https":case"wss":return e!==443;case"ftp":return e!==21;case"gopher":return e!==70;case"file":return!1}return e!==0},$e={},zr=Object.prototype.hasOwnProperty,Br;function rt(t){try{return decodeURIComponent(t.replace(/\+/g," "))}catch{return null}}function nt(t){try{return encodeURIComponent(t)}catch{return null}}function qr(t){for(var e=/([^=?#&]+)=?([^&]*)/g,n={},r;r=e.exec(t);){var o=rt(r[1]),l=rt(r[2]);o===null||l===null||o in n||(n[o]=l)}return n}function $r(t,e){e=e||"";var n=[],r,o;typeof e!="string"&&(e="?");for(o in t)if(zr.call(t,o)){if(r=t[o],!r&&(r===null||r===Br||isNaN(r))&&(r=""),o=nt(o),r=nt(r),o===null||r===null)continue;n.push(o+"="+r)}return n.length?e+n.join("&"):""}$e.stringify=$r;$e.parse=qr;var Ht=Hr,Ee=$e,Mr=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,zt=/[\n\r\t]/g,Vr=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,Bt=/:\d+$/,Gr=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,Kr=/^[a-zA-Z]:/;function Me(t){return(t||"").toString().replace(Mr,"")}var Ae=[["#","hash"],["?","query"],function(e,n){return B(n.protocol)?e.replace(/\\/g,"/"):e},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ot={hash:1,query:1};function qt(t){var e;typeof window<"u"?e=window:typeof Ke<"u"?e=Ke:typeof self<"u"?e=self:e={};var n=e.location||{};t=t||n;var r={},o=typeof t,l;if(t.protocol==="blob:")r=new q(unescape(t.pathname),{});else if(o==="string"){r=new q(t,{});for(l in ot)delete r[l]}else if(o==="object"){for(l in t)l in ot||(r[l]=t[l]);r.slashes===void 0&&(r.slashes=Vr.test(t.href))}return r}function B(t){return t==="file:"||t==="ftp:"||t==="http:"||t==="https:"||t==="ws:"||t==="wss:"}function $t(t,e){t=Me(t),t=t.replace(zt,""),e=e||{};var n=Gr.exec(t),r=n[1]?n[1].toLowerCase():"",o=!!n[2],l=!!n[3],u=0,c;return o?l?(c=n[2]+n[3]+n[4],u=n[2].length+n[3].length):(c=n[2]+n[4],u=n[2].length):l?(c=n[3]+n[4],u=n[3].length):c=n[4],r==="file:"?u>=2&&(c=c.slice(2)):B(r)?c=n[4]:r?o&&(c=c.slice(2)):u>=2&&B(e.protocol)&&(c=n[4]),{protocol:r,slashes:o||B(r),slashesCount:u,rest:c}}function Xr(t,e){if(t==="")return e;for(var n=(e||"/").split("/").slice(0,-1).concat(t.split("/")),r=n.length,o=n[r-1],l=!1,u=0;r--;)n[r]==="."?n.splice(r,1):n[r]===".."?(n.splice(r,1),u++):u&&(r===0&&(l=!0),n.splice(r,1),u--);return l&&n.unshift(""),(o==="."||o==="..")&&n.push(""),n.join("/")}function q(t,e,n){if(t=Me(t),t=t.replace(zt,""),!(this instanceof q))return new q(t,e,n);var r,o,l,u,c,f,y=Ae.slice(),v=typeof e,m=this,E=0;for(v!=="object"&&v!=="string"&&(n=e,e=null),n&&typeof n!="function"&&(n=Ee.parse),e=qt(e),o=$t(t||"",e),r=!o.protocol&&!o.slashes,m.slashes=o.slashes||r&&e.slashes,m.protocol=o.protocol||e.protocol||"",t=o.rest,(o.protocol==="file:"&&(o.slashesCount!==2||Kr.test(t))||!o.slashes&&(o.protocol||o.slashesCount<2||!B(m.protocol)))&&(y[3]=[/(.*)/,"pathname"]);E<y.length;E++){if(u=y[E],typeof u=="function"){t=u(t,m);continue}l=u[0],f=u[1],l!==l?m[f]=t:typeof l=="string"?(c=l==="@"?t.lastIndexOf(l):t.indexOf(l),~c&&(typeof u[2]=="number"?(m[f]=t.slice(0,c),t=t.slice(c+u[2])):(m[f]=t.slice(c),t=t.slice(0,c)))):(c=l.exec(t))&&(m[f]=c[1],t=t.slice(0,c.index)),m[f]=m[f]||r&&u[3]&&e[f]||"",u[4]&&(m[f]=m[f].toLowerCase())}n&&(m.query=n(m.query)),r&&e.slashes&&m.pathname.charAt(0)!=="/"&&(m.pathname!==""||e.pathname!=="")&&(m.pathname=Xr(m.pathname,e.pathname)),m.pathname.charAt(0)!=="/"&&B(m.protocol)&&(m.pathname="/"+m.pathname),Ht(m.port,m.protocol)||(m.host=m.hostname,m.port=""),m.username=m.password="",m.auth&&(c=m.auth.indexOf(":"),~c?(m.username=m.auth.slice(0,c),m.username=encodeURIComponent(decodeURIComponent(m.username)),m.password=m.auth.slice(c+1),m.password=encodeURIComponent(decodeURIComponent(m.password))):m.username=encodeURIComponent(decodeURIComponent(m.auth)),m.auth=m.password?m.username+":"+m.password:m.username),m.origin=m.protocol!=="file:"&&B(m.protocol)&&m.host?m.protocol+"//"+m.host:"null",m.href=m.toString()}function Yr(t,e,n){var r=this;switch(t){case"query":typeof e=="string"&&e.length&&(e=(n||Ee.parse)(e)),r[t]=e;break;case"port":r[t]=e,Ht(e,r.protocol)?e&&(r.host=r.hostname+":"+e):(r.host=r.hostname,r[t]="");break;case"hostname":r[t]=e,r.port&&(e+=":"+r.port),r.host=e;break;case"host":r[t]=e,Bt.test(e)?(e=e.split(":"),r.port=e.pop(),r.hostname=e.join(":")):(r.hostname=e,r.port="");break;case"protocol":r.protocol=e.toLowerCase(),r.slashes=!n;break;case"pathname":case"hash":if(e){var o=t==="pathname"?"/":"#";r[t]=e.charAt(0)!==o?o+e:e}else r[t]=e;break;case"username":case"password":r[t]=encodeURIComponent(e);break;case"auth":var l=e.indexOf(":");~l?(r.username=e.slice(0,l),r.username=encodeURIComponent(decodeURIComponent(r.username)),r.password=e.slice(l+1),r.password=encodeURIComponent(decodeURIComponent(r.password))):r.username=encodeURIComponent(decodeURIComponent(e))}for(var u=0;u<Ae.length;u++){var c=Ae[u];c[4]&&(r[c[1]]=r[c[1]].toLowerCase())}return r.auth=r.password?r.username+":"+r.password:r.username,r.origin=r.protocol!=="file:"&&B(r.protocol)&&r.host?r.protocol+"//"+r.host:"null",r.href=r.toString(),r}function Zr(t){(!t||typeof t!="function")&&(t=Ee.stringify);var e,n=this,r=n.host,o=n.protocol;o&&o.charAt(o.length-1)!==":"&&(o+=":");var l=o+(n.protocol&&n.slashes||B(n.protocol)?"//":"");return n.username?(l+=n.username,n.password&&(l+=":"+n.password),l+="@"):n.password?(l+=":"+n.password,l+="@"):n.protocol!=="file:"&&B(n.protocol)&&!r&&n.pathname!=="/"&&(l+="@"),(r[r.length-1]===":"||Bt.test(n.hostname)&&!n.port)&&(r+=":"),l+=r+n.pathname,e=typeof n.query=="object"?t(n.query):n.query,e&&(l+=e.charAt(0)!=="?"?"?"+e:e),n.hash&&(l+=n.hash),l}q.prototype={set:Yr,toString:Zr};q.extractProtocol=$t;q.location=qt;q.trimLeft=Me;q.qs=Ee;var Wr=q;const Jr=Wt(Wr);function Qr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=Math.random()*16|0,n=t==="x"?e:e&3|8;return n.toString(16)})}function Ie(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Ie=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(s,i,a){s[i]=a.value},l=typeof Symbol=="function"?Symbol:{},u=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",f=l.toStringTag||"@@toStringTag";function y(s,i,a){return Object.defineProperty(s,i,{value:a,enumerable:!0,configurable:!0,writable:!0}),s[i]}try{y({},"")}catch{y=function(a,p,d){return a[p]=d}}function v(s,i,a,p){var d=i&&i.prototype instanceof T?i:T,h=Object.create(d.prototype),b=new G(p||[]);return o(h,"_invoke",{value:z(s,a,b)}),h}function m(s,i,a){try{return{type:"normal",arg:s.call(i,a)}}catch(p){return{type:"throw",arg:p}}}e.wrap=v;var E="suspendedStart",X="suspendedYield",$="executing",I="completed",x={};function T(){}function O(){}function k(){}var A={};y(A,u,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(Y([])));F&&F!==n&&r.call(F,u)&&(A=F);var g=k.prototype=T.prototype=Object.create(A);function P(s){["next","throw","return"].forEach(function(i){y(s,i,function(a){return this._invoke(i,a)})})}function U(s,i){function a(d,h,b,w){var S=m(s[d],s,h);if(S.type!=="throw"){var C=S.arg,R=C.value;return R&&Z(R)=="object"&&r.call(R,"__await")?i.resolve(R.__await).then(function(L){a("next",L,b,w)},function(L){a("throw",L,b,w)}):i.resolve(R).then(function(L){C.value=L,b(C)},function(L){return a("throw",L,b,w)})}w(S.arg)}var p;o(this,"_invoke",{value:function(h,b){function w(){return new i(function(S,C){a(h,b,S,C)})}return p=p?p.then(w,w):w()}})}function z(s,i,a){var p=E;return function(d,h){if(p===$)throw Error("Generator is already running");if(p===I){if(d==="throw")throw h;return{value:t,done:!0}}for(a.method=d,a.arg=h;;){var b=a.delegate;if(b){var w=D(b,a);if(w){if(w===x)continue;return w}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(p===E)throw p=I,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);p=$;var S=m(s,i,a);if(S.type==="normal"){if(p=a.done?I:X,S.arg===x)continue;return{value:S.arg,done:a.done}}S.type==="throw"&&(p=I,a.method="throw",a.arg=S.arg)}}}function D(s,i){var a=i.method,p=s.iterator[a];if(p===t)return i.delegate=null,a==="throw"&&s.iterator.return&&(i.method="return",i.arg=t,D(s,i),i.method==="throw")||a!=="return"&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+a+"' method")),x;var d=m(p,s.iterator,i.arg);if(d.type==="throw")return i.method="throw",i.arg=d.arg,i.delegate=null,x;var h=d.arg;return h?h.done?(i[s.resultName]=h.value,i.next=s.nextLoc,i.method!=="return"&&(i.method="next",i.arg=t),i.delegate=null,x):h:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,x)}function ae(s){var i={tryLoc:s[0]};1 in s&&(i.catchLoc=s[1]),2 in s&&(i.finallyLoc=s[2],i.afterLoc=s[3]),this.tryEntries.push(i)}function V(s){var i=s.completion||{};i.type="normal",delete i.arg,s.completion=i}function G(s){this.tryEntries=[{tryLoc:"root"}],s.forEach(ae,this),this.reset(!0)}function Y(s){if(s||s===""){var i=s[u];if(i)return i.call(s);if(typeof s.next=="function")return s;if(!isNaN(s.length)){var a=-1,p=function d(){for(;++a<s.length;)if(r.call(s,a))return d.value=s[a],d.done=!1,d;return d.value=t,d.done=!0,d};return p.next=p}}throw new TypeError(Z(s)+" is not iterable")}return O.prototype=k,o(g,"constructor",{value:k,configurable:!0}),o(k,"constructor",{value:O,configurable:!0}),O.displayName=y(k,f,"GeneratorFunction"),e.isGeneratorFunction=function(s){var i=typeof s=="function"&&s.constructor;return!!i&&(i===O||(i.displayName||i.name)==="GeneratorFunction")},e.mark=function(s){return Object.setPrototypeOf?Object.setPrototypeOf(s,k):(s.__proto__=k,y(s,f,"GeneratorFunction")),s.prototype=Object.create(g),s},e.awrap=function(s){return{__await:s}},P(U.prototype),y(U.prototype,c,function(){return this}),e.AsyncIterator=U,e.async=function(s,i,a,p,d){d===void 0&&(d=Promise);var h=new U(v(s,i,a,p),d);return e.isGeneratorFunction(i)?h:h.next().then(function(b){return b.done?b.value:h.next()})},P(g),y(g,f,"Generator"),y(g,u,function(){return this}),y(g,"toString",function(){return"[object Generator]"}),e.keys=function(s){var i=Object(s),a=[];for(var p in i)a.push(p);return a.reverse(),function d(){for(;a.length;){var h=a.pop();if(h in i)return d.value=h,d.done=!1,d}return d.done=!0,d}},e.values=Y,G.prototype={constructor:G,reset:function(i){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(V),!i)for(var a in this)a.charAt(0)==="t"&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=t)},stop:function(){this.done=!0;var i=this.tryEntries[0].completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var a=this;function p(C,R){return b.type="throw",b.arg=i,a.next=C,R&&(a.method="next",a.arg=t),!!R}for(var d=this.tryEntries.length-1;d>=0;--d){var h=this.tryEntries[d],b=h.completion;if(h.tryLoc==="root")return p("end");if(h.tryLoc<=this.prev){var w=r.call(h,"catchLoc"),S=r.call(h,"finallyLoc");if(w&&S){if(this.prev<h.catchLoc)return p(h.catchLoc,!0);if(this.prev<h.finallyLoc)return p(h.finallyLoc)}else if(w){if(this.prev<h.catchLoc)return p(h.catchLoc,!0)}else{if(!S)throw Error("try statement without catch or finally");if(this.prev<h.finallyLoc)return p(h.finallyLoc)}}}},abrupt:function(i,a){for(var p=this.tryEntries.length-1;p>=0;--p){var d=this.tryEntries[p];if(d.tryLoc<=this.prev&&r.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var h=d;break}}h&&(i==="break"||i==="continue")&&h.tryLoc<=a&&a<=h.finallyLoc&&(h=null);var b=h?h.completion:{};return b.type=i,b.arg=a,h?(this.method="next",this.next=h.finallyLoc,x):this.complete(b)},complete:function(i,a){if(i.type==="throw")throw i.arg;return i.type==="break"||i.type==="continue"?this.next=i.arg:i.type==="return"?(this.rval=this.arg=i.arg,this.method="return",this.next="end"):i.type==="normal"&&a&&(this.next=a),x},finish:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var p=this.tryEntries[a];if(p.finallyLoc===i)return this.complete(p.completion,p.afterLoc),V(p),x}},catch:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var p=this.tryEntries[a];if(p.tryLoc===i){var d=p.completion;if(d.type==="throw"){var h=d.arg;V(p)}return h}}throw Error("illegal catch attempt")},delegateYield:function(i,a,p){return this.delegate={iterator:Y(i),resultName:a,nextLoc:p},this.method==="next"&&(this.arg=t),x}},e}function it(t,e,n,r,o,l,u){try{var c=t[l](u),f=c.value}catch(y){n(y);return}c.done?e(f):Promise.resolve(f).then(r,o)}function en(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var l=t.apply(e,n);function u(f){it(l,r,o,u,c,"next",f)}function c(f){it(l,r,o,u,c,"throw",f)}u(void 0)})}}function Mt(t,e){return nn(t)||rn(t,e)||Vt(t,e)||tn()}function tn(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rn(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,o,l,u,c=[],f=!0,y=!1;try{if(l=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;f=!1}else for(;!(f=(r=l.call(n)).done)&&(c.push(r.value),c.length!==e);f=!0);}catch(v){y=!0,o=v}finally{try{if(!f&&n.return!=null&&(u=n.return(),Object(u)!==u))return}finally{if(y)throw o}}return c}}function nn(t){if(Array.isArray(t))return t}function Z(t){"@babel/helpers - typeof";return Z=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z(t)}function on(t,e){var n=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Vt(t))||e&&t&&typeof t.length=="number"){n&&(t=n);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(y){throw y},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var l=!0,u=!1,c;return{s:function(){n=n.call(t)},n:function(){var y=n.next();return l=y.done,y},e:function(y){u=!0,c=y},f:function(){try{!l&&n.return!=null&&n.return()}finally{if(u)throw c}}}}function Vt(t,e){if(t){if(typeof t=="string")return at(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return at(t,e)}}function at(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function lt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function Q(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?lt(Object(n),!0).forEach(function(r){an(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):lt(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function an(t,e,n){return e=Gt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function ln(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Gt(r.key),r)}}function sn(t,e,n){return e&&st(t.prototype,e),n&&st(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Gt(t){var e=un(t,"string");return Z(e)=="symbol"?e:e+""}function un(t,e){if(Z(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(Z(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Se="tus-v1",Ue="ietf-draft-03",se="ietf-draft-05",fn={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:Kt,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:Se},xe=function(){function t(e,n){ln(this,t),"resume"in n&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=n,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=e,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return sn(t,[{key:"findPreviousUploads",value:function(){var n=this;return this.options.fingerprint(this.file,this.options).then(function(r){return n._urlStorage.findUploadsByFingerprint(r)})}},{key:"resumeFromPreviousUpload",value:function(n){this.url=n.uploadUrl||null,this._parallelUploadUrls=n.parallelUploadUrls||null,this._urlStorageKey=n.urlStorageKey}},{key:"start",value:function(){var n=this,r=this.file;if(!r){this._emitError(new Error("tus: no file or stream to upload provided"));return}if(![Se,Ue,se].includes(this.options.protocol)){this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));return}if(!this.options.endpoint&&!this.options.uploadUrl&&!this.url){this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));return}var o=this.options.retryDelays;if(o!=null&&Object.prototype.toString.call(o)!=="[object Array]"){this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"));return}if(this.options.parallelUploads>1)for(var l=0,u=["uploadUrl","uploadSize","uploadLengthDeferred"];l<u.length;l++){var c=u[l];if(this.options[c]){this._emitError(new Error("tus: cannot use the ".concat(c," option when parallelUploads is enabled")));return}}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1){this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));return}if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length){this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"));return}}this.options.fingerprint(r,this.options).then(function(f){return n._fingerprint=f,n._source?n._source:n.options.fileReader.openFile(r,n.options.chunkSize)}).then(function(f){if(n._source=f,n.options.uploadLengthDeferred)n._size=null;else if(n.options.uploadSize!=null){if(n._size=Number(n.options.uploadSize),Number.isNaN(n._size)){n._emitError(new Error("tus: cannot convert `uploadSize` option into a number"));return}}else if(n._size=n._source.size,n._size==null){n._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));return}n.options.parallelUploads>1||n._parallelUploadUrls!=null?n._startParallelUpload():n._startSingleUpload()}).catch(function(f){n._emitError(f)})}},{key:"_startParallelUpload",value:function(){var n,r=this,o=this._size,l=0;this._parallelUploads=[];var u=this._parallelUploadUrls!=null?this._parallelUploadUrls.length:this.options.parallelUploads,c=(n=this.options.parallelUploadBoundaries)!==null&&n!==void 0?n:pn(this._source.size,u);this._parallelUploadUrls&&c.forEach(function(v,m){v.uploadUrl=r._parallelUploadUrls[m]||null}),this._parallelUploadUrls=new Array(c.length);var f=c.map(function(v,m){var E=0;return r._source.slice(v.start,v.end).then(function(X){var $=X.value;return new Promise(function(I,x){var T=Q(Q({},r.options),{},{uploadUrl:v.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:r.options.metadataForPartialUploads,headers:Q(Q({},r.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:I,onError:x,onProgress:function(A){l=l-E+A,E=A,r._emitProgress(l,o)},onUploadUrlAvailable:function(){r._parallelUploadUrls[m]=O.url,r._parallelUploadUrls.filter(function(A){return!!A}).length===c.length&&r._saveUploadInUrlStorage()}}),O=new t($,T);O.start(),r._parallelUploads.push(O)})})}),y;Promise.all(f).then(function(){y=r._openRequest("POST",r.options.endpoint),y.setHeader("Upload-Concat","final;".concat(r._parallelUploadUrls.join(" ")));var v=ut(r.options.metadata);return v!==""&&y.setHeader("Upload-Metadata",v),r._sendRequest(y,null)}).then(function(v){if(!ee(v.getStatus(),200)){r._emitHttpError(y,v,"tus: unexpected response while creating upload");return}var m=v.getHeader("Location");if(m==null){r._emitHttpError(y,v,"tus: invalid or missing Location header");return}r.url=ht(r.options.endpoint,m),"Created upload at ".concat(r.url),r._emitSuccess(v)}).catch(function(v){r._emitError(v)})}},{key:"_startSingleUpload",value:function(){if(this._aborted=!1,this.url!=null){"Resuming upload from previous URL: ".concat(this.url),this._resumeUpload();return}if(this.options.uploadUrl!=null){"Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,this._resumeUpload();return}this._createUpload()}},{key:"abort",value:function(n){var r=this;if(this._parallelUploads!=null){var o=on(this._parallelUploads),l;try{for(o.s();!(l=o.n()).done;){var u=l.value;u.abort(n)}}catch(c){o.e(c)}finally{o.f()}}return this._req!==null&&this._req.abort(),this._aborted=!0,this._retryTimeout!=null&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),!n||this.url==null?Promise.resolve():t.terminate(this.url,this.options).then(function(){return r._removeFromUrlStorage()})}},{key:"_emitHttpError",value:function(n,r,o,l){this._emitError(new be(o,l,n,r))}},{key:"_emitError",value:function(n){var r=this;if(!this._aborted){if(this.options.retryDelays!=null){var o=this._offset!=null&&this._offset>this._offsetBeforeRetry;if(o&&(this._retryAttempt=0),pt(n,this._retryAttempt,this.options)){var l=this.options.retryDelays[this._retryAttempt++];this._offsetBeforeRetry=this._offset,this._retryTimeout=setTimeout(function(){r.start()},l);return}}if(typeof this.options.onError=="function")this.options.onError(n);else throw n}}},{key:"_emitSuccess",value:function(n){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),typeof this.options.onSuccess=="function"&&this.options.onSuccess({lastResponse:n})}},{key:"_emitProgress",value:function(n,r){typeof this.options.onProgress=="function"&&this.options.onProgress(n,r)}},{key:"_emitChunkComplete",value:function(n,r,o){typeof this.options.onChunkComplete=="function"&&this.options.onChunkComplete(n,r,o)}},{key:"_createUpload",value:function(){var n=this;if(!this.options.endpoint){this._emitError(new Error("tus: unable to create upload because no endpoint is provided"));return}var r=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?r.setHeader("Upload-Defer-Length","1"):r.setHeader("Upload-Length","".concat(this._size));var o=ut(this.options.metadata);o!==""&&r.setHeader("Upload-Metadata",o);var l;this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,l=this._addChunkToRequest(r)):((this.options.protocol===Ue||this.options.protocol===se)&&r.setHeader("Upload-Complete","?0"),l=this._sendRequest(r,null)),l.then(function(u){if(!ee(u.getStatus(),200)){n._emitHttpError(r,u,"tus: unexpected response while creating upload");return}var c=u.getHeader("Location");if(c==null){n._emitHttpError(r,u,"tus: invalid or missing Location header");return}if(n.url=ht(n.options.endpoint,c),"Created upload at ".concat(n.url),typeof n.options.onUploadUrlAvailable=="function"&&n.options.onUploadUrlAvailable(),n._size===0){n._emitSuccess(u),n._source.close();return}n._saveUploadInUrlStorage().then(function(){n.options.uploadDataDuringCreation?n._handleUploadResponse(r,u):(n._offset=0,n._performUpload())})}).catch(function(u){n._emitHttpError(r,null,"tus: failed to create upload",u)})}},{key:"_resumeUpload",value:function(){var n=this,r=this._openRequest("HEAD",this.url),o=this._sendRequest(r,null);o.then(function(l){var u=l.getStatus();if(!ee(u,200)){if(u===423){n._emitHttpError(r,l,"tus: upload is currently locked; retry later");return}if(ee(u,400)&&n._removeFromUrlStorage(),!n.options.endpoint){n._emitHttpError(r,l,"tus: unable to resume upload (new upload cannot be created without an endpoint)");return}n.url=null,n._createUpload();return}var c=Number.parseInt(l.getHeader("Upload-Offset"),10);if(Number.isNaN(c)){n._emitHttpError(r,l,"tus: invalid or missing offset value");return}var f=Number.parseInt(l.getHeader("Upload-Length"),10);if(Number.isNaN(f)&&!n.options.uploadLengthDeferred&&n.options.protocol===Se){n._emitHttpError(r,l,"tus: invalid or missing length value");return}typeof n.options.onUploadUrlAvailable=="function"&&n.options.onUploadUrlAvailable(),n._saveUploadInUrlStorage().then(function(){if(c===f){n._emitProgress(f,f),n._emitSuccess(l);return}n._offset=c,n._performUpload()})}).catch(function(l){n._emitHttpError(r,null,"tus: failed to resume upload",l)})}},{key:"_performUpload",value:function(){var n=this;if(!this._aborted){var r;this.options.overridePatchMethod?(r=this._openRequest("POST",this.url),r.setHeader("X-HTTP-Method-Override","PATCH")):r=this._openRequest("PATCH",this.url),r.setHeader("Upload-Offset","".concat(this._offset));var o=this._addChunkToRequest(r);o.then(function(l){if(!ee(l.getStatus(),200)){n._emitHttpError(r,l,"tus: unexpected response while uploading chunk");return}n._handleUploadResponse(r,l)}).catch(function(l){n._aborted||n._emitHttpError(r,null,"tus: failed to upload chunk at offset ".concat(n._offset),l)})}}},{key:"_addChunkToRequest",value:function(n){var r=this,o=this._offset,l=this._offset+this.options.chunkSize;return n.setProgressHandler(function(u){r._emitProgress(o+u,r._size)}),this.options.protocol===Se?n.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===se&&n.setHeader("Content-Type","application/partial-upload"),(l===Number.POSITIVE_INFINITY||l>this._size)&&!this.options.uploadLengthDeferred&&(l=this._size),this._source.slice(o,l).then(function(u){var c=u.value,f=u.done,y=c!=null&&c.size?c.size:0;r.options.uploadLengthDeferred&&f&&(r._size=r._offset+y,n.setHeader("Upload-Length","".concat(r._size)));var v=r._offset+y;return!r.options.uploadLengthDeferred&&f&&v!==r._size?Promise.reject(new Error("upload was configured with a size of ".concat(r._size," bytes, but the source is done after ").concat(v," bytes"))):c===null?r._sendRequest(n):((r.options.protocol===Ue||r.options.protocol===se)&&n.setHeader("Upload-Complete",f?"?1":"?0"),r._emitProgress(r._offset,r._size),r._sendRequest(n,c))})}},{key:"_handleUploadResponse",value:function(n,r){var o=Number.parseInt(r.getHeader("Upload-Offset"),10);if(Number.isNaN(o)){this._emitHttpError(n,r,"tus: invalid or missing offset value");return}if(this._emitProgress(o,this._size),this._emitChunkComplete(o-this._offset,o,this._size),this._offset=o,o===this._size){this._emitSuccess(r),this._source.close();return}this._performUpload()}},{key:"_openRequest",value:function(n,r){var o=ft(n,r,this.options);return this._req=o,o}},{key:"_removeFromUrlStorage",value:function(){var n=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(r){n._emitError(r)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var n=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||this._urlStorageKey!==null)return Promise.resolve();var r={size:this._size,metadata:this.options.metadata,creationTime:new Date().toString()};return this._parallelUploads?r.parallelUploadUrls=this._parallelUploadUrls:r.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,r).then(function(o){n._urlStorageKey=o})}},{key:"_sendRequest",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null;return ct(n,r,this.options)}}],[{key:"terminate",value:function(n){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=ft("DELETE",n,r);return ct(o,null,r).then(function(l){if(l.getStatus()!==204)throw new be("tus: unexpected response while terminating upload",null,o,l)}).catch(function(l){if(l instanceof be||(l=new be("tus: failed to terminate upload",l,o,null)),!pt(l,0,r))throw l;var u=r.retryDelays[0],c=r.retryDelays.slice(1),f=Q(Q({},r),{},{retryDelays:c});return new Promise(function(y){return setTimeout(y,u)}).then(function(){return t.terminate(n,f)})})}}])}();function ut(t){return Object.entries(t).map(function(e){var n=Mt(e,2),r=n[0],o=n[1];return"".concat(r," ").concat(Nr.encode(String(o)))}).join(",")}function ee(t,e){return t>=e&&t<e+100}function ft(t,e,n){var r=n.httpStack.createRequest(t,e);n.protocol===Ue?r.setHeader("Upload-Draft-Interop-Version","5"):n.protocol===se?r.setHeader("Upload-Draft-Interop-Version","6"):r.setHeader("Tus-Resumable","1.0.0");for(var o=n.headers||{},l=0,u=Object.entries(o);l<u.length;l++){var c=Mt(u[l],2),f=c[0],y=c[1];r.setHeader(f,y)}if(n.addRequestId){var v=Qr();r.setHeader("X-Request-ID",v)}return r}function ct(t,e,n){return De.apply(this,arguments)}function De(){return De=en(Ie().mark(function t(e,n,r){var o;return Ie().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(typeof r.onBeforeRequest!="function"){u.next=3;break}return u.next=3,r.onBeforeRequest(e);case 3:return u.next=5,e.send(n);case 5:if(o=u.sent,typeof r.onAfterResponse!="function"){u.next=9;break}return u.next=9,r.onAfterResponse(e,o);case 9:return u.abrupt("return",o);case 10:case"end":return u.stop()}},t)})),De.apply(this,arguments)}function cn(){var t=!0;return typeof navigator<"u"&&navigator.onLine===!1&&(t=!1),t}function pt(t,e,n){return n.retryDelays==null||e>=n.retryDelays.length||t.originalRequest==null?!1:n&&typeof n.onShouldRetry=="function"?n.onShouldRetry(t,e,n):Kt(t)}function Kt(t){var e=t.originalResponse?t.originalResponse.getStatus():0;return(!ee(e,400)||e===409||e===423)&&cn()}function ht(t,e){return new Jr(e,t).toString()}function pn(t,e){for(var n=Math.floor(t/e),r=[],o=0;o<e;o++)r.push({start:n*o,end:n*(o+1)});return r[e-1].end=t,r}xe.defaultOptions=fn;var Xt=function(){return typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative"};function hn(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.responseType="blob",r.onload=function(){var o=r.response;e(o)},r.onerror=function(o){n(o)},r.open("GET",t),r.send()})}var dn=function(){return typeof window<"u"&&(typeof window.PhoneGap<"u"||typeof window.Cordova<"u"||typeof window.cordova<"u")};function yn(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(){var o=new Uint8Array(r.result);e({value:o})},r.onerror=function(o){n(o)},r.readAsArrayBuffer(t)})}function pe(t){"@babel/helpers - typeof";return pe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(t)}function mn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,gn(r.key),r)}}function vn(t,e,n){return e&&dt(t.prototype,e),n&&dt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function gn(t){var e=bn(t,"string");return pe(e)=="symbol"?e:e+""}function bn(t,e){if(pe(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(pe(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var yt=function(){function t(e){mn(this,t),this._file=e,this.size=e.size}return vn(t,[{key:"slice",value:function(n,r){if(dn())return yn(this._file.slice(n,r));var o=this._file.slice(n,r),l=r>=this.size;return Promise.resolve({value:o,done:l})}},{key:"close",value:function(){}}])}();function he(t){"@babel/helpers - typeof";return he=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},he(t)}function _n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Sn(r.key),r)}}function wn(t,e,n){return e&&mt(t.prototype,e),n&&mt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Sn(t){var e=Un(t,"string");return he(e)=="symbol"?e:e+""}function Un(t,e){if(he(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(he(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function vt(t){return t===void 0?0:t.size!==void 0?t.size:t.length}function xn(t,e){if(t.concat)return t.concat(e);if(t instanceof Blob)return new Blob([t,e],{type:t.type});if(t.set){var n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n}throw new Error("Unknown data type")}var Pn=function(){function t(e){_n(this,t),this._buffer=void 0,this._bufferOffset=0,this._reader=e,this._done=!1}return wn(t,[{key:"slice",value:function(n,r){return n<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(n,r)}},{key:"_readUntilEnoughDataOrDone",value:function(n,r){var o=this,l=r<=this._bufferOffset+vt(this._buffer);if(this._done||l){var u=this._getDataFromBuffer(n,r),c=u==null?this._done:!1;return Promise.resolve({value:u,done:c})}return this._reader.read().then(function(f){var y=f.value,v=f.done;return v?o._done=!0:o._buffer===void 0?o._buffer=y:o._buffer=xn(o._buffer,y),o._readUntilEnoughDataOrDone(n,r)})}},{key:"_getDataFromBuffer",value:function(n,r){n>this._bufferOffset&&(this._buffer=this._buffer.slice(n-this._bufferOffset),this._bufferOffset=n);var o=vt(this._buffer)===0;return this._done&&o?null:this._buffer.slice(0,r-n)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function W(t){"@babel/helpers - typeof";return W=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},W(t)}function Fe(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */Fe=function(){return e};var t,e={},n=Object.prototype,r=n.hasOwnProperty,o=Object.defineProperty||function(s,i,a){s[i]=a.value},l=typeof Symbol=="function"?Symbol:{},u=l.iterator||"@@iterator",c=l.asyncIterator||"@@asyncIterator",f=l.toStringTag||"@@toStringTag";function y(s,i,a){return Object.defineProperty(s,i,{value:a,enumerable:!0,configurable:!0,writable:!0}),s[i]}try{y({},"")}catch{y=function(a,p,d){return a[p]=d}}function v(s,i,a,p){var d=i&&i.prototype instanceof T?i:T,h=Object.create(d.prototype),b=new G(p||[]);return o(h,"_invoke",{value:z(s,a,b)}),h}function m(s,i,a){try{return{type:"normal",arg:s.call(i,a)}}catch(p){return{type:"throw",arg:p}}}e.wrap=v;var E="suspendedStart",X="suspendedYield",$="executing",I="completed",x={};function T(){}function O(){}function k(){}var A={};y(A,u,function(){return this});var M=Object.getPrototypeOf,F=M&&M(M(Y([])));F&&F!==n&&r.call(F,u)&&(A=F);var g=k.prototype=T.prototype=Object.create(A);function P(s){["next","throw","return"].forEach(function(i){y(s,i,function(a){return this._invoke(i,a)})})}function U(s,i){function a(d,h,b,w){var S=m(s[d],s,h);if(S.type!=="throw"){var C=S.arg,R=C.value;return R&&W(R)=="object"&&r.call(R,"__await")?i.resolve(R.__await).then(function(L){a("next",L,b,w)},function(L){a("throw",L,b,w)}):i.resolve(R).then(function(L){C.value=L,b(C)},function(L){return a("throw",L,b,w)})}w(S.arg)}var p;o(this,"_invoke",{value:function(h,b){function w(){return new i(function(S,C){a(h,b,S,C)})}return p=p?p.then(w,w):w()}})}function z(s,i,a){var p=E;return function(d,h){if(p===$)throw Error("Generator is already running");if(p===I){if(d==="throw")throw h;return{value:t,done:!0}}for(a.method=d,a.arg=h;;){var b=a.delegate;if(b){var w=D(b,a);if(w){if(w===x)continue;return w}}if(a.method==="next")a.sent=a._sent=a.arg;else if(a.method==="throw"){if(p===E)throw p=I,a.arg;a.dispatchException(a.arg)}else a.method==="return"&&a.abrupt("return",a.arg);p=$;var S=m(s,i,a);if(S.type==="normal"){if(p=a.done?I:X,S.arg===x)continue;return{value:S.arg,done:a.done}}S.type==="throw"&&(p=I,a.method="throw",a.arg=S.arg)}}}function D(s,i){var a=i.method,p=s.iterator[a];if(p===t)return i.delegate=null,a==="throw"&&s.iterator.return&&(i.method="return",i.arg=t,D(s,i),i.method==="throw")||a!=="return"&&(i.method="throw",i.arg=new TypeError("The iterator does not provide a '"+a+"' method")),x;var d=m(p,s.iterator,i.arg);if(d.type==="throw")return i.method="throw",i.arg=d.arg,i.delegate=null,x;var h=d.arg;return h?h.done?(i[s.resultName]=h.value,i.next=s.nextLoc,i.method!=="return"&&(i.method="next",i.arg=t),i.delegate=null,x):h:(i.method="throw",i.arg=new TypeError("iterator result is not an object"),i.delegate=null,x)}function ae(s){var i={tryLoc:s[0]};1 in s&&(i.catchLoc=s[1]),2 in s&&(i.finallyLoc=s[2],i.afterLoc=s[3]),this.tryEntries.push(i)}function V(s){var i=s.completion||{};i.type="normal",delete i.arg,s.completion=i}function G(s){this.tryEntries=[{tryLoc:"root"}],s.forEach(ae,this),this.reset(!0)}function Y(s){if(s||s===""){var i=s[u];if(i)return i.call(s);if(typeof s.next=="function")return s;if(!isNaN(s.length)){var a=-1,p=function d(){for(;++a<s.length;)if(r.call(s,a))return d.value=s[a],d.done=!1,d;return d.value=t,d.done=!0,d};return p.next=p}}throw new TypeError(W(s)+" is not iterable")}return O.prototype=k,o(g,"constructor",{value:k,configurable:!0}),o(k,"constructor",{value:O,configurable:!0}),O.displayName=y(k,f,"GeneratorFunction"),e.isGeneratorFunction=function(s){var i=typeof s=="function"&&s.constructor;return!!i&&(i===O||(i.displayName||i.name)==="GeneratorFunction")},e.mark=function(s){return Object.setPrototypeOf?Object.setPrototypeOf(s,k):(s.__proto__=k,y(s,f,"GeneratorFunction")),s.prototype=Object.create(g),s},e.awrap=function(s){return{__await:s}},P(U.prototype),y(U.prototype,c,function(){return this}),e.AsyncIterator=U,e.async=function(s,i,a,p,d){d===void 0&&(d=Promise);var h=new U(v(s,i,a,p),d);return e.isGeneratorFunction(i)?h:h.next().then(function(b){return b.done?b.value:h.next()})},P(g),y(g,f,"Generator"),y(g,u,function(){return this}),y(g,"toString",function(){return"[object Generator]"}),e.keys=function(s){var i=Object(s),a=[];for(var p in i)a.push(p);return a.reverse(),function d(){for(;a.length;){var h=a.pop();if(h in i)return d.value=h,d.done=!1,d}return d.done=!0,d}},e.values=Y,G.prototype={constructor:G,reset:function(i){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(V),!i)for(var a in this)a.charAt(0)==="t"&&r.call(this,a)&&!isNaN(+a.slice(1))&&(this[a]=t)},stop:function(){this.done=!0;var i=this.tryEntries[0].completion;if(i.type==="throw")throw i.arg;return this.rval},dispatchException:function(i){if(this.done)throw i;var a=this;function p(C,R){return b.type="throw",b.arg=i,a.next=C,R&&(a.method="next",a.arg=t),!!R}for(var d=this.tryEntries.length-1;d>=0;--d){var h=this.tryEntries[d],b=h.completion;if(h.tryLoc==="root")return p("end");if(h.tryLoc<=this.prev){var w=r.call(h,"catchLoc"),S=r.call(h,"finallyLoc");if(w&&S){if(this.prev<h.catchLoc)return p(h.catchLoc,!0);if(this.prev<h.finallyLoc)return p(h.finallyLoc)}else if(w){if(this.prev<h.catchLoc)return p(h.catchLoc,!0)}else{if(!S)throw Error("try statement without catch or finally");if(this.prev<h.finallyLoc)return p(h.finallyLoc)}}}},abrupt:function(i,a){for(var p=this.tryEntries.length-1;p>=0;--p){var d=this.tryEntries[p];if(d.tryLoc<=this.prev&&r.call(d,"finallyLoc")&&this.prev<d.finallyLoc){var h=d;break}}h&&(i==="break"||i==="continue")&&h.tryLoc<=a&&a<=h.finallyLoc&&(h=null);var b=h?h.completion:{};return b.type=i,b.arg=a,h?(this.method="next",this.next=h.finallyLoc,x):this.complete(b)},complete:function(i,a){if(i.type==="throw")throw i.arg;return i.type==="break"||i.type==="continue"?this.next=i.arg:i.type==="return"?(this.rval=this.arg=i.arg,this.method="return",this.next="end"):i.type==="normal"&&a&&(this.next=a),x},finish:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var p=this.tryEntries[a];if(p.finallyLoc===i)return this.complete(p.completion,p.afterLoc),V(p),x}},catch:function(i){for(var a=this.tryEntries.length-1;a>=0;--a){var p=this.tryEntries[a];if(p.tryLoc===i){var d=p.completion;if(d.type==="throw"){var h=d.arg;V(p)}return h}}throw Error("illegal catch attempt")},delegateYield:function(i,a,p){return this.delegate={iterator:Y(i),resultName:a,nextLoc:p},this.method==="next"&&(this.arg=t),x}},e}function gt(t,e,n,r,o,l,u){try{var c=t[l](u),f=c.value}catch(y){n(y);return}c.done?e(f):Promise.resolve(f).then(r,o)}function En(t){return function(){var e=this,n=arguments;return new Promise(function(r,o){var l=t.apply(e,n);function u(f){gt(l,r,o,u,c,"next",f)}function c(f){gt(l,r,o,u,c,"throw",f)}u(void 0)})}}function On(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function bt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Rn(r.key),r)}}function kn(t,e,n){return e&&bt(t.prototype,e),n&&bt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Rn(t){var e=jn(t,"string");return W(e)=="symbol"?e:e+""}function jn(t,e){if(W(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(W(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Tn=function(){function t(){On(this,t)}return kn(t,[{key:"openFile",value:function(){var e=En(Fe().mark(function r(o,l){var u;return Fe().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!(Xt()&&o&&typeof o.uri<"u")){f.next=11;break}return f.prev=1,f.next=4,hn(o.uri);case 4:return u=f.sent,f.abrupt("return",new yt(u));case 8:throw f.prev=8,f.t0=f.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(f.t0));case 11:if(!(typeof o.slice=="function"&&typeof o.size<"u")){f.next=13;break}return f.abrupt("return",Promise.resolve(new yt(o)));case 13:if(typeof o.read!="function"){f.next=18;break}if(l=Number(l),Number.isFinite(l)){f.next=17;break}return f.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return f.abrupt("return",Promise.resolve(new Pn(o,l)));case 18:return f.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return f.stop()}},r,null,[[1,8]])}));function n(r,o){return e.apply(this,arguments)}return n}()}])}();function Cn(t,e){return Xt()?Promise.resolve(Ln(t,e)):Promise.resolve(["tus-br",t.name,t.type,t.size,t.lastModified,e.endpoint].join("-"))}function Ln(t,e){var n=t.exif?An(JSON.stringify(t.exif)):"noexif";return["tus-rn",t.name||"noname",t.size||"nosize",n,e.endpoint].join("/")}function An(t){var e=0;if(t.length===0)return e;for(var n=0;n<t.length;n++){var r=t.charCodeAt(n);e=(e<<5)-e+r,e&=e}return e}function de(t){"@babel/helpers - typeof";return de=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},de(t)}function Ve(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,In(r.key),r)}}function Ge(t,e,n){return e&&_t(t.prototype,e),n&&_t(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function In(t){var e=Dn(t,"string");return de(e)=="symbol"?e:e+""}function Dn(t,e){if(de(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(de(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Fn=function(){function t(){Ve(this,t)}return Ge(t,[{key:"createRequest",value:function(n,r){return new Nn(n,r)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),Nn=function(){function t(e,n){Ve(this,t),this._xhr=new XMLHttpRequest,this._xhr.open(e,n,!0),this._method=e,this._url=n,this._headers={}}return Ge(t,[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(n,r){this._xhr.setRequestHeader(n,r),this._headers[n]=r}},{key:"getHeader",value:function(n){return this._headers[n]}},{key:"setProgressHandler",value:function(n){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(r){r.lengthComputable&&n(r.loaded)})}},{key:"send",value:function(){var n=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null;return new Promise(function(o,l){n._xhr.onload=function(){o(new Hn(n._xhr))},n._xhr.onerror=function(u){l(u)},n._xhr.send(r)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Hn=function(){function t(e){Ve(this,t),this._xhr=e}return Ge(t,[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(n){return this._xhr.getResponseHeader(n)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function ye(t){"@babel/helpers - typeof";return ye=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ye(t)}function zn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function wt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,qn(r.key),r)}}function Bn(t,e,n){return e&&wt(t.prototype,e),n&&wt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function qn(t){var e=$n(t,"string");return ye(e)=="symbol"?e:e+""}function $n(t,e){if(ye(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(ye(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Ne=!1;try{Ne="localStorage"in window;var je="tusSupport",St=localStorage.getItem(je);localStorage.setItem(je,St),St===null&&localStorage.removeItem(je)}catch(t){if(t.code===t.SECURITY_ERR||t.code===t.QUOTA_EXCEEDED_ERR)Ne=!1;else throw t}var Mn=Ne,Vn=function(){function t(){zn(this,t)}return Bn(t,[{key:"findAllUploads",value:function(){var n=this._findEntries("tus::");return Promise.resolve(n)}},{key:"findUploadsByFingerprint",value:function(n){var r=this._findEntries("tus::".concat(n,"::"));return Promise.resolve(r)}},{key:"removeUpload",value:function(n){return localStorage.removeItem(n),Promise.resolve()}},{key:"addUpload",value:function(n,r){var o=Math.round(Math.random()*1e12),l="tus::".concat(n,"::").concat(o);return localStorage.setItem(l,JSON.stringify(r)),Promise.resolve(l)}},{key:"_findEntries",value:function(n){for(var r=[],o=0;o<localStorage.length;o++){var l=localStorage.key(o);if(l.indexOf(n)===0)try{var u=JSON.parse(localStorage.getItem(l));u.urlStorageKey=l,r.push(u)}catch{}}return r}}])}();function oe(t){"@babel/helpers - typeof";return oe=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},oe(t)}function Gn(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ut(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Zt(r.key),r)}}function Kn(t,e,n){return e&&Ut(t.prototype,e),n&&Ut(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function Xn(t,e,n){return e=Pe(e),Yn(t,Yt()?Reflect.construct(e,n||[],Pe(t).constructor):e.apply(t,n))}function Yn(t,e){if(e&&(oe(e)==="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return Zn(t)}function Zn(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(Yt=function(){return!!t})()}function Pe(t){return Pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(n){return n.__proto__||Object.getPrototypeOf(n)},Pe(t)}function Wn(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&He(t,e)}function He(t,e){return He=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,o){return r.__proto__=o,r},He(t,e)}function xt(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(t,o).enumerable})),n.push.apply(n,r)}return n}function te(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?xt(Object(n),!0).forEach(function(r){Jn(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):xt(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Jn(t,e,n){return e=Zt(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Zt(t){var e=Qn(t,"string");return oe(e)=="symbol"?e:e+""}function Qn(t,e){if(oe(t)!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(oe(r)!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}var Pt=te(te({},xe.defaultOptions),{},{httpStack:new Fn,fileReader:new Tn,urlStorage:Mn?new Vn:new Or,fingerprint:Cn}),eo=function(t){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:null,r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Gn(this,e),r=te(te({},Pt),r),Xn(this,e,[n,r])}return Wn(e,t),Kn(e,null,[{key:"terminate",value:function(r){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return o=te(te({},Pt),o),xe.terminate(r,o)}}])}(xe);const to={components:{Footer:sr,Navbar:ur,Sidebar:fr},setup(){const t=Qt(),e=er(),n=K(null),r=e.params.courseId,o=e.params.chapterId,l=K(!1),u=K(0),c=K(!1),f=K(""),y=K({title:"",description:"",status:"",pdf_file_url:null,vimeo_id:null,player_embed_url:"",manage_link:"",vimeo_status:"",notes:[{time:"",content:""}]}),v=()=>{y.value.notes.push({time:"",content:""}),lr(()=>{const g=document.querySelector(".notes-container");g.scrollTo({top:g.scrollHeight,behavior:"smooth"})})},m=g=>{y.value.notes.splice(g,1)},E=()=>{try{J.removeVimeo({chapterId:o}),y.value.vimeo_id=null,y.value.player_embed_url="",y.value.manage_link="",y.value.vimeo_status=""}catch(g){console.log(g)}},X=async g=>{const P=g.target.files[0];if(P)try{c.value=!0,T.value=!0,f.value="正在獲取上傳憑證...";const U=await J.getVimeoID(o,{size:P.size}),z=new eo(P,{uploadUrl:U.upload_link,headers:{Accept:"application/vnd.vimeo.*+json;version=3.4"},method:"PUT",chunkSize:512e4,onError:D=>{f.value=`上傳失敗: ${D.message}`,g.target.value=""},onProgress:D=>{u.value=D/P.size*100,f.value=`上傳中: ${u.value.toFixed(1)}%`},onSuccess:()=>{y.value.vimeo_id=U.vimeo_id,y.value.player_embed_url=U.player_embed_url,y.value.manage_link=U.manage_link,J.changeVimeoStatus({vimeoID:y.value.vimeo_id}),f.value="上傳完成",g.target.value="",T.value=!1}});f.value="開始上傳資料...",z.start()}catch(U){f.value=`上傳失敗: ${U.message}`,g.target.value=""}finally{c.value=!1,T.value=!1,setTimeout(()=>{u.value=0},3e3)}},$=async()=>{try{const g=await J.getChapter(r,o);y.value=g}catch(g){console.error("獲取章節數據失敗:",g),alert("獲取章節數據失敗")}},I=g=>{const P=document.querySelector('iframe[src*="vimeo.com"]');if(!P)return;P.contentWindow.postMessage({method:"getCurrentTime"},"*");const U=z=>{if(z.origin.includes("vimeo.com")&&z.data&&typeof z.data.value=="number"){const D=Math.floor(z.data.value),ae=String(Math.floor(D/3600)).padStart(2,"0"),V=String(Math.floor(D%3600/60)).padStart(2,"0"),G=String(D%60).padStart(2,"0");y.value.notes[g].time=`${ae}:${V}:${G}`,window.removeEventListener("message",U)}};window.addEventListener("message",U)},x=async()=>{l.value=!0;try{const g=y.value.notes.filter(U=>U.content&&U.content.trim()!==""),P={...y.value,notes:g};await J.updateChapter(r,o,P),t.push(`/course/${e.params.courseId}/chapters`)}catch(g){console.error("保存章節失敗:",g),alert("保存章節失敗")}finally{l.value=!1}},T=K(!1),O=K(""),k=()=>{t.push(`/course/${r}/chapters`)},A=async g=>{const P=g.target.files[0];if(P&&P.type==="application/pdf")try{T.value=!0,O.value="PDF上傳中...";const U=await J.chapterPDFUpload(P);U.status&&(y.value.pdf_file_url=U.content,O.value="")}catch(U){O.value="PDF上傳失敗："+U.message,g.target.value=""}finally{T.value=!1,setTimeout(()=>{O.value=""},3e3)}else O.value="請上傳PDF格式的檔案",g.target.value=""},M=()=>{y.value.pdf_file_url=null};tr(async()=>{await $(),n.value=await cr.create(document.querySelector("#editor"),{removePlugins:["Markdown"],extraPlugins:[F],toolbar:["heading","|","bold","italic","link","bulletedList","numberedList","blockQuote","imageUpload"],heading:{options:[{model:"paragraph",title:"Paragraph",class:"ck-heading_paragraph"},{model:"heading1",view:"h2",title:"Heading 1",class:"ck-heading_heading1"},{model:"heading2",view:"h3",title:"Heading 2",class:"ck-heading_heading2"}]}}).then(g=>(g.model.document.on("change:data",()=>{y.value.description=g.getData()}),g)).catch(g=>{console.error(g)})});function F(g){g.plugins.get("FileRepository").createUploadAdapter=P=>new pr(P)}return{chapter:y,isUploading:T,isLoading:l,saveChapter:x,handlePdfUpload:A,handleVideoUpload:X,removePdf:M,removeVideo:E,addNote:v,removeNote:m,route:e,uploadStatusText:O,backToChapterList:k,videoUploadStatusText:f,setNoteTime:I}}},ro={class:"main-wrapper"},no={class:"page-wrapper"},oo={class:"page-content"},io={class:"row mb-4"},ao={class:"col-12 mx-auto stretch-card"},lo={class:"card"},so={class:"card-body"},uo={class:"row"},fo={class:"col-md-6"},co={key:0,class:"video-preview mb-3"},po=["src"],ho={key:1},yo={key:1,class:"mt-2"},mo=["href"],vo={class:"col-md-6 video-column"},go={key:0,class:"notes-container"},bo={class:"d-flex align-items-center gap-2 mb-2"},_o=["onUpdate:modelValue"],wo=["onClick"],So=["onClick"],Uo=["onUpdate:modelValue"],xo={key:1,class:"notes-container"},Po={key:2,class:"text-center text-danger"},Eo={class:"mb-3"},Oo={class:"mb-3"},ko=["innerHTML"],Ro={class:"mb-3"},jo={key:0,class:"mt-2"},To=["href"],Co={class:"d-flex justify-content-end"};function Lo(t,e,n,r,o,l){const u=me("Sidebar"),c=me("Navbar"),f=me("router-link"),y=me("Footer");return N(),H("div",ro,[ve(u),_("div",no,[ve(c),_("div",oo,[_("div",io,[_("div",ao,[_("div",lo,[_("div",so,[e[13]||(e[13]=_("h6",{class:"card-title"},"編輯章節",-1)),_("div",uo,[_("div",fo,[r.chapter.vimeo_id?(N(),H("div",co,[r.chapter.vimeo_status=="vimeo_ready"?(N(),H("iframe",{key:0,src:r.chapter.player_embed_url,width:"100%",height:"600",frameborder:"0",allow:"autoplay; fullscreen; picture-in-picture; clipboard-write; encrypted-media",title:"Untitled"},null,8,po)):(N(),H("p",ho,"已上傳Vimeo，Vimeo影片處理中，您可以繼續編輯"))])):ge("",!0),_("input",{type:"file",class:"form-control",accept:".mp4,.mov",onChange:e[0]||(e[0]=(...v)=>r.handleVideoUpload&&r.handleVideoUpload(...v))},null,32),Oe(" "+Xe(r.videoUploadStatusText)+" ",1),r.chapter.vimeo_id?(N(),H("div",yo,[_("button",{type:"button",class:"btn btn-danger btn-sm",onClick:e[1]||(e[1]=(...v)=>r.removeVideo&&r.removeVideo(...v))}," 移除 "),_("a",{href:`https://vimeo.com${r.chapter.manage_link}`,target:"_blank",class:"m-2 btn btn-info btn-sm"},e[6]||(e[6]=[_("i",{class:"material-icons align-middle me-1"},"edit",-1),Oe(" Vimeo編輯 ")]),8,mo)])):ge("",!0)]),_("div",vo,[r.chapter.notes.length>0?(N(),H("div",go,[(N(!0),H(rr,null,nr(r.chapter.notes,(v,m)=>(N(),H("div",{key:m,class:"mb-3 p-2 border-bottom"},[_("div",bo,[ke(_("input",{type:"text",class:"form-control flex-grow-0","onUpdate:modelValue":E=>v.time=E,placeholder:"時間",style:{width:"120px"}},null,8,_o),[[Re,v.time]]),_("button",{class:"btn btn-outline-secondary btn-sm",onClick:E=>r.setNoteTime(m)}," 設為目前時間 ",8,wo),_("button",{class:"btn btn-outline-danger btn-sm",onClick:E=>r.removeNote(m)}," 刪除 ",8,So)]),ke(_("textarea",{"onUpdate:modelValue":E=>v.content=E,class:"form-control w-100",rows:"3",placeholder:"筆記內容"},null,8,Uo),[[Re,v.content]])]))),128))])):(N(),H("div",xo,e[7]||(e[7]=[_("div",{class:"d-flex align-items-center justify-content-center h-100 text-muted"},[_("h3",{class:"empty_note"},"尚未新增筆記")],-1)]))),_("button",{class:or(["btn btn-outline-primary btn-sm my-2",r.chapter.vimeo_status!="vimeo_ready"?"btn-disabled":""]),type:"button",onClick:e[2]||(e[2]=(...v)=>r.addNote&&r.addNote(...v))}," 新增筆記 ",2),r.chapter.vimeo_status!="vimeo_ready"?(N(),H("small",Po,"影片正在處理中，無法新增筆記")):ge("",!0)])]),_("form",{onSubmit:e[5]||(e[5]=ir((...v)=>r.saveChapter&&r.saveChapter(...v),["prevent"]))},[_("div",Eo,[e[8]||(e[8]=_("label",{for:"title",class:"form-label"},"章節標題",-1)),ke(_("input",{type:"text",class:"form-control",id:"title","onUpdate:modelValue":e[3]||(e[3]=v=>r.chapter.title=v),required:""},null,512),[[Re,r.chapter.title]])]),_("div",Oo,[e[9]||(e[9]=_("label",{for:"editor",class:"form-label"},"章節內容",-1)),_("div",{id:"editor",innerHTML:r.chapter.description},null,8,ko)]),_("div",Ro,[e[10]||(e[10]=_("label",{class:"form-label"},"PDF檔案",-1)),_("input",{type:"file",class:"form-control",accept:".pdf",onChange:e[4]||(e[4]=(...v)=>r.handlePdfUpload&&r.handlePdfUpload(...v))},null,32),r.chapter.pdf_file_url&&!r.uploadStatusText?(N(),H("div",jo,[_("a",{href:r.chapter.pdf_file_url,target:"_blank"},"上傳檔案："+Xe(typeof r.chapter.pdf_file_url=="string"?r.chapter.pdf_file_url.split("/").pop():r.chapter.pdf_file_url.name),9,To)])):ge("",!0)]),_("div",Co,[ve(f,{to:`/course/${t.courseId}/chapters`,class:"btn btn-secondary me-2"},{default:ar(()=>e[11]||(e[11]=[Oe("取消")])),_:1},8,["to"]),e[12]||(e[12]=_("button",{type:"submit",class:"btn btn-primary"},"儲存",-1))])],32)])])])])]),ve(y)])])}const Fo=Jt(to,[["render",Lo],["__scopeId","data-v-e49d3e41"]]);export{Fo as default};
